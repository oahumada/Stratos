import{i as e}from"./apiHelper-CL77IM7H.js";import{R as o,H as s}from"./app-BQBzBluS.js";const r=o("auth",{state:()=>({user:null,isAuthenticated:!1,isLoading:!1,authInitialized:!1}),getters:{getUser:t=>t.user,getIsAuthenticated:t=>t.isAuthenticated,isAuthLoading:t=>t.isLoading,isAuthReady:t=>t.authInitialized},actions:{async initializeAuth(){if(!this.authInitialized){this.isLoading=!0;try{await e();const i=s().props.auth?.user;i?(this.user=i,this.isAuthenticated=!0,console.log("Auth initialized with user:",i.email)):this.logout(),this.authInitialized=!0}catch(t){console.error("Error initializing auth:",t),this.logout()}finally{this.isLoading=!1}}},async login(t){try{await e(),this.user=t,this.isAuthenticated=!0,this.authInitialized=!0,await new Promise(i=>setTimeout(i,100)),console.log("User logged in:",t.email)}catch(i){throw console.error("Login error:",i),i}},async reinitializeAfterLogin(t){try{this.isLoading=!0,await e(),await new Promise(i=>setTimeout(i,200)),this.user=t,this.isAuthenticated=!0,this.authInitialized=!0,console.log("Auth reinitialized after login:",t.email)}catch(i){throw console.error("Reinitialize error:",i),i}finally{this.isLoading=!1}},async ensureAuthValid(){return(!this.isAuthenticated||!this.authInitialized)&&(console.log("Auth not valid, reinitializing..."),await this.initializeAuth()),this.isAuthenticated},async handleAuthError(t){console.error("Auth error occurred:",t),(t.response?.status===401||t.response?.status===419)&&(console.log("Critical auth error, logging out..."),this.logout(),typeof window<"u"&&window.location.pathname!=="/login"&&(window.location.href="/login"))},logout(){this.user=null,this.isAuthenticated=!1,this.authInitialized=!1,typeof window<"u"&&(localStorage.removeItem("auth_token"),sessionStorage.removeItem("auth_token")),console.log("User logged out completely")},updateUser(t){this.isAuthenticated&&(t&&t.id?(this.user={...this.user,...t},console.log("User updated with ID:",t.id)):(console.error("Attempting to update user without ID:",t),this.user=t))}}});export{r as useAuthStore};
