import{u as W}from"./useApi-D-wG6FEk.js";import{d as G,o as Q,r as i,b as r,c as h,e as o,w as t,j as u,g as k,t as v,V as ee,W as te,f as p,i as N,k as z,v as R,m as ae,F as A,q as D,K as oe,J as le}from"./app-B4Q7DtOZ.js";import"./apiHelper-BLoNXDsG.js";const ne={class:"parent-scenario-selector"},ie={class:"d-flex flex-column align-end"},se={class:"d-flex align-center"},re=G({__name:"ParentScenarioSelector",props:{modelValue:{},organizationId:{},scopeType:{default:"organization"},scopeId:{default:null},disabled:{type:Boolean,default:!1},label:{default:"Escenario Padre (Opcional)"},hint:{default:"Selecciona un escenario padre para heredar skills obligatorias"}},emits:["update:modelValue"],setup(V,{emit:E}){const f=V,P=E,B=W(),y=z(!1),g=z([]),b=z("");Q(()=>{S()});const S=async()=>{y.value=!0;try{const s=new URLSearchParams({organization_id:f.organizationId.toString(),decision_status:"approved"});f.scopeType==="department"?s.append("scope_type","organization"):f.scopeType==="role_family"&&s.append("scope_type","department,organization");const a=await B.get(`/api/strategic-planning/scenarios?${s.toString()}`);g.value=a.data||[]}catch(s){console.error("Error loading parent candidates:",s),g.value=[]}finally{y.value=!1}},x=R(()=>{if(!b.value)return g.value;const s=b.value.toLowerCase();return g.value.filter(a=>a.name.toLowerCase().includes(s)||a.description?.toLowerCase().includes(s))}),d=R({get:()=>f.modelValue,set:s=>P("update:modelValue",s)}),n=s=>({organization:"mdi-domain",department:"mdi-office-building",role_family:"mdi-account-group"})[s]||"mdi-circle",T=s=>({organization:"primary",department:"info",role_family:"success"})[s]||"grey",I=s=>({draft:{color:"grey",text:"Borrador"},pending_approval:{color:"warning",text:"Pendiente"},approved:{color:"success",text:"Aprobado"},rejected:{color:"error",text:"Rechazado"}})[s]||{color:"grey",text:s};return(s,a)=>{const e=i("v-icon"),c=i("v-list-item-title"),C=i("v-list-item-subtitle"),U=i("v-chip"),$=i("v-list-item"),L=i("v-autocomplete"),O=i("v-alert");return r(),h("div",ne,[o(L,{modelValue:d.value,"onUpdate:modelValue":[a[0]||(a[0]=m=>d.value=m),a[2]||(a[2]=m=>s.$emit("update:modelValue",m))],search:b.value,"onUpdate:search":a[1]||(a[1]=m=>b.value=m),items:x.value,loading:y.value,disabled:V.disabled,label:V.label,hint:V.hint,"persistent-hint":"","item-title":"name","item-value":"id",variant:"outlined",clearable:"","prepend-inner-icon":"mdi-family-tree"},{item:t(({props:m,item:_})=>[o($,ee(te(m)),{prepend:t(()=>[o(e,{icon:n(_.raw.scope_type),color:T(_.raw.scope_type)},null,8,["icon","color"])]),append:t(()=>[k("div",ie,[o(U,{color:I(_.raw.decision_status).color,size:"x-small",variant:"flat",class:"mb-1"},{default:t(()=>[u(v(I(_.raw.decision_status).text),1)]),_:2},1032,["color"]),_.raw.children_count&&_.raw.children_count>0?(r(),p(U,{key:0,size:"x-small",variant:"outlined","prepend-icon":"mdi-file-tree"},{default:t(()=>[u(v(_.raw.children_count)+" hijos ",1)]),_:2},1024)):N("",!0)])]),default:t(()=>[o(c,null,{default:t(()=>[u(v(_.raw.name),1)]),_:2},1024),_.raw.description?(r(),p(C,{key:0,class:"text-wrap"},{default:t(()=>[u(v(_.raw.description),1)]),_:2},1024)):N("",!0)]),_:2},1040)]),selection:t(({item:m})=>[k("div",se,[o(e,{icon:n(m.raw.scope_type),color:T(m.raw.scope_type),size:"small",class:"mr-2"},null,8,["icon","color"]),k("span",null,v(m.raw.name),1)])]),"no-data":t(()=>[o($,null,{default:t(()=>[o(c,{class:"text-medium-emphasis"},{default:t(()=>[...a[3]||(a[3]=[u(" No hay escenarios aprobados disponibles como padre ",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue","search","items","loading","disabled","label","hint"]),V.modelValue?(r(),p(O,{key:0,type:"info",variant:"tonal",density:"compact",class:"mt-2","prepend-icon":"mdi-information"},{default:t(()=>[...a[4]||(a[4]=[u(" Las skills obligatorias del padre se sincronizar谩n autom谩ticamente ",-1)])]),_:1})):N("",!0)])}}}),ce=ae(re,[["__scopeId","data-v-c8df4b10"]]),de={key:1},ve=G({__name:"ScenarioCreateFromTemplate",emits:["created","close"],setup(V,{emit:E}){const f=E,P=W(),{showSuccess:B,showError:y}=le(),g=z(!1),b=z(!1),S=z([]),x=z(null),d=R(()=>S.value.find(a=>a.id===x.value)||null),n=z({name:"",description:"",time_horizon_weeks:52,estimated_budget:5e5,scenario_type:"growth",scope_type:"organization",parent_id:null}),T=async()=>{g.value=!0;try{const a=await P.get("/api/strategic-planning/scenario-templates");S.value=Array.isArray(a?.data)?a.data:Array.isArray(a)?a:[]}catch{y("No se pudieron cargar las plantillas")}finally{g.value=!1}},I=()=>{if(!d.value)return;n.value.name=d.value.name,n.value.description=d.value.description||"";const a=["succession","growth","cost_optimization","restructuring","capacity_planning"],e=d.value.scenario_type;n.value.scenario_type=a.includes(e)?e:"growth"},s=async()=>{if(!d.value){y("Selecciona una plantilla");return}if(!n.value.name.trim()){y("El nombre del escenario es obligatorio");return}b.value=!0;try{console.debug("instantiate-from-template payload",{customizations:n.value});const a=await P.post(`/api/strategic-planning/scenarios/${d.value.id}/instantiate-from-template`,{customizations:n.value}),e=a?.data?.id??a?.id??a?.scenario?.id??null;try{const c=a?.workforce_plan??a?.data?.workforce_plan??null;c?localStorage.setItem("wfp_prefill",JSON.stringify({name:c.name,scope_type:c.scope_type==="organization_wide"?"organization":c.scope_type==="department"?"department":"role_family",description:c.description,time_horizon_weeks:(c.planning_horizon_months||0)*4})):localStorage.setItem("wfp_prefill",JSON.stringify({name:n.value.name,scope_type:n.value.scope_type,description:n.value.description,time_horizon_weeks:n.value.time_horizon_weeks}))}catch(c){}B("Escenario creado correctamente"),e?oe.visit(`/strategic-planning/${e}`):(f("created"),f("close"))}catch(a){console.error("instantiate-from-template error:",a?.response?.data??a);const e=a?.response?.data?.message,c=a?.response?.data?.errors?Object.values(a.response.data.errors).flat()[0]:null;y(e||c||"No se pudo crear el escenario")}finally{b.value=!1}};return Q(()=>{T()}),(a,e)=>{const c=i("v-icon"),C=i("v-btn"),U=i("v-card-title"),$=i("v-skeleton-loader"),L=i("v-list-item-title"),O=i("v-list-item-subtitle"),m=i("v-list-item"),_=i("v-list"),w=i("v-col"),q=i("v-alert"),F=i("v-text-field"),J=i("v-select"),X=i("v-textarea"),j=i("v-row"),M=i("v-divider"),K=i("v-chip"),H=i("v-chip-group"),Y=i("v-card-actions"),Z=i("v-card");return r(),p(Z,null,{default:t(()=>[o(U,{class:"d-flex align-center justify-space-between"},{default:t(()=>[e[9]||(e[9]=k("div",null,[k("div",{class:"text-h6"},"Crear escenario desde plantilla"),k("div",{class:"text-caption text-medium-emphasis"}," Selecciona una plantilla y ajusta los par谩metros clave ")],-1)),o(C,{variant:"text",onClick:e[0]||(e[0]=l=>f("close"))},{default:t(()=>[o(c,null,{default:t(()=>[...e[8]||(e[8]=[u("mdi-close",-1)])]),_:1})]),_:1})]),_:1}),o(j,null,{default:t(()=>[o(w,{cols:"12",md:"4"},{default:t(()=>[g.value?(r(),p($,{key:0,type:"list-item-two-line",class:"mb-4"})):(r(),p(_,{key:1,density:"comfortable",nav:"",class:"rounded-lg border"},{default:t(()=>[(r(!0),h(A,null,D(S.value,l=>(r(),p(m,{key:l.id,value:l.id,active:l.id===x.value,onClick:ue=>{x.value=l.id,I()},class:"mb-1"},{prepend:t(()=>[o(c,{icon:l.icon||"mdi-shape-outline",color:"primary",class:"mr-2"},null,8,["icon"])]),default:t(()=>[o(L,null,{default:t(()=>[u(v(l.name),1)]),_:2},1024),o(O,null,{default:t(()=>[u(v(l.description),1)]),_:2},1024)]),_:2},1032,["value","active","onClick"]))),128))]),_:1}))]),_:1}),o(w,{cols:"12",md:"8"},{default:t(()=>[d.value?(r(),h("div",de,[o(j,null,{default:t(()=>[o(w,{cols:"12",md:"6"},{default:t(()=>[o(F,{modelValue:n.value.name,"onUpdate:modelValue":e[1]||(e[1]=l=>n.value.name=l),label:"Nombre del escenario",required:""},null,8,["modelValue"])]),_:1}),o(w,{cols:"12",md:"6"},{default:t(()=>[o(J,{modelValue:n.value.scenario_type,"onUpdate:modelValue":e[2]||(e[2]=l=>n.value.scenario_type=l),items:[{value:"succession",title:"Sucesi贸n"},{value:"growth",title:"Crecimiento"},{value:"cost_optimization",title:"Optimizaci贸n de Costos"},{value:"restructuring",title:"Reestructuraci贸n"},{value:"capacity_planning",title:"Planificaci贸n de Capacidad"}],label:"Tipo de escenario"},null,8,["modelValue"])]),_:1}),o(w,{cols:"12"},{default:t(()=>[o(X,{modelValue:n.value.description,"onUpdate:modelValue":e[3]||(e[3]=l=>n.value.description=l),label:"Descripci贸n",rows:"3","auto-grow":""},null,8,["modelValue"])]),_:1})]),_:1}),o(j,null,{default:t(()=>[o(w,{cols:"12",md:"4"},{default:t(()=>[o(F,{modelValue:n.value.time_horizon_weeks,"onUpdate:modelValue":e[4]||(e[4]=l=>n.value.time_horizon_weeks=l),modelModifiers:{number:!0},type:"number",label:"Horizonte (semanas)",min:"4",step:"4"},null,8,["modelValue"])]),_:1}),o(w,{cols:"12",md:"4"},{default:t(()=>[o(J,{modelValue:n.value.scope_type,"onUpdate:modelValue":e[5]||(e[5]=l=>n.value.scope_type=l),items:[{value:"organization",title:" Organizaci贸n"},{value:"department",title:" Departamento"},{value:"role_family",title:" Familia de Roles"}],label:"Nivel de alcance (Scope)",hint:"Define el nivel de jerarqu铆a del escenario","persistent-hint":""},null,8,["modelValue"])]),_:1})]),_:1}),n.value.scope_type!=="organization"?(r(),p(j,{key:0,class:"mt-2"},{default:t(()=>[o(w,{cols:"12"},{default:t(()=>[o(ce,{modelValue:n.value.parent_id,"onUpdate:modelValue":e[6]||(e[6]=l=>n.value.parent_id=l),"organization-id":1,"scope-type":n.value.scope_type,label:"Escenario Padre (Opcional)",hint:"Selecciona un escenario padre para heredar skills obligatorias"},null,8,["modelValue","scope-type"])]),_:1})]),_:1})):N("",!0),o(M,{class:"my-4"}),e[12]||(e[12]=k("h4",{class:"mb-2"},"Skills predefinidos",-1)),d.value?.config?.predefined_skills?(r(),p(H,{key:1,column:""},{default:t(()=>[(r(!0),h(A,null,D(d.value.config.predefined_skills,l=>(r(),p(K,{key:l.skill_id||l.skill,color:"primary",variant:"tonal",class:"ma-1"},{default:t(()=>[u(v(l.skill||"Skill #"+l.skill_id)+" - "+v(l.priority||"medium"),1)]),_:2},1024))),128))]),_:1})):(r(),p(q,{key:2,type:"warning",variant:"tonal",class:"mb-4"},{default:t(()=>[...e[11]||(e[11]=[u(" La plantilla no define skills preconfigurados. ",-1)])]),_:1})),e[13]||(e[13]=k("h4",{class:"mt-4 mb-2"},"KPIs sugeridos",-1)),d.value?.config?.kpis?(r(),p(H,{key:3,column:""},{default:t(()=>[(r(!0),h(A,null,D(d.value.config.kpis,l=>(r(),p(K,{key:l,color:"secondary",variant:"tonal",class:"ma-1"},{default:t(()=>[u(v(l),1)]),_:2},1024))),128))]),_:1})):N("",!0)])):(r(),p(q,{key:0,type:"info",class:"mb-4",variant:"tonal"},{default:t(()=>[...e[10]||(e[10]=[u(" Selecciona una plantilla para ver los detalles y continuar. ",-1)])]),_:1}))]),_:1})]),_:1}),o(M),o(Y,{class:"justify-end"},{default:t(()=>[o(C,{variant:"text",onClick:e[7]||(e[7]=l=>f("close"))},{default:t(()=>[...e[14]||(e[14]=[u("Cancelar",-1)])]),_:1}),o(C,{disabled:!d.value,color:"primary",loading:b.value,onClick:s,"prepend-icon":"mdi-rocket"},{default:t(()=>[...e[15]||(e[15]=[u(" Crear escenario ",-1)])]),_:1},8,["disabled","loading"])]),_:1})]),_:1})}}});export{ve as default};
