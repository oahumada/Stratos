import{d as ae,r as f,B as se,b as p,g as P,e as n,w as a,f as t,j as e,t as y,c as u,F as Z,s as X,k as w,J as Se,R as ze,o as we,D as vt,S as _t,m as ue,v as fe,U as te,i as z,V as ve,T as ft,p as ee,l as Me,L as Be,Y as _e,Z as gt,G as he,q as yt,$ as bt,H as Je,u as de,O as Te,_ as xt,K as Ue}from"./app-BQBzBluS.js";import{u as Ee}from"./useApi-DEBD0yG7.js";import kt from"./GenerateWizard-BP3pZ7PE.js";import ht from"./Index-DJ9Dsyfv.js";import"./apiHelper-CL77IM7H.js";import"./FieldHelp-CjJFB33a.js";import"./PreviewConfirm-CO0cbHnJ.js";import"./StepHorizon.vue_vue_type_script_setup_true_lang-BHLWtfJc.js";import"./StepIdentity-BzR0NobI.js";import"./StepIntent.vue_vue_type_script_setup_true_lang-RtHDyAIw.js";import"./StepResources.vue_vue_type_script_setup_true_lang-DXrRigoj.js";import"./StepSituation.vue_vue_type_script_setup_true_lang-Cc83bP0-.js";import"./transform-9n3FYwas.js";const wt={class:"text-h6"},$t={class:"text-caption"},Ct={key:0},Vt={key:1},St={class:"mb-3"},Et={class:"mb-3"},Nt=ae({__name:"IncubatedReviewModal",props:{modelValue:{type:Boolean,default:!1},item:{type:Object,default:null},scenarioId:{type:[Number,String],default:null}},emits:["update:modelValue","close","promoted"],setup(i,{emit:O}){const v=i,I=O,g=Ee(),{showSuccess:l,showError:_}=Se(),x=f(!1),s=f(!!v.modelValue);se(()=>v.modelValue,E=>{s.value=!!E}),se(s,E=>{I("update:modelValue",E)});function k(){v.item?.id&&(window.location.href=`/capabilities/${v.item.id}`)}async function M(){if(!(!v.scenarioId||!v.item?.id)){x.value=!0;try{const E=await g.post(`/api/strategic-planning/scenarios/${v.scenarioId}/capabilities/${v.item.id}/promote`);l("Capability promovida"),I("promoted",E?.data??null),I("close"),s.value=!1}catch(E){console.error(E),_("Error promoviendo capability")}finally{x.value=!1}}}return(E,d)=>{const G=p("v-card-title"),m=p("v-card-text"),c=p("v-spacer"),S=p("v-btn"),N=p("v-card-actions"),j=p("v-card"),C=p("v-dialog");return n(),P(C,{modelValue:s.value,"onUpdate:modelValue":d[1]||(d[1]=o=>s.value=o),"max-width":"800"},{default:a(()=>[t(j,null,{default:a(()=>[t(G,null,{default:a(()=>[e("div",null,[e("div",wt,"Revisi√≥n: "+y(i.item?.name),1),e("div",$t,y(i.item?.description),1)])]),_:1}),t(m,null,{default:a(()=>[i.item?(n(),u("div",Vt,[e("div",St,[d[2]||(d[2]=e("strong",null,"Competencias",-1)),e("ul",null,[(n(!0),u(Z,null,X(i.item.competencies||[],o=>(n(),u("li",{key:o.id},y(o.name),1))),128))])]),e("div",Et,[d[3]||(d[3]=e("strong",null,"Metadatos",-1)),e("pre",null,y(JSON.stringify(i.item,null,2)),1)])])):(n(),u("div",Ct,"No hay datos."))]),_:1}),t(N,null,{default:a(()=>[t(c),t(S,{text:"",onClick:d[0]||(d[0]=o=>E.$emit("close"))},{default:a(()=>[...d[4]||(d[4]=[w("Cerrar",-1)])]),_:1}),t(S,{color:"primary",onClick:k},{default:a(()=>[...d[5]||(d[5]=[w("Editar",-1)])]),_:1}),t(S,{color:"success",onClick:M,loading:x.value},{default:a(()=>[...d[6]||(d[6]=[w("Promover",-1)])]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])}}}),jt=ze("changeSet",()=>{const i=f(!1),O=f(null);return{loading:i,error:O,createChangeSet:async(s,k)=>{i.value=!0,O.value=null;try{const M=await fetch(`/api/strategic-planning/scenarios/${s}/change-sets`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(k)});if(!M.ok)throw new Error("Error creating ChangeSet");return await M.json()}catch(M){throw O.value=M.message||"Unknown error",M}finally{i.value=!1}},previewChangeSet:async s=>{i.value=!0,O.value=null;try{const k=await fetch(`/api/strategic-planning/change-sets/${s}/preview`);if(!k.ok)throw new Error("Error fetching preview");return await k.json()}catch(k){throw O.value=k.message||"Unknown error",k}finally{i.value=!1}},applyChangeSet:async(s,k)=>{i.value=!0,O.value=null;try{const M={method:"POST"};k&&(M.headers={"Content-Type":"application/json"},M.body=JSON.stringify(k));const E=await fetch(`/api/strategic-planning/change-sets/${s}/apply`,M);if(!E.ok)throw new Error("Error applying ChangeSet");return await E.json()}catch(M){throw O.value=M.message||"Unknown error",M}finally{i.value=!1}},canApplyChangeSet:async s=>{i.value=!0,O.value=null;try{const k=await fetch(`/api/strategic-planning/change-sets/${s}/can-apply`);if(!k.ok)throw new Error("Error checking permissions");return await k.json()}catch(k){throw O.value=k.message||"Unknown error",k}finally{i.value=!1}},approveChangeSet:async s=>{i.value=!0,O.value=null;try{const k=await fetch(`/api/strategic-planning/change-sets/${s}/approve`,{method:"POST"});if(!k.ok)throw new Error("Error approving ChangeSet");return await k.json()}catch(k){throw O.value=k.message||"Unknown error",k}finally{i.value=!1}},rejectChangeSet:async s=>{i.value=!0,O.value=null;try{const k=await fetch(`/api/strategic-planning/change-sets/${s}/reject`,{method:"POST"});if(!k.ok)throw new Error("Error rejecting ChangeSet");return await k.json()}catch(k){throw O.value=k.message||"Unknown error",k}finally{i.value=!1}}}}),It=ae({props:{id:{type:Number,required:!0},title:{type:String,default:"ChangeSet"}},setup(i,{emit:O}){const v=jt(),I=f(null),g=f(!1),l=f(!1),_=f([]),x=f({}),s=f({}),k=f(null),M=R=>{(R.key==="Escape"||R.key==="Esc")&&O("close")},E=async()=>{g.value=!0;try{const R=await v.previewChangeSet(i.id);I.value=R.preview??R.data??R;const V=I.value?.ops??[];_.value=V.map(()=>!1);try{const $=await v.canApplyChangeSet(i.id);l.value=$?.can_apply??$?.data?.can_apply??!1}catch{l.value=!1}}finally{g.value=!1}},d=R=>{if(!I.value||!Array.isArray(I.value.ops))return;const V=I.value.ops[R];V&&(V._reverted=!V._reverted,V._reverted?(x.value[R]=!0,I.value.ops=I.value.ops.map(($,K)=>x.value[K]?{...$,_ignored:!0}:$).filter($=>!$._ignored),_.value=I.value.ops.map(()=>!1)):(x.value={},E()))},G=R=>{_.value[R]=!_.value[R]},m=R=>{x.value[R]=!0,I.value&&Array.isArray(I.value.ops)&&(I.value.ops=I.value.ops.map((V,$)=>x.value[$]?{...V,_ignored:!0}:V).filter(V=>!V._ignored))},c=R=>{const V=I.value?.ops?.[R];if(!V)return;const $=JSON.stringify(V,null,2);navigator.clipboard?.writeText($).catch(()=>{})},S=R=>{s.value[R]=!s.value[R]},N=R=>R?R.startsWith("create")?"op-create":R.startsWith("update")?"op-update":R.startsWith("delete")||R.includes("sunset")?"op-delete":"op-default":"op-default",j=R=>R?R.startsWith("create")?"‚ûï":R.startsWith("update")?"‚úèÔ∏è":R.startsWith("delete")||R.includes("sunset")?"üóëÔ∏è":"‚öôÔ∏è":"‚öôÔ∏è",C=async()=>{g.value=!0;try{const R=Object.keys(x.value).filter($=>x.value[Number($)]).map($=>Number($)),V=R.length?{ignored_indexes:R}:void 0;await v.applyChangeSet(i.id,V),window.location.reload()}finally{g.value=!1}},o=async()=>{g.value=!0;try{await v.approveChangeSet(i.id),window.location.reload()}finally{g.value=!1}},W=async()=>{g.value=!0;try{await v.rejectChangeSet(i.id),window.location.reload()}finally{g.value=!1}};return we(()=>{vt(()=>{try{k.value?.focus()}catch{}window.addEventListener("keydown",M)})}),_t(()=>{window.removeEventListener("keydown",M)}),E(),{preview:I,loading:g,apply:C,canApply:l,approve:o,reject:W,collapsed:_,toggle:G,ignoreOp:m,copyOp:c,opClass:N,opIcon:j,revertOp:d,ignored:x,modalRef:k,showRaw:s,toggleRaw:S}}}),At=["aria-labelledby"],Rt=["id"],Ot={key:0},Tt={class:"op-header"},Ut={class:"op-badge"},Mt={class:"op-type"},zt={class:"op-actions"},qt=["onClick","aria-expanded","aria-controls"],Pt=["onClick","aria-label"],Dt=["onClick","aria-label"],Lt=["id"],Bt={key:0},Jt={class:"op-payload-summary"},Ht={key:0},Gt={key:1},Ft={key:1},Wt={class:"op-row-actions"},Kt=["onClick","aria-label"],Qt=["onClick","aria-label"],Zt={key:0,class:"op-reverted"},Yt={key:1},Xt={key:0,class:"no-ops"},ea={key:1},ta={key:2},aa={class:"actions"},na=["disabled"],la=["disabled"],oa=["disabled"];function sa(i,O,v,I,g,l){const _=p("v-alert");return n(),u("div",{class:"changeset-modal",role:"dialog","aria-modal":"true","aria-labelledby":`changeset-title-${i.id}`,tabindex:"-1",ref:"modalRef"},[e("h3",{id:`changeset-title-${i.id}`},y(i.title),9,Rt),i.preview&&i.preview.ops&&i.preview.ops.length?(n(),u("div",Ot,[e("p",null,[O[4]||(O[4]=e("strong",null,"Operaciones:",-1)),w(" "+y(i.preview.ops.length),1)]),e("ol",null,[(n(!0),u(Z,null,X(i.preview.ops,(x,s)=>(n(),u("li",{key:s,class:fe(i.opClass(x.type))},[e("div",Tt,[e("div",null,[e("span",Ut,y(i.opIcon(x.type)),1),e("strong",null,y(s+1)+".",1),e("em",Mt,y(x.type),1)]),e("div",zt,[e("button",{type:"button",onClick:k=>i.toggle(s),"aria-expanded":!i.collapsed[s],"aria-controls":`op-details-${s}`},y(i.collapsed[s]?"Mostrar":"Ocultar"),9,qt),e("button",{type:"button",onClick:k=>i.ignoreOp(s),"aria-label":`Ignorar operaci√≥n ${s+1}: ${x.type}`},"Ignorar",8,Pt),e("button",{type:"button",onClick:k=>i.revertOp(s),"aria-label":i.preview.ops[s]&&i.preview.ops[s]._reverted?`Deshacer revertir operaci√≥n ${s+1}`:`Revertir operaci√≥n ${s+1}`},y(i.preview.ops[s]&&i.preview.ops[s]._reverted?"Deshacer Revertir":"Revertir"),9,Dt)])]),t(ft,{name:"fade"},{default:a(()=>[te(e("div",{class:"op-details",id:`op-details-${s}`},[x.payload&&typeof x.payload=="object"&&!i.showRaw[s]?(n(),u("div",Bt,[e("div",Jt,[(n(!0),u(Z,null,X(x.payload,(k,M)=>(n(),u("div",{key:M,class:"payload-row"},[e("strong",null,y(M)+":",1),typeof k=="object"?(n(),u("span",Ht,y(JSON.stringify(k)),1)):(n(),u("span",Gt,y(String(k)),1))]))),128))])])):(n(),u("pre",Ft,y(JSON.stringify(x,null,2)),1)),e("div",Wt,[e("button",{type:"button",onClick:k=>i.copyOp(s),"aria-label":`Copiar operaci√≥n ${s+1}`},"Copiar op",8,Kt),e("button",{type:"button",onClick:k=>i.toggleRaw(s),"aria-label":`Alternar vista JSON ${s+1}`},y(i.showRaw[s]?"Ocultar JSON":"Ver JSON"),9,Qt),x._reverted?(n(),u("span",Zt,"Revertida")):z("",!0)])],8,Lt),[[ve,!i.collapsed[s]]])]),_:2},1024)],2))),128))])])):(n(),u("div",Yt,[i.preview&&i.preview.ops&&i.preview.ops.length===0?(n(),u("div",Xt,[t(_,{type:"info",variant:"tonal"},{default:a(()=>[...O[5]||(O[5]=[w("No hay operaciones en este ChangeSet.",-1)])]),_:1})])):i.preview?(n(),u("pre",ea,y(JSON.stringify(i.preview,null,2)),1)):(n(),u("div",ta,"No preview available"))])),e("div",aa,[e("button",{onClick:O[0]||(O[0]=x=>i.$emit("close"))},"Cerrar"),e("button",{onClick:O[1]||(O[1]=(...x)=>i.apply&&i.apply(...x)),disabled:i.loading||!i.canApply},"Aplicar",8,na),i.canApply?(n(),u("button",{key:0,onClick:O[2]||(O[2]=(...x)=>i.approve&&i.approve(...x)),disabled:i.loading},"Aprobar",8,la)):z("",!0),i.canApply?(n(),u("button",{key:1,onClick:O[3]||(O[3]=(...x)=>i.reject&&i.reject(...x)),disabled:i.loading},"Rechazar",8,oa)):z("",!0)])],8,At)}const ia=ue(It,[["render",sa],["__scopeId","data-v-54b12d1e"]]),ra={class:"status-timeline"},da={class:"text-caption text-medium-emphasis ml-2"},ua=ae({__name:"StatusTimeline",props:{scenarioId:{}},setup(i,{expose:O}){const v=i,I=Ee(),{showError:g}=Se(),l=f(!1),_=f([]),x=f(!1),s=async()=>{l.value=!0;try{const c=await I.get(`/api/strategic-planning/scenarios/${v.scenarioId}`);_.value=c.data?.status_events||[]}catch{g("Error al cargar historial de cambios")}finally{l.value=!1}},k=()=>{x.value=!0,_.value.length===0&&s()},M=ee(()=>[..._.value].sort((c,S)=>new Date(S.created_at).getTime()-new Date(c.created_at).getTime())),E=c=>new Date(c).toLocaleDateString("es-ES",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),d=c=>c.to_decision_status==="approved"?"mdi-check-circle":c.to_decision_status==="rejected"?"mdi-close-circle":c.to_decision_status==="pending_approval"?"mdi-clock-alert":c.to_execution_status==="in_progress"?"mdi-play-circle":c.to_execution_status==="paused"?"mdi-pause-circle":c.to_execution_status==="completed"?"mdi-check-bold":"mdi-arrow-right-circle",G=c=>c.to_decision_status==="approved"?"success":c.to_decision_status==="rejected"?"error":c.to_decision_status==="pending_approval"?"warning":c.to_execution_status==="in_progress"?"primary":c.to_execution_status==="paused"?"warning":c.to_execution_status==="completed"?"success":"grey",m=c=>{let S="";return c.from_decision_status&&c.to_decision_status?S+=`Estado de decisi√≥n: ${c.from_decision_status} ‚Üí ${c.to_decision_status}`:c.to_decision_status&&(S+=`Estado de decisi√≥n: ${c.to_decision_status}`),c.from_execution_status&&c.to_execution_status?(S&&(S+=" | "),S+=`Estado de ejecuci√≥n: ${c.from_execution_status} ‚Üí ${c.to_execution_status}`):c.to_execution_status&&(S&&(S+=" | "),S+=`Estado de ejecuci√≥n: ${c.to_execution_status}`),S||"Cambio de estado"};return O({openTimeline:k}),(c,S)=>{const N=p("v-btn"),j=p("v-icon"),C=p("v-spacer"),o=p("v-chip"),W=p("v-card-title"),R=p("v-divider"),V=p("v-alert"),$=p("v-card-subtitle"),K=p("v-card-text"),b=p("v-card"),T=p("v-timeline-item"),A=p("v-timeline"),D=p("v-progress-linear"),U=p("v-card-actions"),B=p("v-dialog");return n(),u("div",ra,[t(N,{color:"grey-darken-1",variant:"outlined","prepend-icon":"mdi-timeline-clock",onClick:k},{default:a(()=>[...S[2]||(S[2]=[w(" Ver Historial de Cambios ",-1)])]),_:1}),t(B,{modelValue:x.value,"onUpdate:modelValue":S[1]||(S[1]=Q=>x.value=Q),"max-width":"800",scrollable:""},{default:a(()=>[t(b,null,{default:a(()=>[t(W,{class:"d-flex align-center"},{default:a(()=>[t(j,{icon:"mdi-timeline-clock",class:"mr-2"}),S[3]||(S[3]=w(" Audit Trail - Historial de Cambios de Estado ",-1)),t(C),t(o,{color:"primary",variant:"flat",size:"small"},{default:a(()=>[w(y(_.value.length)+" eventos ",1)]),_:1})]),_:1}),t(R),t(K,{style:{"max-height":"600px"}},{default:a(()=>[_.value.length===0&&!l.value?(n(),P(V,{key:0,type:"info",variant:"tonal"},{default:a(()=>[...S[4]||(S[4]=[w(" No hay eventos de cambio de estado registrados ",-1)])]),_:1})):z("",!0),t(A,{side:"end",align:"start",density:"compact","line-inset":"12"},{default:a(()=>[(n(!0),u(Z,null,X(M.value,Q=>(n(),P(T,{key:Q.id,"dot-color":G(Q),size:"small"},{icon:a(()=>[t(j,{icon:d(Q),size:"small"},null,8,["icon"])]),default:a(()=>[t(b,{elevation:"2",class:"mb-3"},{default:a(()=>[t(W,{class:"text-body-1 pb-2"},{default:a(()=>[w(y(m(Q)),1)]),_:2},1024),t($,{class:"pb-2"},{default:a(()=>[t(j,{icon:"mdi-account",size:"x-small",class:"mr-1"}),w(" "+y(Q.changed_by.name)+" ",1),e("span",da," ¬∑ "+y(E(Q.created_at)),1)]),_:2},1024),Q.notes?(n(),P(K,{key:0},{default:a(()=>[t(V,{type:"info",variant:"outlined",density:"compact",class:"text-body-2"},{default:a(()=>[S[5]||(S[5]=e("strong",null,"Notas:",-1)),w(" "+y(Q.notes),1)]),_:2},1024)]),_:2},1024)):(n(),P(K,{key:1,class:"text-caption text-medium-emphasis"},{default:a(()=>[...S[6]||(S[6]=[w(" Sin notas adicionales ",-1)])]),_:1}))]),_:2},1024)]),_:2},1032,["dot-color"]))),128))]),_:1}),l.value?(n(),P(D,{key:1,indeterminate:"",color:"primary",class:"mt-4"})):z("",!0)]),_:1}),t(R),t(U,null,{default:a(()=>[t(C),t(N,{variant:"text",onClick:S[0]||(S[0]=Q=>x.value=!1)},{default:a(()=>[...S[7]||(S[7]=[w("Cerrar",-1)])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])])}}}),ca=ue(ua,[["__scopeId","data-v-02d3fcfe"]]),ma={class:"d-flex align-center"},pa={class:"d-flex flex-column flex-grow-1"},va={class:"d-flex align-center"},_a={class:"text-h6"},fa={class:"text-caption text-medium-emphasis mt-1"},ga={key:0},ya={class:"text-body-2 mb-2"},ba={class:"d-flex flex-wrap gap-2"},xa=ae({__name:"VersionHistoryModal",props:{scenarioId:{},versionGroupId:{},currentVersion:{}},emits:["versionSelected"],setup(i,{expose:O,emit:v}){const I=i,g=v,l=Ee(),{showSuccess:_,showError:x}=Se(),s=f(!1),k=f(!1),M=f([]),E=f([]),d=f(!1),G=()=>{s.value=!0,m()},m=async()=>{k.value=!0;try{const V=await l.get(`/api/strategic-planning/scenarios/${I.scenarioId}/versions`);M.value=V.data?.versions||[]}catch{x("Error al cargar versiones")}finally{k.value=!1}},c=ee(()=>[...M.value].sort((V,$)=>$.version_number-V.version_number)),S=V=>({draft:"grey",pending_approval:"warning",approved:"success",rejected:"error"})[V]||"grey",N=V=>({planned:"grey-lighten-1",in_progress:"primary",paused:"warning",completed:"success"})[V]||"grey",j=V=>new Date(V).toLocaleDateString("es-ES",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),C=V=>{g("versionSelected",V),s.value=!1},o=V=>{const $=E.value.indexOf(V);$>-1?E.value.splice($,1):E.value.length<2&&E.value.push(V)},W=()=>{E.value.length===2&&(d.value=!0,_("Comparando versiones..."))},R=ee(()=>E.value.length===2);return O({openDialog:G}),(V,$)=>{const K=p("v-icon"),b=p("v-spacer"),T=p("v-chip"),A=p("v-card-title"),D=p("v-divider"),U=p("v-alert"),B=p("v-btn"),Q=p("v-checkbox"),F=p("v-card-text"),q=p("v-card-actions"),$e=p("v-card"),ge=p("v-timeline-item"),ye=p("v-timeline"),ke=p("v-progress-linear"),be=p("v-dialog");return n(),P(be,{modelValue:s.value,"onUpdate:modelValue":$[1]||($[1]=J=>s.value=J),"max-width":"900",scrollable:""},{default:a(()=>[t($e,null,{default:a(()=>[t(A,{class:"d-flex align-center"},{default:a(()=>[t(K,{icon:"mdi-history",class:"mr-2"}),$[2]||($[2]=w(" Historial de Versiones ",-1)),t(b),t(T,{color:"primary",variant:"flat",size:"small","prepend-icon":"mdi-information"},{default:a(()=>[w(" Total: "+y(M.value.length)+" versiones ",1)]),_:1})]),_:1}),t(D),t(F,{style:{"max-height":"600px"}},{default:a(()=>[M.value.length===0&&!k.value?(n(),P(U,{key:0,type:"info",variant:"tonal",class:"mb-4"},{default:a(()=>[...$[3]||($[3]=[w(" No hay versiones anteriores. Esta es la primera versi√≥n del escenario. ",-1)])]),_:1})):z("",!0),E.value.length>0?(n(),P(U,{key:1,type:"warning",variant:"outlined",dismissible:"",class:"mb-4"},{default:a(()=>[e("div",ma,[e("span",null,y(E.value.length)+" versiones seleccionadas para comparar",1),t(b),R.value?(n(),P(B,{key:0,color:"primary",size:"small",variant:"elevated","prepend-icon":"mdi-compare",onClick:W},{default:a(()=>[...$[4]||($[4]=[w(" Comparar ",-1)])]),_:1})):z("",!0)])]),_:1})):z("",!0),t(ye,{side:"end",density:"compact","line-inset":"8"},{default:a(()=>[(n(!0),u(Z,null,X(c.value,J=>(n(),P(ge,{key:J.id,"dot-color":J.is_current_version?"primary":"grey",size:"small"},{icon:a(()=>[t(K,{icon:J.is_current_version?"mdi-star":"mdi-circle",size:"small"},null,8,["icon"])]),default:a(()=>[t($e,{elevation:J.is_current_version?4:1,class:fe([{"border-primary":J.is_current_version},"mb-3"])},{default:a(()=>[t(A,{class:"d-flex align-center"},{default:a(()=>[e("div",pa,[e("div",va,[t(T,{color:J.is_current_version?"primary":"grey",size:"small",variant:"flat",class:"mr-2"},{default:a(()=>[w(" v"+y(J.version_number),1)]),_:2},1032,["color"]),e("span",_a,y(J.name),1)]),e("div",fa,[w(" Creado: "+y(j(J.created_at))+" ",1),J.owner?(n(),u("span",ga," ¬∑ "+y(J.owner.name),1)):z("",!0)])]),t(Q,{"model-value":E.value.includes(J.id),disabled:!R.value&&!E.value.includes(J.id),density:"compact","hide-details":"","onUpdate:modelValue":Ce=>o(J.id)},null,8,["model-value","disabled","onUpdate:modelValue"])]),_:2},1024),J.description?(n(),P(F,{key:0},{default:a(()=>[e("p",ya,y(J.description),1)]),_:2},1024)):z("",!0),t(F,null,{default:a(()=>[e("div",ba,[t(T,{color:S(J.decision_status),size:"small",variant:"tonal"},{default:a(()=>[w(y(J.decision_status),1)]),_:2},1032,["color"]),t(T,{color:N(J.execution_status),size:"small",variant:"outlined"},{default:a(()=>[w(y(J.execution_status),1)]),_:2},1032,["color"]),J.is_current_version?(n(),P(T,{key:0,color:"primary",size:"small","prepend-icon":"mdi-star"},{default:a(()=>[...$[5]||($[5]=[w(" Actual ",-1)])]),_:1})):z("",!0)])]),_:2},1024),t(q,null,{default:a(()=>[J.id!==i.scenarioId?(n(),P(B,{key:0,color:"primary",variant:"text",size:"small","prepend-icon":"mdi-open-in-new",onClick:Ce=>C(J.id)},{default:a(()=>[...$[6]||($[6]=[w(" Ver esta versi√≥n ",-1)])]),_:1},8,["onClick"])):(n(),P(B,{key:1,color:"grey",variant:"text",size:"small",disabled:""},{default:a(()=>[...$[7]||($[7]=[w(" Versi√≥n actual ",-1)])]),_:1}))]),_:2},1024)]),_:2},1032,["elevation","class"])]),_:2},1032,["dot-color"]))),128))]),_:1}),k.value?(n(),P(ke,{key:2,indeterminate:"",color:"primary",class:"mt-4"})):z("",!0)]),_:1}),t(D),t(q,null,{default:a(()=>[t(b),t(B,{variant:"text",onClick:$[0]||($[0]=J=>s.value=!1)},{default:a(()=>[...$[8]||($[8]=[w("Cerrar",-1)])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])}}}),ka=ue(xa,[["__scopeId","data-v-e78a3aa4"]]),He=ze("roleCompetency",()=>{const i=f(null),O=f(""),v=f(12),I=f([]),g=f([]),l=f([]),_=f(!1),x=f(null),s=f(null),k=ee(()=>I.value.map(N=>({roleId:N.role_id,roleName:N.role_name,fte:N.fte||0,status:N.role_change,mappings:new Map(l.value.filter(j=>j.role_id===N.role_id&&j.scenario_id===i.value).map(j=>[j.competency_id,j]))}))),M=ee(()=>g.value.map(N=>({id:N.id,name:N.name,capability_id:N.capability_id??null,capability_name:N.capability_name??N.category??"General",category:N.category??null})));return{scenarioId:i,scenarioName:O,horizonMonths:v,roles:I,competencies:g,mappings:l,loading:_,error:x,success:s,matrixRows:k,competencyColumns:M,loadScenarioData:async N=>{_.value=!0,x.value=null;try{const j=await fetch(`/api/scenarios/${N}/step2/data`);if(!j.ok)throw new Error("Error loading scenario data");const C=await j.json();i.value=N,O.value=C.scenario.name,v.value=C.scenario.horizon_months||12,I.value=C.roles,g.value=C.competencies,l.value=C.mappings}catch(j){x.value=j.message||"Error loading scenario data"}finally{_.value=!1}},saveMapping:async N=>{_.value=!0,x.value=null;try{const j=await fetch(`/api/scenarios/${i.value}/step2/mappings`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:N.id,role_id:N.role_id,competency_id:N.competency_id,required_level:N.required_level,is_core:N.is_core,change_type:N.change_type,rationale:N.rationale,competency_version_id:N.competency_version_id??null})});if(!j.ok)throw new Error("Error saving mapping");const C=await j.json(),o=l.value.findIndex(W=>W.role_id===N.role_id&&W.competency_id===N.competency_id);o>=0?l.value[o]=C.mapping:l.value.push(C.mapping),s.value=C.message||"Mapping saved successfully",setTimeout(()=>s.value=null,3e3)}catch(j){x.value=j.message||"Error saving mapping"}finally{_.value=!1}},removeMapping:async(N,j,C)=>{_.value=!0,x.value=null;try{if(!(await fetch(`/api/scenarios/${i.value}/step2/mappings/${C}`,{method:"DELETE"})).ok)throw new Error("Error removing mapping");l.value=l.value.filter(W=>!(W.role_id===N&&W.competency_id===j)),s.value="Mapping removed successfully",setTimeout(()=>s.value=null,3e3)}catch(o){x.value=o.message||"Error removing mapping"}finally{_.value=!1}},addNewRole:async N=>{_.value=!0,x.value=null;try{const j=await fetch(`/api/scenarios/${i.value}/step2/roles`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(N)});if(!j.ok)throw new Error("Error adding role");const C=await j.json();I.value.push(C.role),s.value=C.message||"Role added successfully",setTimeout(()=>s.value=null,3e3)}catch(j){x.value=j.message||"Error adding role"}finally{_.value=!1}},getMapping:(N,j)=>l.value.find(C=>C.role_id===N&&C.competency_id===j&&C.scenario_id===i.value),clearMessages:()=>{x.value=null,s.value=null}}}),Ge=ze("transform",{actions:{async transformCompetency(i,O){return(await Me.post(`/api/competencies/${i}/transform`,O)).data.data},async getVersions(i){return(await Me.get(`/api/competencies/${i}/versions`)).data.data}}}),ha={class:"bars-editor"},wa={key:0,class:"bars-guide"},$a={key:1,class:"bars-example"},Ca={class:"mode-toggle"},Va=["disabled"],Sa=["disabled"],Ea={key:2,class:"structured"},Na=["for"],ja={class:"items"},Ia={key:0},Aa=["data-testid","placeholder","onUpdate:modelValue","disabled"],Ra=["onClick"],Oa={key:0,class:"add-row"},Ta=["data-testid","onClick"],Ua={key:1},Ma={class:"skill-chips"},za={key:0},qa={class:"skill-chip"},Pa={key:1},Da=["data-testid","onUpdate:modelValue","disabled"],La=["onClick"],Ba=["data-testid","onUpdate:modelValue"],Ja={key:0,class:"skill-input-row"},Ha=["onKeydown"],Ga={key:0,class:"suggestions"},Fa=["onClick"],Wa={key:3,class:"json-mode"},Ka=["disabled"],Qa=ae({__name:"BarsEditor",props:{modelValue:{},initialMode:{},readOnly:{type:Boolean}},emits:["update:modelValue"],setup(i,{emit:O}){const v=i,I=O,g=f(v.initialMode??"structured"),l=()=>({behaviour:[],attitude:[],responsibility:[],skills:[]}),_=Be(v.modelValue?k(v.modelValue):l()),x=f(JSON.stringify(v.modelValue??_,null,2)),s=f(null);function k(b){if(!b)return l();if(typeof b=="string")try{return JSON.parse(b)}catch{return l()}return{behaviour:Array.isArray(b.behaviour)?b.behaviour.slice():l().behaviour,attitude:Array.isArray(b.attitude)?b.attitude.slice():l().attitude,responsibility:Array.isArray(b.responsibility)?b.responsibility.slice():l().responsibility,skills:Array.isArray(b.skills)?b.skills.map(T=>{if(typeof T=="string")return{name:T};if(!T)return{name:""};const A=T.name??T.label??T.title??"";return{id:T.id,name:typeof A=="string"?A:String(A)}}):l().skills}}se(()=>v.modelValue,b=>{if(g.value==="json")x.value=JSON.stringify(b??N(),null,2);else{const T=k(b);Object.keys(T).forEach(A=>{_[A]=T[A]})}}),se(g,b=>{if(b==="json")x.value=JSON.stringify(N(),null,2),s.value=null;else try{const T=JSON.parse(x.value),A=k(T);Object.keys(A).forEach(D=>{_[D]=A[D]}),I("update:modelValue",N()),s.value=null}catch{s.value=null}});function M(){try{const b=JSON.parse(x.value);s.value=null,I("update:modelValue",b)}catch(b){s.value=b&&b.message?String(b.message):"Invalid JSON"}}const E=["behaviour","attitude","responsibility","skills"];function d(b){return b==="behaviour"?"Behaviour":b==="attitude"?"Attitude":b==="responsibility"?"Responsibility":"Skills"}function G(b){_[b].push(""),I("update:modelValue",N())}function m(){_.skills.push({name:""}),I("update:modelValue",N())}function c(b,T){_[b].splice(T,1),I("update:modelValue",N())}function S(){I("update:modelValue",N())}function N(){return{behaviour:_.behaviour.slice(),attitude:_.attitude.slice(),responsibility:_.responsibility.slice(),skills:_.skills.map(b=>b&&b.name?{id:b.id,name:b.name}:{name:String(b)})}}const j=f(""),C=f([]);let o=0;async function W(){const b=String(j.value||"").trim();if(!b){C.value=[];return}const T=++o;try{const A=await Me.get("/api/skills",{params:{q:b}});if(T!==o)return;const D=A?.data??A;C.value=Array.isArray(D)?D:D?.data??[]}catch{C.value=[]}}function R(b){b&&(_.skills.push({id:b.id,name:b.name}),j.value="",C.value=[],I("update:modelValue",N()))}function V(){const b=String(j.value||"").trim();b&&(_.skills.push({name:b}),j.value="",C.value=[],I("update:modelValue",N()))}function $(b){_.skills.splice(b,1),I("update:modelValue",N())}function K(b){return b?typeof b=="string"?b:b.name&&typeof b.name=="string"?b.name:b.label&&typeof b.label=="string"?b.label:b.title&&typeof b.title=="string"?b.title:String(b):""}return ee(()=>E.some(b=>_[b].some(T=>!T||String(T).trim()===""))),(b,T)=>(n(),u("div",ha,[T[6]||(T[6]=e("h4",{class:"bars-title"},"BARS",-1)),v.readOnly?z("",!0):(n(),u("p",wa,'BARS = Behaviour, Attitude, Responsibility, Skills. Describe comportamientos observables o evidencias para cada secci√≥n. Ejemplo: "Behaviour: Comunica progreso semanalmente".')),v.readOnly?z("",!0):(n(),u("div",$a,[...T[4]||(T[4]=[e("strong",null,"Ejemplo r√°pido",-1),e("div",{class:"example-line"},"Behaviour: Comunica resultados claramente",-1),e("div",{class:"example-line"},"Attitude: Proactivo",-1),e("div",{class:"example-line"},"Responsibility: Mantener pipelines de datos",-1),e("div",{class:"example-line"},"Skills: SQL, Python",-1)])])),e("div",Ca,[e("button",{type:"button",class:fe(["mode-btn",{active:g.value==="structured"}]),onClick:T[0]||(T[0]=A=>g.value="structured"),disabled:v.readOnly},"Estructurado",10,Va),e("button",{type:"button",class:fe(["mode-btn",{active:g.value==="json"}]),onClick:T[1]||(T[1]=A=>g.value="json"),disabled:v.readOnly},"JSON",10,Sa)]),g.value==="structured"?(n(),u("div",Ea,[(n(),u(Z,null,X(E,A=>e("div",{class:"section",key:A},[e("label",{for:A},y(d(A)),9,Na),e("div",ja,[A!=="skills"?(n(),u("div",Ia,[(n(!0),u(Z,null,X(_[A],(D,U)=>(n(),u("div",{key:U,class:"item-row"},[te(e("input",{"data-testid":`${A}-${U}`,placeholder:`${d(A)} item ${Number(U)+1}`,"onUpdate:modelValue":B=>_[A][U]=B,onInput:S,disabled:v.readOnly},null,40,Aa),[[_e,_[A][U]]]),v.readOnly?z("",!0):(n(),u("button",{key:0,type:"button",class:"remove",onClick:B=>c(A,Number(U))},"Eliminar",8,Ra))]))),128)),v.readOnly?z("",!0):(n(),u("div",Oa,[e("button",{type:"button",class:"add","data-testid":`add-${A}`,onClick:D=>G(A)},"Agregar "+y(d(A)),9,Ta)]))])):(n(),u("div",Ua,[e("div",Ma,[(n(!0),u(Z,null,X(_.skills,(D,U)=>(n(),u(Z,{key:U},[v.readOnly&&D&&D.name?(n(),u("div",za,[e("span",qa,y(K(D)),1)])):(n(),u("div",Pa,[te(e("input",{"data-testid":`skills-${U}`,placeholder:"Agregar skill...","onUpdate:modelValue":B=>_.skills[U].name=B,onInput:S,disabled:v.readOnly},null,40,Da),[[_e,_.skills[U].name]]),v.readOnly?z("",!0):(n(),u("button",{key:0,type:"button",class:"remove",onClick:B=>$(Number(U))},"Eliminar",8,La))])),v.readOnly?z("",!0):te((n(),u("input",{key:2,"data-testid":`skills-hidden-${U}`,"onUpdate:modelValue":B=>_.skills[U].name=B,style:{position:"absolute",left:"-9999px",width:"1px",height:"1px",opacity:"0"},"aria-hidden":"true"},null,8,Ba)),[[_e,_.skills[U].name]])],64))),128))]),v.readOnly?z("",!0):(n(),u("div",Ja,[te(e("input",{"data-testid":"skill-input",placeholder:"Agregar skill...","onUpdate:modelValue":T[2]||(T[2]=D=>j.value=D),onInput:W,onKeydown:gt(he(V,["prevent"]),["enter"])},null,40,Ha),[[_e,j.value]]),C.value.length?(n(),u("div",Ga,[(n(!0),u(Z,null,X(C.value,(D,U)=>(n(),u("div",{key:U,class:"suggestion",onClick:B=>R(D)},y(D.name),9,Fa))),128))])):z("",!0)]))]))]),!v.readOnly&&A==="skills"?(n(),u("button",{key:0,type:"button",class:"add","data-testid":"add-skills",onClick:m},"Agregar Skill")):z("",!0)])),64))])):(n(),u("div",Wa,[T[5]||(T[5]=e("label",null,"JSON",-1)),te(e("textarea",{"data-testid":"json-textarea","onUpdate:modelValue":T[3]||(T[3]=A=>x.value=A),onInput:M,rows:"8",disabled:v.readOnly},null,40,Ka),[[_e,x.value]])]))]))}}),Za=ue(Qa,[["__scopeId","data-v-2055f958"]]),Ya={class:"flex items-center justify-between px-4 py-2 bg-gray-50 border-b"},Xa={class:"flex items-center gap-3"},en={class:"text-lg font-semibold"},tn={class:"mb-1"},an=["innerHTML"],nn={key:0,class:"mt-2"},ln={class:"info-example"},on={class:"px-4 pb-3 flex justify-end"},Fe=ae({__name:"InfoLegend",props:{modelValue:{type:Boolean,required:!0},title:{type:String,default:"Informaci√≥n"},items:{type:Array,default:()=>[]},icon:{type:String,default:"mdi-information-variant-circle"},width:{type:[String,Number],default:480},stripeColor:{type:String,default:"rgb(var(--v-theme-info))"}},emits:["update:modelValue"],setup(i,{emit:O}){const v=ee(()=>"text-2xl text-info-darken-1");return(I,g)=>{const l=p("v-icon"),_=p("v-btn"),x=p("v-card-text"),s=p("v-card"),k=p("v-dialog");return n(),P(k,{"model-value":i.modelValue,"max-width":"{width}","onUpdate:modelValue":g[2]||(g[2]=M=>I.$emit("update:modelValue",M))},{default:a(()=>[t(s,{class:"rounded-lg shadow-sm",style:yt(`border-left:4px solid ${i.stripeColor}`)},{default:a(()=>[e("div",Ya,[e("div",Xa,[t(l,{class:fe(v.value)},{default:a(()=>[w(y(i.icon),1)]),_:1},8,["class"]),e("div",en,y(i.title),1)]),t(_,{icon:"",variant:"text","aria-label":"Cerrar",onClick:g[0]||(g[0]=M=>I.$emit("update:modelValue",!1))},{default:a(()=>[t(l,null,{default:a(()=>[...g[3]||(g[3]=[w("mdi-close",-1)])]),_:1})]),_:1})]),t(x,{class:"p-4 bg-white",style:{"font-size":"16px","line-height":"1.4"}},{default:a(()=>[(n(!0),u(Z,null,X(i.items,(M,E)=>(n(),u("div",{key:E,class:"mb-3"},[e("p",tn,[e("strong",null,y(M.title),1),g[4]||(g[4]=w(": ",-1)),e("span",{innerHTML:M.text},null,8,an)]),M.example?(n(),u("div",nn,[e("pre",ln,y(M.example),1)])):z("",!0)]))),128))]),_:1}),e("div",on,[t(_,{variant:"text",onClick:g[1]||(g[1]=M=>I.$emit("update:modelValue",!1))},{default:a(()=>[...g[5]||(g[5]=[w("Cerrar",-1)])]),_:1})])]),_:1},8,["style"])]),_:1},8,["model-value"])}}}),sn={class:"transform-modal"},rn={class:"transform-header"},dn={key:0,class:"text-sm"},un={class:"guide-toggle-row",style:{display:"flex","justify-content":"space-between","align-items":"center","margin-bottom":"0.5rem"}},cn={style:{display:"flex",gap:"0.5rem","align-items":"center"}},mn={style:{"margin-top":"0.5rem"}},pn={style:{display:"flex","align-items":"center",gap:"0.5rem"}},vn={class:"bars-container"},_n={class:"modal-footer"},fn={type:"submit",class:"btn-primary"},gn=ae({__name:"TransformModal",props:{competencyId:{}},emits:["transformed","close"],setup(i,{emit:O}){const v=i,I=O,g=Be({name:"",description:"",bars:null,create_skills_incubated:!0}),l=f(!1),_=[{title:"Descripci√≥n",text:'¬øPara qu√© sirve esta pantalla?</strong> Para crear o transformar la definici√≥n de una competencia asociada a un rol. Al guardar se crea una nueva versi√≥n de la competencia (p. ej. 1.0, 1.1) que puede ser referenciada por mappings de roles. Esto permite mantener historial de definiciones y aplicar cambios sin romper referencias existentes. Rellena un <em>Nombre</em> y una <em>Descripci√≥n</em> para esta versi√≥n. El editor <strong>BARS</strong> contiene cuatro secciones: <strong>Behaviour</strong>, <strong>Attitude</strong>, <strong>Responsibility</strong> y <strong>Skills</strong>. Describe ejemplos concretos y observables (p. ej. "Comunica ideas claramente", "Aplica metodolog√≠as √°giles").'},{title:"Consejo",text:"Usa el modo <strong>Estructurado</strong> para editar por secciones o <strong>JSON</strong> si vas a pegar una definici√≥n completa. Si est√°s creando la versi√≥n inicial (1.0), piensa en la definici√≥n base que usar√° este rol; si est√°s transformando, documenta los cambios esperados y evidencias."},{title:"Skills incubadas",text:'Activa "Crear skills en incubaci√≥n" para que las skills nuevas se creen con estado <code>incubation</code> al crear la versi√≥n. Estas aparecer√°n en el modal principal como "Skills creadas (incubaci√≥n)" y pueden revisarse antes de cerrar.'},{title:"Ejemplo (JSON)",text:"En este ejemplo la versi√≥n define evidencias concretas y una lista de skills relevantes; al crear la versi√≥n se guarda esta definici√≥n y el mapping del rol puede apuntar a ella. Ejemplo de payload BARS que se guardar√° en metadata.bars:",example:`{
  "behaviour": ["Comunica resultados claramente","Documenta an√°lisis"],
  "attitude": ["Proactivo","Orientado a detalle"],
  "responsibility": ["Mantener pipelines de datos","Revisar calidad de datos"],
  "skills": ["SQL","Python","ETL"]
}`}],x=f([]),s=f(!1),k=Ge();we(async()=>{s.value=!0;try{const E=await k.getVersions(v.competencyId);x.value=E||[]}catch{}finally{s.value=!1}});async function M(){try{const E=g.bars??null,d=Array.isArray(E?.skills)?E.skills:[],G=d.filter(j=>j&&j.id).map(j=>j.id),m=d.filter(j=>j&&!j.id).map(j=>j.name),c={name:g.name,description:g.description,metadata:{bars:E},create_skills_incubated:g.create_skills_incubated};G.length&&(c.skill_ids=G),m.length&&(c.new_skills=m),console.debug("transform-payload",c);const S=await k.transformCompetency(v.competencyId,c),N=await k.getVersions(v.competencyId);x.value=N||[],I("transformed",S)}catch(E){console.error("transform error",E);const d=E,G=d?.response?.data?.message||d?.response?.data||d?.message;try{alert("Error al transformar: "+(typeof G=="string"?G:JSON.stringify(G)))}catch{alert("Error al transformar")}}}return(E,d)=>{const G=p("v-icon"),m=p("v-btn");return n(),u("div",sn,[e("form",{onSubmit:he(M,["prevent"])},[e("div",rn,[e("h3",null,y(x.value.length===0?"Crear versi√≥n 1.0":"Transformar competencia"),1),x.value.length>0?(n(),u("p",dn,"Versiones existentes: "+y(x.value.length),1)):z("",!0)]),e("div",un,[d[9]||(d[9]=e("div",null,[e("strong",null,"Gu√≠a r√°pida"),e("small",{class:"text-sm text-gray-500",style:{"margin-left":"0.5rem"}},"(¬øNecesitas m√°s detalle?)")],-1)),e("div",cn,[d[8]||(d[8]=e("a",{href:"/docs/COMIENZA_AQUI_WORKFORCE_PLANNING.md",target:"_blank",rel:"noopener",class:"text-sm",style:{color:"#1f79ff"}},"Gu√≠a completa",-1)),t(m,{variant:"text",size:"small",class:"text-info",title:"ver informaci√≥n",onClick:d[0]||(d[0]=c=>l.value=!0)},{default:a(()=>[t(G,{class:"align-middle text-4xl text-info-darken-1"},{default:a(()=>[...d[7]||(d[7]=[w("mdi-information-variant-circle",-1)])]),_:1})]),_:1}),t(Fe,{modelValue:l.value,"onUpdate:modelValue":d[1]||(d[1]=c=>l.value=c),title:"Gu√≠a: Transformaci√≥n / BARS",items:_,icon:"mdi-information-variant-circle"},null,8,["modelValue"])])]),e("div",null,[d[10]||(d[10]=e("label",{for:"transform-name"},"Nombre",-1)),te(e("input",{id:"transform-name","onUpdate:modelValue":d[2]||(d[2]=c=>g.name=c),required:""},null,512),[[_e,g.name]])]),e("div",null,[d[11]||(d[11]=e("label",{for:"transform-desc"},"Descripci√≥n",-1)),te(e("textarea",{id:"transform-desc","onUpdate:modelValue":d[3]||(d[3]=c=>g.description=c)},null,512),[[_e,g.description]])]),e("div",mn,[e("label",pn,[te(e("input",{type:"checkbox","onUpdate:modelValue":d[4]||(d[4]=c=>g.create_skills_incubated=c)},null,512),[[bt,g.create_skills_incubated]]),d[12]||(d[12]=e("span",null,"Crear skills en incubaci√≥n",-1))]),d[13]||(d[13]=e("p",{class:"text-sm text-gray-500",style:{margin:"0.25rem 0 0 1.8rem"}},"Si est√° activado, las skills nuevas se crear√°n con estado 'incubation' cuando se cree la versi√≥n.",-1))]),e("div",vn,[t(Za,{modelValue:g.bars,"onUpdate:modelValue":d[5]||(d[5]=c=>g.bars=c),initialMode:"structured",readOnly:!1},null,8,["modelValue"])]),e("div",_n,[e("button",{type:"button",class:"btn-secondary",onClick:d[6]||(d[6]=c=>E.$emit("close"))},"Cancelar"),e("button",fn,y(x.value.length===0?"Crear versi√≥n 1.0":"Transformar"),1)])],32)])}}}),yn=ue(gn,[["__scopeId","data-v-a015f2b5"]]),bn={key:0,class:"mb-4"},xn={class:"mb-6 p-4 bg-gray-50 rounded"},kn={class:"font-semibold"},hn={key:1,class:"mb-4 p-3 bg-yellow-50 border-l-4 border-yellow-400 rounded"},wn={class:"flex flex-wrap gap-2"},$n={class:"mb-6"},Cn={class:"flex items-center gap-2 mb-3"},Vn={class:"p-3 border border-gray-200 rounded mb-2 hover:bg-gray-50 cursor-pointer"},Sn={class:"p-3 border border-gray-200 rounded mb-2 hover:bg-gray-50 cursor-pointer"},En={class:"p-3 border border-gray-200 rounded mb-2 hover:bg-gray-50 cursor-pointer"},Nn={class:"p-3 border border-gray-200 rounded mb-2 hover:bg-gray-50 cursor-pointer"},jn={key:2,class:"mb-6"},In={class:"p-4 bg-blue-50 border-l-4 border-blue-500 rounded"},An={class:"flex items-center gap-4"},Rn={class:"flex-1"},On={class:"flex-1"},Tn={class:"mt-3"},Un={class:"mt-3"},Mn={key:0,class:"mt-3"},zn={key:0,class:"text-sm text-gray-600 ml-2"},qn={key:3,class:"mb-6"},Pn={class:"p-4 bg-green-50 border-l-4 border-green-500 rounded"},Dn={class:"mt-3"},Ln={class:"mt-3"},Bn={key:4,class:"mb-6"},Jn={class:"p-4 bg-red-50 border-l-4 border-red-500 rounded"},Hn={class:"mb-3"},Gn={class:"space-y-2"},Fn={class:"flex items-center"},Wn={class:"flex items-center"},Kn={class:"flex items-center"},Qn={key:5,class:"mb-6"},Zn={class:"mb-4"},Yn={class:"mb-6"},Xn=ae({__name:"RoleCompetencyStateModal",props:{visible:{type:Boolean},roleId:{},roleName:{},competencyId:{},competencyName:{},mapping:{}},emits:["save","close"],setup(i,{emit:O}){const v=i,I=O,g=f(!1),l=f(!1),_=f(!1),x=Ge(),s=He(),k=f([]),M=[{title:"Mantenci√≥n",text:"cambios peque√±os en el mapeo (por ejemplo, ajustar nivel requerido) que no generan una nueva versi√≥n de la competencia."},{title:"Transformaci√≥n",text:"cambios en la definici√≥n de la competencia (BARS, skills, nombre o descripci√≥n). Al guardar se crear√° una nueva versi√≥n de la competencia."},{title:"Enriquecimiento",text:"agregar o mejorar la competencia; puede generar una versi√≥n inicial si la competencia es nueva."},{title:"Extinci√≥n",text:"plan para descontinuar la competencia (se define timeline y plan de transici√≥n)."}];async function E(){try{const C=await x.getVersions(v.competencyId);k.value=C||[],v.mapping?!v.mapping.change_type&&k.value.length>0&&(m.value.change_type="transformation"):m.value.change_type=k.value.length>0?"transformation":"enrichment"}catch{k.value=[]}}we(()=>E()),se(()=>v.competencyId,()=>E());const d=f({message:"",color:""}),G=f([]),m=f({id:null,change_type:"maintenance",required_level:3,current_level:1,is_core:!0,rationale:"",timeline_months:12,extinction_timeline:12,transition_plan:"reskilling",suggest_learning_path:!1,competency_version_id:null}),c=C=>({maintenance:"‚úÖ Mantenci√≥n",transformation:"üîÑ Transformaci√≥n",enrichment:"üìà Enriquecimiento",extinction:"üìâ Extinci√≥n"})[C]||C,S=async()=>{if(m.value.change_type==="transformation"&&!m.value.competency_version_id){l.value=!0;return}g.value=!0;try{I("save",{...m.value,id:v.mapping?.id})}finally{g.value=!1}};se(()=>v.mapping,C=>{C&&(m.value={id:C.id,change_type:C.change_type||"maintenance",required_level:C.required_level||3,current_level:C.current_level||1,is_core:C.is_core||!1,rationale:C.rationale||"",timeline_months:C.timeline_months||12,extinction_timeline:C.extinction_timeline||12,transition_plan:C.transition_plan||"reskilling",suggest_learning_path:C.suggest_learning_path||!1,competency_version_id:C.competency_version_id||null})},{immediate:!0});const N=()=>{l.value=!0},j=async C=>{const o=C?.id??C?.version_id??null;o&&(m.value.competency_version_id=o);const W=C?.created_skills??C?.createdSkills??[];G.value=Array.isArray(W)?W.filter(R=>R&&(R.is_incubated===!0||R.status==="incubation")):[],l.value=!1;try{const R={id:m.value.id,role_id:v.roleId,competency_id:v.competencyId,required_level:m.value.required_level,is_core:m.value.is_core,change_type:m.value.change_type,rationale:m.value.rationale,competency_version_id:m.value.competency_version_id,timeline_months:m.value.timeline_months,current_level:m.value.current_level};I("save",R);try{await s.saveMapping(R),d.value={message:"Mapeo guardado correctamente",color:"success"},setTimeout(()=>d.value.message="",3e3)}catch(V){d.value={message:V?.message||"Error guardando el mapeo",color:"error"},setTimeout(()=>d.value.message="",5e3)}}catch(R){console.error("Auto-save mapping failed",R)}};return(C,o)=>{const W=p("v-card-title"),R=p("v-alert"),V=p("v-icon"),$=p("v-btn"),K=p("v-radio"),b=p("v-radio-group"),T=p("v-select"),A=p("v-checkbox"),D=p("v-textarea"),U=p("v-card-text"),B=p("v-card-actions"),Q=p("v-card"),F=p("v-dialog");return n(),u(Z,null,[t(F,{"model-value":v.visible,"max-width":"700px","onUpdate:modelValue":o[17]||(o[17]=q=>C.$emit("close"))},{default:a(()=>[t(Q,null,{default:a(()=>[t(W,{class:"text-lg font-bold"},{default:a(()=>[w(y(v.competencyName)+" - "+y(v.roleName),1)]),_:1}),t(U,{class:"py-6"},{default:a(()=>[d.value.message?(n(),u("div",bn,[t(R,{color:d.value.color,variant:"tonal",density:"comfortable",dismissible:""},{default:a(()=>[w(y(d.value.message),1)]),_:1},8,["color"])])):z("",!0),e("div",xn,[o[20]||(o[20]=e("p",{class:"text-sm text-gray-600 mb-2"},"Estado actual del rol:",-1)),e("p",kn,y(v.mapping?c(v.mapping.change_type):"Sin asociaci√≥n"),1)]),G.value.length?(n(),u("div",hn,[o[22]||(o[22]=e("label",{class:"block text-sm font-semibold mb-2"},"Skills creadas (incubaci√≥n):",-1)),e("div",wn,[(n(!0),u(Z,null,X(G.value,q=>(n(),u("span",{key:q.id||q.name,class:"px-2 py-1 bg-yellow-100 text-sm rounded-full"},[w(y(q.name)+" ",1),o[21]||(o[21]=e("span",{class:"text-xs text-gray-600",style:{"margin-left":"6px"}},"(incubation)",-1))]))),128))])])):z("",!0),e("div",$n,[e("div",Cn,[o[24]||(o[24]=e("label",{class:"block text-sm font-semibold"}," Seleccionar estado (una √∫nica opci√≥n): ",-1)),e("div",null,[t($,{variant:"text",size:"medium",class:"text-info","aria-label":"Leyenda tipo de asociaci√≥n",title:"ver informaci√≥n",onClick:o[0]||(o[0]=q=>_.value=!0)},{default:a(()=>[t(V,{class:"align-middle text-3xl text-info-darken-1"},{default:a(()=>[...o[23]||(o[23]=[w("mdi-information-variant-circle",-1)])]),_:1})]),_:1}),t(Fe,{modelValue:_.value,"onUpdate:modelValue":o[1]||(o[1]=q=>_.value=q),title:"Leyenda: Tipos de asociaci√≥n",items:M,icon:"mdi-information-variant-circle"},null,8,["modelValue"])])]),t(b,{modelValue:m.value.change_type,"onUpdate:modelValue":o[2]||(o[2]=q=>m.value.change_type=q),column:"",class:"mt-4"},{default:a(()=>[e("div",Vn,[t(K,{value:"maintenance",class:"mb-1"},{label:a(()=>[...o[25]||(o[25]=[e("span",{class:"font-medium"},"Mantenci√≥n",-1),e("span",{class:"text-xs text-gray-500 ml-2"},"(Sin cambios esperados)",-1)])]),_:1})]),e("div",Sn,[t(K,{value:"transformation",class:"mb-1"},{label:a(()=>[...o[26]||(o[26]=[e("span",{class:"font-medium"},"Transformaci√≥n",-1),e("span",{class:"text-xs text-gray-500 ml-2"},"(Requiere upskilling)",-1)])]),_:1})]),e("div",En,[t(K,{value:"enrichment",class:"mb-1"},{label:a(()=>[...o[27]||(o[27]=[e("span",{class:"font-medium"},"Enriquecimiento",-1),e("span",{class:"text-xs text-gray-500 ml-2"},"(Nueva o mejorada)",-1)])]),_:1})]),e("div",Nn,[t(K,{value:"extinction",class:"mb-1"},{label:a(()=>[...o[28]||(o[28]=[e("span",{class:"font-medium"},"Extinci√≥n",-1),e("span",{class:"text-xs text-gray-500 ml-2"},"(Desaparecer√°)",-1)])]),_:1})])]),_:1},8,["modelValue"])]),m.value.change_type==="transformation"?(n(),u("div",jn,[e("div",In,[o[34]||(o[34]=e("label",{class:"block text-sm font-semibold mb-3"}," Nivel actual ‚Üí Futuro: ",-1)),e("div",An,[e("div",Rn,[o[29]||(o[29]=e("label",{class:"text-xs text-gray-600 block mb-1"}," Actual ",-1)),t(T,{modelValue:m.value.current_level,"onUpdate:modelValue":o[3]||(o[3]=q=>m.value.current_level=q),items:[1,2,3,4,5],density:"compact",label:"Nivel"},null,8,["modelValue"])]),o[31]||(o[31]=e("div",{class:"pt-4"},"‚Üí",-1)),e("div",On,[o[30]||(o[30]=e("label",{class:"text-xs text-gray-600 block mb-1"},"Futuro",-1)),t(T,{modelValue:m.value.required_level,"onUpdate:modelValue":o[4]||(o[4]=q=>m.value.required_level=q),items:[1,2,3,4,5],density:"compact",label:"Nivel"},null,8,["modelValue"])])]),e("div",Tn,[o[32]||(o[32]=e("label",{class:"text-xs text-gray-600 block mb-1"}," Timeline (meses) ",-1)),t(T,{modelValue:m.value.timeline_months,"onUpdate:modelValue":o[5]||(o[5]=q=>m.value.timeline_months=q),items:[6,12,18,24],density:"compact"},null,8,["modelValue"])]),e("div",Un,[t(A,{modelValue:m.value.suggest_learning_path,"onUpdate:modelValue":o[6]||(o[6]=q=>m.value.suggest_learning_path=q),label:"Proponer learning path autom√°tico"},null,8,["modelValue"])]),m.value.change_type==="transformation"||m.value.change_type==="enrichment"?(n(),u("div",Mn,[t($,{text:"",onClick:N},{default:a(()=>[...o[33]||(o[33]=[w("Editar Transformaci√≥n (Crear versi√≥n)",-1)])]),_:1}),m.value.competency_version_id?(n(),u("span",zn,"Versi√≥n: "+y(m.value.competency_version_id),1)):z("",!0)])):z("",!0)])])):z("",!0),m.value.change_type==="enrichment"?(n(),u("div",qn,[e("div",Pn,[o[37]||(o[37]=e("label",{class:"block text-sm font-semibold mb-3"}," Competencia Nueva: ",-1)),e("div",null,[o[35]||(o[35]=e("label",{class:"text-xs text-gray-600 block mb-1"}," Nivel requerido ",-1)),t(T,{modelValue:m.value.required_level,"onUpdate:modelValue":o[7]||(o[7]=q=>m.value.required_level=q),items:[1,2,3,4,5],density:"compact"},null,8,["modelValue"])]),e("div",Dn,[o[36]||(o[36]=e("label",{class:"text-xs text-gray-600 block mb-1"}," Timeline (meses) ",-1)),t(T,{modelValue:m.value.timeline_months,"onUpdate:modelValue":o[8]||(o[8]=q=>m.value.timeline_months=q),items:[6,12,18,24],density:"compact"},null,8,["modelValue"])]),e("div",Ln,[t(A,{modelValue:m.value.suggest_learning_path,"onUpdate:modelValue":o[9]||(o[9]=q=>m.value.suggest_learning_path=q),label:"Proponer learning path autom√°tico"},null,8,["modelValue"])])])])):z("",!0),m.value.change_type==="extinction"?(n(),u("div",Bn,[e("div",Jn,[o[39]||(o[39]=e("label",{class:"block text-sm font-semibold mb-3"}," Plan de Transici√≥n: ",-1)),e("div",Hn,[o[38]||(o[38]=e("label",{class:"text-xs text-gray-600 block mb-2"}," Timeline desaparici√≥n (meses) ",-1)),t(T,{modelValue:m.value.extinction_timeline,"onUpdate:modelValue":o[10]||(o[10]=q=>m.value.extinction_timeline=q),items:[6,12,18,24],density:"compact"},null,8,["modelValue"])]),o[40]||(o[40]=e("label",{class:"text-xs text-gray-600 block mb-2"}," Plan de transici√≥n: ",-1)),e("div",Gn,[e("div",Fn,[t(K,{modelValue:m.value.transition_plan,"onUpdate:modelValue":o[11]||(o[11]=q=>m.value.transition_plan=q),value:"reskilling",label:"Reskilling a otra competencia"},null,8,["modelValue"])]),e("div",Wn,[t(K,{modelValue:m.value.transition_plan,"onUpdate:modelValue":o[12]||(o[12]=q=>m.value.transition_plan=q),value:"role_change",label:"Cambio de rol"},null,8,["modelValue"])]),e("div",Kn,[t(K,{modelValue:m.value.transition_plan,"onUpdate:modelValue":o[13]||(o[13]=q=>m.value.transition_plan=q),value:"devinculacion",label:"Desvincular"},null,8,["modelValue"])])])])])):z("",!0),m.value.change_type==="maintenance"?(n(),u("div",Qn,[...o[41]||(o[41]=[e("div",{class:"p-4 bg-blue-50 border-l-4 border-blue-500 rounded"},[e("p",{class:"text-sm text-gray-600"}," ‚úÖ Esta competencia se mantiene en el mismo nivel. No requiere cambios de entrenamiento. ")],-1)])])):z("",!0),e("div",Zn,[o[42]||(o[42]=e("label",{class:"block text-sm font-semibold mb-2"}," ¬øEs cr√≠tica para el rol? ",-1)),t(A,{modelValue:m.value.is_core,"onUpdate:modelValue":o[14]||(o[14]=q=>m.value.is_core=q),label:"S√≠, es cr√≠tica"},null,8,["modelValue"])]),e("div",Yn,[o[43]||(o[43]=e("label",{class:"block text-sm font-semibold mb-2"},"Notas:",-1)),t(D,{modelValue:m.value.rationale,"onUpdate:modelValue":o[15]||(o[15]=q=>m.value.rationale=q),placeholder:"Justificaci√≥n de esta asociaci√≥n...",density:"compact",rows:"3"},null,8,["modelValue"])])]),_:1}),t(B,{class:"flex justify-end gap-3 px-6 pb-4"},{default:a(()=>[t($,{variant:"text",onClick:o[16]||(o[16]=q=>C.$emit("close"))},{default:a(()=>[...o[44]||(o[44]=[w(" Cancelar ",-1)])]),_:1}),t($,{color:"primary",onClick:S,loading:g.value,variant:"elevated"},{default:a(()=>[...o[45]||(o[45]=[w(" Guardar ",-1)])]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["model-value"]),t(F,{"model-value":l.value,"max-width":"900px","onUpdate:modelValue":o[19]||(o[19]=q=>l.value=q)},{default:a(()=>[t(Q,null,{default:a(()=>[t(U,null,{default:a(()=>[t(yn,{competencyId:v.competencyId,onTransformed:j,onClose:o[18]||(o[18]=q=>l.value=!1)},null,8,["competencyId"])]),_:1})]),_:1})]),_:1},8,["model-value"])],64)}}}),el={class:"space-y-4"},tl={key:0},al={key:1,class:"space-y-3"},nl=ae({__name:"AddRoleDialog",props:{visible:{type:Boolean}},emits:["save","close"],setup(i,{emit:O}){const v=O,I=f(!1),g=f([]),l=f({type:"existing",role_id:null,role_name:"",fte:1,role_change:"create",impact_level:"medium",evolution_type:"new_role",rationale:""}),_=["create","modify","eliminate","maintain"],x=["critical","high","medium","low"],s=["new_role","upgrade_skills","transformation","downsize","elimination"],k=async()=>{I.value=!0;try{v("save",{...l.value,role_id:l.value.type==="existing"?l.value.role_id:null,role_name:l.value.type==="new"?l.value.role_name:null})}finally{I.value=!1}};return(async()=>{try{try{const E=await fetch("/api/roles");if(E.ok){const d=await E.json();g.value=Array.isArray(d?.data)?d.data:Array.isArray(d)?d:d?.data??[];return}}catch{}try{const E=Je();g.value=E.props.roles||[]}catch(E){console.error("Error loading roles from page props:",E),g.value=[]}}catch(E){console.error("Error loading roles:",E),g.value=[]}})(),(E,d)=>{const G=p("v-card-title"),m=p("v-radio"),c=p("v-radio-group"),S=p("v-select"),N=p("v-text-field"),j=p("v-textarea"),C=p("v-card-text"),o=p("v-btn"),W=p("v-card-actions"),R=p("v-card"),V=p("v-dialog");return n(),P(V,{"model-value":i.visible,"max-width":"500px","onUpdate:modelValue":d[9]||(d[9]=$=>E.$emit("close"))},{default:a(()=>[t(R,null,{default:a(()=>[t(G,null,{default:a(()=>[...d[10]||(d[10]=[w("Agregar Nuevo Rol",-1)])]),_:1}),t(C,{class:"py-6"},{default:a(()=>[e("div",el,[e("div",null,[d[11]||(d[11]=e("label",{class:"block text-sm font-semibold mb-2"}," Seleccionar o crear rol: ",-1)),t(c,{modelValue:l.value.type,"onUpdate:modelValue":d[0]||(d[0]=$=>l.value.type=$)},{default:a(()=>[t(m,{value:"existing",label:"Usar rol existente"}),t(m,{value:"new",label:"Crear rol nuevo"})]),_:1},8,["modelValue"])]),l.value.type==="existing"?(n(),u("div",tl,[t(S,{modelValue:l.value.role_id,"onUpdate:modelValue":d[1]||(d[1]=$=>l.value.role_id=$),items:g.value,"item-title":"name","item-value":"id",label:"Seleccionar rol",density:"compact"},null,8,["modelValue","items"])])):z("",!0),l.value.type==="new"?(n(),u("div",al,[t(N,{modelValue:l.value.role_name,"onUpdate:modelValue":d[2]||(d[2]=$=>l.value.role_name=$),label:"Nombre del rol",density:"compact"},null,8,["modelValue"]),t(N,{modelValue:l.value.fte,"onUpdate:modelValue":d[3]||(d[3]=$=>l.value.fte=$),modelModifiers:{number:!0},type:"number",label:"FTE (personas)",density:"compact"},null,8,["modelValue"]),t(S,{modelValue:l.value.evolution_type,"onUpdate:modelValue":d[4]||(d[4]=$=>l.value.evolution_type=$),items:s,label:"Tipo de evoluci√≥n",density:"compact"},null,8,["modelValue"])])):z("",!0),t(S,{modelValue:l.value.role_change,"onUpdate:modelValue":d[5]||(d[5]=$=>l.value.role_change=$),items:_,label:"Cambio del rol",density:"compact"},null,8,["modelValue"]),t(S,{modelValue:l.value.impact_level,"onUpdate:modelValue":d[6]||(d[6]=$=>l.value.impact_level=$),items:x,label:"Nivel de impacto",density:"compact"},null,8,["modelValue"]),t(j,{modelValue:l.value.rationale,"onUpdate:modelValue":d[7]||(d[7]=$=>l.value.rationale=$),label:"Justificaci√≥n",density:"compact",rows:"3"},null,8,["modelValue"])])]),_:1}),t(W,{class:"flex justify-end gap-3 px-6 pb-4"},{default:a(()=>[t(o,{variant:"text",onClick:d[8]||(d[8]=$=>E.$emit("close"))},{default:a(()=>[...d[12]||(d[12]=[w("Cancelar",-1)])]),_:1}),t(o,{color:"primary",onClick:k,loading:I.value,variant:"elevated"},{default:a(()=>[...d[13]||(d[13]=[w(" Agregar Rol ",-1)])]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["model-value"])}}}),ll={key:0,class:"cell-content flex flex-col items-center justify-center h-full gap-1 px-2 py-2"},ol={class:"text-xs text-center text-gray-600"},sl={key:0,class:"font-mono"},il={key:1,class:"font-mono"},rl={class:"flex gap-1 mt-1"},dl={class:"text-center"},ul=ae({__name:"CellContent",props:{mapping:{}},emits:["edit","remove"],setup(i){const O=ee(()=>g.mapping&&{maintenance:"‚úÖ",transformation:"üîÑ",enrichment:"üìà",extinction:"üìâ"}[g.mapping.change_type]||""),v=ee(()=>g.mapping&&{maintenance:"Mant.",transformation:"Transf.",enrichment:"Enriq.",extinction:"Extinc."}[g.mapping.change_type]||""),I=ee(()=>g.mapping?{maintenance:"bg-green-500",transformation:"bg-blue-500",enrichment:"bg-green-600",extinction:"bg-red-500"}[g.mapping.change_type]||"bg-gray-500":"bg-gray-300"),g=i;return(l,_)=>{const x=p("v-btn"),s=p("v-icon");return i.mapping?(n(),u("div",ll,[e("div",{class:fe(["px-2 py-1 rounded text-xs font-semibold text-white",I.value])},y(O.value)+" "+y(v.value),3),e("div",ol,[i.mapping.change_type==="transformation"?(n(),u("div",sl," Lvl "+y(i.mapping.current_level||"?")+" ‚Üí "+y(i.mapping.required_level),1)):(n(),u("div",il," Lvl "+y(i.mapping.required_level),1))]),e("div",rl,[t(x,{icon:"mdi-pencil",size:"x-small",variant:"text",density:"compact",onClick:_[0]||(_[0]=he(k=>l.$emit("edit"),["stop"]))}),t(x,{icon:"mdi-delete",size:"x-small",variant:"text",color:"red",density:"compact",onClick:_[1]||(_[1]=he(k=>l.$emit("remove"),["stop"]))})])])):(n(),u("div",{key:1,class:"cell-empty h-full flex items-center justify-center cursor-pointer hover:bg-blue-50 transition-colors border-2 border-dashed border-gray-300 hover:border-blue-300 rounded",onClick:_[2]||(_[2]=he(k=>l.$emit("edit"),["stop"]))},[e("div",dl,[t(s,{icon:"mdi-plus-circle",class:"text-gray-400 hover:text-blue-500 mb-1"}),_[3]||(_[3]=e("div",{class:"text-xs text-gray-500"},"Click para asignar",-1))])]))}}}),cl=ue(ul,[["__scopeId","data-v-5027df17"]]),ml={class:"role-competency-matrix"},pl={class:"matrix-header mb-6"},vl={class:"flex items-center justify-between"},_l={class:"text-2xl font-bold"},fl={class:"text-gray-600 mt-1"},gl={class:"flex gap-2"},yl={key:0,class:"mb-4"},bl={key:1,class:"flex justify-center py-8"},xl={key:2},kl={class:"mb-4 p-4 bg-blue-50 border-l-4 border-blue-500 rounded"},hl={class:"flex items-start gap-3"},wl={class:"matrix-table"},$l={class:"w-32 p-3 text-center"},Cl={class:"sticky left-0 z-10 bg-white border-b border-gray-200"},Vl={class:"w-48 p-3 border-r border-gray-200"},Sl={class:"font-semibold"},El={class:"text-xs text-gray-500"},Nl=["onClick"],jl=ae({__name:"RoleCompetencyMatrix",props:{scenarioId:{}},setup(i){const O=i,v=He(),I=f(!1),g=f(!1),l=f(0),_=f(null),x=f(!1),s=ee(()=>{const m={};return v.competencyColumns.forEach(c=>{const S=c.capability_name||c.category||"General";m[S]||(m[S]=[]),m[S].push(c)}),Object.keys(m).map(c=>({name:c,comps:m[c],count:m[c].length}))}),k=m=>{let c=0;return v.matrixRows.forEach(S=>{(s.value.find(j=>j.name===m)?.comps||[]).forEach(j=>{S.mappings&&S.mappings.get&&S.mappings.get(j.id)&&(c+=1)})}),c};we(async()=>{await v.loadScenarioData(O.scenarioId)}),se(()=>v.success,m=>{m&&(x.value=!0)});const M=(m,c)=>{const S=v.roles.find(C=>C.role_id===m),N=v.competencies.find(C=>C.id===c),j=v.getMapping(m,c);_.value={roleId:m,roleName:S?.role_name||"",competencyId:c,competencyName:N?.name||"",mapping:j},I.value=!0},E=async m=>{if(!_.value)return;const c={id:m.id,scenario_id:v.scenarioId,role_id:_.value.roleId,competency_id:_.value.competencyId,competency_name:_.value.competencyName,required_level:m.required_level,is_core:m.is_core,change_type:m.change_type,rationale:m.rationale};await v.saveMapping(c),I.value=!1},d=async(m,c)=>{const S=v.getMapping(m,c);S&&confirm("¬øEliminar esta asociaci√≥n?")&&await v.removeMapping(m,c,S.id)},G=async m=>{await v.addNewRole(m),g.value=!1};return(m,c)=>{const S=p("v-btn"),N=p("v-alert"),j=p("v-snackbar"),C=p("v-progress-circular"),o=p("v-icon"),W=p("v-tooltip"),R=p("v-badge"),V=p("v-tab"),$=p("v-tabs"),K=p("v-window-item"),b=p("v-window"),T=p("v-card");return n(),u("div",ml,[e("div",pl,[e("div",vl,[e("div",null,[e("h2",_l,y(de(v).scenarioName||"Escenario"),1),e("p",fl," Mapeo: Roles ‚Üî Competencias (Horizonte: "+y(de(v).horizonMonths)+" meses) ",1)]),e("div",gl,[t(S,{color:"primary","prepend-icon":"mdi-plus",onClick:c[0]||(c[0]=A=>g.value=!0)},{default:a(()=>[...c[7]||(c[7]=[w(" + Nuevo Rol ",-1)])]),_:1})])])]),de(v).error?(n(),u("div",yl,[t(N,{type:"error",closable:"","onClick:close":c[1]||(c[1]=A=>de(v).clearMessages())},{default:a(()=>[w(y(de(v).error),1)]),_:1})])):z("",!0),t(j,{modelValue:x.value,"onUpdate:modelValue":c[2]||(c[2]=A=>x.value=A),color:"success",timeout:"2000"},{default:a(()=>[w(y(de(v).success),1)]),_:1},8,["modelValue"]),de(v).loading?(n(),u("div",bl,[t(C,{indeterminate:"",color:"primary"})])):(n(),u("div",xl,[e("div",kl,[e("div",hl,[t(o,{icon:"mdi-information",class:"text-blue-600 mt-1"}),c[8]||(c[8]=e("div",null,[e("h3",{class:"font-semibold text-blue-800 mb-1"},"C√≥mo asignar competencias"),e("p",{class:"text-sm text-blue-700"}," Haz click en cualquier celda para asignar una competencia a un rol. Las celdas vac√≠as muestran un √≠cono + para indicar que se pueden asignar. "),e("p",{class:"text-sm text-blue-700 mt-2"}," Paso 2 consiste en conectar competencias con roles y definir su transici√≥n (mantenci√≥n, transformaci√≥n, enriquecimiento o extinci√≥n) de forma simple y visual. ")],-1))])]),t(T,null,{default:a(()=>[t($,{modelValue:l.value,"onUpdate:modelValue":c[3]||(c[3]=A=>l.value=A),"bg-color":"gray-100",class:"border-b"},{default:a(()=>[(n(!0),u(Z,null,X(s.value,(A,D)=>(n(),P(V,{key:A.name,value:D,class:fe(l.value===D?"bg-blue-50":"")},{default:a(()=>[t(W,{text:A.name,location:"top"},{activator:a(({props:U})=>[e("span",Te({ref_for:!0},U,{class:"tab-label text-truncate"}),y(A.name),17)]),_:2},1032,["text"]),t(R,{content:k(A.name),color:"primary",location:"top end","offset-x":"-8","offset-y":"-8"},null,8,["content"])]),_:2},1032,["value","class"]))),128))]),_:1},8,["modelValue"]),t(b,{modelValue:l.value,"onUpdate:modelValue":c[4]||(c[4]=A=>l.value=A),class:"matrix-container"},{default:a(()=>[(n(!0),u(Z,null,X(s.value,(A,D)=>(n(),P(K,{key:A.name,value:D},{default:a(()=>[e("table",wl,[e("thead",null,[e("tr",null,[c[9]||(c[9]=e("th",{class:"sticky left-0 z-20 bg-gray-100 border-b border-gray-300 role-column-header"},[e("div",{class:"w-48 p-3 flex items-center justify-between group"},[e("strong",null,"Rol"),e("div",{class:"cursor-col-resize opacity-0 group-hover:opacity-100 transition-opacity"},"‚ãÆ‚ãÆ")])],-1)),(n(!0),u(Z,null,X(A.comps,U=>(n(),u("th",{key:U.id,class:"border-b border-gray-300 bg-gray-50"},[e("div",$l,[t(W,{text:U.name,location:"top"},{activator:a(({props:B})=>[e("div",Te({ref_for:!0},B,{class:"font-semibold text-sm text-truncate comp-name"}),y(U.name),17)]),_:2},1032,["text"]),t(W,{text:U.capability_name||U.category,location:"top"},{activator:a(({props:B})=>[e("div",Te({ref_for:!0},B,{class:"text-xs text-gray-500 text-truncate comp-capability"}),y(U.capability_name||U.category),17)]),_:2},1032,["text"])])]))),128))])]),e("tbody",null,[(n(!0),u(Z,null,X(de(v).matrixRows,U=>(n(),u("tr",{key:U.roleId},[e("td",Cl,[e("div",Vl,[e("div",Sl,y(U.roleName),1),e("div",El,y(U.fte)+" FTE ‚Ä¢ "+y(U.status),1)])]),(n(!0),u(Z,null,X(A.comps,B=>(n(),u("td",{key:`${U.roleId}-${B.id}`,class:"border-b border-gray-200 p-0"},[e("div",{class:"w-32 h-24 flex items-center justify-center cursor-pointer hover:bg-gray-50 border-r border-gray-200 transition",onClick:Q=>M(U.roleId,B.id)},[t(cl,{mapping:U.mappings.get(B.id),"role-id":U.roleId,"role-name":U.roleName,"competency-id":B.id,"competency-name":B.name,onEdit:Q=>M(U.roleId,B.id),onRemove:Q=>d(U.roleId,B.id)},null,8,["mapping","role-id","role-name","competency-id","competency-name","onEdit","onRemove"])],8,Nl)]))),128))]))),128))])])]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1})])),_.value?(n(),P(Xn,{key:3,visible:I.value,"role-id":_.value.roleId,"role-name":_.value.roleName,"competency-id":_.value.competencyId,"competency-name":_.value.competencyName,mapping:_.value.mapping,onSave:E,onClose:c[5]||(c[5]=A=>I.value=!1)},null,8,["visible","role-id","role-name","competency-id","competency-name","mapping"])):z("",!0),t(nl,{visible:g.value,onSave:G,onClose:c[6]||(c[6]=A=>g.value=!1)},null,8,["visible"])])}}}),Il=ue(jl,[["__scopeId","data-v-10ac35c2"]]),Al={class:"scenario-detail-wrapper"},Rl={class:"font-weight-medium"},Ol={class:"d-flex align-center flex-wrap justify-center gap-1"},Tl={class:"d-none d-md-inline"},Ul={class:"d-md-none"},Ml={class:"scenario-content"},zl={class:"step-content step-map"},ql={class:"mb-4 rounded border-l-4 border-blue-500 bg-blue-50 p-4"},Pl={class:"d-flex align-start gap-3"},Dl={class:"mt-4"},Ll={key:0},Bl={key:1},Jl={key:0},Hl={key:1},Gl={class:"d-flex align-center justify-space-between"},Fl={class:"text-sm text-gray-600"},Wl={class:"mt-2 ml-4"},Kl={class:"d-flex align-center gap-2"},Ql={class:"text-sm"},Zl={class:"ml-4 text-sm text-gray-700"},Yl={key:0,class:"text-yellow-700"},Xl={key:0},eo={key:0},to={key:1},ao={key:0},no={key:1},lo={class:"text-sm text-gray-700"},oo={key:0,class:"mt-1"},so={class:"text-sm"},io={key:1,class:"mt-1"},ro={class:"text-sm"},uo={key:0,class:"step-content"},co={key:0},mo={key:1,class:"flex justify-center py-8"},po={class:"step-content"},vo={class:"step-content"},_o={class:"step-content"},fo={class:"step-content"},go={class:"step-content"},yo={class:"d-none d-sm-inline"},bo={class:"text-caption text-medium-emphasis"},xo={class:"d-none d-sm-inline"},ko={key:0},ho=ae({layout:xt,__name:"ScenarioDetail",props:{id:{}},setup(i){const O=i,v=Ee(),{showSuccess:I,showError:g}=Se(),l=f(null),_=f(!1),x=f(!1);f(!1);const s=f({id:null,name:"",description:"",scenario_type:"",status:"draft",decision_status:"",execution_status:"",current_step:1,is_current_version:!1,version_number:null,version_group_id:null,parent_id:null,planning_horizon_months:12,horizon_months:12,time_horizon_weeks:null,start_date:null,end_date:null,owner:null,estimated_budget:null,scope_type:"",scope_id:null,import_to_plan:!1});f({});const k=f([]),M=f(!1),E=f([]),d=f(!1),G=f([]);f(!1),f(""),f("technical"),f(!1),f(null);const m=f({}),c=f([]),S=f(!1),N=f([]),j=ee(()=>Object.values(m.value).filter(h=>h==="include").length),C=ee(()=>Object.values(m.value).filter(h=>h==="import").length),o=ee(()=>Object.values(m.value).filter(h=>h==="ignore").length),W=f([{title:"Rol",key:"name"},{title:"Departamento",key:"department"},{title:"Familia",key:"family"},{title:"Acciones",key:"actions",sortable:!1}]),R=f("stepper"),V=f(1),$=f(null),K=f(!1),b=f(null),T=f(!1),A=f(null),D=f(!1),U=f(!1),B=f(null),Q=f(!1),F=ee(()=>{const h=typeof O.id=="string"?parseInt(O.id,10):O.id;return isNaN(h)?0:h}),q=Je(),$e=ee(()=>{try{const h=q.props?.auth?.user??null;if(!h)return!1;const r=h.role??null;return["admin","approver","owner","superadmin"].includes(r)?!0:l.value?(l.value.created_by??null)===h.id:!1}catch{return!1}});ee(()=>{try{const h=q.url||window.location.href;return new URLSearchParams(new URL(h,window.location.origin).search).get("view")||null}catch{return null}});const ge=async()=>{if(!(!F.value||F.value<=0)){_.value=!0;try{const h=await v.get(`/api/strategic-planning/scenarios/${F.value}`),r=h?.data??h;l.value=r,V.value=l.value?.current_step||1,s.value.name=l.value?.name??"",s.value.description=l.value?.description??"",s.value.scope_type=l.value?.scope_type??"",s.value.planning_horizon_months=l.value?.horizon_months??l.value?.planning_horizon_months??12,s.value.horizon_months=l.value?.horizon_months??s.value.planning_horizon_months,s.value.time_horizon_weeks=l.value?.time_horizon_weeks??null,s.value.start_date=l.value?.start_date??null,s.value.end_date=l.value?.end_date??null,s.value.owner=l.value?.owner??null,s.value.scope_id=l.value?.scope_id??null,s.value.id=l.value?.id??null,s.value.scenario_type=l.value?.scenario_type??"",s.value.status=l.value?.status??"draft",s.value.decision_status=l.value?.decision_status??"",s.value.execution_status=l.value?.execution_status??"",s.value.current_step=l.value?.current_step??s.value.current_step,s.value.is_current_version=l.value?.is_current_version??!1,s.value.version_number=l.value?.version_number??null,s.value.version_group_id=l.value?.version_group_id??null,s.value.parent_id=l.value?.parent_id??null,s.value.estimated_budget=l.value?.estimated_budget??null,(s.value.scope_type==="department"||s.value.scope_type==="role_family")&&await tt(),await et(),G.value=(l.value?.scenario_skills||l.value?.skill_demands||[]).map(H=>({id:H.id||null,skill_id:H.skill_id||H.id||null,required_level:H.required_level??H.level??1,required_headcount:H.required_headcount??H.required_headcount??1,priority:H.priority||"medium",rationale:H.rationale||H.notes||""})),await Ne(),await Ce(),l.value?.source_generation_id&&await Ze()}catch{g("No se pudo cargar el escenario")}finally{_.value=!1}}},ye=f([]),ke=f(!1),be=f([]),J=f(!1),Ce=async()=>{if(!(!F.value||F.value<=0)){ke.value=!0;try{const h=await v.get(`/api/strategic-planning/scenarios/${F.value}/capability-tree`);ye.value=h?.data??h??[]}catch(h){console.error("Error loading capability tree",h),ye.value=[]}finally{ke.value=!1}}},We=h=>{B.value=h,U.value=!0},Ke=async h=>{await Ce(),await ge()},Qe=async()=>{if(!(!l.value||!l.value.source_generation_id)){Q.value=!0;try{await v.post(`/api/strategic-planning/scenarios/generate/${l.value.source_generation_id}/record-view`)}catch(h){console.error("record view failed",h)}}},Ze=async()=>{if(!(!l.value||!l.value.source_generation_id)){J.value=!0;try{const h=await v.get(`/api/strategic-planning/scenarios/generate/${l.value.source_generation_id}`),r=h?.data??h;be.value=r?.metadata?.import_audit??[]}catch(h){console.error("Error loading import audit",h),be.value=[]}finally{J.value=!1}}},Ye=h=>{Ue.visit(`/competencies/${h}`)},Xe=async()=>{if(F.value)try{await v.post(`/api/strategic-planning/scenarios/${F.value}/approve`),I("Entidades incubadas promovidas"),await ge()}catch(h){console.error(h),g("Error promoviendo entidades")}},Ne=async()=>{M.value=!0;try{const h={};s.value.scope_type&&(h.scope_type=s.value.scope_type),s.value.scope_id&&(h.scope_id=s.value.scope_id);const r=await v.get("/api/roles",h);k.value=r?.data??r;const H={};k.value.forEach(Y=>{const ce=Y.role_family_id||Y.role_family&&Y.role_family.id||null,Ie=Y.role_family_name||Y.role_family&&Y.role_family.name||Y.role_family||null;ce&&!H[ce]&&(H[ce]={id:ce,name:Ie})}),N.value=Object.values(H),k.value.forEach(Y=>{m.value[Y.id]||(m.value[Y.id]="ignore")})}catch{}finally{M.value=!1}},et=async()=>{d.value=!0;try{const h=await v.get("/api/skills");E.value=h?.data??h??[]}catch{}finally{d.value=!1}};j.value,C.value,o.value,W.value,R.value,se(()=>s.value.scope_type,async(h,r)=>{h!==r&&await Ne()}),se(()=>s.value.scope_id,async(h,r)=>{h!==r&&await Ne()});const tt=async()=>{S.value=!0;try{const h=await v.get("/api/departments");c.value=h?.data??h}catch{}finally{S.value=!1}},at=()=>{ge()},nt=()=>{$.value?.openDialog()},lt=()=>{K.value=!1,b.value=null},ot=async()=>{if(!(!F.value||F.value<=0)){T.value=!0;try{const h=await v.post(`/api/strategic-planning/scenarios/${F.value}/change-sets`,{}),r=h?.data??h;b.value=r?.id??(r?.data&&r.data.id)??null,b.value?K.value=!0:g("No se pudo obtener el ChangeSet")}catch(h){console.error(h);const r=h?.friendlyMessage||h?.message||"No se pudo generar el ChangeSet";g(r)}finally{T.value=!1}}},st=h=>{Ue.visit(`/strategic-planning/${h}`)},it=async()=>{x.value=!0;try{I("Estrategias actualizadas")}catch{g("Error al actualizar estrategias")}finally{x.value=!1}};D.value;const ne=[{value:1,title:"Mapa",icon:"mdi-map",subtitle:"Visualizaci√≥n del escenario"},{value:2,title:"Mapeo",icon:"mdi-table",subtitle:"Roles ‚Üî Competencias"},{value:3,title:"Estrategias",icon:"mdi-strategy",subtitle:"Cierre de brechas"},{value:4,title:"Workforce",icon:"mdi-account-group",subtitle:"Plan de personal"},{value:5,title:"Pron√≥sticos",icon:"mdi-chart-timeline-variant",subtitle:"Roles futuros"},{value:6,title:"Comparar",icon:"mdi-compare",subtitle:"Versiones"},{value:7,title:"Dashboard",icon:"mdi-view-dashboard",subtitle:"Resumen"}],qe=ee(()=>ne.find(h=>h.value===V.value)||ne[0]),Pe=()=>{Ue.visit("/scenario-planning")},je=h=>{if(h>=1&&h<=ne.length){V.value=h;const r=new URL(window.location.href);r.searchParams.set("step",String(h)),window.history.replaceState({},"",r.toString())}},rt=()=>{V.value<ne.length&&je(V.value+1)},dt=()=>{V.value>1&&je(V.value-1)},ut=()=>{try{const h=new URL(window.location.href),r=h.searchParams.get("step");if(h.searchParams.get("view")==="map"){V.value=1;return}if(r){const Y=parseInt(r,10);Y>=1&&Y<=ne.length&&(V.value=Y)}}catch{}};return we(()=>{ut(),ge()}),(h,r)=>{const H=p("v-btn"),Y=p("v-col"),ce=p("v-chip"),Ie=p("v-skeleton-loader"),De=p("v-row"),ie=p("v-container"),Ae=p("v-sheet"),Re=p("v-progress-linear"),me=p("v-icon"),Le=p("v-spacer"),pe=p("v-card-title"),le=p("v-card-text"),oe=p("v-card"),ct=p("v-progress-circular"),xe=p("v-alert"),Oe=p("v-dialog"),mt=p("v-card-actions"),pt=p("v-app");return n(),P(pt,null,{default:a(()=>[e("div",Al,[t(Ae,{color:"surface",class:"border-b",style:{position:"sticky",top:"0","z-index":"10"}},{default:a(()=>[t(ie,{fluid:"",class:"pa-2"},{default:a(()=>[t(De,{"no-gutters":"",align:"center"},{default:a(()=>[t(Y,{cols:"auto"},{default:a(()=>[t(H,{icon:"mdi-arrow-left",variant:"text",onClick:Pe})]),_:1}),l.value?(n(),P(Y,{key:0,cols:"auto",class:"d-flex align-center flex-grow-1 gap-2"},{default:a(()=>[e("span",Rl,y(l.value.name),1),$e.value&&l.value.source_generation_id&&l.value.accepted_prompt?(n(),P(H,{key:0,small:"",variant:"text",onClick:Qe},{default:a(()=>[...r[7]||(r[7]=[w("Ver prompt aceptado",-1)])]),_:1})):z("",!0),l.value.decision_status?(n(),P(ce,{key:1,size:"x-small",color:l.value.decision_status==="approved"?"success":l.value.decision_status==="rejected"?"error":"warning"},{default:a(()=>[w(y(l.value.decision_status),1)]),_:1},8,["color"])):z("",!0)]),_:1})):(n(),P(Y,{key:1,cols:"auto",class:"flex-grow-1"},{default:a(()=>[t(Ie,{type:"text",width:"200"})]),_:1})),t(Y,{cols:"auto",class:"d-flex align-center gap-2"},{default:a(()=>[t(ce,{variant:"tonal",color:"primary",size:"small"},{default:a(()=>[w(" Paso "+y(V.value)+"/"+y(ne.length),1)]),_:1}),t(H,{icon:"mdi-history",variant:"text",size:"small",onClick:nt,title:"Historial de versiones"}),t(H,{icon:"mdi-source-branch",variant:"text",size:"small",loading:T.value,onClick:ot,title:"ChangeSet"},null,8,["loading"]),t(H,{icon:"mdi-robot",variant:"text",size:"small","data-test":"generate-wizard-button",onClick:r[0]||(r[0]=L=>D.value=!0),title:"Generar escenario"})]),_:1})]),_:1})]),_:1})]),_:1}),t(Ae,{color:"grey-lighten-4",class:"stepper-nav border-b px-2 py-1"},{default:a(()=>[e("div",Ol,[(n(),u(Z,null,X(ne,L=>t(H,{key:L.value,variant:V.value===L.value?"flat":"text",color:V.value===L.value?"primary":"default",size:"small","prepend-icon":L.icon,onClick:re=>je(L.value),class:"step-btn"},{default:a(()=>[e("span",Tl,y(L.title),1),e("span",Ul,y(L.value),1)]),_:2},1032,["variant","color","prepend-icon","onClick"])),64))])]),_:1}),e("div",Ml,[_.value?(n(),P(Re,{key:0,indeterminate:"",color:"primary"})):l.value?(n(),u(Z,{key:1},[te(e("div",zl,[e("div",ql,[e("div",Pl,[t(me,{icon:"mdi-information",class:"mt-1 text-blue-600"}),r[8]||(r[8]=e("div",null,[e("h3",{class:"font-weight-semibold mb-1 text-blue-800"}," ¬øEn qu√© consiste el Paso 1? "),e("p",{class:"text-body-2 mb-0 text-blue-700"}," Dise√±ar el escenario definiendo capacidades estrat√©gicas y competencias (existentes o nuevas) que dar√°n base al mapa del escenario. ")],-1))])]),t(ht,{scenario:l.value},null,8,["scenario"]),e("div",Dl,[t(oe,{class:"pa-3"},{default:a(()=>[t(pe,null,{default:a(()=>[t(me,{class:"mr-2"},{default:a(()=>[...r[9]||(r[9]=[w("mdi-seed",-1)])]),_:1}),r[11]||(r[11]=w(" Entidades incubadas en este escenario ",-1)),t(Le),t(H,{small:"",variant:"text",onClick:Xe,title:"Promover incubadas"},{default:a(()=>[...r[10]||(r[10]=[w("Promover todas",-1)])]),_:1})]),_:1}),t(le,null,{default:a(()=>[ke.value?(n(),u("div",Ll,[t(Re,{indeterminate:"",color:"primary"})])):(n(),u("div",Bl,[ye.value.length===0?(n(),u("div",Jl," No se encontraron entidades incubadas. ")):(n(),u("div",Hl,[(n(!0),u(Z,null,X(ye.value,L=>(n(),u("div",{key:L.id,class:"mb-3"},[e("div",Gl,[e("div",null,[e("strong",null,y(L.name),1),e("div",Fl,y(L.description),1)]),e("div",null,[t(H,{size:"x-small",variant:"text",onClick:re=>We(L)},{default:a(()=>[...r[12]||(r[12]=[w("Revisar",-1)])]),_:1},8,["onClick"])])]),e("div",Wl,[(n(!0),u(Z,null,X(L.competencies,re=>(n(),u("div",{key:re.id,class:"mb-1"},[e("div",Kl,[e("span",Ql,"‚Ä¢ "+y(re.name),1),t(H,{size:"x-small",variant:"text",onClick:Ve=>Ye(re.id)},{default:a(()=>[...r[13]||(r[13]=[w("Ver/Editar",-1)])]),_:1},8,["onClick"])]),e("div",Zl,[(n(!0),u(Z,null,X(re.skills,Ve=>(n(),u("span",{key:Ve.id,class:"mr-3"},[w(y(Ve.name)+" ",1),Ve.is_incubating?(n(),u("small",Yl,"(incubation)")):z("",!0)]))),128))])]))),128))])]))),128))]))]))]),_:1}),t(le,null,{default:a(()=>[l.value&&l.value.source_generation_id?(n(),u("div",Xl,[r[18]||(r[18]=e("h4",{class:"mb-2"}," Registro de importaci√≥n ",-1)),J.value?(n(),u("div",eo,[t(Re,{indeterminate:"",color:"primary"})])):(n(),u("div",to,[be.value.length===0?(n(),u("div",ao," No hay registros de importaci√≥n. ")):(n(),u("div",no,[(n(!0),u(Z,null,X(be.value,(L,re)=>(n(),u("div",{key:re,class:"mb-3"},[e("div",lo,[e("strong",null,y(L.attempted_at||L.attempted||"‚Äî"),1),r[14]||(r[14]=w(" ‚Äî ",-1)),e("em",null,y(L.attempted_by||"Sistema"),1)]),e("div",null,[r[15]||(r[15]=w(" Resultado: ",-1)),e("strong",null,y(L.result),1)]),L.error?(n(),u("div",oo,[r[16]||(r[16]=e("div",{class:"text-sm text-red-700"}," Error: ",-1)),e("pre",so,y(JSON.stringify(L.error,null,2)),1)])):z("",!0),L.report?(n(),u("div",io,[r[17]||(r[17]=e("div",{class:"text-sm text-green-700"}," Reporte: ",-1)),e("pre",ro,y(JSON.stringify(L.report,null,2)),1)])):z("",!0)]))),128))]))]))])):z("",!0)]),_:1})]),_:1})])],512),[[ve,V.value===1]]),V.value===2?(n(),u("div",uo,[F.value>0?(n(),u("div",co,[(n(),P(Il,{"scenario-id":F.value,key:`rcm-${F.value}-${V.value}`},null,8,["scenario-id"]))])):(n(),u("div",mo,[t(ct,{indeterminate:"",color:"primary"}),r[19]||(r[19]=e("span",{class:"ml-2"},"Cargando escenario...",-1))]))])):z("",!0),te(e("div",po,[t(ie,null,{default:a(()=>[t(oe,null,{default:a(()=>[t(pe,null,{default:a(()=>[t(me,{class:"mr-2"},{default:a(()=>[...r[20]||(r[20]=[w("mdi-strategy",-1)])]),_:1}),r[21]||(r[21]=w(" Estrategias de Cierre ",-1))]),_:1}),t(le,null,{default:a(()=>[t(xe,{type:"info",variant:"tonal",class:"mb-4"},{default:a(()=>[...r[22]||(r[22]=[w(" Define estrategias para cerrar las brechas identificadas (capacitaci√≥n, contrataci√≥n, etc.). ",-1)])]),_:1}),t(H,{color:"primary",onClick:it,loading:x.value},{default:a(()=>[...r[23]||(r[23]=[w(" Generar Estrategias ",-1)])]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1})],512),[[ve,V.value===3]]),te(e("div",vo,[t(ie,null,{default:a(()=>[t(oe,null,{default:a(()=>[t(pe,null,{default:a(()=>[t(me,{class:"mr-2"},{default:a(()=>[...r[24]||(r[24]=[w("mdi-account-group",-1)])]),_:1}),r[25]||(r[25]=w(" Plan de Workforce ",-1))]),_:1}),t(le,null,{default:a(()=>[t(xe,{type:"info",variant:"tonal"},{default:a(()=>[...r[26]||(r[26]=[w(" Planifica los recursos humanos necesarios para ejecutar el escenario. ",-1)])]),_:1})]),_:1})]),_:1})]),_:1})],512),[[ve,V.value===4]]),te(e("div",_o,[t(ie,null,{default:a(()=>[t(oe,null,{default:a(()=>[t(pe,null,{default:a(()=>[t(me,{class:"mr-2"},{default:a(()=>[...r[27]||(r[27]=[w("mdi-chart-timeline-variant",-1)])]),_:1}),r[28]||(r[28]=w(" Pron√≥stico de Roles ",-1))]),_:1}),t(le,null,{default:a(()=>[t(xe,{type:"info",variant:"tonal"},{default:a(()=>[...r[29]||(r[29]=[w(" Proyecta las necesidades de roles a futuro bas√°ndose en el escenario. ",-1)])]),_:1})]),_:1})]),_:1})]),_:1})],512),[[ve,V.value===5]]),te(e("div",fo,[t(ie,null,{default:a(()=>[t(oe,null,{default:a(()=>[t(pe,null,{default:a(()=>[t(me,{class:"mr-2"},{default:a(()=>[...r[30]||(r[30]=[w("mdi-compare",-1)])]),_:1}),r[31]||(r[31]=w(" Comparaci√≥n de Escenarios ",-1))]),_:1}),t(le,null,{default:a(()=>[t(xe,{type:"info",variant:"tonal"},{default:a(()=>[...r[32]||(r[32]=[w(" Compara diferentes versiones del escenario o escenarios alternativos. ",-1)])]),_:1})]),_:1})]),_:1})]),_:1})],512),[[ve,V.value===6]]),te(e("div",go,[t(ie,null,{default:a(()=>[t(oe,null,{default:a(()=>[t(pe,null,{default:a(()=>[t(me,{class:"mr-2"},{default:a(()=>[...r[33]||(r[33]=[w("mdi-view-dashboard",-1)])]),_:1}),r[34]||(r[34]=w(" Dashboard Ejecutivo ",-1))]),_:1}),t(le,null,{default:a(()=>[t(xe,{type:"info",variant:"tonal"},{default:a(()=>[...r[35]||(r[35]=[w(" Resumen ejecutivo y KPIs del escenario. ",-1)])]),_:1})]),_:1})]),_:1})]),_:1})],512),[[ve,V.value===7]])],64)):(n(),P(ie,{key:2},{default:a(()=>[t(xe,{type:"error",variant:"tonal"},{default:a(()=>[...r[36]||(r[36]=[w(" No se pudo cargar el escenario. ",-1)])]),_:1})]),_:1}))]),t(Ae,{color:"surface",class:"border-t",style:{position:"fixed",bottom:"0",left:"0",right:"0","z-index":"10"}},{default:a(()=>[t(ie,{fluid:"",class:"pa-2"},{default:a(()=>[t(De,{"no-gutters":"",align:"center"},{default:a(()=>[t(Y,{cols:"4"},{default:a(()=>[V.value>1?(n(),P(H,{key:0,variant:"text",size:"small","prepend-icon":"mdi-chevron-left",onClick:dt},{default:a(()=>[e("span",yo,y(ne[V.value-2]?.title),1),r[37]||(r[37]=e("span",{class:"d-sm-none"},"Anterior",-1))]),_:1})):z("",!0)]),_:1}),t(Y,{cols:"4",class:"text-center"},{default:a(()=>[e("span",bo,y(qe.value.title)+": "+y(qe.value.subtitle),1)]),_:1}),t(Y,{cols:"4",class:"text-right"},{default:a(()=>[V.value<ne.length?(n(),P(H,{key:0,variant:"tonal",color:"primary",size:"small","append-icon":"mdi-chevron-right",onClick:rt},{default:a(()=>[e("span",xo,y(ne[V.value]?.title),1),r[38]||(r[38]=e("span",{class:"d-sm-none"},"Siguiente",-1))]),_:1})):(n(),P(H,{key:1,variant:"flat",color:"success",size:"small","prepend-icon":"mdi-check",onClick:Pe},{default:a(()=>[...r[39]||(r[39]=[w(" Finalizar ",-1)])]),_:1}))]),_:1})]),_:1})]),_:1})]),_:1}),F.value&&F.value>0&&l.value?(n(),P(ka,{key:0,ref_key:"versionHistoryRef",ref:$,"scenario-id":F.value,"version-group-id":l.value.version_group_id||"","current-version":l.value.version_number||1,onVersionSelected:st},null,8,["scenario-id","version-group-id","current-version"])):z("",!0),F.value&&F.value>0?(n(),P(ca,{key:1,ref_key:"statusTimelineRef",ref:A,"scenario-id":F.value,onStatusChanged:at},null,8,["scenario-id"])):z("",!0),t(Oe,{modelValue:K.value,"onUpdate:modelValue":r[1]||(r[1]=L=>K.value=L),"max-width":"900",scrollable:""},{default:a(()=>[t(oe,null,{default:a(()=>[t(le,null,{default:a(()=>[b.value?(n(),P(ia,{key:0,id:b.value,title:"ChangeSet",onClose:lt},null,8,["id"])):z("",!0)]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(Oe,{modelValue:D.value,"onUpdate:modelValue":r[2]||(r[2]=L=>D.value=L),"max-width":"1000"},{default:a(()=>[t(oe,null,{default:a(()=>[t(le,null,{default:a(()=>[t(kt)]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(Nt,{modal:U.value,"onUpdate:modal":r[3]||(r[3]=L=>U.value=L),item:B.value,"scenario-id":F.value,onClose:r[4]||(r[4]=L=>U.value=!1),onPromoted:Ke},null,8,["modal","item","scenario-id"]),t(Oe,{modelValue:Q.value,"onUpdate:modelValue":r[6]||(r[6]=L=>Q.value=L),"max-width":"800"},{default:a(()=>[t(oe,null,{default:a(()=>[t(pe,null,{default:a(()=>[...r[40]||(r[40]=[w("Prompt aceptado",-1)])]),_:1}),t(le,null,{default:a(()=>[l.value?(n(),u("pre",ko,y(l.value.accepted_prompt),1)):z("",!0)]),_:1}),t(mt,null,{default:a(()=>[t(Le),t(H,{text:"",onClick:r[5]||(r[5]=L=>Q.value=!1)},{default:a(()=>[...r[41]||(r[41]=[w("Cerrar",-1)])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])])]),_:1})}}}),Uo=ue(ho,[["__scopeId","data-v-8f825a88"]]);export{Uo as default};
