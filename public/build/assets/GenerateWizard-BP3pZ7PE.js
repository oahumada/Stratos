import{d as Re,p as V,b as p,g as ae,e as c,w as o,f as s,k as m,t as v,c as d,j as r,F as ne,s as se,m as Ve,o as tt,r as y,l as G,P as at,i as C,u,O as Se,Q as nt,v as st}from"./app-BQBzBluS.js";import{u as ot,n as H}from"./FieldHelp-CjJFB33a.js";import rt from"./PreviewConfirm-CO0cbHnJ.js";import{_ as lt}from"./StepHorizon.vue_vue_type_script_setup_true_lang-BHLWtfJc.js";import it from"./StepIdentity-BzR0NobI.js";import{_ as ct}from"./StepIntent.vue_vue_type_script_setup_true_lang-RtHDyAIw.js";import{_ as ut}from"./StepResources.vue_vue_type_script_setup_true_lang-DXrRigoj.js";import{_ as dt}from"./StepSituation.vue_vue_type_script_setup_true_lang-Cc83bP0-.js";const pt={key:0},mt={key:1},vt=Re({__name:"ErrorModal",props:{modelValue:{type:Boolean,default:!1},title:{type:String,default:"Errores"},messages:{type:Array,default:()=>[]}},emits:["update:modelValue"],setup(F,{emit:K}){const Q=F,t=K,J=V({get:()=>Q.modelValue,set:M=>t("update:modelValue",M)});function oe(){J.value=!1}return(M,x)=>{const re=p("v-card-title"),le=p("v-card-text"),ie=p("v-spacer"),O=p("v-btn"),X=p("v-card-actions"),ce=p("v-card"),Y=p("v-dialog");return c(),ae(Y,{modelValue:J.value,"onUpdate:modelValue":x[0]||(x[0]=U=>J.value=U),"max-width":"600"},{default:o(()=>[s(ce,null,{default:o(()=>[s(re,null,{default:o(()=>[m(v(F.title),1)]),_:1}),s(le,null,{default:o(()=>[F.messages&&F.messages.length?(c(),d("div",pt,[r("ul",null,[(c(!0),d(ne,null,se(F.messages,(U,ue)=>(c(),d("li",{key:ue},v(U),1))),128))])])):(c(),d("div",mt,[...x[1]||(x[1]=[r("p",null,"No hay detalles adicionales.",-1)])]))]),_:1}),s(X,null,{default:o(()=>[s(ie),s(O,{text:"",color:"primary",onClick:oe},{default:o(()=>[...x[2]||(x[2]=[m("Cerrar",-1)])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])}}}),gt=Ve(vt,[["__scopeId","data-v-d76618b4"]]),ft={class:"generate-wizard"},_t={class:"progress-label"},yt={class:"font-weight-medium"},ht={style:{"margin-top":"6px"}},bt={key:0,style:{color:"var(--v-theme-error)","font-weight":"600","margin-bottom":"6px"}},wt={style:{margin:"0.25rem 0 0","padding-left":"1rem"}},kt={key:0},Ct={class:"mt-2"},At={key:0},xt={class:"d-flex align-center justify-space-between mb-2"},St={class:"caption d-flex align-center"},Rt={class:"d-flex align-center"},Vt={key:0,class:"mb-3"},It={key:1,class:"instruction-error-text caption"},Pt={class:"d-flex align-center mt-2"},Et={class:"wizard-controls d-flex mt-4"},Mt={key:1,class:"generation-status"},Ot={style:{"margin-top":"8px"}},Nt=["disabled"],$t={key:0},jt={key:0,class:"d-flex align-center",style:{"min-height":"120px"}},zt={key:0,class:"caption"},Ft={key:0},Lt={key:1},Dt={key:0,class:"mb-2"},Gt={class:"mt-2"},Jt={key:1,class:"mb-2"},Ut={style:{"max-height":"400px",overflow:"auto",background:"#f6f6f6",padding:"8px"}},qt={key:2,class:"mb-3"},Bt={class:"subtitle-2",style:{color:"var(--v-theme-error)","font-weight":"600"}},Tt={style:{"margin-top":"6px","padding-left":"1rem",color:"var(--v-theme-error)"}},Wt={key:2,class:"preview-modal-backdrop"},Ht={class:"preview-modal"},Kt=Re({__name:"GenerateWizard",async setup(F){let K,Q;const t=ot(),J={1:it,2:dt,3:ct,4:ut,5:lt},oe=V(()=>J[t.step]);tt(()=>{Z(I.value)});const M=["company_name","industry","company_size","current_challenges","current_capabilities","strategic_goal","key_initiatives","time_horizon"],x=[...M,"current_gaps","budget_level","talent_availability","milestones"],re=M.length*2+(x.length-M.length)*1,le=V(()=>{const a=t.data;let e=0;return x.forEach(n=>{a[n]&&(e+=M.includes(n)?2:1)}),e}),ie=V(()=>{const a=t.data;return x.reduce((e,n)=>a[n]?e+1:e,0)}),O=V(()=>Math.round(le.value/re*100)),X=V(()=>O.value<40?"error":O.value<80?"warning":"success"),ce={1:["company_name","industry","company_size"],2:["current_challenges","current_capabilities","current_gaps"],3:["strategic_goal","key_initiatives"],4:["budget_level","talent_availability"],5:["time_horizon","milestones"]},Y=V(()=>{const a=ce[t.step]||[],e=t.data;return a.filter(n=>M.includes(n)&&!e[n]).length}),U=V(()=>O.value<40?"Insuficiente":O.value<80?"Parcial":"Completado"),ue=a=>{const e=t.data,n=[];switch(a){case 1:e.company_name||n.push("Nombre de la organización"),e.industry||n.push("Industria"),e.company_size||n.push("Tamaño (personas)");break;case 2:e.current_challenges||n.push("Desafíos"),e.current_capabilities||n.push("Capacidades existentes"),e.current_gaps||n.push("Brechas");break;case 3:e.strategic_goal||n.push("Objetivo principal"),e.key_initiatives||n.push("Iniciativas clave");break;case 4:e.budget_level||n.push("Nivel de presupuesto"),e.talent_availability||n.push("Disponibilidad de talento");break;case 5:e.time_horizon||n.push("Plazo"),e.milestones||n.push("Hitos");break}return n},fe=V(()=>ue(t.step));function Ie(){t.next()}function Pe(){t.prev()}const q=y(!1),I=y("es"),de=y(!1),_e=y(""),ye=y([]);function h(a,e="Error"){_e.value=e,ye.value=Array.isArray(a)?a:[a],de.value=!0}const w=y(""),k=y(!1),P=y(!1),L=y([]),N=y(null),$=y("db");function Ee(a){if(!a)return!1;const e=a.toLowerCase();return e.includes("formato: markdown")||e.includes("format: markdown")||e.includes("markdown.")||e.includes(`
markdown`)}function pe(){return $.value==="client"&&w.value&&Ee(w.value)?{valid:!1,message:"La instrucción contiene indicaciones para formato Markdown. Cambie la instrucción a salida JSON única, o seleccione una instrucción de la base de datos."}:{valid:!0}}const me=V(()=>pe());async function Z(a="es"){P.value=!0;try{const n=(await G.get("/api/strategic-planning/scenarios/instructions",{params:{language:a}})).data.data||[];L.value=n,n.length?(N.value=0,w.value=n[0].content||"",k.value=!!n[0].editable,I.value=n[0].language||a,$.value="db"):(L.value=[],N.value=null,w.value="",k.value=!1,I.value=a,$.value="client")}catch(e){console.error("Failed loading instruction",e)}finally{P.value=!1}}function Me(a){if(N.value=a,a===null){$.value="client",k.value=!0;return}const e=L.value[a];w.value=e?.content||"",k.value=!!e?.editable,$.value="db"}async function Oe(){P.value=!0;try{const a={language:I.value,content:w.value,editable:!!k.value},e=await G.post("/api/strategic-planning/scenarios/instructions",a);e.data&&e.data.success&&await Z(I.value)}catch(a){console.error("Save instruction failed",a),h("No se pudo guardar la instrucción: "+(a?.response?.data?.message||a?.message))}finally{P.value=!1}}async function Ne(){if(confirm("¿Restablecer la instrucción por defecto? Esto creará una nueva versión editable con el contenido por defecto.")){P.value=!0;try{const a=await G.post("/api/strategic-planning/scenarios/instructions/restore-default",{language:I.value});a.data&&a.data.success?await Z(I.value):h("No se pudo restaurar la instrucción por defecto")}catch(a){console.error("Restore default failed",a),h(a?.response?.data?.message||a?.message||"Error al restaurar por defecto")}finally{P.value=!1}}}async function $e(){try{const a=await t.validate();if(!a.valid){h(a.errors,"Faltan campos críticos");return}const e=pe();if(!e.valid){h(e.message||"Instrucción incompatible","Instrucción incompatible"),k.value=!0;return}await t.preview(),w.value&&(t.previewPrompt=(t.previewPrompt??"")+`

`+w.value),q.value=!0}catch(a){const e=a;if(console.error("Preview failed",a),e?.response?.status===422){const l=e.response.data||{},f=l.errors?Object.entries(l.errors).map(([_,g])=>`${_}: ${Array.isArray(g)?g.join(", "):g}`):[l.message||JSON.stringify(l)];k.value=!0,h(f,"Validación de instrucción (422)");return}const n=he(a);h(n.split(`
`),"Error al generar preview")}}async function je(a=!1){q.value=!1;try{const e=await t.validate();if(!e.valid){h(e.errors,"Faltan campos críticos");return}const n=pe();if(!n.valid){h(n.message||"Instrucción incompatible","Instrucción incompatible"),k.value=!0;return}if(t.importAfterAccept=!!a,$.value==="client"&&w.value)t.setField("instruction",w.value),t.setField("instruction_id",null);else if($.value==="db"&&N.value!==null){const R=L.value[N.value]?.id??null;t.setField("instruction",null),t.setField("instruction_id",R)}else t.setField("instruction",null),t.setField("instruction_id",null);await t.generate();try{await t.fetchStatus()}catch{}const l=Date.now(),f=6e5;let _=null;try{const g=await t.fetchProgress();_=g?.progress?.received_chunks??(Array.isArray(g?.recent_chunks)?g.recent_chunks.length:_)}catch{}for(;t.generationStatus!=="complete"&&Date.now()-l<f;){await new Promise(g=>setTimeout(g,2e3));try{await t.fetchProgress(),await t.fetchStatus();const R=t.generationProgress?.progress?.received_chunks??(t.recentChunks?t.recentChunks.length:null);R!==null&&_!==null&&R>_&&(_=R)}catch{}}t.generationStatus==="complete"?(await t.fetchStatus(),j.value=!0):h("Generación encolada. Verifique el estado en la sección de generación.","Encolada")}catch(e){const n=e;if(console.error("Generate failed",e),n?.response?.status===422){const f=n.response.data||{},_=f.errors?Object.entries(f.errors).map(([g,R])=>`${g}: ${Array.isArray(R)?R.join(", "):R}`):[f.message||JSON.stringify(f)];k.value=!0,h(_,"Validación de instrucción (422)");return}const l=he(e);h(l.split(`
`),"Error al generar escenario")}}function he(a){if(!a)return"Unknown error";if(a.response&&a.response.data){const e=a.response.data;return e.errors?Object.entries(e.errors).map(([n,l])=>`${n}: ${Array.isArray(l)?l.join(", "):l}`).join(`
`):e.message||JSON.stringify(e)}return a.message||String(a)}function ze(){q.value=!1,t.step=1}[K,Q]=at(()=>t.fetchStatus()),await K,Q();const z=y(!1),B=y(null),ve=y("");async function Fe(){if(t.generationId){z.value=!0;try{const a=await t.accept(t.generationId),e=a?.data?.scenario_id||a?.data?.id||a?.data&&a.data.id;if(e){window.location.href=`/scenario-planning/${e}`;return}window.location.reload()}catch(a){console.error("Accept failed",a);const e=a;h(e?.response?.data?.message||e?.message||String(a),"Error al aceptar generación")}finally{z.value=!1}}}const j=y(!1);let T=null;const S=y(!1),b=y(null),be=V(()=>{if(b.value!==null)return b.value;try{const a=t.recentChunks?t.recentChunks.length:0;return a>0?a:null}catch{return null}}),Le=()=>{const a=t.generationResult;if(!a)return!1;const e=typeof a.content=="string"&&a.content.trim().length>0,n=a.scenario_metadata&&Object.keys(a.scenario_metadata).length>0&&(a.scenario_metadata.name||a.scenario_metadata.description),l=Array.isArray(a.capabilities)&&a.capabilities.length>0;return e||n||l};function De(){j.value=!0,Ae()}async function we(a=!1){if(t.generationId){t.importAfterAccept=!!a,B.value=null,ve.value="",z.value=!0;try{const e=await t.accept(t.generationId),n=e?.data?.scenario_id||e?.data?.id||e?.data&&e.data.id;if(n){window.location.href=`/scenario-planning/${n}`;return}window.location.reload()}catch(e){const n=e;if(n?.response?.status===422){const l=n.response.data||{},f=l.errors?Object.entries(l.errors).map(([_,g])=>`${_}: ${Array.isArray(g)?g.join(", "):g}`):[l.message||JSON.stringify(l)];ve.value="Validación del servidor (422)",B.value=f,j.value=!0,k.value=!0;return}console.error("Accept failed",e),h(n?.response?.data?.message||n?.message||String(e),"Error al aceptar generación")}finally{z.value=!1}}}function ke(){j.value=!1,Ce()}async function Ge(){S.value=!0;try{await E("generation.regenerate",{reason:"operator_clicked"}),await t.generate();try{await t.fetchStatus()}catch{}await ee(),Ae()}catch(a){console.error("Regenerate failed",a),h(a?.response?.data?.message||a?.message||String(a),"Error al regenerar")}finally{S.value=!1}}function Ce(){S.value=!1,T&&(clearInterval(T),T=null)}async function Ae(){if(T)return;S.value=!0;try{await t.fetchStatus(),await ee()}catch{}if(b.value===null&&t.generationResult&&t.generationResult.content&&(b.value=1),(b.value||0)>0&&(function(){const e=t.generationResult;if(!e)return!0;const n=typeof e.content=="string"&&e.content.trim().length>0,l=e.scenario_metadata&&Object.keys(e.scenario_metadata).length>0,f=Array.isArray(e.capabilities)&&e.capabilities.length>0;return!(n||l||f)})()&&(await E("generation.assemble_attempt",{phase:"initial"}),await te()),t.generationStatus==="complete"){S.value=!1,(b.value||0)>0&&(function(){const n=t.generationResult;if(!n)return!0;const l=typeof n.content=="string"&&n.content.trim().length>0,f=n.scenario_metadata&&Object.keys(n.scenario_metadata).length>0,_=Array.isArray(n.capabilities)&&n.capabilities.length>0;return!(l||f||_)})()&&(await E("generation.assemble_attempt",{phase:"complete"}),await te()),j.value=!0;return}T=setInterval(async()=>{try{await t.fetchStatus(),await ee(),(b.value||0)>0&&(function(){const n=t.generationResult;if(!n)return!0;const l=typeof n.content=="string"&&n.content.trim().length>0,f=n.scenario_metadata&&Object.keys(n.scenario_metadata).length>0,_=Array.isArray(n.capabilities)&&n.capabilities.length>0;return!(l||f||_)})()&&(await E("generation.assemble_attempt",{phase:"interval"}),await te()),t.generationStatus==="complete"&&(Ce(),j.value=!0)}catch{}},2e3)}async function ee(){try{if(!t.generationId){b.value=null;return}const a=await t.fetchProgress();a&&(a.progress&&typeof a.progress.received_chunks=="number"?b.value=a.progress.received_chunks:Array.isArray(a.recent_chunks)?b.value=a.recent_chunks.length:b.value=null)}catch{b.value=null}}async function E(a,e={}){try{const n={event:a,properties:{generationId:t.generationId,chunkCount:b.value,...e}};await G.post("/api/telemetry/event",n),console.debug("analytics sent",n)}catch(n){console.debug("analytics failed",n)}}async function te(){try{if(!t.generationId)return null;try{const e=await G.get(`/api/strategic-planning/scenarios/generate/${t.generationId}/compacted`);if(e.data&&e.data.success){const n=e.data.data;if(Array.isArray(n)||typeof n=="object"&&n!==null)return t.generationResult=H(n),await E("generation.assemble_success",{method:"compacted_obj"}),t.generationResult;if(typeof n=="string")try{const l=JSON.parse(n);return t.generationResult=H(l),await E("generation.assemble_success",{method:"compacted_json"}),t.generationResult}catch{return t.generationResult=H({content:n}),await E("generation.assemble_success",{method:"compacted_raw"}),t.generationResult}}}catch{}const a=await G.get(`/api/strategic-planning/scenarios/generate/${t.generationId}/chunks`);if(a.data&&Array.isArray(a.data.data)&&a.data.data.length){b.value=a.data.data.length;const e=a.data.data.slice().sort((n,l)=>(n.sequence||0)-(l.sequence||0)).map(n=>n.chunk||"").join("");try{const n=JSON.parse(e);return t.generationResult=H(n),await E("generation.assemble_success",{method:"chunks",count:a.data.data.length}),t.generationResult}catch{return t.generationResult=H({content:e}),await E("generation.assemble_success",{method:"chunks_raw",count:a.data.data.length}),t.generationResult}}}catch{}return null}async function Je(){try{await t.fetchStatus();try{await ee()}catch{}}catch(a){console.error("Refresh status failed",a),h(a?.response?.data?.message||a?.message||"Error al actualizar estado")}}function Ue(){t.prefillDemo(),w.value=`Por favor, genera UN SOLO objeto JSON que describa el escenario generado con las siguientes claves: 
- scenario_metadata: { name, description, scenario_type, horizon_months, fiscal_year }
- capabilities: [ { name, competencies: [ { name, required_level } ], importance } ]
- notes: string
Devuelve únicamente JSON válido sin texto adicional.`,k.value=!0,$.value="client",N.value=null,t.setField("instruction",w.value),t.step=5}return(a,e)=>{const n=p("v-progress-linear"),l=p("v-col"),f=p("v-chip"),_=p("v-card-text"),g=p("v-card"),R=p("v-menu"),A=p("v-btn"),qe=p("v-row"),W=p("v-icon"),Be=p("v-tooltip"),Te=p("v-select"),xe=p("v-radio"),We=p("v-radio-group"),He=p("v-textarea"),Ke=p("v-checkbox"),ge=p("v-spacer"),Qe=p("v-card-title"),Xe=p("v-progress-circular"),Ye=p("v-alert"),Ze=p("v-card-actions"),et=p("v-dialog");return c(),d("div",ft,[e[37]||(e[37]=r("h2",null,"Generar Escenario (Asistido)",-1)),s(qe,{class:"align-center mb-4"},{default:o(()=>[s(l,{cols:"12",md:"8"},{default:o(()=>[s(n,{value:O.value,color:X.value,height:"16",rounded:""},{default:o(()=>[r("div",_t," Paso "+v(u(t).step)+" de 5 / "+v(O.value)+"% ("+v(ie.value)+"/"+v(x.length)+") ",1)]),_:1},8,["value","color"])]),_:1}),s(l,{cols:"12",md:"4",class:"text-right"},{default:o(()=>[s(R,{"offset-y":""},{activator:o(({props:i})=>[s(f,Se(i,{color:X.value,"text-color":"white",class:"cursor-pointer"}),{default:o(()=>[m(v(U.value),1)]),_:1},16,["color"])]),default:o(()=>[s(g,{style:{"max-width":"320px"}},{default:o(()=>[s(_,null,{default:o(()=>[r("div",yt," Campos faltantes (Paso "+v(u(t).step)+") ",1),r("div",ht,[Y.value>0?(c(),d("div",bt," Campos críticos faltantes: "+v(Y.value),1)):C("",!0),r("ul",wt,[(c(!0),d(ne,null,se(fe.value,(i,D)=>(c(),d("li",{key:D},v(i),1))),128)),fe.value.length===0?(c(),d("li",kt," Ninguno: paso completo ")):C("",!0)])])]),_:1})]),_:1})]),_:1}),r("div",Ct,[s(A,{small:"",color:"secondary",onClick:Ue},{default:o(()=>[...e[12]||(e[12]=[m(" Cargar Demo ",-1)])]),_:1})])]),_:1})]),_:1}),(c(),ae(nt(oe.value))),u(t).step===5?(c(),d("div",At,[s(g,{class:"pa-3 mb-4"},{default:o(()=>[r("div",xt,[r("div",null,[e[16]||(e[16]=r("strong",null,"Instrucciones del generador",-1)),r("div",St,[e[15]||(e[15]=r("div",null," Plantilla que se aplica al prompt generado. Soporta Markdown. ",-1)),s(Be,null,{activator:o(({props:i})=>[s(W,Se(i,{class:"ml-2",small:"",color:"primary"}),{default:o(()=>[...e[13]||(e[13]=[m(" mdi-information ",-1)])]),_:1},16)]),default:o(()=>[e[14]||(e[14]=r("span",null," Recomendado: la instrucción debe exigir salida JSON única para integridad del import. ",-1))]),_:1})])]),r("div",Rt,[s(Te,{modelValue:I.value,"onUpdate:modelValue":e[0]||(e[0]=i=>I.value=i),items:["es","en"],dense:"","hide-details":"",style:{width:"90px"}},null,8,["modelValue"]),s(A,{small:"",class:"ml-2",loading:P.value,onClick:e[1]||(e[1]=i=>Z(I.value))},{default:o(()=>[...e[17]||(e[17]=[m("Cargar",-1)])]),_:1},8,["loading"])])]),L.value.length?(c(),d("div",Vt,[s(We,{modelValue:N.value,"onUpdate:modelValue":e[2]||(e[2]=i=>N.value=i),class:"mb-2",onChange:e[3]||(e[3]=i=>Me(i!==null?Number(i):null))},{default:o(()=>[(c(!0),d(ne,null,se(L.value,(i,D)=>(c(),d("div",{key:"instr-"+(i.id??D),style:{padding:"6px 0","border-bottom":"1px solid rgba(0, 0, 0, 0.04)"}},[s(xe,{label:(i.editable?"Versión editable (Operador)":"Versión por defecto (Sistema)")+" / "+(i.author_name||"system")+" ("+(i.created_at?new Date(i.created_at).toLocaleString():"")+")",value:D},null,8,["label","value"])]))),128)),s(xe,{label:"Editar/Usar como instrucción personalizada",value:null})]),_:1},8,["modelValue"])])):C("",!0),s(He,{modelValue:w.value,"onUpdate:modelValue":e[4]||(e[4]=i=>w.value=i),readonly:!k.value,rows:"6",outlined:"",dense:"",placeholder:"Escribe las instrucciones aquí (Markdown)...",class:st({"instruction-error":!me.value.valid})},null,8,["modelValue","readonly","class"]),me.value.valid?C("",!0):(c(),d("div",It,v(me.value.message),1)),r("div",Pt,[s(Ke,{modelValue:k.value,"onUpdate:modelValue":e[5]||(e[5]=i=>k.value=i),label:"Habilitar edición"},null,8,["modelValue"]),s(ge),s(A,{small:"",color:"secondary",class:"mr-2",loading:P.value,onClick:Ne},{default:o(()=>[...e[18]||(e[18]=[m("Restablecer por defecto",-1)])]),_:1},8,["loading"]),s(A,{color:"primary",loading:P.value,onClick:Oe},{default:o(()=>[...e[19]||(e[19]=[m("Guardar instrucciones",-1)])]),_:1},8,["loading"])])]),_:1})])):C("",!0),r("div",Et,[s(A,{color:"info",onClick:Pe,disabled:u(t).step===1},{default:o(()=>[s(W,{left:""},{default:o(()=>[...e[20]||(e[20]=[m("mdi-arrow-left",-1)])]),_:1}),e[21]||(e[21]=m(" Atrás ",-1))]),_:1},8,["disabled"]),s(ge),u(t).step<5?(c(),ae(A,{key:0,color:"primary",class:"mx-2",depressed:"",onClick:Ie},{default:o(()=>[e[23]||(e[23]=m(" Siguiente ",-1)),s(W,{right:""},{default:o(()=>[...e[22]||(e[22]=[m("mdi-arrow-right",-1)])]),_:1})]),_:1})):(c(),ae(A,{key:1,color:"success",class:"mx-2",depressed:"",onClick:$e,loading:u(t).generating},{default:o(()=>[s(W,{left:""},{default:o(()=>[...e[24]||(e[24]=[m("mdi-rocket-launch",-1)])]),_:1}),e[25]||(e[25]=m(" Generar ",-1))]),_:1},8,["loading"]))]),u(t).generationId?(c(),d("div",Mt,[r("p",null," ID: "+v(u(t).generationId)+" '-' Estado: "+v(u(t).generationStatus),1),r("div",Ot,[u(t).generationStatus==="complete"?(c(),d("button",{key:0,onClick:De}," Ver respuesta ")):C("",!0),u(t).generationStatus==="complete"?(c(),d("button",{key:1,onClick:e[6]||(e[6]=()=>{u(t).importAfterAccept=!1,Fe()}),disabled:z.value,style:{"margin-left":"8px"}}," Aceptar y crear escenario ",8,Nt)):C("",!0)]),r("button",{onClick:Je},"Actualizar"),u(t).generationResult?(c(),d("pre",$t,v(JSON.stringify(u(t).generationResult,null,2)),1)):C("",!0)])):C("",!0),s(et,{modelValue:j.value,"onUpdate:modelValue":e[9]||(e[9]=i=>j.value=i),"max-width":"900","onClick:outside":ke},{default:o(()=>[s(g,null,{default:o(()=>[s(Qe,null,{default:o(()=>[...e[26]||(e[26]=[m("Respuesta del LLM",-1)])]),_:1}),s(_,null,{default:o(()=>[S.value?(c(),d("div",jt,[s(Xe,{indeterminate:"",color:"primary",class:"mr-4"}),r("div",null,[e[27]||(e[27]=r("div",null,[r("strong",null,"Esperando respuesta del LLM…")],-1)),e[28]||(e[28]=r("div",{class:"caption"}," La generación está en progreso. Esto puede tardar unos segundos. ",-1)),be.value!==null?(c(),d("div",zt,[m(" Chunks recibidos: "+v(be.value)+" ",1),u(t).generationProgress&&u(t).generationProgress.percent!==null?(c(),d("span",Ft," — "+v(Math.round(u(t).generationProgress.percent))+"%",1)):C("",!0)])):C("",!0)])])):S.value?C("",!0):(c(),d("div",Lt,[u(t).generationResult&&!Le()&&(b.value===0||b.value===null)?(c(),d("div",Dt,[s(Ye,{type:"warning",dense:"",class:"mb-2"},{default:o(()=>[s(W,{class:"mr-2",small:""},{default:o(()=>[...e[29]||(e[29]=[m("mdi-alert-circle-outline",-1)])]),_:1}),e[30]||(e[30]=r("div",null,[r("strong",null,"Respuesta parcial disponible"),r("div",{class:"caption",style:{"margin-top":"4px"}}," Se detectaron metadatos (confianza, assumptions) pero no hay contenido ensamblado en el servidor. Puedes intentar ensamblar los chunks o generar un nuevo intento. ")],-1))]),_:1}),r("div",Gt,[s(A,{small:"",color:"primary",class:"mr-2",loading:S.value,onClick:te},{default:o(()=>[...e[31]||(e[31]=[m(" Reintentar ensamblado ",-1)])]),_:1},8,["loading"]),s(A,{small:"",color:"secondary",loading:S.value,onClick:Ge},{default:o(()=>[...e[32]||(e[32]=[m(" Regenerar (nuevo intento) ",-1)])]),_:1},8,["loading"])])])):(c(),d("div",Jt,[e[33]||(e[33]=r("strong",null,"Resumen:",-1)),r("div",null," Nombre: "+v(u(t).generationResult?.scenario_metadata?.name||u(t).generationResult?.name||u(t).generationResult?.scenario_metadata?.title||(u(t).previewPrompt?(u(t).previewPrompt||"").slice(0,48)+"...":"—")),1),r("div",null," Confianza: "+v(u(t).generationResult?.confidence_score??u(t).generationResult?.scenario_metadata?.confidence_score??"—"),1),r("div",null," Capacidades: "+v((u(t).generationResult?.capabilities||[]).length),1)])),r("pre",Ut,v(JSON.stringify(u(t).generationResult,null,2)),1)])),B.value&&B.value.length?(c(),d("div",qt,[r("div",Bt,v(ve.value||"Errores de validación"),1),r("ul",Tt,[(c(!0),d(ne,null,se(B.value,(i,D)=>(c(),d("li",{key:D},v(i),1))),128))])])):C("",!0)]),_:1}),s(Ze,null,{default:o(()=>[s(ge),s(A,{color:"secondary",text:"",onClick:ke},{default:o(()=>[...e[34]||(e[34]=[m("Cerrar",-1)])]),_:1}),s(A,{color:"primary",onClick:e[7]||(e[7]=i=>we(!1)),loading:z.value,disabled:S.value||u(t).generationStatus!=="complete"},{default:o(()=>[...e[35]||(e[35]=[m("Aceptar y crear escenario",-1)])]),_:1},8,["loading","disabled"]),s(A,{color:"success",onClick:e[8]||(e[8]=i=>we(!0)),loading:z.value,disabled:S.value||u(t).generationStatus!=="complete"},{default:o(()=>[...e[36]||(e[36]=[m("Aceptar y crear + Importar",-1)])]),_:1},8,["loading","disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),q.value?(c(),d("div",Wt,[r("div",Ht,[s(rt,{promptPreview:u(t).previewPrompt||"",onConfirm:je,onEdit:ze},null,8,["promptPreview"]),r("button",{class:"close",onClick:e[10]||(e[10]=i=>q.value=!1)}," Cerrar ")])])):C("",!0),s(gt,{modelValue:de.value,"onUpdate:modelValue":e[11]||(e[11]=i=>de.value=i),title:_e.value,messages:ye.value},null,8,["modelValue","title","messages"])])}}}),sa=Ve(Kt,[["__scopeId","data-v-783278e2"]]);export{sa as default};
