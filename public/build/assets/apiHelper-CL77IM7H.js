const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/authStore-CkNyWsuy.js","assets/app-BQBzBluS.js","assets/app-CsbepBPQ.css"])))=>i.map(i=>d[i]);
import{l as o,N as u}from"./app-BQBzBluS.js";const d=()=>typeof window<"u"&&window.location.hostname==="esalud.appchain.cl"?"https://esalud.appchain.cl":"",h=d();o.defaults.withCredentials=!0;o.defaults.headers.common["X-Requested-With"]="XMLHttpRequest";o.interceptors.request.use(e=>{const r=document.querySelector('meta[name="csrf-token"]')?.getAttribute("content");return r&&(e.headers["X-CSRF-TOKEN"]=r),e});let n=!1,c=[];const l=(e,r=null)=>{c.forEach(({resolve:t,reject:a})=>{e?a(e):t(r)}),c=[]};o.interceptors.response.use(e=>e,async e=>{const r=e.config;if(e.response?.status===419&&!r._retry){if(console.warn("CSRF token mismatch (419), handling..."),n)return new Promise((t,a)=>{c.push({resolve:t,reject:a})}).then(()=>o(r)).catch(t=>Promise.reject(t));r._retry=!0,n=!0;try{console.log("Refreshing authentication tokens..."),await s(),await new Promise(a=>setTimeout(a,300));const t=document.querySelector('meta[name="csrf-token"]')?.getAttribute("content");if(t)return r.headers["X-CSRF-TOKEN"]=t,o.defaults.headers.common["X-CSRF-TOKEN"]=t,console.log("Auth tokens refreshed successfully"),l(null,t),o(r);throw new Error("No CSRF token available after refresh")}catch(t){console.error("Auth refresh failed:",t),l(t,null);try{const{useAuthStore:a}=await u(async()=>{const{useAuthStore:f}=await import("./authStore-CkNyWsuy.js");return{useAuthStore:f}},__vite__mapDeps([0,1,2]));a().logout(),typeof window<"u"&&(window.location.href="/login")}catch(a){console.error("Error importing auth store:",a)}return Promise.reject(t)}finally{n=!1}}if(e.response?.status===401){console.warn("Unauthorized request (401), clearing auth state");try{const{useAuthStore:t}=await u(async()=>{const{useAuthStore:i}=await import("./authStore-CkNyWsuy.js");return{useAuthStore:i}},__vite__mapDeps([0,1,2]));t().logout(),typeof window<"u"&&window.location.pathname!=="/login"&&(window.location.href="/login")}catch(t){console.error("Error importing auth store:",t)}}return Promise.reject(e)});const s=async()=>{try{await o.get(`${h}/sanctum/csrf-cookie`,{headers:{Accept:"application/json"}}),console.log("Sanctum initialized successfully")}catch(e){console.error("Error al inicializar Sanctum:",e)}},m=async(e,r={})=>{try{return await s(),(await o.post(e,r)).data}catch(t){throw t}},p=async(e,r={})=>{try{return await s(),(await o.put(e,r)).data}catch(t){throw t}},y=async(e,r={})=>{try{return await s(),(await o.delete(e,{params:r})).data}catch(t){throw t}},g=async(e=[])=>{try{return await s(),(await o.get(`${h}/api/catalogs`,{params:{endpoints:e}})).data}catch(r){throw r}};export{m as a,g as f,s as i,p,y as r};
