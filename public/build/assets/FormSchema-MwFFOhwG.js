import{d as Oe,H as ze,p as v,n as Ee,r as m,L as je,o as Le,b as u,c as T,e as d,j as i,f as a,g,i as V,q as F,t as w,w as l,k as c,F as K,s as ne,G as re,u as Be,M as Pe,m as Ge}from"./app-BQBzBluS.js";import{f as Me,p as He,a as Ae,r as qe}from"./apiHelper-CL77IM7H.js";import{g as Ke}from"./index.es-CBox0HgD.js";import We from"./FormData-C_Q_stz2.js";const Je={class:"text-h4 font-weight-bold mb-2",style:{color:"white"}},Qe={class:"text-subtitle2",style:{color:"rgba(255, 255, 255, 0.85)"}},Ye={class:"d-flex gap-2"},Xe={class:"text-grey py-8 text-center"},Ze={class:"d-flex align-center justify-space-between mb-3"},et={key:0,class:"d-flex flex-column gap-4"},tt={class:"d-flex flex-column gap-1",style:{"max-height":"320px",overflow:"auto"}},lt={key:1,class:"mt-6 text-center text-secondary"},at=Oe({__name:"FormSchema",props:{peopleId:{},config:{default:()=>({endpoints:{index:"",apiUrl:""},titulo:"Registros",descripcion:"Manage your records",permisos:{crear:!0,editar:!0,eliminar:!0}})},tableConfig:{default:()=>({headers:[],options:{pagination:!0,search:!0}})},itemForm:{default:()=>({fields:[],catalogs:[],layout:"single-column"})},filters:{default:()=>[]},enableRowDetail:{type:Boolean,default:!1}},emits:["sync-role"],setup(O,{expose:ie,emit:de}){const ue=ze(),ce=v(()=>ue.props.auth.user),{notify:N}=Ke(),R=Ee(),ve=v(()=>{const t=R.global.current.value;return`linear-gradient(135deg, ${t.colors.primary} 0%, ${t.colors.secondary} 100%)`}),W=v(()=>{const t=R.global.current.value;return`linear-gradient(135deg, ${t.colors.accent} 0%, ${t.colors.primary} 100%)`}),J=v(()=>{const t=R.global.current.value;return`linear-gradient(135deg, ${t.colors.primary} 0%, ${t.colors.secondary} 100%)`}),me=v(()=>{const t=R.global.current.value;return`linear-gradient(135deg, ${t.colors.primary} 0%, ${t.colors.secondary} 100%)`}),pe=v(()=>{const t=R.global.current.value;return`linear-gradient(135deg, ${t.colors.accent} 0%, ${t.colors.error} 100%)`});ce.value,pe.value;const fe=de,$=O,y=v(()=>({...{endpoints:{index:"",apiUrl:""},titulo:"Registros",descripcion:"Manage your records",permisos:{crear:!0,editar:!0,eliminar:!0},detail:!1},...$.config||{}})),Q=v(()=>({...{headers:[],options:{pagination:!0,search:!0}},...$.tableConfig||{}})),z=v(()=>({...{fields:[],catalogs:[],layout:"single-column"},...$.itemForm||{}})),Y=m([]),L=m(!1),U=m(!1),b=m(null),E=m(!1),j=m(!1),B=m(null),p=m(null),M=m(null),P=m({}),S=m(""),_=je({}),D=m(!1),I=m(null),H=m("active"),X=v(()=>$.enableRowDetail||y.value.detail===!0),ge=t=>{H.value=t},ye=()=>{$.filters?.forEach(t=>{_[t.field]=null})},A=async()=>{if(y.value.endpoints.index){L.value=!0,b.value=null;try{const t=await fetch(y.value.endpoints.index,{headers:{Accept:"application/json"}}),e=await t.text();if(!t.ok)throw new Error(`HTTP ${t.status}: ${e.slice(0,200)}`);let s;try{s=e?JSON.parse(e):null}catch(o){throw new Error(`Respuesta no JSON (status ${t.status}): ${e.slice(0,200)}`)}Y.value=s?.data||s||[]}catch(t){b.value=t.message||"Failed to load records",console.error("loadItems error",t)}finally{L.value=!1}}},be=async()=>{if(!z.value.catalogs||z.value.catalogs.length===0){console.log("No catalogs to load");return}console.log("Loading catalogs:",z.value.catalogs);const t=z.value.catalogs||[];try{const e=await Me(t);console.log("Catalogs loaded from API:",e),console.log("Catalogs keys:",Object.keys(e)),console.log("All catalogs:",{departments:e.departments,roles:e.roles,skills:e.skills,responseFull:e}),console.log("Departments length:",e.departments?.length),console.log("Roles length:",e.roles?.length),P.value=e,console.log("Catalogs assigned to state:",P.value)}catch(e){console.error("Failed to load catalogs",e)}},Z=v(()=>$.filters?.map(t=>{const e=t.catalogKey,s=t.items??(e?P.value[e]||[]:[]);return{...t,items:s}})||[]),_e=v(()=>{let t=Y.value;if(S.value){const o=S.value.toLowerCase();t=t.filter(r=>Object.values(r).some(f=>String(f).toLowerCase().includes(o)))}const e=o=>{if(o==null)return null;const r=Number(o);return!Number.isNaN(r)&&String(o).trim()!==""?r:String(o)},s=(o,r)=>{if(Object.prototype.hasOwnProperty.call(o,r))return o[r];if(r.endsWith("_id")){const f=r.replace(/_id$/,""),h=o?.[f];if(h&&Object.prototype.hasOwnProperty.call(h,"id"))return h.id}};return $.filters?.forEach(o=>{const r=_[o.field];if(!(r==null||r===""))if(o.type==="text"){const f=String(r).toLowerCase();t=t.filter(h=>{const x=s(h,o.field);return x==null?!1:String(x).toLowerCase().includes(f)})}else{const f=e(r);t=t.filter(h=>e(s(h,o.field))===f)}}),t}),xe=()=>{p.value=null,E.value=!0},ke=t=>{p.value={...t},D.value=!1,E.value=!0},ee=()=>{E.value=!1,p.value=null,B.value?.reset()},he=async()=>{if(!B.value?.validate()){N({type:"error",text:"Please fill all required fields"});return}U.value=!0,b.value=null;try{const t={...B.value.formData};p.value?.id&&(t.id=p.value.id);const e={data:t};p.value&&p.value.id?(await He(`${y.value.endpoints.apiUrl}/${p.value.id}`,e),N({type:"success",text:"Record updated successfully"})):(await Ae(y.value.endpoints.apiUrl,e),N({type:"success",text:"Record created successfully"})),ee(),A()}catch(t){b.value=t.message||"Failed to save record",N({type:"error",text:b.value||"Failed to save record"}),console.error(t)}finally{U.value=!1}},we=t=>{D.value=!1,M.value=t,j.value=!0},Ce=async()=>{if(M.value){U.value=!0,b.value=null;try{await qe(`${y.value.endpoints.apiUrl}/${M.value.id}`),N({type:"success",text:"Record deleted successfully"}),j.value=!1,A()}catch(t){b.value=t.message||"Failed to delete record",N({type:"error",text:b.value||"Failed to delete record"}),console.error(t)}finally{U.value=!1}}},Ve=()=>{S.value="",Object.keys(_).forEach(t=>{_[t]=null})},$e=(t,e)=>{if(!X.value)return;const s=e?.item?.raw??e?.item??e;te(s)},Se=()=>{I.value&&fe("sync-role",I.value.id)},te=t=>{I.value=t,H.value="active",D.value=!0};ie({openDetail:te});const De=v(()=>Q.value.headers.map(t=>{const e=t.value||t.key,s=String(e).replace(/\./g,"__");return{title:t.text||t.title,key:s,value:s,origKey:e,...t}})),Fe=v(()=>{const t=Q.value.headers||[];return _e.value.map(e=>{const s={...e};return t.forEach(o=>{const r=o.value||o.key;if(r&&String(r).includes(".")){const f=String(r).replace(/\./g,"__");s[f]=Ne(e,r)}if(o.type==="date"&&r){const f=String(o.value||o.key).replace(/\./g,"__");s[f]=le(e[o.value])}}),s})}),le=t=>{if(!t)return"";try{const e=new Date(t);if(!isNaN(e.getTime())){const s=String(e.getDate()).padStart(2,"0"),o=String(e.getMonth()+1).padStart(2,"0"),r=e.getFullYear();return`${s}/${o}/${r}`}}catch{return t}return t},Ne=(t,e)=>{const s=e.split(".").reduce((o,r)=>o?.[r],t);return s&&(e.includes("date")||e.includes("fecha"))?le(s):s};return Le(()=>{ye(),A(),be()}),(t,e)=>{const s=u("v-btn"),o=u("v-text-field"),r=u("v-col"),f=u("v-select"),h=u("v-row"),x=u("v-card-text"),C=u("v-card"),Re=u("v-progress-circular"),Ue=u("v-alert"),G=u("v-icon"),Ie=u("v-data-table"),ae=u("v-card-title"),Te=u("v-divider"),oe=u("v-spacer"),se=u("v-card-actions"),q=u("v-dialog");return d(),T(K,null,[i("div",{class:"pa-4",style:F({"--table-gradient":J.value})},[i("div",{class:"d-flex justify-space-between align-center mb-4",style:F([{background:ve.value},{padding:"1.5rem","border-radius":"8px"}])},[i("div",null,[i("h1",Je,w(y.value.titulo),1),i("p",Qe,w(y.value.descripcion),1)]),y.value.permisos?.crear?(d(),g(s,{key:0,"prepend-icon":"mdi-plus",onClick:xe,size:"large",variant:"tonal",style:F({background:W.value,color:"white"})},{default:l(()=>[...e[8]||(e[8]=[c(" New Record ",-1)])]),_:1},8,["style"])):V("",!0)],4),O.filters&&O.filters.length>0?(d(),g(C,{key:0,class:"mb-4",variant:"outlined"},{default:l(()=>[a(x,null,{default:l(()=>[a(h,{dense:""},{default:l(()=>[a(r,{cols:"12",sm:"6",md:12/(O.filters.length+1)},{default:l(()=>[a(o,{modelValue:S.value,"onUpdate:modelValue":e[0]||(e[0]=n=>S.value=n),label:"Search",placeholder:"Search records...","prepend-icon":"mdi-magnify",variant:"outlined",density:"compact",clearable:""},null,8,["modelValue"])]),_:1},8,["md"]),(d(!0),T(K,null,ne(Z.value,n=>(d(),g(r,{key:n.field,cols:"12",sm:"6",md:12/(Z.value.length+1)},{default:l(()=>[n.type==="text"?(d(),g(o,{key:0,modelValue:_[n.field],"onUpdate:modelValue":k=>_[n.field]=k,label:n.label,placeholder:n.placeholder,variant:"outlined",density:"compact",clearable:""},null,8,["modelValue","onUpdate:modelValue","label","placeholder"])):n.type==="select"?(d(),g(f,{key:1,modelValue:_[n.field],"onUpdate:modelValue":k=>_[n.field]=k,label:n.label,items:n.items||[],"item-title":"name","item-value":"id",variant:"outlined",density:"compact",clearable:""},null,8,["modelValue","onUpdate:modelValue","label","items"])):n.type==="date"?(d(),g(o,{key:2,modelValue:_[n.field],"onUpdate:modelValue":k=>_[n.field]=k,label:n.label,type:"date",variant:"outlined",density:"compact",clearable:""},null,8,["modelValue","onUpdate:modelValue","label"])):V("",!0)]),_:2},1032,["md"]))),128)),a(r,{cols:"12",sm:"6",md:12/(O.filters.length+1)},{default:l(()=>[a(s,{color:"secondary",variant:"outlined",block:"",onClick:Ve},{default:l(()=>[...e[9]||(e[9]=[c(" Reset Filters ",-1)])]),_:1})]),_:1},8,["md"])]),_:1})]),_:1})]),_:1})):(d(),g(C,{key:1,class:"mb-4",variant:"outlined"},{default:l(()=>[a(x,null,{default:l(()=>[a(o,{modelValue:S.value,"onUpdate:modelValue":e[1]||(e[1]=n=>S.value=n),label:"Search",placeholder:"Search records...","prepend-icon":"mdi-magnify",variant:"outlined",density:"compact",clearable:""},null,8,["modelValue"])]),_:1})]),_:1})),L.value?(d(),g(C,{key:2,class:"mb-4"},{default:l(()=>[a(x,{class:"py-8 text-center"},{default:l(()=>[a(Re,{indeterminate:"",color:"primary"}),e[10]||(e[10]=i("p",{class:"mt-4"},"Loading records...",-1))]),_:1})]),_:1})):V("",!0),b.value?(d(),g(Ue,{key:3,type:"error",closable:"",class:"mb-4","onClick:close":e[2]||(e[2]=n=>b.value=null)},{default:l(()=>[c(w(b.value),1)]),_:1})):V("",!0),L.value?V("",!0):(d(),g(C,{key:4},{default:l(()=>[a(Ie,{headers:De.value,items:Fe.value,class:"elevation-0",density:"comfortable",hover:"","mobile-breakpoint":"md",style:F({"--table-gradient":J.value}),"onClick:row":$e},{"item.actions":l(({item:n})=>[i("div",Ye,[y.value.permisos?.editar?(d(),g(s,{key:0,class:"action-btn",icon:"mdi-pencil",size:"large",color:"primary",variant:"tonal",onClick:re(k=>ke(n),["stop"]),title:"Editar"},null,8,["onClick"])):V("",!0),y.value.permisos?.eliminar?(d(),g(s,{key:1,class:"action-btn",icon:"mdi-trash-can",size:"large",color:"error",variant:"tonal",onClick:re(k=>we(n),["stop"]),title:"Borrar"},null,8,["onClick"])):V("",!0)])]),"no-data":l(()=>[i("div",Xe,[a(G,{size:"48",class:"mb-4"},{default:l(()=>[...e[11]||(e[11]=[c("mdi-inbox-outline",-1)])]),_:1}),e[12]||(e[12]=i("p",null,"No records found",-1))])]),_:1},8,["headers","items","style"])]),_:1}))],4),a(q,{modelValue:E.value,"onUpdate:modelValue":e[3]||(e[3]=n=>E.value=n),"max-width":"960px",persistent:"",transition:"dialog-transition"},{default:l(()=>[a(C,{class:"form-dialog",elevation:"24"},{default:l(()=>[i("div",{class:"dialog-header-gradient",style:F({background:me.value})},[a(ae,{class:"text-h5 font-weight-bold text-white"},{default:l(()=>[a(G,{class:"mr-2"},{default:l(()=>[c(w(p.value?"mdi-pencil":"mdi-plus-circle"),1)]),_:1}),c(" "+w(p.value?"Edit Record":"New Record"),1)]),_:1})],4),a(x,{class:"py-6",style:F({"--form-primary":Be(R).global.current.value.colors.primary})},{default:l(()=>[a(We,{ref_key:"formDataRef",ref:B,fields:z.value.fields,"initial-data":p.value||void 0,catalogs:P.value},null,8,["fields","initial-data","catalogs"])]),_:1},8,["style"]),a(Te),a(se,{class:"pa-4"},{default:l(()=>[a(oe),a(s,{color:"secondary",variant:"outlined",onClick:ee,size:"large"},{default:l(()=>[a(G,{left:""},{default:l(()=>[...e[13]||(e[13]=[c("mdi-close",-1)])]),_:1}),e[14]||(e[14]=c(" Cancel ",-1))]),_:1}),a(s,{onClick:he,loading:U.value,size:"large",variant:"tonal",style:F({background:W.value,color:"white"})},{default:l(()=>[a(G,{left:""},{default:l(()=>[c(w(p.value?"mdi-check-circle":"mdi-plus-circle"),1)]),_:1}),c(" "+w(p.value?"Update":"Create"),1)]),_:1},8,["loading","style"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(q,{modelValue:j.value,"onUpdate:modelValue":e[5]||(e[5]=n=>j.value=n),"max-width":"400px"},{default:l(()=>[a(C,null,{default:l(()=>[a(ae,null,{default:l(()=>[...e[15]||(e[15]=[c("Confirm Delete",-1)])]),_:1}),a(x,null,{default:l(()=>[...e[16]||(e[16]=[c(" Are you sure you want to delete this record? ",-1),i("br",null,null,-1),i("small",{class:"text-error"},"This action cannot be undone.",-1)])]),_:1}),a(se,null,{default:l(()=>[a(oe),a(s,{color:"secondary",variant:"text",onClick:e[4]||(e[4]=n=>j.value=!1)},{default:l(()=>[...e[17]||(e[17]=[c(" Cancel ",-1)])]),_:1}),a(s,{color:"error",onClick:Ce,loading:U.value},{default:l(()=>[...e[18]||(e[18]=[c(" Delete ",-1)])]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),X.value?(d(),g(q,{key:0,modelValue:D.value,"onUpdate:modelValue":e[7]||(e[7]=n=>D.value=n),width:"720",persistent:"",scrim:"transparent",transition:"dialog-right-transition"},{default:l(()=>[a(C,{class:"pa-4",height:"100%",style:{"min-height":"100vh","border-left":"1px solid var(--v-theme-surface-variant)"}},{default:l(()=>[i("div",Ze,[e[19]||(e[19]=i("div",null,[i("div",{class:"text-subtitle-1 font-weight-medium"}," Detalle "),i("div",{class:"text-body-2 text-secondary"}," Registro seleccionado ")],-1)),a(s,{icon:"mdi-close",variant:"text",onClick:e[6]||(e[6]=n=>D.value=!1)})]),I.value?(d(),T("div",et,[Pe(t.$slots,"detail",{item:I.value,tab:H.value,setTab:ge,sync:Se,close:()=>{D.value=!1}},()=>[a(C,{flat:"",border:"",class:"pa-3"},{default:l(()=>[e[20]||(e[20]=i("div",{class:"text-subtitle-2 mb-2"}," Detalle del registro ",-1)),e[21]||(e[21]=i("div",{class:"text-body-2 mb-2 text-secondary"},' Personaliza este contenido usando el slot "detail". ',-1)),i("div",tt,[(d(!0),T(K,null,ne(I.value,(n,k)=>(d(),T("div",{key:k,class:"text-body-2"},[i("strong",null,w(k)+":",1),c(" "+w(n),1)]))),128))])]),_:1})],!0)])):(d(),T("div",lt," Selecciona una fila para ver detalle. "))]),_:3})]),_:3},8,["modelValue"])):V("",!0)],64)}}}),it=Ge(at,[["__scopeId","data-v-2875e71b"]]);export{it as default};
