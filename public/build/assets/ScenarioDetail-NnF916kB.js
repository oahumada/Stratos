import{d as ie,k as y,B as xe,r as d,b as n,f as P,w as a,e as t,g as e,t as _,c,F as B,q as Q,j as m,J as Ee,Q as Ge,o as Se,D as nt,R as st,m as we,s as he,S as ye,i as O,U as be,T as Be,v as te,l as Fe,O as Ve,H as We,G as qe,u as _e,_ as it,K as Pe}from"./app-B4Q7DtOZ.js";import{u as Te}from"./useApi-D-wG6FEk.js";import{u as rt,_ as dt,T as ct}from"./TransformModal-DVE5F0u1.js";import ut from"./GenerateWizard-DkWH2_NZ.js";import pt from"./Index-BwFWo2yK.js";import"./apiHelper-BLoNXDsG.js";import"./FieldHelp-CfAKUl3b.js";import"./PreviewConfirm-BUvksGLW.js";import"./StepHorizon.vue_vue_type_script_setup_true_lang-DHmQkcQl.js";import"./StepIdentity-DIuH8JJK.js";import"./StepIntent.vue_vue_type_script_setup_true_lang-B4u9Ekjf.js";import"./StepResources.vue_vue_type_script_setup_true_lang-Ch7d6lwL.js";import"./StepSituation.vue_vue_type_script_setup_true_lang-NxYaDh5q.js";import"./transform-9n3FYwas.js";const mt={class:"text-h6"},vt={class:"text-caption"},_t={key:0},gt={key:1},ft={class:"mb-3"},yt={class:"mb-3"},bt=ie({__name:"IncubatedReviewModal",props:{modelValue:{type:Boolean,default:!1},item:{type:Object,default:null},scenarioId:{type:[Number,String],default:null}},emits:["update:modelValue","close","promoted"],setup(p,{emit:N}){const f=p,I=N,S=Te(),{showSuccess:s,showError:w}=Ee(),k=y(!1),r=y(!!f.modelValue);xe(()=>f.modelValue,h=>{r.value=!!h}),xe(r,h=>{I("update:modelValue",h)});function x(){f.item?.id&&(globalThis.location.href=`/capabilities/${f.item.id}`)}async function q(){if(!(!f.scenarioId||!f.item?.id)){k.value=!0;try{const h=await S.post(`/api/strategic-planning/scenarios/${f.scenarioId}/capabilities/${f.item.id}/promote`);s("Capability promovida"),I("promoted",h?.data??null),I("close"),r.value=!1}catch(h){console.error(h),w("Error promoviendo capability")}finally{k.value=!1}}}return(h,$)=>{const X=d("v-card-title"),T=d("v-card-text"),v=d("v-spacer"),l=d("v-btn"),V=d("v-card-actions"),z=d("v-card"),U=d("v-dialog");return n(),P(U,{modelValue:r.value,"onUpdate:modelValue":$[1]||($[1]=G=>r.value=G),"max-width":"800"},{default:a(()=>[t(z,null,{default:a(()=>[t(X,null,{default:a(()=>[e("div",null,[e("div",mt,"Revisi√≥n: "+_(p.item?.name),1),e("div",vt,_(p.item?.description),1)])]),_:1}),t(T,null,{default:a(()=>[p.item?(n(),c("div",gt,[e("div",ft,[$[2]||($[2]=e("strong",null,"Competencias",-1)),e("ul",null,[(n(!0),c(B,null,Q(p.item.competencies||[],G=>(n(),c("li",{key:G.id},_(G.name),1))),128))])]),e("div",yt,[$[3]||($[3]=e("strong",null,"Metadatos",-1)),e("pre",null,_(JSON.stringify(p.item,null,2)),1)])])):(n(),c("div",_t,"No hay datos."))]),_:1}),t(V,null,{default:a(()=>[t(v),t(l,{text:"",onClick:$[0]||($[0]=G=>h.$emit("close"))},{default:a(()=>[...$[4]||($[4]=[m("Cerrar",-1)])]),_:1}),t(l,{color:"primary",onClick:x},{default:a(()=>[...$[5]||($[5]=[m("Editar",-1)])]),_:1}),t(l,{color:"success",onClick:q,loading:k.value},{default:a(()=>[...$[6]||($[6]=[m("Promover",-1)])]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])}}}),xt=Ge("changeSet",()=>{const p=y(!1),N=y(null);return{loading:p,error:N,createChangeSet:async(r,x)=>{p.value=!0,N.value=null;try{const q=await fetch(`/api/strategic-planning/scenarios/${r}/change-sets`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(x)});if(!q.ok)throw new Error("Error creating ChangeSet");return await q.json()}catch(q){throw N.value=q.message||"Unknown error",q}finally{p.value=!1}},previewChangeSet:async r=>{p.value=!0,N.value=null;try{const x=await fetch(`/api/strategic-planning/change-sets/${r}/preview`);if(!x.ok)throw new Error("Error fetching preview");return await x.json()}catch(x){throw N.value=x.message||"Unknown error",x}finally{p.value=!1}},applyChangeSet:async(r,x)=>{p.value=!0,N.value=null;try{const q={method:"POST"};x&&(q.headers={"Content-Type":"application/json"},q.body=JSON.stringify(x));const h=await fetch(`/api/strategic-planning/change-sets/${r}/apply`,q);if(!h.ok)throw new Error("Error applying ChangeSet");return await h.json()}catch(q){throw N.value=q.message||"Unknown error",q}finally{p.value=!1}},canApplyChangeSet:async r=>{p.value=!0,N.value=null;try{const x=await fetch(`/api/strategic-planning/change-sets/${r}/can-apply`);if(!x.ok)throw new Error("Error checking permissions");return await x.json()}catch(x){throw N.value=x.message||"Unknown error",x}finally{p.value=!1}},approveChangeSet:async r=>{p.value=!0,N.value=null;try{const x=await fetch(`/api/strategic-planning/change-sets/${r}/approve`,{method:"POST"});if(!x.ok)throw new Error("Error approving ChangeSet");return await x.json()}catch(x){throw N.value=x.message||"Unknown error",x}finally{p.value=!1}},rejectChangeSet:async r=>{p.value=!0,N.value=null;try{const x=await fetch(`/api/strategic-planning/change-sets/${r}/reject`,{method:"POST"});if(!x.ok)throw new Error("Error rejecting ChangeSet");return await x.json()}catch(x){throw N.value=x.message||"Unknown error",x}finally{p.value=!1}}}}),ht=ie({props:{id:{type:Number,required:!0},title:{type:String,default:"ChangeSet"}},setup(p,{emit:N}){const f=xt(),I=y(null),S=y(!1),s=y(!1),w=y([]),k=y({}),r=y({}),x=y(null),q=R=>{(R.key==="Escape"||R.key==="Esc")&&N("close")},h=async()=>{S.value=!0;try{const R=await f.previewChangeSet(p.id);I.value=R.preview??R.data??R;const g=I.value?.ops??[];w.value=g.map(()=>!1);try{const o=await f.canApplyChangeSet(p.id);s.value=o?.can_apply??o?.data?.can_apply??!1}catch{s.value=!1}}finally{S.value=!1}},$=R=>{if(!I.value||!Array.isArray(I.value.ops))return;const g=I.value.ops[R];g&&(g._reverted=!g._reverted,g._reverted?(k.value[R]=!0,I.value.ops=I.value.ops.map((o,W)=>k.value[W]?{...o,_ignored:!0}:o).filter(o=>!o._ignored),w.value=I.value.ops.map(()=>!1)):(k.value={},h()))},X=R=>{w.value[R]=!w.value[R]},T=R=>{k.value[R]=!0,I.value&&Array.isArray(I.value.ops)&&(I.value.ops=I.value.ops.map((g,o)=>k.value[o]?{...g,_ignored:!0}:g).filter(g=>!g._ignored))},v=R=>{const g=I.value?.ops?.[R];if(!g)return;const o=JSON.stringify(g,null,2);navigator.clipboard?.writeText(o).catch(()=>{})},l=R=>{r.value[R]=!r.value[R]},V=R=>R?R.startsWith("create")?"op-create":R.startsWith("update")?"op-update":R.startsWith("delete")||R.includes("sunset")?"op-delete":"op-default":"op-default",z=R=>R?R.startsWith("create")?"‚ûï":R.startsWith("update")?"‚úèÔ∏è":R.startsWith("delete")||R.includes("sunset")?"üóëÔ∏è":"‚öôÔ∏è":"‚öôÔ∏è",U=async()=>{S.value=!0;try{const R=Object.keys(k.value).filter(o=>k.value[Number(o)]).map(o=>Number(o)),g=R.length?{ignored_indexes:R}:void 0;await f.applyChangeSet(p.id,g),window.location.reload()}finally{S.value=!1}},G=async()=>{S.value=!0;try{await f.approveChangeSet(p.id),window.location.reload()}finally{S.value=!1}},K=async()=>{S.value=!0;try{await f.rejectChangeSet(p.id),window.location.reload()}finally{S.value=!1}};return Se(()=>{nt(()=>{try{x.value?.focus()}catch{}window.addEventListener("keydown",q)})}),st(()=>{window.removeEventListener("keydown",q)}),h(),{preview:I,loading:S,apply:U,canApply:s,approve:G,reject:K,collapsed:w,toggle:X,ignoreOp:T,copyOp:v,opClass:V,opIcon:z,revertOp:$,ignored:k,modalRef:x,showRaw:r,toggleRaw:l}}}),wt=["aria-labelledby"],kt=["id"],$t={key:0},Ct={class:"op-header"},Vt={class:"op-badge"},Et={class:"op-type"},St={class:"op-actions"},zt=["onClick","aria-expanded","aria-controls"],Rt=["onClick","aria-label"],Nt=["onClick","aria-label"],Tt=["id"],It={key:0},At={class:"op-payload-summary"},Mt={key:0},Ut={key:1},jt={key:1},Ot={class:"op-row-actions"},qt=["onClick","aria-label"],Pt=["onClick","aria-label"],Dt={key:0,class:"op-reverted"},Jt={key:1},Lt={key:0,class:"no-ops"},Ht={key:1},Ft={key:2},Gt={class:"actions"},Bt=["disabled"],Wt=["disabled"],Kt=["disabled"];function Qt(p,N,f,I,S,s){const w=d("v-alert");return n(),c("div",{class:"changeset-modal",role:"dialog","aria-modal":"true","aria-labelledby":`changeset-title-${p.id}`,tabindex:"-1",ref:"modalRef"},[e("h3",{id:`changeset-title-${p.id}`},_(p.title),9,kt),p.preview&&p.preview.ops&&p.preview.ops.length?(n(),c("div",$t,[e("p",null,[N[4]||(N[4]=e("strong",null,"Operaciones:",-1)),m(" "+_(p.preview.ops.length),1)]),e("ol",null,[(n(!0),c(B,null,Q(p.preview.ops,(k,r)=>(n(),c("li",{key:r,class:he(p.opClass(k.type))},[e("div",Ct,[e("div",null,[e("span",Vt,_(p.opIcon(k.type)),1),e("strong",null,_(r+1)+".",1),e("em",Et,_(k.type),1)]),e("div",St,[e("button",{type:"button",onClick:x=>p.toggle(r),"aria-expanded":!p.collapsed[r],"aria-controls":`op-details-${r}`},_(p.collapsed[r]?"Mostrar":"Ocultar"),9,zt),e("button",{type:"button",onClick:x=>p.ignoreOp(r),"aria-label":`Ignorar operaci√≥n ${r+1}: ${k.type}`},"Ignorar",8,Rt),e("button",{type:"button",onClick:x=>p.revertOp(r),"aria-label":p.preview.ops[r]&&p.preview.ops[r]._reverted?`Deshacer revertir operaci√≥n ${r+1}`:`Revertir operaci√≥n ${r+1}`},_(p.preview.ops[r]&&p.preview.ops[r]._reverted?"Deshacer Revertir":"Revertir"),9,Nt)])]),t(Be,{name:"fade"},{default:a(()=>[ye(e("div",{class:"op-details",id:`op-details-${r}`},[k.payload&&typeof k.payload=="object"&&!p.showRaw[r]?(n(),c("div",It,[e("div",At,[(n(!0),c(B,null,Q(k.payload,(x,q)=>(n(),c("div",{key:q,class:"payload-row"},[e("strong",null,_(q)+":",1),typeof x=="object"?(n(),c("span",Mt,_(JSON.stringify(x)),1)):(n(),c("span",Ut,_(String(x)),1))]))),128))])])):(n(),c("pre",jt,_(JSON.stringify(k,null,2)),1)),e("div",Ot,[e("button",{type:"button",onClick:x=>p.copyOp(r),"aria-label":`Copiar operaci√≥n ${r+1}`},"Copiar op",8,qt),e("button",{type:"button",onClick:x=>p.toggleRaw(r),"aria-label":`Alternar vista JSON ${r+1}`},_(p.showRaw[r]?"Ocultar JSON":"Ver JSON"),9,Pt),k._reverted?(n(),c("span",Dt,"Revertida")):O("",!0)])],8,Tt),[[be,!p.collapsed[r]]])]),_:2},1024)],2))),128))])])):(n(),c("div",Jt,[p.preview&&p.preview.ops&&p.preview.ops.length===0?(n(),c("div",Lt,[t(w,{type:"info",variant:"tonal"},{default:a(()=>[...N[5]||(N[5]=[m("No hay operaciones en este ChangeSet.",-1)])]),_:1})])):p.preview?(n(),c("pre",Ht,_(JSON.stringify(p.preview,null,2)),1)):(n(),c("div",Ft,"No preview available"))])),e("div",Gt,[e("button",{onClick:N[0]||(N[0]=k=>p.$emit("close"))},"Cerrar"),e("button",{onClick:N[1]||(N[1]=(...k)=>p.apply&&p.apply(...k)),disabled:p.loading||!p.canApply},"Aplicar",8,Bt),p.canApply?(n(),c("button",{key:0,onClick:N[2]||(N[2]=(...k)=>p.approve&&p.approve(...k)),disabled:p.loading},"Aprobar",8,Wt)):O("",!0),p.canApply?(n(),c("button",{key:1,onClick:N[3]||(N[3]=(...k)=>p.reject&&p.reject(...k)),disabled:p.loading},"Rechazar",8,Kt)):O("",!0)])],8,wt)}const Xt=we(ht,[["render",Qt],["__scopeId","data-v-3e1b3568"]]),Yt={class:"status-timeline"},Zt={class:"text-caption text-medium-emphasis ml-2"},ea=ie({__name:"StatusTimeline",props:{scenarioId:{}},setup(p,{expose:N}){const f=p,I=Te(),{showError:S}=Ee(),s=y(!1),w=y([]),k=y(!1),r=async()=>{s.value=!0;try{const v=await I.get(`/api/strategic-planning/scenarios/${f.scenarioId}`);w.value=v.data?.status_events||[]}catch{S("Error al cargar historial de cambios")}finally{s.value=!1}},x=()=>{k.value=!0,w.value.length===0&&r()},q=te(()=>[...w.value].sort((v,l)=>new Date(l.created_at).getTime()-new Date(v.created_at).getTime())),h=v=>new Date(v).toLocaleDateString("es-ES",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),$=v=>v.to_decision_status==="approved"?"mdi-check-circle":v.to_decision_status==="rejected"?"mdi-close-circle":v.to_decision_status==="pending_approval"?"mdi-clock-alert":v.to_execution_status==="in_progress"?"mdi-play-circle":v.to_execution_status==="paused"?"mdi-pause-circle":v.to_execution_status==="completed"?"mdi-check-bold":"mdi-arrow-right-circle",X=v=>v.to_decision_status==="approved"?"success":v.to_decision_status==="rejected"?"error":v.to_decision_status==="pending_approval"?"warning":v.to_execution_status==="in_progress"?"primary":v.to_execution_status==="paused"?"warning":v.to_execution_status==="completed"?"success":"grey",T=v=>{let l="";return v.from_decision_status&&v.to_decision_status?l+=`Estado de decisi√≥n: ${v.from_decision_status} ‚Üí ${v.to_decision_status}`:v.to_decision_status&&(l+=`Estado de decisi√≥n: ${v.to_decision_status}`),v.from_execution_status&&v.to_execution_status?(l&&(l+=" | "),l+=`Estado de ejecuci√≥n: ${v.from_execution_status} ‚Üí ${v.to_execution_status}`):v.to_execution_status&&(l&&(l+=" | "),l+=`Estado de ejecuci√≥n: ${v.to_execution_status}`),l||"Cambio de estado"};return N({openTimeline:x}),(v,l)=>{const V=d("v-btn"),z=d("v-icon"),U=d("v-spacer"),G=d("v-chip"),K=d("v-card-title"),R=d("v-divider"),g=d("v-alert"),o=d("v-card-subtitle"),W=d("v-card-text"),b=d("v-card"),u=d("v-timeline-item"),E=d("v-timeline"),j=d("v-progress-linear"),M=d("v-card-actions"),D=d("v-dialog");return n(),c("div",Yt,[t(V,{color:"grey-darken-1",variant:"outlined","prepend-icon":"mdi-timeline-clock",onClick:x},{default:a(()=>[...l[2]||(l[2]=[m(" Ver Historial de Cambios ",-1)])]),_:1}),t(D,{modelValue:k.value,"onUpdate:modelValue":l[1]||(l[1]=F=>k.value=F),"max-width":"800",scrollable:""},{default:a(()=>[t(b,null,{default:a(()=>[t(K,{class:"d-flex align-center"},{default:a(()=>[t(z,{icon:"mdi-timeline-clock",class:"mr-2"}),l[3]||(l[3]=m(" Audit Trail - Historial de Cambios de Estado ",-1)),t(U),t(G,{color:"primary",variant:"flat",size:"small"},{default:a(()=>[m(_(w.value.length)+" eventos ",1)]),_:1})]),_:1}),t(R),t(W,{style:{"max-height":"600px"}},{default:a(()=>[w.value.length===0&&!s.value?(n(),P(g,{key:0,type:"info",variant:"tonal"},{default:a(()=>[...l[4]||(l[4]=[m(" No hay eventos de cambio de estado registrados ",-1)])]),_:1})):O("",!0),t(E,{side:"end",align:"start",density:"compact","line-inset":"12"},{default:a(()=>[(n(!0),c(B,null,Q(q.value,F=>(n(),P(u,{key:F.id,"dot-color":X(F),size:"small"},{icon:a(()=>[t(z,{icon:$(F),size:"small"},null,8,["icon"])]),default:a(()=>[t(b,{elevation:"2",class:"mb-3"},{default:a(()=>[t(K,{class:"text-body-1 pb-2"},{default:a(()=>[m(_(T(F)),1)]),_:2},1024),t(o,{class:"pb-2"},{default:a(()=>[t(z,{icon:"mdi-account",size:"x-small",class:"mr-1"}),m(" "+_(F.changed_by.name)+" ",1),e("span",Zt," ¬∑ "+_(h(F.created_at)),1)]),_:2},1024),F.notes?(n(),P(W,{key:0},{default:a(()=>[t(g,{type:"info",variant:"outlined",density:"compact",class:"text-body-2"},{default:a(()=>[l[5]||(l[5]=e("strong",null,"Notas:",-1)),m(" "+_(F.notes),1)]),_:2},1024)]),_:2},1024)):(n(),P(W,{key:1,class:"text-caption text-medium-emphasis"},{default:a(()=>[...l[6]||(l[6]=[m(" Sin notas adicionales ",-1)])]),_:1}))]),_:2},1024)]),_:2},1032,["dot-color"]))),128))]),_:1}),s.value?(n(),P(j,{key:1,indeterminate:"",color:"primary",class:"mt-4"})):O("",!0)]),_:1}),t(R),t(M,null,{default:a(()=>[t(U),t(V,{variant:"text",onClick:l[0]||(l[0]=F=>k.value=!1)},{default:a(()=>[...l[7]||(l[7]=[m("Cerrar",-1)])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])])}}}),ta=we(ea,[["__scopeId","data-v-af41c9c0"]]),aa={class:"incubated-cube-review"},oa={class:"cube-review-info mb-8"},la={class:"flex items-start gap-4 rounded-xl border border-indigo-100 bg-indigo-50/50 p-4"},na={class:"flex-shrink-0 rounded-lg bg-indigo-600 p-3 shadow-lg shadow-indigo-200"},sa={class:"flex flex-shrink-0 gap-2 self-center"},ia={key:0,class:"mt-4 rounded-xl border-2 border-indigo-100 bg-white p-6 shadow-sm"},ra={class:"mb-4 flex items-center gap-2"},da={class:"flex items-center gap-3"},ca={class:"leading-relaxed text-slate-700"},ua={class:"font-bold text-indigo-700"},pa={class:"max-height-[150px] mt-6 overflow-y-auto rounded-xl border border-slate-100 bg-slate-50 p-3"},ma={key:"loading",class:"flex flex-col items-center justify-center p-20"},va={key:"empty",class:"rounded-2xl border-2 border-dashed border-slate-200 bg-slate-50/50 p-16 text-center"},_a={class:"mx-auto mb-4 flex h-20 w-20 items-center justify-center rounded-full bg-slate-100"},ga={key:"content",class:"space-y-10"},fa={class:"flex items-center justify-between rounded-t-2xl border-b border-slate-100 bg-slate-50/30 px-8 py-5"},ya={class:"flex items-center gap-4"},ba={class:"text-xl font-black text-slate-800"},xa={class:"grid grid-cols-1 gap-8 p-8 md:grid-cols-2 lg:grid-cols-3"},ha={class:"absolute top-4 right-4 z-10"},wa={class:"mb-4 flex flex-wrap gap-2"},ka={class:"pa-2 max-w-[250px]"},$a={class:"space-y-1 text-[10px]"},Ca={class:"font-black"},Va={class:"pa-2 max-w-[250px]"},Ea={class:"space-y-1 text-[10px]"},Sa={class:"font-black"},za={key:1,class:"rounded-md border border-emerald-200 bg-emerald-100 px-2.5 py-1 text-[10px] font-black tracking-wider text-emerald-700 uppercase shadow-sm"},Ra={class:"text-lg font-bold text-slate-900 transition-colors group-hover/card:text-indigo-700"},Na={class:"mt-2 line-clamp-2 h-10 text-sm leading-relaxed text-slate-500"},Ta={class:"mt-6 space-y-3"},Ia={class:"flex items-center justify-between"},Aa={class:"truncate pr-2 text-sm font-medium text-slate-700"},Ma={class:"flex gap-1"},Ua={key:0,class:"mt-12"},ja={class:"grid grid-cols-2 gap-4 md:grid-cols-4 lg:grid-cols-6"},Oa={class:"truncate text-xs font-bold text-slate-700"},qa=ie({__name:"IncubatedCubeReview",props:{scenarioId:{}},setup(p){const N=p,{showSuccess:f,showError:I}=Ee(),S=y(!1),s=y(!1),w=y(!1),k=y(!1),r=y([]),x=y([]),q=y([]),h=y([]),$=y({}),X=te(()=>r.value.length>0||x.value.length>0),T=b=>{const[u,E]=b.split(":"),j=Number(E);return u==="role"?x.value.find(M=>M.id===j)?.role_name||"Rol":u==="capability"?r.value.find(M=>M.id===j)?.name||"Capacidad":`ID: ${E}`},v=te(()=>[]),l=async()=>{S.value=!0;try{const b=await Fe.get(`/api/strategic-planning/scenarios/${N.scenarioId}/incubated-items`),u=b.data.data||b.data;r.value=u.capabilities||[],x.value=u.roles||[],q.value=u.competencies||[]}catch(b){console.error("Fetch error:",b),I("No se pudieron cargar los datos del laboratorio.")}finally{S.value=!1}},V=b=>b.human_leverage>70?"Estrat√©gico (E)":b.human_leverage>40?"T√°ctico (T)":"Operacional (O)",z=b=>b.human_leverage>70?"bg-purple-50 text-purple-700 border border-purple-100":b.human_leverage>40?"bg-blue-50 text-blue-700 border border-blue-100":"bg-emerald-50 text-emerald-700 border border-emerald-100",U=b=>x.value.length?b.llm_id?x.value.filter(u=>{const E=u.key_competencies;return Array.isArray(E)?E.some(j=>String(j).startsWith(b.llm_id)):!1}):r.value.length>0&&b.id===r.value[0].id?x.value:[]:[],G=b=>{let u=b.key_competencies;if(typeof u=="string")try{u=JSON.parse(u)}catch{u=[]}return Array.isArray(u)?u.map(E=>typeof E=="string"?{name:E,level:3}:{name:E.name||E.key||"Competencia",level:E.level||E.score||3}):[]},K=(b,u)=>h.value.includes(`${u}:${b}`),R=(b,u)=>{const E=`${u}:${b}`,j=h.value.indexOf(E);j>-1?h.value.splice(j,1):h.value.push(E)},g=b=>{const u=$.value[b];U(r.value.find(M=>M.id===b)).forEach(M=>{const D=`role:${M.id}`,F=h.value.includes(D);u&&!F&&h.value.push(D),!u&&F&&h.value.splice(h.value.indexOf(D),1)});const j=`capability:${b}`;u&&!h.value.includes(j)?h.value.push(j):!u&&h.value.includes(j)&&h.value.splice(h.value.indexOf(j),1)},o=()=>{w.value=!0},W=async()=>{s.value=!0,w.value=!1;try{const b={items:h.value.map(u=>{const[E,j]=u.split(":");return{type:E,id:Number(j)}})};await Fe.post(`/api/strategic-planning/scenarios/${N.scenarioId}/incubated-items/approve`,b),f("Estructura organizacional conciliada exitosamente."),await l(),h.value=[],$.value={}}catch{I("Fallo en la conciliaci√≥n de elementos.")}finally{s.value=!1}};return Se(l),(b,u)=>{const E=d("v-icon"),j=d("v-btn"),M=d("v-expand-transition"),D=d("v-card-title"),F=d("v-alert"),oe=d("v-card-text"),le=d("v-divider"),de=d("v-spacer"),ce=d("v-card-actions"),ue=d("v-card"),A=d("v-dialog"),$e=d("v-progress-circular"),L=d("v-checkbox"),Ce=d("v-chip"),ze=d("v-tooltip");return n(),c("div",aa,[e("div",oa,[e("div",la,[e("div",na,[t(E,{color:"white",size:"28"},{default:a(()=>[...u[3]||(u[3]=[m("mdi-cube-scan",-1)])]),_:1})]),u[4]||(u[4]=e("div",{class:"flex-grow"},[e("h4",{class:"text-lg leading-tight font-bold text-indigo-900"}," Cubo de Roles e Ingenier√≠a Organizacional "),e("p",{class:"mt-1 max-w-2xl text-sm text-indigo-700/80"},[m(" Esta fase permite validar la coherencia tridimensional (Procesos x Arquetipos x Maestr√≠a). Los elementos en esta secci√≥n est√°n en modo "),e("span",{class:"font-bold underline decoration-indigo-300"},"laboratorio"),m(" y no afectar√°n el cat√°logo hasta ser conciliados. ")])],-1)),e("div",sa,[t(j,{variant:"tonal",color:"indigo",icon:"mdi-help-circle-outline",onClick:u[0]||(u[0]=Y=>k.value=!k.value),class:"rounded-lg"}),t(j,{variant:"elevated",color:"indigo",loading:s.value,onClick:o,disabled:h.value.length===0,class:"text-none font-bold",rounded:"lg"},{default:a(()=>[m(" Aprobar para Ingenier√≠a ("+_(h.value.length)+") ",1)]),_:1},8,["loading","disabled"])])]),t(M,null,{default:a(()=>[k.value?(n(),c("div",ia,[e("div",ra,[t(E,{color:"indigo"},{default:a(()=>[...u[5]||(u[5]=[m("mdi-book-open-variant",-1)])]),_:1}),u[6]||(u[6]=e("h5",{class:"text-sm font-black tracking-widest text-indigo-900 uppercase"}," Gu√≠a de Conciliaci√≥n Organizacional ",-1))]),u[7]||(u[7]=e("div",{class:"grid grid-cols-1 gap-4 md:grid-cols-4"},[e("div",{class:"rounded-lg border border-emerald-100 bg-emerald-50 p-3 text-center"},[e("div",{class:"mb-1 text-[10px] font-bold text-emerald-700 uppercase"}," Nuevo (0%) "),e("div",{class:"text-xs font-bold text-slate-800"}," üìà Enriquecimiento "),e("div",{class:"mt-1 text-[9px] text-slate-500"},[e("strong",null,"Job Enlargement"),m(": Aumento horizontal. Creaci√≥n de capacidad/rol inexistente. ")])]),e("div",{class:"rounded-lg border border-amber-100 bg-amber-50 p-3 text-center"},[e("div",{class:"mb-1 text-[10px] font-bold text-amber-700 uppercase"}," Parcial (40-85%) "),e("div",{class:"text-xs font-bold text-slate-800"}," üîÑ Transformaci√≥n "),e("div",{class:"mt-1 text-[9px] text-slate-500"},[e("strong",null,"Job Enrichment"),m(": Aumento vertical. El rol evoluciona en profundidad (Upskilling). ")])]),e("div",{class:"rounded-lg border border-slate-100 bg-slate-50 p-3 text-center"},[e("div",{class:"mb-1 text-[10px] font-bold text-slate-500 uppercase"}," Existente (>85%) "),e("div",{class:"text-xs font-bold text-slate-800"}," ‚úÖ Mantenci√≥n "),e("div",{class:"mt-1 text-[9px] text-slate-500"},[e("strong",null,"Job Stabilization"),m(": El rol actual es maduro y suficiente para el dise√±o. ")])]),e("div",{class:"rounded-lg border border-red-100 bg-red-50 p-3 text-center"},[e("div",{class:"mb-1 text-[10px] font-bold text-red-700 uppercase"}," No Propuesto "),e("div",{class:"text-xs font-bold text-slate-800"}," üìâ Extinci√≥n "),e("div",{class:"mt-1 text-[9px] text-slate-500"},[e("strong",null,"Job Substitution"),m(": Potencial obsolescencia por cambio de modelo estrat√©gico. ")])])],-1)),u[8]||(u[8]=e("p",{class:"mt-4 text-[11px] text-slate-400 italic"}," Esta l√≥gica asegura que las propuestas de la IA se traduzcan en estados t√©cnicos coherentes en la Matriz de Ingenier√≠a. ",-1))])):O("",!0)]),_:1})]),t(A,{modelValue:w.value,"onUpdate:modelValue":u[2]||(u[2]=Y=>w.value=Y),"max-width":"500",persistent:""},{default:a(()=>[t(ue,{class:"overflow-hidden rounded-2xl border-t-4 border-indigo-600"},{default:a(()=>[t(D,{class:"bg-indigo-50/50 px-6 py-4"},{default:a(()=>[e("div",da,[t(E,{color:"indigo-darken-2"},{default:a(()=>[...u[9]||(u[9]=[m("mdi-shield-alert",-1)])]),_:1}),u[10]||(u[10]=e("span",{class:"font-black text-indigo-900"},"Confirmar Conciliaci√≥n",-1))])]),_:1}),t(oe,{class:"pa-6"},{default:a(()=>[e("p",ca,[u[11]||(u[11]=m(" Est√°s a punto de ",-1)),e("span",ua,"promover "+_(h.value.length)+" elementos",1),u[12]||(u[12]=m(" del laboratorio a la fase de ingenier√≠a. ",-1))]),t(F,{type:"warning",variant:"tonal",icon:"mdi-alert-octagon",class:"mt-4 border-l-4 border-amber-500",density:"comfortable"},{default:a(()=>[...u[13]||(u[13]=[e("div",{class:"text-sm font-bold"}," Advertencia de Ingenier√≠a ",-1),e("div",{class:"mt-1 text-xs opacity-90"},' Este paso crea registros maestros en la base de datos de competencias y roles. Una vez promovidos, no podr√°n revertirse a "incubaci√≥n" desde esta vista. ',-1)])]),_:1}),e("div",pa,[u[15]||(u[15]=e("div",{class:"mb-2 text-[10px] font-bold text-slate-400 uppercase"}," Entidades a promover: ",-1)),(n(!0),c(B,null,Q(h.value,Y=>(n(),c("div",{key:Y,class:"mb-1 flex items-center gap-2 text-xs text-slate-600"},[t(E,{size:"10",color:"indigo"},{default:a(()=>[...u[14]||(u[14]=[m("mdi-check",-1)])]),_:1}),m(" "+_(T(Y)),1)]))),128))])]),_:1}),t(le),t(ce,{class:"pa-4 bg-slate-50/80"},{default:a(()=>[t(de),t(j,{variant:"text",color:"slate-darken-1",onClick:u[1]||(u[1]=Y=>w.value=!1),class:"text-none"},{default:a(()=>[...u[16]||(u[16]=[m(" Cancelar ",-1)])]),_:1}),t(j,{variant:"elevated",color:"indigo-darken-1",onClick:W,loading:s.value,class:"text-none font-bold"},{default:a(()=>[...u[17]||(u[17]=[m(" S√≠, Proceder a Ingenier√≠a ",-1)])]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(Be,{name:"fade",mode:"out-in"},{default:a(()=>[S.value?(n(),c("div",ma,[t($e,{indeterminate:"",color:"indigo",size:"64",width:"6"}),u[18]||(u[18]=e("span",{class:"mt-4 animate-pulse font-medium text-indigo-400"},"Analizando geometr√≠a del cubo...",-1))])):X.value?(n(),c("div",ga,[(n(!0),c(B,null,Q(r.value,Y=>(n(),c("div",{key:Y.id,class:"process-block group rounded-2xl border border-slate-200 bg-white shadow-sm transition-all duration-300 hover:border-indigo-200 hover:shadow-md"},[e("div",fa,[e("div",ya,[t(L,{modelValue:$.value[Y.id],"onUpdate:modelValue":ee=>$.value[Y.id]=ee,onChange:ee=>g(Y.id),"hide-details":"",density:"compact",color:"indigo"},null,8,["modelValue","onUpdate:modelValue","onChange"]),e("div",null,[u[22]||(u[22]=e("span",{class:"text-[10px] font-bold tracking-[0.2em] text-indigo-500 uppercase"},"Capacidad / Dominio",-1)),e("h4",ba,_(Y.name),1)])]),t(Ce,{size:"small",variant:"flat",color:"slate-100",class:"border border-slate-200 font-bold text-slate-600"},{default:a(()=>[m(_(Y.category||"Core Business"),1)]),_:2},1024)]),e("div",xa,[(n(!0),c(B,null,Q(U(Y),ee=>(n(),c("div",{key:ee.id,class:"role-card-premium group/card relative rounded-2xl border border-slate-100 bg-white p-6 transition-all duration-300 hover:-translate-y-1 hover:border-indigo-200 hover:shadow-xl"},[e("div",ha,[t(L,{"model-value":K(ee.id,"role"),"onUpdate:modelValue":ae=>R(ee.id,"role"),"hide-details":"",density:"compact",color:"indigo"},null,8,["model-value","onUpdate:modelValue"])]),e("div",wa,[e("span",{class:he(["rounded-md px-2.5 py-1 text-[10px] font-black tracking-wider uppercase shadow-sm",z(ee)])},_(V(ee)),3),ee.similarity_warnings&&ee.similarity_warnings.length>0?(n(),c(B,{key:0},[ee.similarity_warnings[0].score>.85?(n(),P(ze,{key:0,location:"top"},{activator:a(({props:ae})=>[e("span",Ve({ref_for:!0},ae,{class:"cursor-help rounded-md border border-slate-200 bg-slate-100 px-2.5 py-1 text-[10px] font-black tracking-wider text-slate-700 uppercase shadow-sm"})," En Cat√°logo ("+_(Math.round(ee.similarity_warnings[0].score*100))+"%) ",17)]),default:a(()=>[e("div",ka,[u[23]||(u[23]=e("div",{class:"mb-1 border-b border-white/20 pb-1 font-bold text-slate-200"}," Match Alto Detectado ",-1)),e("div",$a,[(n(!0),c(B,null,Q(ee.similarity_warnings,ae=>(n(),c("div",{key:ae.id,class:"flex justify-between gap-4"},[e("span",null,"‚Ä¢ "+_(ae.name),1),e("span",Ca,_(Math.round(ae.score*100))+"%",1)]))),128))]),u[24]||(u[24]=e("div",{class:"mt-2 text-[9px] italic opacity-80"}," Sugerencia: Mantenci√≥n. Este rol ya est√° cubierto por el cat√°logo actual. ",-1))])]),_:2},1024)):(n(),P(ze,{key:1,location:"top"},{activator:a(({props:ae})=>[e("span",Ve({ref_for:!0},ae,{class:"cursor-help rounded-md border border-amber-200 bg-amber-100 px-2.5 py-1 text-[10px] font-black tracking-wider text-amber-700 uppercase shadow-sm"})," Parcial ("+_(Math.round(ee.similarity_warnings[0].score*100))+"%) ",17)]),default:a(()=>[e("div",Va,[u[25]||(u[25]=e("div",{class:"mb-1 border-b border-white/20 pb-1 font-bold text-amber-200"}," Similitud Parcial ",-1)),e("div",Ea,[(n(!0),c(B,null,Q(ee.similarity_warnings,ae=>(n(),c("div",{key:ae.id,class:"flex justify-between gap-4"},[e("span",null,"‚Ä¢ "+_(ae.name),1),e("span",Sa,_(Math.round(ae.score*100))+"%",1)]))),128))]),u[26]||(u[26]=e("div",{class:"mt-2 text-[9px] italic opacity-80"}," Sugerencia: Transformaci√≥n / Upskilling. El rol evoluciona respecto al cat√°logo. ",-1))])]),_:2},1024))],64)):(n(),c("span",za," Nuevo Rol "))]),e("h5",Ra,_(ee.role_name),1),e("p",Na,_(ee.role_description),1),e("div",Ta,[e("div",Ia,[u[28]||(u[28]=e("span",{class:"text-[10px] font-bold tracking-widest text-slate-400 uppercase"},"Aptitud Requerida",-1)),t(E,{size:"14",color:"slate-300"},{default:a(()=>[...u[27]||(u[27]=[m("mdi-chevron-right",-1)])]),_:1})]),(n(!0),c(B,null,Q(G(ee),(ae,Ie)=>(n(),c("div",{key:Ie,class:"comp-item flex items-center justify-between rounded-lg border border-transparent bg-slate-50/50 p-2.5 transition-all hover:border-slate-200 hover:bg-white"},[e("span",Aa,_(ae.name),1),e("div",Ma,[(n(),c(B,null,Q(5,Re=>e("div",{key:Re,class:he(["h-1.5 w-1.5 rounded-full",Re<=ae.level?"bg-indigo-500 shadow-sm shadow-indigo-200":"bg-slate-200"])},null,2)),64))])]))),128))])]))),128))])]))),128)),v.value.length>0?(n(),c("div",Ua,[u[29]||(u[29]=e("div",{class:"mb-6 flex items-center gap-3"},[e("div",{class:"h-px flex-grow bg-slate-200"}),e("span",{class:"text-xs font-black tracking-[0.3em] text-slate-400 uppercase"},"Competencias sin anclaje"),e("div",{class:"h-px flex-grow bg-slate-200"})],-1)),e("div",ja,[(n(!0),c(B,null,Q(v.value,Y=>(n(),c("div",{key:Y.id,class:"flex items-center gap-2 rounded-xl border border-slate-100 bg-white p-3 transition-all hover:border-indigo-100"},[t(L,{"model-value":K(Y.id,"competency"),"onUpdate:modelValue":ee=>R(Y.id,"competency"),"hide-details":"",density:"compact",color:"indigo"},null,8,["model-value","onUpdate:modelValue"]),e("span",Oa,_(Y.name),1)]))),128))])])):O("",!0)])):(n(),c("div",va,[e("div",_a,[t(E,{size:"40",color:"slate-lighten-1"},{default:a(()=>[...u[19]||(u[19]=[m("mdi-cube-off-outline",-1)])]),_:1})]),u[20]||(u[20]=e("h3",{class:"text-xl font-bold text-slate-800"}," No hay propuestas incubadas ",-1)),u[21]||(u[21]=e("p",{class:"mx-auto mt-2 max-w-sm text-slate-500"}," Utiliza el motor de IA para generar una propuesta de roles y competencias para este escenario. ",-1))]))]),_:1})])}}}),Pa=we(qa,[["__scopeId","data-v-adfaa3da"]]),Ke=Ge("roleCompetency",()=>{const p=y(null),N=y(""),f=y(12),I=y([]),S=y([]),s=y([]),w=y(!1),k=y(null),r=y(null),x=te(()=>I.value.map(V=>({roleId:V.role_id,roleName:V.role_name,fte:V.fte||0,status:V.role_change,human_leverage:V.human_leverage,archetype:V.archetype,mappings:new Map(s.value.filter(z=>z.role_id===V.role_id&&z.scenario_id===p.value).map(z=>[z.competency_id,z]))}))),q=te(()=>S.value.map(V=>({id:V.id,name:V.name,capability_id:V.capability_id??null,capability_name:V.capability_name??V.category??"General",category:V.category??null})));return{scenarioId:p,scenarioName:N,horizonMonths:f,roles:I,competencies:S,mappings:s,loading:w,error:k,success:r,matrixRows:x,competencyColumns:q,loadScenarioData:async V=>{w.value=!0,k.value=null;try{const z=await fetch(`/api/scenarios/${V}/step2/data`);if(!z.ok)throw new Error("Error loading scenario data");const U=await z.json();p.value=V,N.value=U.scenario.name,f.value=U.scenario.horizon_months||12,I.value=U.roles,S.value=U.competencies,s.value=U.mappings}catch(z){k.value=z.message||"Error loading scenario data"}finally{w.value=!1}},saveMapping:async V=>{w.value=!0,k.value=null;try{const z=await fetch(`/api/scenarios/${p.value}/step2/mappings`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:V.id,role_id:V.role_id,competency_id:V.competency_id,required_level:V.required_level,is_core:V.is_core,is_referent:V.is_referent??!1,change_type:V.change_type,rationale:V.rationale,competency_version_id:V.competency_version_id??null})});if(!z.ok)throw new Error("Error saving mapping");const U=await z.json(),G=s.value.findIndex(K=>K.role_id===V.role_id&&K.competency_id===V.competency_id);G>=0?s.value[G]=U.mapping:s.value.push(U.mapping),r.value=U.message||"Mapping saved successfully",setTimeout(()=>r.value=null,3e3)}catch(z){k.value=z.message||"Error saving mapping"}finally{w.value=!1}},removeMapping:async(V,z,U)=>{w.value=!0,k.value=null;try{if(!(await fetch(`/api/scenarios/${p.value}/step2/mappings/${U}`,{method:"DELETE"})).ok)throw new Error("Error removing mapping");s.value=s.value.filter(K=>!(K.role_id===V&&K.competency_id===z)),r.value="Mapping removed successfully",setTimeout(()=>r.value=null,3e3)}catch(G){k.value=G.message||"Error removing mapping"}finally{w.value=!1}},addNewRole:async V=>{w.value=!0,k.value=null;try{const z=await fetch(`/api/scenarios/${p.value}/step2/roles`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(V)});if(!z.ok)throw new Error("Error adding role");const U=await z.json();I.value.push(U.role),r.value=U.message||"Role added successfully",setTimeout(()=>r.value=null,3e3)}catch(z){k.value=z.message||"Error adding role"}finally{w.value=!1}},getMapping:(V,z)=>s.value.find(U=>U.role_id===V&&U.competency_id===z&&U.scenario_id===p.value),clearMessages:()=>{k.value=null,r.value=null}}}),Da={class:"space-y-4"},Ja={key:0},La={key:1,class:"space-y-3"},Ha=ie({__name:"AddRoleDialog",props:{visible:{type:Boolean}},emits:["save","close"],setup(p,{emit:N}){const f=N,I=y(!1),S=y([]),s=y({type:"existing",role_id:null,role_name:"",fte:1,role_change:"create",impact_level:"medium",evolution_type:"new_role",rationale:""}),w=["create","modify","eliminate","maintain"],k=["critical","high","medium","low"],r=["new_role","upgrade_skills","transformation","downsize","elimination"],x=async()=>{I.value=!0;try{f("save",{...s.value,role_id:s.value.type==="existing"?s.value.role_id:null,role_name:s.value.type==="new"?s.value.role_name:null})}finally{I.value=!1}};return(async()=>{try{try{const h=await fetch("/api/roles");if(h.ok){const $=await h.json();let X=[];Array.isArray($?.data)?X=$.data:Array.isArray($)&&(X=$),S.value=X;return}}catch{}try{const h=We();S.value=h.props.roles||[]}catch(h){console.error("Error loading roles from page props:",h),S.value=[]}}catch(h){console.error("Error loading roles:",h),S.value=[]}})(),(h,$)=>{const X=d("v-card-title"),T=d("v-radio"),v=d("v-radio-group"),l=d("v-select"),V=d("v-text-field"),z=d("v-textarea"),U=d("v-card-text"),G=d("v-btn"),K=d("v-card-actions"),R=d("v-card"),g=d("v-dialog");return n(),P(g,{"model-value":p.visible,"max-width":"500px","onUpdate:modelValue":$[9]||($[9]=o=>h.$emit("close"))},{default:a(()=>[t(R,null,{default:a(()=>[t(X,null,{default:a(()=>[...$[10]||($[10]=[m("Agregar Nuevo Rol",-1)])]),_:1}),t(U,{class:"py-6"},{default:a(()=>[e("div",Da,[e("div",null,[$[11]||($[11]=e("div",{id:"role-type-label",class:"mb-2 block text-sm font-semibold"}," Seleccionar o crear rol: ",-1)),t(v,{modelValue:s.value.type,"onUpdate:modelValue":$[0]||($[0]=o=>s.value.type=o),"aria-labelledby":"role-type-label"},{default:a(()=>[t(T,{value:"existing",label:"Usar rol existente"}),t(T,{value:"new",label:"Crear rol nuevo"})]),_:1},8,["modelValue"])]),s.value.type==="existing"?(n(),c("div",Ja,[t(l,{modelValue:s.value.role_id,"onUpdate:modelValue":$[1]||($[1]=o=>s.value.role_id=o),items:S.value,"item-title":"name","item-value":"id",label:"Seleccionar rol",density:"compact"},null,8,["modelValue","items"])])):O("",!0),s.value.type==="new"?(n(),c("div",La,[t(V,{modelValue:s.value.role_name,"onUpdate:modelValue":$[2]||($[2]=o=>s.value.role_name=o),label:"Nombre del rol",density:"compact"},null,8,["modelValue"]),t(V,{modelValue:s.value.fte,"onUpdate:modelValue":$[3]||($[3]=o=>s.value.fte=o),modelModifiers:{number:!0},type:"number",label:"FTE (personas)",density:"compact"},null,8,["modelValue"]),t(l,{modelValue:s.value.evolution_type,"onUpdate:modelValue":$[4]||($[4]=o=>s.value.evolution_type=o),items:r,label:"Tipo de evoluci√≥n",density:"compact"},null,8,["modelValue"])])):O("",!0),t(l,{modelValue:s.value.role_change,"onUpdate:modelValue":$[5]||($[5]=o=>s.value.role_change=o),items:w,label:"Cambio del rol",density:"compact"},null,8,["modelValue"]),t(l,{modelValue:s.value.impact_level,"onUpdate:modelValue":$[6]||($[6]=o=>s.value.impact_level=o),items:k,label:"Nivel de impacto",density:"compact"},null,8,["modelValue"]),t(z,{modelValue:s.value.rationale,"onUpdate:modelValue":$[7]||($[7]=o=>s.value.rationale=o),label:"Justificaci√≥n",density:"compact",rows:"3"},null,8,["modelValue"])])]),_:1}),t(K,{class:"flex justify-end gap-3 px-6 pb-4"},{default:a(()=>[t(G,{variant:"text",onClick:$[8]||($[8]=o=>h.$emit("close"))},{default:a(()=>[...$[12]||($[12]=[m("Cancelar",-1)])]),_:1}),t(G,{color:"primary",onClick:x,loading:I.value,variant:"elevated"},{default:a(()=>[...$[13]||($[13]=[m(" Agregar Rol ",-1)])]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["model-value"])}}}),Fa={key:0,class:"cell-content flex flex-col items-center justify-center h-full gap-1 px-2 py-2"},Ga={class:"text-xs text-center text-gray-600"},Ba={key:0,class:"font-mono"},Wa={key:1,class:"font-mono"},Ka={class:"flex gap-1 mt-1"},Qa={class:"text-center"},Xa=ie({__name:"CellContent",props:{mapping:{}},emits:["edit","remove"],setup(p){const N=te(()=>S.mapping&&{maintenance:"‚úÖ",transformation:"üîÑ",enrichment:"üìà",extinction:"üìâ"}[S.mapping.change_type]||""),f=te(()=>S.mapping&&{maintenance:"Mant.",transformation:"Transf.",enrichment:"Enriq.",extinction:"Extinc."}[S.mapping.change_type]||""),I=te(()=>S.mapping?{maintenance:"bg-green-500",transformation:"bg-blue-500",enrichment:"bg-green-600",extinction:"bg-red-500"}[S.mapping.change_type]||"bg-gray-500":"bg-gray-300"),S=p;return(s,w)=>{const k=d("v-btn"),r=d("v-icon");return p.mapping?(n(),c("div",Fa,[e("div",{class:he(["px-2 py-1 rounded text-xs font-semibold text-white",I.value])},_(N.value)+" "+_(f.value),3),e("div",Ga,[p.mapping.change_type==="transformation"?(n(),c("div",Ba," Lvl "+_(p.mapping.current_level||"?")+" ‚Üí "+_(p.mapping.required_level),1)):(n(),c("div",Wa," Lvl "+_(p.mapping.required_level),1))]),e("div",Ka,[t(k,{icon:"mdi-pencil",size:"x-small",variant:"text",density:"compact",onClick:w[0]||(w[0]=qe(x=>s.$emit("edit"),["stop"]))}),t(k,{icon:"mdi-delete",size:"x-small",variant:"text",color:"red",density:"compact",onClick:w[1]||(w[1]=qe(x=>s.$emit("remove"),["stop"]))})])])):(n(),c("div",{key:1,class:"cell-empty h-full flex items-center justify-center cursor-pointer hover:bg-blue-50 transition-colors border-2 border-dashed border-gray-300 hover:border-blue-300 rounded",onClick:w[2]||(w[2]=qe(x=>s.$emit("edit"),["stop"]))},[e("div",Qa,[t(r,{icon:"mdi-plus-circle",class:"text-gray-400 hover:text-blue-500 mb-1"}),w[3]||(w[3]=e("div",{class:"text-xs text-gray-500"},"Click para asignar",-1))])]))}}}),Ya=we(Xa,[["__scopeId","data-v-81e9f69d"]]),Za={key:0,class:"mb-4"},eo={class:"mb-6 rounded bg-gray-50 p-4"},to={class:"font-semibold"},ao={key:1,class:"mb-4 rounded border-l-4 border-yellow-400 bg-yellow-50 p-3"},oo={class:"flex flex-wrap gap-2"},lo={class:"mb-6"},no={class:"mb-3 flex items-center gap-2"},so={class:"mb-2 cursor-pointer rounded border border-gray-200 p-3 hover:bg-gray-50"},io={class:"mb-2 cursor-pointer rounded border border-gray-200 p-3 hover:bg-gray-50"},ro={class:"mb-2 cursor-pointer rounded border border-gray-200 p-3 hover:bg-gray-50"},co={class:"mb-2 cursor-pointer rounded border border-gray-200 p-3 hover:bg-gray-50"},uo={key:2,class:"mb-6"},po={class:"flex items-center justify-between"},mo={class:"mb-1 text-xs font-black tracking-wider uppercase"},vo={class:"text-sm leading-snug"},_o={key:3,class:"animate-pulse-slow mb-6"},go={class:"mb-2 flex items-center gap-2 text-xs font-black tracking-wider text-amber-700 uppercase"},fo={key:4,class:"mb-6"},yo={class:"flex items-center gap-2"},bo={key:5,class:"mb-6"},xo={class:"rounded border-l-4 border-blue-500 bg-blue-50 p-4"},ho={class:"flex items-center gap-4"},wo={class:"flex-1"},ko={class:"flex-1"},$o={class:"mt-3"},Co={class:"mt-3"},Vo={key:0,class:"mt-3"},Eo={key:0,class:"ml-2 text-sm text-gray-600"},So={key:6,class:"mb-6"},zo={class:"rounded border-l-4 border-green-500 bg-green-50 p-4"},Ro={class:"mt-3"},No={class:"mt-3"},To={key:7,class:"mb-6"},Io={class:"rounded border-l-4 border-red-500 bg-red-50 p-4"},Ao={class:"mb-3"},Mo={class:"space-y-2"},Uo={class:"flex items-center"},jo={class:"flex items-center"},Oo={class:"flex items-center"},qo={key:8,class:"mb-6"},Po={class:"mb-4"},Do={class:"mb-6"},Jo=ie({__name:"RoleCompetencyStateModal",props:{visible:{type:Boolean},roleId:{},roleName:{},archetype:{},competencyId:{},competencyName:{},mapping:{}},emits:["save","close"],setup(p,{emit:N}){const f=p,I=N,S=y(!1),s=y(!1),w=y(!1),k=rt(),r=Ke(),x=y([]),q=te(()=>({E:"Estrat√©gico",T:"T√°ctico",O:"Operacional"})[f.archetype||"T"]||"T√°ctico"),h=te(()=>{const g=l.value.required_level,o=f.archetype||"T",W=l.value.is_referent;if(o==="E"){if(g<4)return{color:"warning",icon:"mdi-alert-decagram",title:"Arquitectura D√©bil",message:`Un Rol Estrat√©gico suele requerir niveles 4 o 5. El nivel ${g} podr√≠a ser insuficiente para el Job Enrichment esperado.`}}else if(o==="O"){if(g>3&&!W)return{color:"info",icon:"mdi-lightbulb-on",title:"Sobrecarga T√©cnica",message:`Nivel ${g} es inusualmente alto para un Rol Operacional. Verifica si no hay un exceso de Job Enrichment, o marca este rol como Referente/Mentor.`};if(g>3&&W)return{color:"success",icon:"mdi-account-star",title:"Rol de Referencia Validado",message:`Este rol operacional act√∫a como mentor t√©cnico. El nivel ${g} es coherente con su funci√≥n de mentor√≠a.`}}else if(o==="T"){if(g<2)return{color:"warning",icon:"mdi-alert-outline",title:"Nivel Insuficiente",message:"Un Rol T√°ctico requiere al menos nivel 2 o 3 para asegurar la coordinaci√≥n efectiva."};if(g>4&&!W)return{color:"info",icon:"mdi-lightbulb-on",title:"Nivel Inusual",message:`Nivel ${g} es inusualmente alto para un Rol T√°ctico. Considera si este rol deber√≠a ser Estrat√©gico o marcarlo como Referente.`}}return{color:"success",icon:"mdi-check-decagram",title:"Dise√±o Coherente",message:`El nivel ${g} es consistente con un Arquetipo ${q.value}.`}}),$=[{title:"‚úÖ Mantenci√≥n (Job Stabilization)",text:"El dise√±o del puesto es maduro. El foco es la sostenibilidad del nivel de maestr√≠a actual. No requiere cambios estructurales."},{title:"üîÑ Transformaci√≥n (Job Enrichment)",text:"<strong>Aumento Vertical (Herzberg)</strong>: El rol crece en complejidad y autonom√≠a. Requiere un salto de nivel o <strong>Upskilling</strong> para mutar el ADN del rol."},{title:"üìà Enriquecimiento (Job Enlargement)",text:"<strong>Aumento Horizontal (Hackman & Oldham)</strong>: Se a√±aden nuevas tareas/competencias al mismo nivel de responsabilidad para diversificar el rol."},{title:"üìâ Extinci√≥n (Job Substitution)",text:"<strong>Destrucci√≥n Creativa (Schumpeter)</strong>: El rol es desplazado por la automatizaci√≥n o cambio de modelo. Requiere plan de transici√≥n o reskilling."}];async function X(){try{const g=await k.getVersions(f.competencyId);x.value=g||[],f.mapping?!f.mapping.change_type&&x.value.length>0&&(l.value.change_type="transformation"):l.value.change_type=x.value.length>0?"transformation":"enrichment"}catch{x.value=[]}}Se(()=>X()),xe(()=>f.competencyId,()=>X());const T=y({message:"",color:""}),v=y([]),l=y({id:null,change_type:"maintenance",required_level:3,current_level:1,is_core:!0,is_referent:!1,rationale:"",timeline_months:12,extinction_timeline:12,transition_plan:"reskilling",suggest_learning_path:!1,competency_version_id:null,reduced_level_rationale:"efficiency"}),V=te(()=>f.mapping?l.value.required_level<f.mapping.required_level:!1),z=te(()=>{const g=f.archetype||"T",o=l.value.required_level;return g==="O"&&o>3||g==="T"&&o>4}),U=g=>({maintenance:"‚úÖ Mantenci√≥n",transformation:"üîÑ Transformaci√≥n",enrichment:"üìà Enriquecimiento",extinction:"üìâ Extinci√≥n"})[g]||g,G=async()=>{if(l.value.change_type==="transformation"&&!l.value.competency_version_id){s.value=!0;return}S.value=!0;try{I("save",{...l.value,id:f.mapping?.id})}finally{S.value=!1}};xe(()=>f.mapping,g=>{g&&(l.value={id:g.id,change_type:g.change_type||"maintenance",required_level:g.required_level||3,current_level:g.current_level||1,is_core:g.is_core||!1,is_referent:g.is_referent||!1,rationale:g.rationale||"",timeline_months:g.timeline_months||12,extinction_timeline:g.extinction_timeline||12,transition_plan:g.transition_plan||"reskilling",suggest_learning_path:g.suggest_learning_path||!1,competency_version_id:g.competency_version_id||null,reduced_level_rationale:"efficiency"})},{immediate:!0});const K=()=>{s.value=!0},R=async g=>{const o=g?.id??g?.version_id??null;o&&(l.value.competency_version_id=o);const W=g?.created_skills??g?.createdSkills??[];v.value=Array.isArray(W)?W.filter(b=>b&&(b.is_incubated===!0||b.status==="incubation")):[],s.value=!1;try{const b={id:l.value.id,role_id:f.roleId,competency_id:f.competencyId,required_level:l.value.required_level,is_core:l.value.is_core,change_type:l.value.change_type,rationale:l.value.rationale,competency_version_id:l.value.competency_version_id,timeline_months:l.value.timeline_months,current_level:l.value.current_level};I("save",b);try{await r.saveMapping(b),T.value={message:"Mapeo guardado correctamente",color:"success"},setTimeout(()=>T.value.message="",3e3)}catch(u){T.value={message:u?.message||"Error guardando el mapeo",color:"error"},setTimeout(()=>T.value.message="",5e3)}}catch(b){console.error("Auto-save mapping failed",b)}};return(g,o)=>{const W=d("v-card-title"),b=d("v-alert"),u=d("v-icon"),E=d("v-btn"),j=d("v-radio"),M=d("v-radio-group"),D=d("v-select"),F=d("v-checkbox"),oe=d("v-textarea"),le=d("v-card-text"),de=d("v-card-actions"),ce=d("v-card"),ue=d("v-dialog");return n(),c(B,null,[t(ue,{"model-value":f.visible,"max-width":"700px","onUpdate:modelValue":o[19]||(o[19]=A=>g.$emit("close"))},{default:a(()=>[t(ce,null,{default:a(()=>[t(W,{class:"text-lg font-bold"},{default:a(()=>[m(_(f.competencyName)+" - "+_(f.roleName),1)]),_:1}),t(le,{class:"py-6"},{default:a(()=>[T.value.message?(n(),c("div",Za,[t(b,{color:T.value.color,variant:"tonal",density:"comfortable",dismissible:""},{default:a(()=>[m(_(T.value.message),1)]),_:1},8,["color"])])):O("",!0),e("div",eo,[o[22]||(o[22]=e("p",{class:"mb-2 text-sm text-gray-600"}," Estado actual del rol: ",-1)),e("p",to,_(f.mapping?U(f.mapping.change_type):"Sin asociaci√≥n"),1)]),v.value.length?(n(),c("div",ao,[o[24]||(o[24]=e("label",{class:"mb-2 block text-sm font-semibold"},"Skills creadas (incubaci√≥n):",-1)),e("div",oo,[(n(!0),c(B,null,Q(v.value,A=>(n(),c("span",{key:A.id||A.name,class:"rounded-full bg-yellow-100 px-2 py-1 text-sm"},[m(_(A.name)+" ",1),o[23]||(o[23]=e("span",{class:"text-xs text-gray-600",style:{"margin-left":"6px"}},"(incubation)",-1))]))),128))])])):O("",!0),e("div",lo,[e("div",no,[o[26]||(o[26]=e("label",{class:"block text-sm font-semibold"}," Seleccionar estado (una √∫nica opci√≥n): ",-1)),e("div",null,[t(E,{variant:"text",size:"medium",class:"text-info","aria-label":"Leyenda tipo de asociaci√≥n",title:"ver informaci√≥n",onClick:o[0]||(o[0]=A=>w.value=!0)},{default:a(()=>[t(u,{class:"text-info-darken-1 align-middle text-3xl"},{default:a(()=>[...o[25]||(o[25]=[m("mdi-information-variant-circle",-1)])]),_:1})]),_:1}),t(dt,{modelValue:w.value,"onUpdate:modelValue":o[1]||(o[1]=A=>w.value=A),title:"Metodolog√≠a: Tipos de Asociaci√≥n Estrat√©gica",items:$,icon:"mdi-book-open-variant",width:"650"},null,8,["modelValue"])])]),t(M,{modelValue:l.value.change_type,"onUpdate:modelValue":o[2]||(o[2]=A=>l.value.change_type=A),column:"",class:"mt-4"},{default:a(()=>[e("div",so,[t(j,{value:"maintenance",class:"mb-1"},{label:a(()=>[...o[27]||(o[27]=[e("span",{class:"font-medium"},"Mantenci√≥n",-1),e("span",{class:"ml-2 text-xs text-gray-500"},"(Sin cambios esperados)",-1)])]),_:1})]),e("div",io,[t(j,{value:"transformation",class:"mb-1"},{label:a(()=>[...o[28]||(o[28]=[e("span",{class:"font-medium"},"Transformaci√≥n",-1),e("span",{class:"ml-2 text-xs text-gray-500"},"(Requiere upskilling)",-1)])]),_:1})]),e("div",ro,[t(j,{value:"enrichment",class:"mb-1"},{label:a(()=>[...o[29]||(o[29]=[e("span",{class:"font-medium"},"Enriquecimiento",-1),e("span",{class:"ml-2 text-xs text-gray-500"},"(Nueva o mejorada)",-1)])]),_:1})]),e("div",co,[t(j,{value:"extinction",class:"mb-1"},{label:a(()=>[...o[30]||(o[30]=[e("span",{class:"font-medium"},"Extinci√≥n",-1),e("span",{class:"ml-2 text-xs text-gray-500"},"(Desaparecer√°)",-1)])]),_:1})])]),_:1},8,["modelValue"])]),h.value?(n(),c("div",uo,[t(b,{color:h.value.color,icon:h.value.icon,variant:"tonal",border:"start",class:"rounded-lg shadow-sm"},{default:a(()=>[e("div",po,[e("div",null,[e("div",mo," Validaci√≥n de Arquitectura: "+_(h.value.title),1),e("div",vo,_(h.value.message),1)])])]),_:1},8,["color","icon"])])):O("",!0),V.value?(n(),c("div",_o,[e("div",go,[t(u,{size:"16",color:"amber-darken-2"},{default:a(()=>[...o[31]||(o[31]=[m("mdi-chart-line-variant",-1)])]),_:1}),o[32]||(o[32]=m(" Racional Estrat√©gico de Reducci√≥n ",-1))]),t(D,{modelValue:l.value.reduced_level_rationale,"onUpdate:modelValue":o[3]||(o[3]=A=>l.value.reduced_level_rationale=A),items:[{title:"Efficiency Gain (IA/Automation)",value:"efficiency"},{title:"Reduced Scope (Job Simplification)",value:"scope"},{title:"Capacity Loss (Strategic Risk)",value:"risk"}],label:"¬øPor qu√© disminuye el nivel?",variant:"outlined",density:"comfortable",color:"amber-darken-2",hint:"Este motivo se usar√° en el Gap Analysis para evaluar el riesgo organizacional.","persistent-hint":""},null,8,["modelValue"])])):O("",!0),z.value?(n(),c("div",fo,[t(F,{modelValue:l.value.is_referent,"onUpdate:modelValue":o[4]||(o[4]=A=>l.value.is_referent=A),color:"purple-darken-2","hide-details":""},{label:a(()=>[e("div",yo,[t(u,{size:"18",color:"purple-darken-2"},{default:a(()=>[...o[33]||(o[33]=[m("mdi-account-star",-1)])]),_:1}),o[34]||(o[34]=e("span",{class:"text-sm font-semibold"},"Rol de Referencia / Mentor√≠a",-1))])]),_:1},8,["modelValue"]),o[35]||(o[35]=e("div",{class:"mt-1 ml-8 text-xs text-purple-700"},[m(" Este rol act√∫a como "),e("strong",null,"mentor t√©cnico"),m(" o referente interno. El nivel alto es coherente con su funci√≥n de mentor√≠a. ")],-1))])):O("",!0),l.value.change_type==="transformation"?(n(),c("div",bo,[e("div",xo,[o[41]||(o[41]=e("label",{class:"mb-3 block text-sm font-semibold"}," Nivel actual ‚Üí Futuro: ",-1)),e("div",ho,[e("div",wo,[o[36]||(o[36]=e("label",{class:"mb-1 block text-xs text-gray-600"}," Actual ",-1)),t(D,{modelValue:l.value.current_level,"onUpdate:modelValue":o[5]||(o[5]=A=>l.value.current_level=A),items:[1,2,3,4,5],density:"compact",label:"Nivel"},null,8,["modelValue"])]),o[38]||(o[38]=e("div",{class:"pt-4"},"‚Üí",-1)),e("div",ko,[o[37]||(o[37]=e("label",{class:"mb-1 block text-xs text-gray-600"},"Futuro",-1)),t(D,{modelValue:l.value.required_level,"onUpdate:modelValue":o[6]||(o[6]=A=>l.value.required_level=A),items:[1,2,3,4,5],density:"compact",label:"Nivel"},null,8,["modelValue"])])]),e("div",$o,[o[39]||(o[39]=e("label",{class:"mb-1 block text-xs text-gray-600"}," Timeline (meses) ",-1)),t(D,{modelValue:l.value.timeline_months,"onUpdate:modelValue":o[7]||(o[7]=A=>l.value.timeline_months=A),items:[6,12,18,24],density:"compact"},null,8,["modelValue"])]),e("div",Co,[t(F,{modelValue:l.value.suggest_learning_path,"onUpdate:modelValue":o[8]||(o[8]=A=>l.value.suggest_learning_path=A),label:"Proponer learning path autom√°tico"},null,8,["modelValue"])]),l.value.change_type==="transformation"||l.value.change_type==="enrichment"?(n(),c("div",Vo,[t(E,{text:"",onClick:K},{default:a(()=>[...o[40]||(o[40]=[m("Editar Transformaci√≥n (Crear versi√≥n)",-1)])]),_:1}),l.value.competency_version_id?(n(),c("span",Eo,"Versi√≥n: "+_(l.value.competency_version_id),1)):O("",!0)])):O("",!0)])])):O("",!0),l.value.change_type==="enrichment"?(n(),c("div",So,[e("div",zo,[o[44]||(o[44]=e("label",{class:"mb-3 block text-sm font-semibold"}," Competencia Nueva: ",-1)),e("div",null,[o[42]||(o[42]=e("label",{class:"mb-1 block text-xs text-gray-600"}," Nivel requerido ",-1)),t(D,{modelValue:l.value.required_level,"onUpdate:modelValue":o[9]||(o[9]=A=>l.value.required_level=A),items:[1,2,3,4,5],density:"compact"},null,8,["modelValue"])]),e("div",Ro,[o[43]||(o[43]=e("label",{class:"mb-1 block text-xs text-gray-600"}," Timeline (meses) ",-1)),t(D,{modelValue:l.value.timeline_months,"onUpdate:modelValue":o[10]||(o[10]=A=>l.value.timeline_months=A),items:[6,12,18,24],density:"compact"},null,8,["modelValue"])]),e("div",No,[t(F,{modelValue:l.value.suggest_learning_path,"onUpdate:modelValue":o[11]||(o[11]=A=>l.value.suggest_learning_path=A),label:"Proponer learning path autom√°tico"},null,8,["modelValue"])])])])):O("",!0),l.value.change_type==="extinction"?(n(),c("div",To,[e("div",Io,[o[46]||(o[46]=e("label",{class:"mb-3 block text-sm font-semibold"}," Plan de Transici√≥n: ",-1)),e("div",Ao,[o[45]||(o[45]=e("label",{class:"mb-2 block text-xs text-gray-600"}," Timeline desaparici√≥n (meses) ",-1)),t(D,{modelValue:l.value.extinction_timeline,"onUpdate:modelValue":o[12]||(o[12]=A=>l.value.extinction_timeline=A),items:[6,12,18,24],density:"compact"},null,8,["modelValue"])]),o[47]||(o[47]=e("label",{class:"mb-2 block text-xs text-gray-600"}," Plan de transici√≥n: ",-1)),e("div",Mo,[e("div",Uo,[t(j,{modelValue:l.value.transition_plan,"onUpdate:modelValue":o[13]||(o[13]=A=>l.value.transition_plan=A),value:"reskilling",label:"Reskilling a otra competencia"},null,8,["modelValue"])]),e("div",jo,[t(j,{modelValue:l.value.transition_plan,"onUpdate:modelValue":o[14]||(o[14]=A=>l.value.transition_plan=A),value:"role_change",label:"Cambio de rol"},null,8,["modelValue"])]),e("div",Oo,[t(j,{modelValue:l.value.transition_plan,"onUpdate:modelValue":o[15]||(o[15]=A=>l.value.transition_plan=A),value:"devinculacion",label:"Desvincular"},null,8,["modelValue"])])])])])):O("",!0),l.value.change_type==="maintenance"?(n(),c("div",qo,[...o[48]||(o[48]=[e("div",{class:"rounded border-l-4 border-blue-500 bg-blue-50 p-4"},[e("p",{class:"text-sm text-gray-600"}," ‚úÖ Esta competencia se mantiene en el mismo nivel. No requiere cambios de entrenamiento. ")],-1)])])):O("",!0),e("div",Po,[o[49]||(o[49]=e("label",{class:"mb-2 block text-sm font-semibold"}," ¬øEs cr√≠tica para el rol? ",-1)),t(F,{modelValue:l.value.is_core,"onUpdate:modelValue":o[16]||(o[16]=A=>l.value.is_core=A),label:"S√≠, es cr√≠tica"},null,8,["modelValue"])]),e("div",Do,[o[50]||(o[50]=e("label",{class:"mb-2 block text-sm font-semibold"},"Notas:",-1)),t(oe,{modelValue:l.value.rationale,"onUpdate:modelValue":o[17]||(o[17]=A=>l.value.rationale=A),placeholder:"Justificaci√≥n de esta asociaci√≥n...",density:"compact",rows:"3"},null,8,["modelValue"])])]),_:1}),t(de,{class:"flex justify-end gap-3 px-6 pb-4"},{default:a(()=>[t(E,{variant:"text",onClick:o[18]||(o[18]=A=>g.$emit("close"))},{default:a(()=>[...o[51]||(o[51]=[m(" Cancelar ",-1)])]),_:1}),t(E,{color:"primary",onClick:G,loading:S.value,variant:"elevated"},{default:a(()=>[...o[52]||(o[52]=[m(" Guardar ",-1)])]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["model-value"]),t(ue,{"model-value":s.value,"max-width":"900px","onUpdate:modelValue":o[21]||(o[21]=A=>s.value=A)},{default:a(()=>[t(ce,null,{default:a(()=>[t(le,null,{default:a(()=>[t(ct,{competencyId:f.competencyId,onTransformed:R,onClose:o[20]||(o[20]=A=>s.value=!1)},null,8,["competencyId"])]),_:1})]),_:1})]),_:1},8,["model-value"])],64)}}}),Lo={class:"role-competency-matrix"},Ho={class:"matrix-header mb-6"},Fo={class:"flex items-center justify-between"},Go={class:"text-2xl font-bold"},Bo={class:"mt-1 text-gray-600"},Wo={class:"flex gap-2"},Ko={key:0,class:"mb-4"},Qo={class:"d-flex align-center"},Xo={key:1,class:"flex justify-center py-8"},Yo={key:2},Zo={class:"mb-4 rounded border-l-4 border-blue-500 bg-blue-50 p-4"},el={class:"flex items-start gap-3"},tl={class:"matrix-table"},al={class:"w-32 p-3 text-center"},ol={class:"sticky left-0 z-10 border-b border-gray-200 bg-white"},ll={class:"w-48 border-r border-gray-200 p-3"},nl={class:"font-semibold"},sl={class:"mt-1 flex flex-wrap items-center gap-1.5"},il={class:"text-xs text-gray-500"},rl=["onClick"],dl=ie({__name:"RoleCompetencyMatrix",props:{scenarioId:{}},setup(p){const N=p,f=Ke(),I=y(!1),S=y(!1),s=y(0),w=y(null),k=y(!1),r=te(()=>{const T={};return f.competencyColumns.forEach(v=>{const l=v.capability_name||v.category||"General";T[l]||(T[l]=[]),T[l].push(v)}),Object.keys(T).map(v=>({name:v,comps:T[v],count:T[v].length}))}),x=T=>{let v=0;return f.matrixRows.forEach(l=>{(r.value.find(z=>z.name===T)?.comps||[]).forEach(z=>{l.mappings&&l.mappings.get&&l.mappings.get(z.id)&&(v+=1)})}),v};Se(async()=>{await f.loadScenarioData(N.scenarioId)}),xe(()=>f.success,T=>{T&&(k.value=!0)});const q=(T,v)=>{const l=f.roles.find(U=>U.role_id===T),V=f.competencies.find(U=>U.id===v),z=f.getMapping(T,v);w.value={roleId:T,roleName:l?.role_name||"",archetype:l?.archetype||"T",competencyId:v,competencyName:V?.name||"",mapping:z},I.value=!0},h=async T=>{if(!w.value)return;const v={id:T.id,scenario_id:f.scenarioId,role_id:w.value.roleId,competency_id:w.value.competencyId,competency_name:w.value.competencyName,required_level:T.required_level,is_core:T.is_core,change_type:T.change_type,rationale:T.rationale};await f.saveMapping(v),I.value=!1},$=async(T,v)=>{const l=f.getMapping(T,v);l&&confirm("¬øEliminar esta asociaci√≥n?")&&await f.removeMapping(T,v,l.id)},X=async T=>{await f.addNewRole(T),S.value=!1};return(T,v)=>{const l=d("v-btn"),V=d("v-alert"),z=d("v-icon"),U=d("v-snackbar"),G=d("v-progress-circular"),K=d("v-tooltip"),R=d("v-badge"),g=d("v-tab"),o=d("v-tabs"),W=d("v-window-item"),b=d("v-window"),u=d("v-card");return n(),c("div",Lo,[e("div",Ho,[e("div",Fo,[e("div",null,[e("h2",Go,_(_e(f).scenarioName||"Escenario"),1),e("p",Bo," Mapeo: Roles ‚Üî Competencias (Horizonte: "+_(_e(f).horizonMonths)+" meses) ",1)]),e("div",Wo,[t(l,{color:"primary","prepend-icon":"mdi-plus",onClick:v[0]||(v[0]=E=>S.value=!0)},{default:a(()=>[...v[7]||(v[7]=[m(" + Nuevo Rol ",-1)])]),_:1})])])]),_e(f).error?(n(),c("div",Ko,[t(V,{type:"error",closable:"","onClick:close":v[1]||(v[1]=E=>_e(f).clearMessages())},{default:a(()=>[m(_(_e(f).error),1)]),_:1})])):O("",!0),t(U,{modelValue:k.value,"onUpdate:modelValue":v[2]||(v[2]=E=>k.value=E),color:"success",timeout:"2000"},{default:a(()=>[e("div",Qo,[t(z,{class:"mr-2"},{default:a(()=>[...v[8]||(v[8]=[m("mdi-check-circle",-1)])]),_:1}),m(" "+_(_e(f).success),1)])]),_:1},8,["modelValue"]),_e(f).loading?(n(),c("div",Xo,[t(G,{indeterminate:"",color:"primary"})])):(n(),c("div",Yo,[e("div",Zo,[e("div",el,[t(z,{icon:"mdi-information",class:"mt-1 text-blue-600"}),v[9]||(v[9]=e("div",null,[e("h3",{class:"mb-1 font-semibold text-blue-800"}," C√≥mo asignar competencias "),e("p",{class:"text-sm text-blue-700"}," Haz click en cualquier celda para asignar una competencia a un rol. Las celdas vac√≠as muestran un √≠cono + para indicar que se pueden asignar. "),e("p",{class:"mt-2 text-sm text-blue-700"}," Paso 2 consiste en conectar competencias con roles y definir su transici√≥n (mantenci√≥n, transformaci√≥n, enriquecimiento o extinci√≥n) de forma simple y visual. ")],-1))])]),t(u,null,{default:a(()=>[t(o,{modelValue:s.value,"onUpdate:modelValue":v[3]||(v[3]=E=>s.value=E),"bg-color":"gray-100",class:"border-b"},{default:a(()=>[(n(!0),c(B,null,Q(r.value,(E,j)=>(n(),P(g,{key:E.name,value:j,class:he(s.value===j?"bg-blue-50":"")},{default:a(()=>[t(K,{text:E.name,location:"top"},{activator:a(({props:M})=>[e("span",Ve({ref_for:!0},M,{class:"tab-label text-truncate"}),_(E.name),17)]),_:2},1032,["text"]),t(R,{content:x(E.name),color:"primary",location:"top end","offset-x":"-8","offset-y":"-8"},null,8,["content"])]),_:2},1032,["value","class"]))),128))]),_:1},8,["modelValue"]),t(b,{modelValue:s.value,"onUpdate:modelValue":v[4]||(v[4]=E=>s.value=E),class:"matrix-container"},{default:a(()=>[(n(!0),c(B,null,Q(r.value,(E,j)=>(n(),P(W,{key:E.name,value:j},{default:a(()=>[e("table",tl,[e("thead",null,[e("tr",null,[v[10]||(v[10]=e("th",{class:"role-column-header sticky left-0 z-20 border-b border-gray-300 bg-gray-100"},[e("div",{class:"group flex w-48 items-center justify-between p-3"},[e("strong",null,"Rol"),e("div",{class:"cursor-col-resize opacity-0 transition-opacity group-hover:opacity-100"}," ‚ãÆ‚ãÆ ")])],-1)),(n(!0),c(B,null,Q(E.comps,M=>(n(),c("th",{key:M.id,class:"border-b border-gray-300 bg-gray-50"},[e("div",al,[t(K,{text:M.name,location:"top"},{activator:a(({props:D})=>[e("div",Ve({ref_for:!0},D,{class:"text-truncate comp-name text-sm font-semibold"}),_(M.name),17)]),_:2},1032,["text"]),t(K,{text:M.capability_name||M.category,location:"top"},{activator:a(({props:D})=>[e("div",Ve({ref_for:!0},D,{class:"text-truncate comp-capability text-xs text-gray-500"}),_(M.capability_name||M.category),17)]),_:2},1032,["text"])])]))),128))])]),e("tbody",null,[(n(!0),c(B,null,Q(_e(f).matrixRows,M=>(n(),c("tr",{key:M.roleId},[e("td",ol,[e("div",ll,[e("div",nl,_(M.roleName),1),e("div",sl,[M.archetype?(n(),c("span",{key:0,class:he(["rounded border px-1.5 py-0.5 text-[9px] font-black tracking-tighter uppercase",{"border-purple-200 bg-purple-50 text-purple-700":M.archetype==="E","border-blue-200 bg-blue-50 text-blue-700":M.archetype==="T","border-emerald-200 bg-emerald-50 text-emerald-700":M.archetype==="O"}])},_(M.archetype),3)):O("",!0),e("span",il,_(M.fte)+" FTE ‚Ä¢ "+_(M.status),1)])])]),(n(!0),c(B,null,Q(E.comps,D=>(n(),c("td",{key:`${M.roleId}-${D.id}`,class:"border-b border-gray-200 p-0"},[e("div",{class:"flex h-24 w-32 cursor-pointer items-center justify-center border-r border-gray-200 transition hover:bg-gray-50",onClick:F=>q(M.roleId,D.id)},[t(Ya,{mapping:M.mappings.get(D.id),"role-id":M.roleId,"role-name":M.roleName,"competency-id":D.id,"competency-name":D.name,onEdit:F=>q(M.roleId,D.id),onRemove:F=>$(M.roleId,D.id)},null,8,["mapping","role-id","role-name","competency-id","competency-name","onEdit","onRemove"])],8,rl)]))),128))]))),128))])])]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1})])),w.value?(n(),P(Jo,{key:3,visible:I.value,"role-id":w.value.roleId,"role-name":w.value.roleName,archetype:w.value.archetype,"competency-id":w.value.competencyId,"competency-name":w.value.competencyName,mapping:w.value.mapping,onSave:h,onClose:v[5]||(v[5]=E=>I.value=!1)},null,8,["visible","role-id","role-name","archetype","competency-id","competency-name","mapping"])):O("",!0),t(Ha,{visible:S.value,onSave:X,onClose:v[6]||(v[6]=E=>S.value=!1)},null,8,["visible"])])}}}),cl=we(dl,[["__scopeId","data-v-94a5aa48"]]),ul={class:"d-flex align-center"},pl={class:"d-flex flex-column flex-grow-1"},ml={class:"d-flex align-center"},vl={class:"text-h6"},_l={class:"text-caption text-medium-emphasis mt-1"},gl={key:0},fl={class:"text-body-2 mb-2"},yl={class:"d-flex flex-wrap gap-2"},bl=ie({__name:"VersionHistoryModal",props:{scenarioId:{},versionGroupId:{},currentVersion:{}},emits:["versionSelected"],setup(p,{expose:N,emit:f}){const I=p,S=f,s=Te(),{showSuccess:w,showError:k}=Ee(),r=y(!1),x=y(!1),q=y([]),h=y([]),$=y(!1),X=()=>{r.value=!0,T()},T=async()=>{x.value=!0;try{const g=await s.get(`/api/strategic-planning/scenarios/${I.scenarioId}/versions`);q.value=g.data?.versions||[]}catch{k("Error al cargar versiones")}finally{x.value=!1}},v=te(()=>[...q.value].sort((g,o)=>o.version_number-g.version_number)),l=g=>({draft:"grey",pending_approval:"warning",approved:"success",rejected:"error"})[g]||"grey",V=g=>({planned:"grey-lighten-1",in_progress:"primary",paused:"warning",completed:"success"})[g]||"grey",z=g=>new Date(g).toLocaleDateString("es-ES",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),U=g=>{S("versionSelected",g),r.value=!1},G=g=>{const o=h.value.indexOf(g);o>-1?h.value.splice(o,1):h.value.length<2&&h.value.push(g)},K=()=>{h.value.length===2&&($.value=!0,w("Comparando versiones..."))},R=te(()=>h.value.length===2);return N({openDialog:X}),(g,o)=>{const W=d("v-icon"),b=d("v-spacer"),u=d("v-chip"),E=d("v-card-title"),j=d("v-divider"),M=d("v-alert"),D=d("v-btn"),F=d("v-checkbox"),oe=d("v-card-text"),le=d("v-card-actions"),de=d("v-card"),ce=d("v-timeline-item"),ue=d("v-timeline"),A=d("v-progress-linear"),$e=d("v-dialog");return n(),P($e,{modelValue:r.value,"onUpdate:modelValue":o[1]||(o[1]=L=>r.value=L),"max-width":"900",scrollable:""},{default:a(()=>[t(de,null,{default:a(()=>[t(E,{class:"d-flex align-center"},{default:a(()=>[t(W,{icon:"mdi-history",class:"mr-2"}),o[2]||(o[2]=m(" Historial de Versiones ",-1)),t(b),t(u,{color:"primary",variant:"flat",size:"small","prepend-icon":"mdi-information"},{default:a(()=>[m(" Total: "+_(q.value.length)+" versiones ",1)]),_:1})]),_:1}),t(j),t(oe,{style:{"max-height":"600px"}},{default:a(()=>[q.value.length===0&&!x.value?(n(),P(M,{key:0,type:"info",variant:"tonal",class:"mb-4"},{default:a(()=>[...o[3]||(o[3]=[m(" No hay versiones anteriores. Esta es la primera versi√≥n del escenario. ",-1)])]),_:1})):O("",!0),h.value.length>0?(n(),P(M,{key:1,type:"warning",variant:"outlined",dismissible:"",class:"mb-4"},{default:a(()=>[e("div",ul,[e("span",null,_(h.value.length)+" versiones seleccionadas para comparar",1),t(b),R.value?(n(),P(D,{key:0,color:"primary",size:"small",variant:"elevated","prepend-icon":"mdi-compare",onClick:K},{default:a(()=>[...o[4]||(o[4]=[m(" Comparar ",-1)])]),_:1})):O("",!0)])]),_:1})):O("",!0),t(ue,{side:"end",density:"compact","line-inset":"8"},{default:a(()=>[(n(!0),c(B,null,Q(v.value,L=>(n(),P(ce,{key:L.id,"dot-color":L.is_current_version?"primary":"grey",size:"small"},{icon:a(()=>[t(W,{icon:L.is_current_version?"mdi-star":"mdi-circle",size:"small"},null,8,["icon"])]),default:a(()=>[t(de,{elevation:L.is_current_version?4:1,class:he([{"border-primary":L.is_current_version},"mb-3"])},{default:a(()=>[t(E,{class:"d-flex align-center"},{default:a(()=>[e("div",pl,[e("div",ml,[t(u,{color:L.is_current_version?"primary":"grey",size:"small",variant:"flat",class:"mr-2"},{default:a(()=>[m(" v"+_(L.version_number),1)]),_:2},1032,["color"]),e("span",vl,_(L.name),1)]),e("div",_l,[m(" Creado: "+_(z(L.created_at))+" ",1),L.owner?(n(),c("span",gl," ¬∑ "+_(L.owner.name),1)):O("",!0)])]),t(F,{"model-value":h.value.includes(L.id),disabled:!R.value&&!h.value.includes(L.id),density:"compact","hide-details":"","onUpdate:modelValue":Ce=>G(L.id)},null,8,["model-value","disabled","onUpdate:modelValue"])]),_:2},1024),L.description?(n(),P(oe,{key:0},{default:a(()=>[e("p",fl,_(L.description),1)]),_:2},1024)):O("",!0),t(oe,null,{default:a(()=>[e("div",yl,[t(u,{color:l(L.decision_status),size:"small",variant:"tonal"},{default:a(()=>[m(_(L.decision_status),1)]),_:2},1032,["color"]),t(u,{color:V(L.execution_status),size:"small",variant:"outlined"},{default:a(()=>[m(_(L.execution_status),1)]),_:2},1032,["color"]),L.is_current_version?(n(),P(u,{key:0,color:"primary",size:"small","prepend-icon":"mdi-star"},{default:a(()=>[...o[5]||(o[5]=[m(" Actual ",-1)])]),_:1})):O("",!0)])]),_:2},1024),t(le,null,{default:a(()=>[L.id!==p.scenarioId?(n(),P(D,{key:0,color:"primary",variant:"text",size:"small","prepend-icon":"mdi-open-in-new",onClick:Ce=>U(L.id)},{default:a(()=>[...o[6]||(o[6]=[m(" Ver esta versi√≥n ",-1)])]),_:1},8,["onClick"])):(n(),P(D,{key:1,color:"grey",variant:"text",size:"small",disabled:""},{default:a(()=>[...o[7]||(o[7]=[m(" Versi√≥n actual ",-1)])]),_:1}))]),_:2},1024)]),_:2},1032,["elevation","class"])]),_:2},1032,["dot-color"]))),128))]),_:1}),x.value?(n(),P(A,{key:2,indeterminate:"",color:"primary",class:"mt-4"})):O("",!0)]),_:1}),t(j),t(le,null,{default:a(()=>[t(b),t(D,{variant:"text",onClick:o[0]||(o[0]=L=>r.value=!1)},{default:a(()=>[...o[8]||(o[8]=[m("Cerrar",-1)])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])}}}),xl=we(bl,[["__scopeId","data-v-36cc71a2"]]),hl={class:"scenario-detail-wrapper"},wl={class:"font-weight-medium"},kl={class:"d-flex align-center flex-wrap justify-center gap-1"},$l={class:"d-none d-md-inline"},Cl={class:"d-md-none"},Vl={class:"scenario-content"},El={class:"step-content step-map"},Sl={class:"mb-4 rounded border-l-4 border-blue-500 bg-blue-50 p-4"},zl={class:"d-flex align-start gap-3"},Rl={class:"mt-4"},Nl={key:0},Tl={key:1},Il={key:0},Al={key:1},Ml={class:"d-flex align-center justify-space-between"},Ul={class:"text-sm text-gray-600"},jl={class:"mt-2 ml-4"},Ol={class:"d-flex align-center gap-2"},ql={class:"text-sm"},Pl={class:"ml-4 text-sm text-gray-700"},Dl={key:0,class:"text-yellow-700"},Jl={key:0},Ll={key:0},Hl={key:1},Fl={key:0},Gl={key:1},Bl={class:"text-sm text-gray-700"},Wl={key:0,class:"mt-1"},Kl={class:"text-sm"},Ql={key:1,class:"mt-1"},Xl={class:"text-sm"},Yl={key:0,class:"step-content"},Zl={key:0},en={key:0,class:"mb-8 overflow-hidden rounded-xl border border-indigo-100 bg-gradient-to-br from-white to-indigo-50/30 shadow-sm"},tn={class:"d-flex align-center justify-space-between bg-indigo-50/50 px-6 py-4"},an={class:"pa-6"},on={key:1,class:"mb-8 flex items-center justify-between rounded-xl border border-emerald-100 bg-emerald-50/30 p-6"},ln={class:"flex items-center gap-4"},nn={class:"rounded-full bg-emerald-500 p-2"},sn={key:1,class:"flex justify-center py-8"},rn={class:"step-content"},dn={class:"step-content"},cn={class:"step-content"},un={class:"step-content"},pn={class:"step-content"},mn={class:"d-none d-sm-inline"},vn={class:"text-caption text-medium-emphasis"},_n={class:"d-none d-sm-inline"},gn={key:0},fn=ie({layout:it,__name:"ScenarioDetail",props:{id:{}},setup(p){const N=p,f=Te(),{showSuccess:I,showError:S}=Ee(),s=y(null),w=y(!1),k=y(!1),r=y({id:null,name:"",description:"",scenario_type:"",status:"draft",decision_status:"",execution_status:"",current_step:1,is_current_version:!1,version_number:null,version_group_id:null,parent_id:null,planning_horizon_months:12,horizon_months:12,time_horizon_weeks:null,start_date:null,end_date:null,owner:null,estimated_budget:null,scope_type:"",scope_id:null,import_to_plan:!1}),x=y([]),q=y(!1),h=y([]),$=y({}),X=y([]),T=y(!1),v=y([]),l=y(1),V=y(null),z=y(!1),U=y(null),G=y(!1),K=y(null),R=y(!1),g=y(!1),o=y(null),W=y(!1),b=te(()=>{const C=typeof N.id=="string"?Number.parseInt(N.id,10):N.id;return Number.isNaN(C)?0:C}),u=We(),E=te(()=>{try{const C=u.props?.auth?.user??null;if(!C)return!1;const i=C.role??null;return["admin","approver","owner","superadmin"].includes(i)?!0:s.value?(s.value.created_by??null)===C.id:!1}catch{return!1}}),j=async()=>{if(!(!b.value||b.value<=0)){w.value=!0;try{const C=await f.get(`/api/strategic-planning/scenarios/${b.value}`),i=C?.data??C;s.value=i,l.value=s.value?.current_step||1,r.value.name=s.value?.name??"",r.value.description=s.value?.description??"",r.value.scope_type=s.value?.scope_type??"",r.value.planning_horizon_months=s.value?.horizon_months??s.value?.planning_horizon_months??12,r.value.horizon_months=s.value?.horizon_months??r.value.planning_horizon_months,r.value.time_horizon_weeks=s.value?.time_horizon_weeks??null,r.value.start_date=s.value?.start_date??null,r.value.end_date=s.value?.end_date??null,r.value.owner=s.value?.owner??null,r.value.scope_id=s.value?.scope_id??null,r.value.id=s.value?.id??null,r.value.scenario_type=s.value?.scenario_type??"",r.value.status=s.value?.status??"draft",r.value.decision_status=s.value?.decision_status??"",r.value.execution_status=s.value?.execution_status??"",r.value.current_step=s.value?.current_step??r.value.current_step,r.value.is_current_version=s.value?.is_current_version??!1,r.value.version_number=s.value?.version_number??null,r.value.version_group_id=s.value?.version_group_id??null,r.value.parent_id=s.value?.parent_id??null,r.value.estimated_budget=s.value?.estimated_budget??null,(r.value.scope_type==="department"||r.value.scope_type==="role_family")&&await ee(),h.value=(s.value?.scenario_skills||s.value?.skill_demands||[]).map(H=>({id:H.id||null,skill_id:H.skill_id||H.id||null,required_level:H.required_level??H.level??1,required_headcount:H.required_headcount??H.required_headcount??1,priority:H.priority||"medium",rationale:H.rationale||H.notes||""})),await Y(),await le(),s.value?.source_generation_id&&await A()}catch{S("No se pudo cargar el escenario")}finally{w.value=!1}}},M=y([]),D=y(!1),F=y([]),oe=y(!1),le=async()=>{if(!(!b.value||b.value<=0)){D.value=!0;try{const C=await f.get(`/api/strategic-planning/scenarios/${b.value}/capability-tree`);M.value=C?.data??C??[]}catch(C){console.error("Error loading capability tree",C),M.value=[]}finally{D.value=!1}}},de=C=>{o.value=C,g.value=!0},ce=async()=>{await le(),await j()},ue=async()=>{if(!(!s.value||!s.value.source_generation_id)){W.value=!0;try{await f.post(`/api/strategic-planning/scenarios/generate/${s.value.source_generation_id}/record-view`)}catch(C){console.error("record view failed",C)}}},A=async()=>{if(!(!s.value||!s.value.source_generation_id)){oe.value=!0;try{const C=await f.get(`/api/strategic-planning/scenarios/generate/${s.value.source_generation_id}`),i=C?.data??C;F.value=i?.metadata?.import_audit??[]}catch(C){console.error("Error loading import audit",C),F.value=[]}finally{oe.value=!1}}},$e=C=>{Pe.visit(`/competencies/${C}`)},L=async()=>{if(b.value)try{await f.post(`/api/strategic-planning/scenarios/${b.value}/approve`),I("Entidades incubadas promovidas"),await j()}catch(C){console.error(C),S("Error promoviendo entidades")}},Ce=async()=>{if(b.value){w.value=!0;try{await f.post(`/api/strategic-planning/scenarios/${b.value}/simulate-import`),I("Simulaci√≥n de respuesta LLM completada. Estructura generada."),await j()}catch(C){console.error(C),S("Error al simular importaci√≥n: "+(C.response?.data?.message||C.message))}finally{w.value=!1}}},ze=async()=>{k.value=!0;try{await new Promise(C=>setTimeout(C,1e3)),I("Estrategias de cierre actualizadas")}catch(C){console.error(C),S("Error al actualizar las estrategias")}finally{k.value=!1}},Y=async()=>{q.value=!0;try{const C={};r.value.scope_type&&(C.scope_type=r.value.scope_type),r.value.scope_id&&(C.scope_id=r.value.scope_id);const i=await f.get("/api/roles",C);x.value=i?.data??i;const H={};x.value.forEach(Z=>{const ge=Z.role_family_id||Z.role_family&&Z.role_family.id||null,Me=Z.role_family_name||Z.role_family&&Z.role_family.name||Z.role_family||null;ge&&!H[ge]&&(H[ge]={id:ge,name:Me})}),v.value=Object.values(H),x.value.forEach(Z=>{$.value[Z.id]||($.value[Z.id]="ignore")})}catch{}finally{q.value=!1}};xe(()=>r.value.scope_type,async(C,i)=>{C!==i&&await Y()}),xe(()=>r.value.scope_id,async(C,i)=>{C!==i&&await Y()});const ee=async()=>{T.value=!0;try{const C=await f.get("/api/departments");X.value=C?.data??C}catch{}finally{T.value=!1}},ae=()=>{j()},Ie=()=>{V.value?.openDialog()},Re=()=>{z.value=!1,U.value=null},Qe=async()=>{if(!(!b.value||b.value<=0)){G.value=!0;try{const C=await f.post(`/api/strategic-planning/scenarios/${b.value}/change-sets`,{}),i=C?.data??C;U.value=i?.id??(i?.data&&i.data.id)??null,U.value?z.value=!0:S("No se pudo obtener el ChangeSet")}catch(C){console.error(C);const i=C?.friendlyMessage||C?.message||"No se pudo generar el ChangeSet";S(i)}finally{G.value=!1}}},Xe=C=>{Pe.visit(`/strategic-planning/${C}`)},ne=[{value:1,title:"Mapa",icon:"mdi-map",subtitle:"Visualizaci√≥n del escenario"},{value:2,title:"Mapeo",icon:"mdi-table",subtitle:"Roles ‚Üî Competencias"},{value:3,title:"Estrategias",icon:"mdi-strategy",subtitle:"Cierre de brechas"},{value:4,title:"Escenarios",icon:"mdi-account-group",subtitle:"Plan de personal"},{value:5,title:"Pron√≥sticos",icon:"mdi-chart-timeline-variant",subtitle:"Roles futuros"},{value:6,title:"Comparar",icon:"mdi-compare",subtitle:"Versiones"},{value:7,title:"Dashboard",icon:"mdi-view-dashboard",subtitle:"Resumen"}],De=te(()=>ne.find(C=>C.value===l.value)||ne[0]),Je=()=>{Pe.visit("/scenario-planning")},Ae=C=>{if(C>=1&&C<=ne.length){l.value=C;const i=new URL(globalThis.location.href);i.searchParams.set("step",String(C)),globalThis.history.replaceState({},"",i.toString())}},Ye=()=>{l.value<ne.length&&Ae(l.value+1)},Ze=()=>{l.value>1&&Ae(l.value-1)},et=()=>{try{const C=new URL(globalThis.location.href),i=C.searchParams.get("step");if(C.searchParams.get("view")==="map"){l.value=1;return}if(i){const Z=Number.parseInt(i,10);Z>=1&&Z<=ne.length&&(l.value=Z)}}catch{}};return Se(()=>{et(),j()}),(C,i)=>{const H=d("v-btn"),Z=d("v-col"),ge=d("v-chip"),Me=d("v-skeleton-loader"),Le=d("v-row"),pe=d("v-container"),Ue=d("v-sheet"),je=d("v-progress-linear"),me=d("v-icon"),He=d("v-spacer"),fe=d("v-card-title"),se=d("v-card-text"),re=d("v-card"),tt=d("v-divider"),at=d("v-progress-circular"),ke=d("v-alert"),Oe=d("v-dialog"),ot=d("v-card-actions"),lt=d("v-app");return n(),P(lt,null,{default:a(()=>[e("div",hl,[t(Ue,{color:"surface",class:"border-b",style:{position:"sticky",top:"0","z-index":"10"}},{default:a(()=>[t(pe,{fluid:"",class:"pa-2"},{default:a(()=>[t(Le,{"no-gutters":"",align:"center"},{default:a(()=>[t(Z,{cols:"auto"},{default:a(()=>[t(H,{icon:"mdi-arrow-left",variant:"text",onClick:Je})]),_:1}),s.value?(n(),P(Z,{key:0,cols:"auto",class:"d-flex align-center flex-grow-1 gap-2"},{default:a(()=>[e("span",wl,_(s.value.name),1),E.value&&s.value.source_generation_id&&s.value.accepted_prompt?(n(),P(H,{key:0,small:"",variant:"text",onClick:ue},{default:a(()=>[...i[8]||(i[8]=[m("Ver prompt aceptado",-1)])]),_:1})):O("",!0),s.value.decision_status?(n(),P(ge,{key:1,size:"x-small",color:s.value.decision_status==="approved"?"success":s.value.decision_status==="rejected"?"error":"warning"},{default:a(()=>[m(_(s.value.decision_status),1)]),_:1},8,["color"])):O("",!0)]),_:1})):(n(),P(Z,{key:1,cols:"auto",class:"flex-grow-1"},{default:a(()=>[t(Me,{type:"text",width:"200"})]),_:1})),t(Z,{cols:"auto",class:"d-flex align-center gap-2"},{default:a(()=>[t(ge,{variant:"tonal",color:"primary",size:"small"},{default:a(()=>[m(" Paso "+_(l.value)+"/"+_(ne.length),1)]),_:1}),t(H,{icon:"mdi-history",variant:"text",size:"small",onClick:Ie,title:"Historial de versiones"}),t(H,{icon:"mdi-source-branch",variant:"text",size:"small",loading:G.value,onClick:Qe,title:"ChangeSet"},null,8,["loading"]),t(H,{icon:"mdi-robot",variant:"text",size:"small","data-test":"generate-wizard-button",onClick:i[0]||(i[0]=J=>R.value=!0),title:"Generar escenario"})]),_:1})]),_:1})]),_:1})]),_:1}),t(Ue,{color:"grey-lighten-4",class:"stepper-nav border-b px-2 py-1"},{default:a(()=>[e("div",kl,[(n(),c(B,null,Q(ne,J=>t(H,{key:J.value,variant:l.value===J.value?"flat":"text",color:l.value===J.value?"primary":"default",size:"small","prepend-icon":J.icon,onClick:ve=>Ae(J.value),class:"step-btn"},{default:a(()=>[e("span",$l,_(J.title),1),e("span",Cl,_(J.value),1)]),_:2},1032,["variant","color","prepend-icon","onClick"])),64))])]),_:1}),e("div",Vl,[w.value?(n(),P(je,{key:0,indeterminate:"",color:"primary"})):s.value?(n(),c(B,{key:1},[ye(e("div",El,[e("div",Sl,[e("div",zl,[t(me,{icon:"mdi-information",class:"mt-1 text-blue-600"}),i[9]||(i[9]=e("div",null,[e("h3",{class:"font-weight-semibold mb-1 text-blue-800"}," ¬øEn qu√© consiste el Paso 1? "),e("p",{class:"text-body-2 mb-0 text-blue-700"}," Dise√±ar el escenario definiendo capacidades estrat√©gicas y competencias (existentes o nuevas) que dar√°n base al mapa del escenario. ")],-1))])]),t(pt,{scenario:s.value},null,8,["scenario"]),e("div",Rl,[t(re,{class:"pa-3"},{default:a(()=>[t(fe,null,{default:a(()=>[t(me,{class:"mr-2"},{default:a(()=>[...i[10]||(i[10]=[m("mdi-seed",-1)])]),_:1}),i[12]||(i[12]=m(" Entidades incubadas en este escenario ",-1)),t(He),t(H,{small:"",variant:"text",onClick:L,title:"Promover incubadas"},{default:a(()=>[...i[11]||(i[11]=[m("Promover todas",-1)])]),_:1})]),_:1}),t(se,null,{default:a(()=>[D.value?(n(),c("div",Nl,[t(je,{indeterminate:"",color:"primary"})])):(n(),c("div",Tl,[M.value.length===0?(n(),c("div",Il," No se encontraron entidades incubadas. ")):(n(),c("div",Al,[(n(!0),c(B,null,Q(M.value,J=>(n(),c("div",{key:J.id,class:"mb-3"},[e("div",Ml,[e("div",null,[e("strong",null,_(J.name),1),e("div",Ul,_(J.description),1)]),e("div",null,[t(H,{size:"x-small",variant:"text",onClick:ve=>de(J)},{default:a(()=>[...i[13]||(i[13]=[m("Revisar",-1)])]),_:1},8,["onClick"])])]),e("div",jl,[(n(!0),c(B,null,Q(J.competencies,ve=>(n(),c("div",{key:ve.id,class:"mb-1"},[e("div",Ol,[e("span",ql,"‚Ä¢ "+_(ve.name),1),t(H,{size:"x-small",variant:"text",onClick:Ne=>$e(ve.id)},{default:a(()=>[...i[14]||(i[14]=[m("Ver/Editar",-1)])]),_:1},8,["onClick"])]),e("div",Pl,[(n(!0),c(B,null,Q(ve.skills,Ne=>(n(),c("span",{key:Ne.id,class:"mr-3"},[m(_(Ne.name)+" ",1),Ne.is_incubating?(n(),c("small",Dl,"(incubation)")):O("",!0)]))),128))])]))),128))])]))),128))]))]))]),_:1}),t(se,null,{default:a(()=>[s.value&&s.value.source_generation_id?(n(),c("div",Jl,[i[19]||(i[19]=e("h4",{class:"mb-2"}," Registro de importaci√≥n ",-1)),oe.value?(n(),c("div",Ll,[t(je,{indeterminate:"",color:"primary"})])):(n(),c("div",Hl,[F.value.length===0?(n(),c("div",Fl," No hay registros de importaci√≥n. ")):(n(),c("div",Gl,[(n(!0),c(B,null,Q(F.value,(J,ve)=>(n(),c("div",{key:ve,class:"mb-3"},[e("div",Bl,[e("strong",null,_(J.attempted_at||J.attempted||"‚Äî"),1),i[15]||(i[15]=m(" ‚Äî ",-1)),e("em",null,_(J.attempted_by||"Sistema"),1)]),e("div",null,[i[16]||(i[16]=m(" Resultado: ",-1)),e("strong",null,_(J.result),1)]),J.error?(n(),c("div",Wl,[i[17]||(i[17]=e("div",{class:"text-sm text-red-700"}," Error: ",-1)),e("pre",Kl,_(JSON.stringify(J.error,null,2)),1)])):O("",!0),J.report?(n(),c("div",Ql,[i[18]||(i[18]=e("div",{class:"text-sm text-green-700"}," Reporte: ",-1)),e("pre",Xl,_(JSON.stringify(J.report,null,2)),1)])):O("",!0)]))),128))]))]))])):O("",!0)]),_:1})]),_:1})])],512),[[be,l.value===1]]),l.value===2?(n(),c("div",Yl,[b.value>0?(n(),c("div",Zl,[["draft","incubating","incubated"].includes(s.value?.status)?(n(),c("div",en,[e("div",tn,[i[21]||(i[21]=e("div",null,[e("h3",{class:"text-h6 font-weight-bold mb-0 text-indigo-900"}," Fase de Conciliaci√≥n Estrat√©gica "),e("div",{class:"text-caption text-indigo-700"}," Puente de Transici√≥n: Valida el dise√±o incubado antes de la ingenier√≠a de detalle. ")],-1)),t(H,{size:"small",variant:"flat",color:"indigo-darken-2",onClick:Ce,"prepend-icon":"mdi-auto-fix",class:"text-none"},{default:a(()=>[...i[20]||(i[20]=[m(" Simular IA (Full Concept) ",-1)])]),_:1})]),e("div",an,[(n(),P(Pa,{"scenario-id":Number(b.value),key:`incubated-${b.value}-${s.value?.updated_at||""}`,onApproved:j},null,8,["scenario-id"]))]),t(tt,{class:"my-8"}),i[22]||(i[22]=e("h3",{class:"text-h6 font-weight-bold mb-4 text-slate-800"}," Matriz de Ingenier√≠a de Roles (Pivote Final) ",-1))])):(n(),c("div",on,[e("div",ln,[e("div",nn,[t(me,{color:"white"},{default:a(()=>[...i[23]||(i[23]=[m("mdi-check-all",-1)])]),_:1})]),i[24]||(i[24]=e("div",null,[e("h4",{class:"text-lg font-bold text-emerald-900"}," Dise√±o Consolidado "),e("p",{class:"text-sm text-emerald-700"}," La estructura ha sido aprobada. Ahora puedes precisar las brechas en la matriz inferior. ")],-1))]),t(H,{variant:"text",color:"emerald-darken-2",size:"small","prepend-icon":"mdi-history",onClick:i[1]||(i[1]=J=>s.value.status="incubating")},{default:a(()=>[...i[25]||(i[25]=[m(" Reabrir Laboratorio ",-1)])]),_:1})])),(n(),P(cl,{"scenario-id":b.value,key:`rcm-${b.value}-${l.value}-${s.value?.updated_at||""}`},null,8,["scenario-id"]))])):(n(),c("div",sn,[t(at,{indeterminate:"",color:"primary"}),i[26]||(i[26]=e("span",{class:"ml-2"},"Cargando escenario...",-1))]))])):O("",!0),ye(e("div",rn,[t(pe,null,{default:a(()=>[t(re,null,{default:a(()=>[t(fe,null,{default:a(()=>[t(me,{class:"mr-2"},{default:a(()=>[...i[27]||(i[27]=[m("mdi-strategy",-1)])]),_:1}),i[28]||(i[28]=m(" Estrategias de Cierre ",-1))]),_:1}),t(se,null,{default:a(()=>[t(ke,{type:"info",variant:"tonal",class:"mb-4"},{default:a(()=>[...i[29]||(i[29]=[m(" Define estrategias para cerrar las brechas identificadas (capacitaci√≥n, contrataci√≥n, etc.). ",-1)])]),_:1}),t(H,{color:"primary",onClick:ze,loading:k.value},{default:a(()=>[...i[30]||(i[30]=[m(" Generar Estrategias ",-1)])]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1})],512),[[be,l.value===3]]),ye(e("div",dn,[t(pe,null,{default:a(()=>[t(re,null,{default:a(()=>[t(fe,null,{default:a(()=>[t(me,{class:"mr-2"},{default:a(()=>[...i[31]||(i[31]=[m("mdi-account-group",-1)])]),_:1}),i[32]||(i[32]=m(" Plan de Personal ",-1))]),_:1}),t(se,null,{default:a(()=>[t(ke,{type:"info",variant:"tonal"},{default:a(()=>[...i[33]||(i[33]=[m(" Planifica los recursos humanos necesarios para ejecutar el escenario. ",-1)])]),_:1})]),_:1})]),_:1})]),_:1})],512),[[be,l.value===4]]),ye(e("div",cn,[t(pe,null,{default:a(()=>[t(re,null,{default:a(()=>[t(fe,null,{default:a(()=>[t(me,{class:"mr-2"},{default:a(()=>[...i[34]||(i[34]=[m("mdi-chart-timeline-variant",-1)])]),_:1}),i[35]||(i[35]=m(" Pron√≥stico de Roles ",-1))]),_:1}),t(se,null,{default:a(()=>[t(ke,{type:"info",variant:"tonal"},{default:a(()=>[...i[36]||(i[36]=[m(" Proyecta las necesidades de roles a futuro bas√°ndose en el escenario. ",-1)])]),_:1})]),_:1})]),_:1})]),_:1})],512),[[be,l.value===5]]),ye(e("div",un,[t(pe,null,{default:a(()=>[t(re,null,{default:a(()=>[t(fe,null,{default:a(()=>[t(me,{class:"mr-2"},{default:a(()=>[...i[37]||(i[37]=[m("mdi-compare",-1)])]),_:1}),i[38]||(i[38]=m(" Comparaci√≥n de Escenarios ",-1))]),_:1}),t(se,null,{default:a(()=>[t(ke,{type:"info",variant:"tonal"},{default:a(()=>[...i[39]||(i[39]=[m(" Compara diferentes versiones del escenario o escenarios alternativos. ",-1)])]),_:1})]),_:1})]),_:1})]),_:1})],512),[[be,l.value===6]]),ye(e("div",pn,[t(pe,null,{default:a(()=>[t(re,null,{default:a(()=>[t(fe,null,{default:a(()=>[t(me,{class:"mr-2"},{default:a(()=>[...i[40]||(i[40]=[m("mdi-view-dashboard",-1)])]),_:1}),i[41]||(i[41]=m(" Dashboard Ejecutivo ",-1))]),_:1}),t(se,null,{default:a(()=>[t(ke,{type:"info",variant:"tonal"},{default:a(()=>[...i[42]||(i[42]=[m(" Resumen ejecutivo y KPIs del escenario. ",-1)])]),_:1})]),_:1})]),_:1})]),_:1})],512),[[be,l.value===7]])],64)):(n(),P(pe,{key:2},{default:a(()=>[t(ke,{type:"error",variant:"tonal"},{default:a(()=>[...i[43]||(i[43]=[m(" No se pudo cargar el escenario. ",-1)])]),_:1})]),_:1}))]),t(Ue,{color:"surface",class:"border-t",style:{position:"fixed",bottom:"0",left:"0",right:"0","z-index":"10"}},{default:a(()=>[t(pe,{fluid:"",class:"pa-2"},{default:a(()=>[t(Le,{"no-gutters":"",align:"center"},{default:a(()=>[t(Z,{cols:"4"},{default:a(()=>[l.value>1?(n(),P(H,{key:0,variant:"text",size:"small","prepend-icon":"mdi-chevron-left",onClick:Ze},{default:a(()=>[e("span",mn,_(ne[l.value-2]?.title),1),i[44]||(i[44]=e("span",{class:"d-sm-none"},"Anterior",-1))]),_:1})):O("",!0)]),_:1}),t(Z,{cols:"4",class:"text-center"},{default:a(()=>[e("span",vn,_(De.value.title)+": "+_(De.value.subtitle),1)]),_:1}),t(Z,{cols:"4",class:"text-right"},{default:a(()=>[l.value<ne.length?(n(),P(H,{key:0,variant:"tonal",color:"primary",size:"small","append-icon":"mdi-chevron-right",onClick:Ye},{default:a(()=>[e("span",_n,_(ne[l.value]?.title),1),i[45]||(i[45]=e("span",{class:"d-sm-none"},"Siguiente",-1))]),_:1})):(n(),P(H,{key:1,variant:"flat",color:"success",size:"small","prepend-icon":"mdi-check",onClick:Je},{default:a(()=>[...i[46]||(i[46]=[m(" Finalizar ",-1)])]),_:1}))]),_:1})]),_:1})]),_:1})]),_:1}),b.value&&b.value>0&&s.value?(n(),P(xl,{key:0,ref_key:"versionHistoryRef",ref:V,"scenario-id":b.value,"version-group-id":s.value.version_group_id||"","current-version":s.value.version_number||1,onVersionSelected:Xe},null,8,["scenario-id","version-group-id","current-version"])):O("",!0),b.value&&b.value>0?(n(),P(ta,{key:1,ref_key:"statusTimelineRef",ref:K,"scenario-id":b.value,onStatusChanged:ae},null,8,["scenario-id"])):O("",!0),t(Oe,{modelValue:z.value,"onUpdate:modelValue":i[2]||(i[2]=J=>z.value=J),"max-width":"900",scrollable:""},{default:a(()=>[t(re,null,{default:a(()=>[t(se,null,{default:a(()=>[U.value?(n(),P(Xt,{key:0,id:U.value,title:"ChangeSet",onClose:Re},null,8,["id"])):O("",!0)]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(Oe,{modelValue:R.value,"onUpdate:modelValue":i[3]||(i[3]=J=>R.value=J),"max-width":"1000"},{default:a(()=>[t(re,null,{default:a(()=>[t(se,null,{default:a(()=>[t(ut)]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(bt,{modal:g.value,"onUpdate:modal":i[4]||(i[4]=J=>g.value=J),item:o.value,"scenario-id":b.value,onClose:i[5]||(i[5]=J=>g.value=!1),onPromoted:ce},null,8,["modal","item","scenario-id"]),t(Oe,{modelValue:W.value,"onUpdate:modelValue":i[7]||(i[7]=J=>W.value=J),"max-width":"800"},{default:a(()=>[t(re,null,{default:a(()=>[t(fe,null,{default:a(()=>[...i[47]||(i[47]=[m("Prompt aceptado",-1)])]),_:1}),t(se,null,{default:a(()=>[s.value?(n(),c("pre",gn,_(s.value.accepted_prompt),1)):O("",!0)]),_:1}),t(ot,null,{default:a(()=>[t(He),t(H,{text:"",onClick:i[6]||(i[6]=J=>W.value=!1)},{default:a(()=>[...i[48]||(i[48]=[m("Cerrar",-1)])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])])]),_:1})}}}),Tn=we(fn,[["__scopeId","data-v-346f5cc1"]]);export{Tn as default};
