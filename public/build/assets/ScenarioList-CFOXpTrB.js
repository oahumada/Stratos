import{u as te}from"./useApi-DEBD0yG7.js";import{d as ae,_ as oe,r as v,p as se,o as ne,b as n,c as z,e as r,f as a,w as o,j as _,k as d,g as u,i as f,O as C,t as E,J as ie,K as le}from"./app-BQBzBluS.js";import{u as re}from"./scenarioPlanningScenariosStore-DvAo8lLm.js";import{_ as ce}from"./ScenarioCreateModal.vue_vue_type_script_setup_true_lang-DGbjRTpg.js";import"./apiHelper-CL77IM7H.js";const de={class:"scenario-list-page"},ue={key:0,class:"text-caption"},pe={key:1,class:"text-medium-emphasis"},me={class:"d-flex gap-1"},xe=ae({layout:oe,__name:"ScenarioList",setup(ve){const S=te(),{showSuccess:j,showError:V}=ie(),P=re(),h=v([]),b=v(!1),y=v(!1),$=v([]),l=v({status:null,type:null}),B=["draft","active","completed","archived"],U=[{value:"transformation",title:"Transformación"},{value:"growth",title:"Crecimiento"},{value:"automation",title:"Automatización"},{value:"merger",title:"Fusión"},{value:"custom",title:"Personalizado"}],D=[{title:"Nombre",key:"name"},{title:"Tipo",key:"scenario_type"},{title:"Estado (Decisión)",key:"decision_status"},{title:"Estado (Ejecución)",key:"execution_status"},{title:"Versión",key:"version_number"},{title:"Horizonte (semanas)",key:"time_horizon_weeks"},{title:"Acciones",key:"actions",sortable:!1}],F=se(()=>h.value.filter(s=>{const e=l.value.status?s.status===l.value.status:!0,c=l.value.type?s.scenario_type===l.value.type:!0;return e&&c})),L=s=>({draft:"grey",pending_approval:"warning",approved:"success",rejected:"error"})[s||"draft"]||"grey",O=s=>({planned:"grey-lighten-1",in_progress:"primary",paused:"warning",completed:"success"})[s||"planned"]||"grey",H=s=>({draft:"Borrador",pending_approval:"Pendiente",approved:"Aprobado",rejected:"Rechazado"})[s||"draft"],R=s=>({planned:"Planificado",in_progress:"En ejecución",paused:"Pausado",completed:"Completado"})[s||"planned"],g=async()=>{b.value=!0;try{const s=await S.get("/api/strategic-planning/scenarios",{params:{status:l.value.status,type:l.value.type}}),e=Array.isArray(s)?s:Array.isArray(s?.data)?s.data:[];h.value=e,P.scenarios=e}catch{V("No se pudieron cargar los escenarios")}finally{b.value=!1}},p=s=>{le.visit(`/scenario-planning/${s.id}?view=map`)},I=async s=>{if(window.confirm(`¿Eliminar escenario "${s.name}"? Esta acción no se puede deshacer.`))try{await S.delete(`/api/strategic-planning/scenarios/${s.id}`),j("Escenario eliminado"),await g()}catch(c){V(c?.response?.data?.message||"Error al eliminar el escenario")}},J=()=>{y.value=!0};return ne(()=>{g()}),(s,e)=>{const c=n("v-col"),A=n("v-row"),N=n("v-select"),m=n("v-btn"),K=n("v-alert"),M=n("v-card-text"),k=n("v-chip"),T=n("v-icon"),w=n("v-tooltip"),x=n("v-list-item"),q=n("v-divider"),G=n("v-list"),Q=n("v-menu"),W=n("v-data-table"),X=n("v-card"),Y=n("v-container"),Z=n("v-dialog");return r(),z("div",de,[a(Y,{fluid:""},{default:o(()=>[a(A,{class:"align-center mb-4"},{default:o(()=>[a(c,{cols:"12",md:"6"},{default:o(()=>[...e[5]||(e[5]=[_("h2",{class:"mb-0"}," Planificación Estratégica de Escenarios ",-1),_("p",{class:"text-medium-emphasis mb-0"}," Administra, filtra y navega escenarios con metodología 7 pasos ",-1)])]),_:1})]),_:1}),a(X,{class:"mb-4"},{default:o(()=>[a(M,null,{default:o(()=>[a(A,null,{default:o(()=>[a(c,{cols:"12",md:"3"},{default:o(()=>[a(N,{modelValue:l.value.status,"onUpdate:modelValue":e[0]||(e[0]=t=>l.value.status=t),items:B,label:"Estado (Legacy)",clearable:""},null,8,["modelValue"])]),_:1}),a(c,{cols:"12",md:"3"},{default:o(()=>[a(N,{modelValue:l.value.type,"onUpdate:modelValue":e[1]||(e[1]=t=>l.value.type=t),items:U,"item-title":"title","item-value":"value",label:"Tipo de escenario",clearable:""},null,8,["modelValue"])]),_:1}),a(c,{cols:"12",md:"2",class:"text-right"},{default:o(()=>[a(m,{variant:"outlined",color:"primary",onClick:g,"prepend-icon":"mdi-refresh"},{default:o(()=>[...e[6]||(e[6]=[d(" Refrescar ",-1)])]),_:1})]),_:1}),a(c,{cols:"12",md:"4",class:"text-right"},{default:o(()=>[a(m,{color:"primary","prepend-icon":"mdi-plus",onClick:J},{default:o(()=>[...e[7]||(e[7]=[d(" Nuevo escenario ",-1)])]),_:1})]),_:1})]),_:1}),a(K,{type:"info",variant:"tonal",density:"compact",class:"mt-2"},{default:o(()=>[...e[8]||(e[8]=[_("strong",null,"Estados duales:",-1),d(" Los escenarios ahora tienen estado de decisión (borrador/pendiente/aprobado/rechazado) y estado de ejecución (planificado/en progreso/pausado/completado). ",-1)])]),_:1})]),_:1}),a(W,{headers:D,items:F.value,loading:b.value,"item-key":"id","show-select":"",selected:$.value,"onUpdate:selected":e[2]||(e[2]=t=>$.value=t),class:"elevation-0"},{"item.decision_status":o(({item:t})=>[a(k,{color:L(t.decision_status),size:"small",variant:"flat",class:"text-uppercase"},{default:o(()=>[d(E(H(t.decision_status)),1)]),_:2},1032,["color"])]),"item.execution_status":o(({item:t})=>[t.decision_status==="approved"?(r(),u(k,{key:0,color:O(t.execution_status),size:"small",variant:"outlined",class:"text-uppercase"},{default:o(()=>[d(E(R(t.execution_status)),1)]),_:2},1032,["color"])):(r(),u(k,{key:1,size:"small",color:"grey-lighten-2",variant:"flat",disabled:""},{default:o(()=>[...e[9]||(e[9]=[d(" N/A ",-1)])]),_:1}))]),"item.version_number":o(({item:t})=>[t.version_number?(r(),z("div",ue,[a(T,{icon:"mdi-history",size:"x-small",class:"mr-1"}),d(" v"+E(t.version_number)+" ",1),t.is_current_version?(r(),u(k,{key:0,size:"x-small",color:"primary",variant:"flat",class:"ml-1"},{default:o(()=>[...e[10]||(e[10]=[d(" Actual ",-1)])]),_:1})):f("",!0)])):(r(),z("span",pe,"—"))]),"item.actions":o(({item:t})=>[_("div",me,[a(w,{text:"Ver detalle"},{activator:o(({props:i})=>[a(m,C(i,{size:"small",variant:"text",icon:"mdi-eye",color:"primary",onClick:ee=>p(t)}),null,16,["onClick"])]),_:2},1024),a(w,{text:"Borrar"},{activator:o(({props:i})=>[a(m,C(i,{size:"small",variant:"text",icon:"mdi-delete",color:"error",onClick:ee=>I(t)}),null,16,["onClick"])]),_:2},1024),t.parent_id?(r(),u(w,{key:0,text:"Escenario hijo"},{activator:o(({props:i})=>[a(T,C(i,{icon:"mdi-file-tree",size:"small",color:"info"}),null,16)]),_:1})):f("",!0),a(Q,null,{activator:o(({props:i})=>[a(m,C(i,{size:"small",variant:"text",icon:"mdi-dots-vertical",color:"grey-darken-1"}),null,16)]),default:o(()=>[a(G,{density:"compact"},{default:o(()=>[t.decision_status==="approved"&&t.is_current_version?(r(),u(x,{key:0,"prepend-icon":"mdi-content-copy",title:"Crear nueva versión",onClick:i=>p(t)},null,8,["onClick"])):f("",!0),t.decision_status!=="approved"?(r(),u(x,{key:1,"prepend-icon":"mdi-pencil",title:"Editar",onClick:i=>p(t)},null,8,["onClick"])):f("",!0),t.parent_id?(r(),u(x,{key:2,"prepend-icon":"mdi-sync",title:"Sincronizar desde padre",onClick:i=>p(t)},null,8,["onClick"])):f("",!0),a(q),a(x,{"prepend-icon":"mdi-history",title:"Ver historial de versiones",onClick:i=>p(t)},null,8,["onClick"])]),_:2},1024)]),_:2},1024)])]),"no-data":o(()=>[...e[11]||(e[11]=[_("div",{class:"pa-6 text-medium-emphasis text-center"}," No hay escenarios todavía. Crea uno desde plantilla. ",-1)])]),_:1},8,["items","loading","selected"])]),_:1})]),_:1}),a(Z,{modelValue:y.value,"onUpdate:modelValue":e[4]||(e[4]=t=>y.value=t),"max-width":"900px"},{default:o(()=>[a(ce,{onCreated:g,onClose:e[3]||(e[3]=t=>y.value=!1)})]),_:1},8,["modelValue"])])}}});export{xe as default};
