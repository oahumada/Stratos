import{D as Oe,J as jl,r as i,p as Le,d as Ci,o as ol,B as ft,S as hl,b as _e,c as te,e as z,j as x,f as y,i as Qt,I as bl,q as Sa,F as Ue,s as Je,G as Ye,u as rl,t as he,w as D,k as ae,v as It,g as Bl,m as Si}from"./app-BQBzBluS.js";import{u as Sl}from"./useApi-DEBD0yG7.js";import{s as Mi,l as Ai,m as _i,a as Ni}from"./transform-9n3FYwas.js";import"./apiHelper-CL77IM7H.js";function wl(K,re,Y,T={}){const q=T.rows??2,O=T.cols??5,le=T.hSpacing??120,F=T.vSpacing??100,b=Math.min(K,q*O),A=[];for(let G=0;G<b;G++){const X=Math.floor(G/O),N=G%O,P=b-X*O,E=Math.min(P,O),_=E>1?(E-1)*le:0,p=Math.round(re-_/2+N*le),v=Math.round(Y+X*F);A.push({x:p,y:v})}return A}function xl(K,re=[{min:4,max:8,rows:2,cols:4},{min:9,max:10,rows:2,cols:5}],Y=10){const T=Math.min(K,Y);for(const q of re)if((q.min??0)<=K&&K<=(q.max??1/0))return{rows:q.rows,cols:q.cols,limit:T};return{rows:2,cols:Math.min(5,Math.max(1,Math.ceil(K/2))),limit:T}}function Wl(K,re,Y,T,q,O=120,le=100){return wl(K,re,Y,{rows:T,cols:q,hSpacing:O,vSpacing:le})}function kl(K,re,Y,T={},q=null){const O=T.hSpacing??140,le=T.vSpacing??90,F=T.parentOffset??80;if(T.selectedOffsetMultiplier,K===0)return[];const b=Y+F,A=Math.floor(K/2),G=K-A;function X(v){const k=[];if(v===1)return k.push(b),k;const m=(v-1)*le,h=Math.round(b-m/2);for(let u=0;u<v;u++)k.push(h+u*le);return k}const N=X(A).reverse(),P=X(G),E=[],_=Math.round(re-O),p=Math.round(re+O);if(q!=null&&q>=0&&q<K){const v=Array.from({length:K},(oe,me)=>me).filter(oe=>oe!==q),k=Math.floor(v.length/2),m=v.length-k,h=X(k).reverse(),u=X(m),M=[];let U=0,fe=0;for(let oe=0;oe<K;oe++)oe!==q&&(U<h.length?M.push({x:_,y:h[U++]}):M.push({x:p,y:u[fe++]??b}));M.map(oe=>Math.abs(oe.y-b));const ye=Y+Math.round(F*.8);let ge=0,xe=0;for(let oe=0;oe<K;oe++)oe===q?E.push({x:Math.round(re),y:ye}):ge<h.length?E.push({x:_,y:h[ge++]}):E.push({x:p,y:u[xe++]??b})}else for(let v=0;v<K;v++)if(v<A)E.push({x:_,y:N[v]??b});else{const k=v-A;E.push({x:p,y:P[k]??b})}return E}function Cl(K,re,Y,T="auto"){if(K&&K!=="auto")return K;const q=T??"auto";return q!=="auto"?q:re&&Y>3?"sides":"matrix"}function Ei(){const{post:K,get:re}=Sl();async function Y(O,le){if(!O)throw new Error("compId required");try{const F=await K(`/api/competencies/${O}/skills`,{skill:le});return F?.data??F}catch(F){throw F}}async function T(O,le){if(!O)throw new Error("compId required");if(!le)throw new Error("skillId required");try{const F=await K(`/api/competencies/${O}/skills`,{skill_id:le});return F?.data??F}catch(F){throw F}}async function q(O){if(!O)return[];const le=await re(`/api/competencies/${O}/skills`);return le?.data??le}return{createAndAttachSkill:Y,attachExistingSkill:T,listSkillsForCompetency:q}}function Vi(K,re={}){const{nodes:Y,focusedNode:T,childNodes:q,selectedChild:O,grandChildNodes:le}=K,{wrapLabel:F=p=>p,debug:b=!1}=re,A=(...p)=>{b&&console.debug("[useHierarchicalUpdate]",...p)};function G(p,v){if(!p||typeof p.id>"u")return A("updateSkill: invalid freshSkill",p),!1;const k=p.id;A("updateSkill",{skillId:k,competencyId:v,name:p.name});const m=u=>u.map(M=>(M.id??M.raw?.id)===k?{...p,pivot:M.pivot??M.raw?.pivot,raw:{...p,pivot:M.pivot??M.raw?.pivot}}:M);if(le.value=le.value.map(u=>(u.raw?.id??u.skillId)===k?{...u,name:p.name,description:p.description,displayName:F(p.name??u.name,12),raw:{...p,pivot:u.raw?.pivot}}:u),A("Updated grandChildNodes"),O.value&&Array.isArray(O.value.skills)){const u=m(O.value.skills);O.value={...O.value,skills:u,raw:{...O.value.raw,skills:u}},A("Updated selectedChild.skills")}q.value=q.value.map(u=>{if(u.compId===v||u.raw?.id===v){const M=Array.isArray(u.skills)?m(u.skills):u.skills;return{...u,skills:M,raw:{...u.raw,skills:M}}}return u}),A("Updated childNodes[].skills");const h=T.value?.competencies;if(Array.isArray(h)){const u=h.find(M=>M.id===v);u&&Array.isArray(u.skills)&&(u.skills=m(u.skills),A("Updated focusedNode.competencies[].skills"))}return Y.value=Y.value.map(u=>{if(Array.isArray(u.competencies)){const M=u.competencies.find(U=>U.id===v);M&&Array.isArray(M.skills)&&(M.skills=m(M.skills))}return u}),A("Updated nodes[].competencies[].skills"),!0}function X(p,v){if(!p||typeof p.id>"u")return A("updateCompetency: invalid freshComp",p),!1;const k=p.id;A("updateCompetency",{compId:k,capabilityId:v,name:p.name});const m=u=>({name:p.name??u.name,description:p.description??u.description,readiness:p.readiness??u.readiness,skills:p.skills??u.skills});q.value=q.value.map(u=>u.compId===k||u.raw?.id===k?{...u,...m(u),displayName:F(p.name??u.name,14),raw:{...u.raw??{},...p}}:u),A("Updated childNodes"),O.value&&(O.value.compId===k||O.value.raw?.id===k)&&(O.value={...O.value,...m(O.value),displayName:F(p.name??O.value.name,14),raw:{...O.value.raw??{},...p}},A("Updated selectedChild"));const h=T.value?.competencies;if(Array.isArray(h)){const u=h.find(M=>M.id===k);u&&(Object.assign(u,m(u)),A("Updated focusedNode.competencies[]"))}return Y.value=Y.value.map(u=>{if(Array.isArray(u.competencies)){const M=u.competencies.find(U=>U.id===k);M&&Object.assign(M,m(M))}return u}),A("Updated nodes[].competencies[]"),!0}function N(p){if(!p||typeof p.id>"u")return A("updateCapability: invalid freshCap",p),!1;const v=p.id;A("updateCapability",{capId:v,name:p.name});const k=m=>({name:p.name??m.name,description:p.description??m.description,competencies:p.competencies??m.competencies});return Y.value=Y.value.map(m=>m.id===v?{...m,...k(m),displayName:F(p.name??m.name,16),raw:{...m.raw??{},...p}}:m),A("Updated nodes[]"),T.value&&T.value.id===v&&(Object.assign(T.value,k(T.value)),T.value.displayName=F(p.name??T.value.name,16),T.value.raw&&Object.assign(T.value.raw,p),A("Updated focusedNode")),!0}function P(p,v){A("removeSkill",{skillId:p,competencyId:v});const k=u=>u.filter(M=>(M.id??M.raw?.id)!==p);le.value=le.value.filter(u=>(u.skillId??u.raw?.id??u.raw?.raw?.id)!==p&&u.id!==p),O.value&&Array.isArray(O.value.skills)&&(O.value.skills=k(O.value.skills)),O.value&&Array.isArray(O.value.raw?.skills)&&(O.value.raw.skills=k(O.value.raw.skills));const m=T.value?.competencies;if(Array.isArray(m)){const u=m.find(M=>M.id===v);u&&Array.isArray(u.skills)&&(u.skills=k(u.skills))}const h=q.value.find(u=>u.compId===v);return h&&(Array.isArray(h.skills)&&(h.skills=k(h.skills)),Array.isArray(h.raw?.skills)&&(h.raw.skills=k(h.raw.skills))),Y.value.forEach(u=>{if(Array.isArray(u.competencies)){const M=u.competencies.find(U=>U.id===v);M&&Array.isArray(M.skills)&&(M.skills=k(M.skills))}}),!0}async function E(p,v,k){let m=!1;switch(p){case"skill":if(!k)return A("updateSkill requires parentId (competencyId)"),!1;m=G(v,k);break;case"competency":m=X(v,k);break;case"capability":m=N(v);break}return await Oe(),m}async function _(p,v,k){let m=!1;switch(p){case"skill":if(!k)return A("removeSkill requires parentId (competencyId)"),!1;m=P(v,k);break}return await Oe(),m}return{updateSkill:G,updateCompetency:X,updateCapability:N,removeSkill:P,update:E,remove:_}}function Ii(K){const re=Sl(),{showSuccess:Y,showError:T}=jl(),q=m=>{const h=re?.[m],u=re?.api?.[m];return h??u},O=async(m,h)=>{const u=q("get");return typeof u=="function"?u(m,h):Promise.resolve({data:[]})},le=async(m,h)=>{const u=q("post");return typeof u=="function"?u(m,h):Promise.resolve({data:{}})},F=async(m,h)=>{const u=q("patch");return typeof u=="function"?u(m,h):Promise.resolve({data:{}})},b=async m=>{const h=q("delete");return typeof h=="function"?h(m):Promise.resolve({data:{}})};async function A(){try{const m=document.cookie.includes("XSRF-TOKEN=");if(console.debug("[ensureCsrf] has XSRF-TOKEN cookie?",m),!m){const h=re?.api?.get??re?.get;typeof h=="function"&&await h("/sanctum/csrf-cookie"),console.debug("[ensureCsrf] fetched /sanctum/csrf-cookie")}}catch(m){console.warn("[ensureCsrf] failed to fetch csrf-cookie",m)}}async function G(m){if(!m)return[];try{console.debug("[loadCapabilityTree] fetching for scenario",m);const h=await O(`/api/strategic-planning/scenarios/${m}/capability-tree`),u=h?.data??h??[],M=Array.isArray(u)?u:u?.data??u??[];return console.debug("[loadCapabilityTree] fetched items_count=",M.length),M}catch(h){return console.error("[loadCapabilityTree] error",h),[]}}async function X(m,h,u){await A();try{console.debug("[saveCapability] PATCH /api/capabilities/"+m,h);const M=await F(`/api/capabilities/${m}`,h);if(console.debug("[saveCapability] PATCH /api/capabilities response",M),Y("Capacidad actualizada"),u){const U={strategic_role:h.strategic_role,strategic_weight:h.strategic_weight,priority:h.priority,rationale:h.rationale,required_level:h.required_level,is_critical:h.is_critical};try{const fe=await F(`/api/strategic-planning/scenarios/${u}/capabilities/${m}`,U);return console.debug("[saveCapability] PATCH pivot response",fe),Y("Relación escenario–capacidad actualizada"),fe?.data??M?.data}catch(fe){console.error("[saveCapability] error PATCH pivot",fe);try{const ye=await le(`/api/strategic-planning/scenarios/${u}/capabilities`,h);return Y("Relación actualizada (fallback)"),ye?.data}catch(ye){console.error("[saveCapability] error POST fallback",ye),T("No se pudo actualizar la relación. Verifica el backend.")}}}return M?.data}catch(M){const U=M;throw console.error("[saveCapability] error PATCH /api/capabilities/",U?.response?.data??U),U?.response?.status!==404&&T(U?.response?.data?.message||"Error actualizando capacidad"),M}}async function N(m,h){try{let u=null,M=null;if(h)try{await b(`/api/strategic-planning/scenarios/${h}/capabilities/${m}`)}catch(U){u=U?.response?.status??null}try{await b(`/api/capabilities/${m}`)}catch(U){M=U?.response?.status??null}return(u===404||u===null)&&(M===404||M===null)?T("Eliminado localmente. El backend no expone endpoints DELETE."):Y("Capacidad y relación eliminadas"),!0}catch(u){return console.error("[deleteCapability] error",u),T("Error al eliminar capacidad"),!1}}async function P(m,h,u){try{const M=u?`/api/strategic-planning/scenarios/${u}/capabilities/${h}/competencies/${m}`:`/api/capabilities/${h}/competencies/${m}`;return console.debug("[deleteCompetency] DELETE",M),await b(M),Y("Competencia eliminada"),!0}catch(M){return M?.response?.status===404?(console.debug("[deleteCompetency] DELETE 404, removing locally"),!0):(console.error("[deleteCompetency] error",M),T("Error eliminando competencia"),!1)}}async function E(m){if(!m)return[];try{K?.scenario?.id;try{const h=await O(`/api/competencies/${m}/skills`),u=h?.data??h;if(Array.isArray(u))return u}catch(h){console.debug("[fetchSkillsForCompetency] /competencies/:id/skills failed",h)}try{const h=await O(`/api/competencies/${m}`),u=h?.data??h;if(u?.skills&&Array.isArray(u.skills))return u.skills}catch(h){console.debug("[fetchSkillsForCompetency] /competencies/:id failed",h)}return[]}catch(h){return console.error("[fetchSkillsForCompetency] error",h),[]}}async function _(m,h){await A();try{console.debug("[saveSkill] PATCH /api/skills/"+m,h);const u=await F(`/api/skills/${m}`,h);return Y("Skill actualizada"),u?.data??u}catch(u){throw console.error("[saveSkill] error",u),T("Error guardando skill"),u}}async function p(m,h,u){try{if(u)try{return await b(`/api/competency-skills/${u}`),Y("Skill eliminada"),!0}catch(M){console.debug("[deleteSkill] DELETE by pivotId failed",M)}if(h&&m)try{return await b(`/api/competencies/${h}/skills/${m}`),Y("Skill eliminada"),!0}catch(M){console.debug("[deleteSkill] DELETE via competency failed",M)}return T("No se pudo eliminar la skill"),!1}catch(M){return console.error("[deleteSkill] error",M),T("Error eliminando skill"),!1}}async function v(m,h,u){await A();try{console.debug("[createCompetency] POST",{scenarioId:u,capabilityId:m,competencyPayload:h});const M=u?`/api/strategic-planning/scenarios/${u}/capabilities/${m}/competencies`:`/api/capabilities/${m}/competencies`,U=await le(M,h),fe=U?.data??U;return Y("Competencia creada y asociada"),fe}catch(M){throw console.error("[createCompetency] error",M),T("Error creando competencia"),M}}async function k(m,h){if(!m)return T("Escenario no seleccionado"),!1;try{const u={positions:h.map(M=>({id:M.id,x:M.x,y:M.y}))};return await le(`/api/strategic-planning/scenarios/${m}/capability-tree/save-positions`,u),Y("Posiciones guardadas"),!0}catch(u){return console.error("[savePositions] error",u),T("Error al guardar posiciones"),!1}}return{ensureCsrf:A,loadCapabilityTree:G,saveCapability:X,deleteCapability:N,deleteCompetency:P,fetchSkillsForCompetency:E,saveSkill:_,deleteSkill:p,createCompetency:v,savePositions:k}}const W={capability:{spacing:{hSpacing:10,vSpacing:10},forces:{linkDistance:100,linkStrength:.5,chargeStrength:-220},scenarioEdgeDepth:120,text:{fontSize:12,fontWeight:600}},competency:{radial:{radius:150,selectedOffsetY:-20,startAngle:-Math.PI/4,endAngle:5*Math.PI/4},sides:{selectedOffsetMultiplier:.75},defaultLayout:"auto",parentOffset:20,maxDisplay:10,matrixVariants:[{min:2,max:3,rows:1,cols:3},{min:4,max:8,rows:2,cols:4},{min:9,max:10,rows:2,cols:5}],spacing:{hSpacing:100,vSpacing:20,parentOffset:-10},edge:{baseDepth:40,curveFactor:.65,spreadOffset:18},text:{fontSize:10,fontWeight:600}},skill:{maxDisplay:10,radial:{radius:20,startAngle:-Math.PI/6,endAngle:7*Math.PI/6,offsetFactor:.8,offsetY:40},defaultLayout:"sides",matrixVariants:[{min:2,max:3,rows:1,cols:3},{min:4,max:8,rows:2,cols:4},{min:9,max:10,rows:2,cols:5}],sides:{hSpacing:80,vSpacing:40,parentOffset:150,selectedOffsetMultiplier:2},linear:{hSpacing:60,vSpacing:40},edge:{baseDepth:35,curveFactor:.5,spreadOffset:20},text:{fontSize:12,fontWeight:600}},animations:{competencyEntryFinalize:80,skillEntryFinalize:70,collapseDuration:10,competencyStaggerRow:30,competencyStaggerCol:12,competencyStaggerRandom:30,skillStaggerRow:20,skillStaggerCol:8,leadFactor:.6},node:{radius:34,focusRadius:44,competencyOpacity:.2,skillOpacity:.2},clamp:{minY:40,bottomPadding:40,minViewportHeight:120}};function Pi(){function K(A){return new Promise(G=>setTimeout(G,A))}function re(A){const G=W.clamp.minY,X=W.clamp.bottomPadding,N=W.clamp.minViewportHeight,P=Math.max(N,window.__scenarioHeight??600)-X;return Math.min(Math.max(A,G),P)}function Y(A,G=14){if(A==null)return"";const X=String(A).trim();if(X.length<=G)return X;const N=(v,k)=>{if(v.length<=k)return{line:v,rest:""};const h=v.slice(0,k+1).lastIndexOf(" ");return h>0?{line:v.slice(0,h),rest:v.slice(h+1).trim()}:{line:v.slice(0,k),rest:v.slice(k).trim()}},P=N(X,G);if(!P.rest)return P.line;const E=P.rest;if(E.length<=G)return P.line+`
`+E;const _=N(E,G);let p=_.line;return _.rest&&p.length>=G?p=p.slice(0,Math.max(0,G-1)).replace(/\s+$/,"")+"…":_.rest&&(p=p+"…"),P.line+`
`+p}function T(A,G,X,N){const P=X/2,E=N/2-30;if(G<=1)return{x:Math.round(P),y:Math.round(E)};const _=Math.min(5,Math.max(1,Math.ceil(Math.sqrt(G)))),p=Math.max(1,Math.ceil(G/_)),v=24,k=Math.max(120,X-v*2),m=Math.max(120,N-v*2),h=_>1?Math.min(160,Math.floor(k/_)):0,u=p>1?Math.min(140,Math.floor(m/p)):0,M=A%_,U=Math.floor(A/_),fe=(_-1)*h,ye=(p-1)*u,ge=M*h-fe/2,xe=U*u-ye/2;return{x:Math.round(P+ge),y:Math.round(E+xe)}}function q(A,G,X,N){if(!A)return;const P=Math.round(X/2),_=Math.round(N*.25);if(G&&G.id!==A.id){const p=G,v=A,k=p.x??0,m=p.y??0;return p.x=v.x??k,p.y=v.y??m,v.x=k,v.y=m,{updatedNode:v,updatedPrevNode:p}}return A.x=P,A.y=_,{updatedNode:A}}function O(A,G,X,N,P={},E,_){const p=A.competencies??[];if(!Array.isArray(p)||p.length===0)return{childNodes:[],childEdges:[]};const v=W.competency.maxDisplay,k=Math.min(P.limit??v,v),m=p.slice(0,k),h=A.x??Math.round((E??900)/2),u=A.y??Math.round((_??600)/2),U=W.competency.spacing.parentOffset,ye=Math.round(u+U+18);let ge=P.rows??1,xe=P.cols??4;const oe=W.competency.spacing.hSpacing,me=W.competency.spacing.vSpacing,Fe=W.competency.matrixVariants;try{const L=xl(m.length,Fe,v);ge=L.rows,xe=L.cols}catch{}const Ne=Cl(P.layout,!1,m.length,W.competency.defaultLayout);let Ie=[];if(Ne==="radial"){const L=W.competency.radial.radius,Se=W.competency.radial.startAngle,Re=(W.competency.radial.endAngle-Se)/Math.max(1,m.length-1);Ie=m.map((Xe,Pt)=>{const qe=Se+Pt*Re,be=Math.round(h+L*Math.cos(qe)),H=Math.round(ye+L*Math.sin(qe));return{x:be,y:H}})}else if(Ne==="sides")try{Ie=kl(m.length,h,u,W.competency.sides,null)}catch{Ie=[]}else Ie=Wl(m.length,h,ye,ge,xe,oe,me);const Qe=[];return m.forEach((L,Se)=>{const je=Ie[Se]||{x:h,y:ye},$=-(A.id*1e3+Se+1),Re=Math.max(0,Math.floor(Se/xe)*W.animations.competencyStaggerRow+Se%xe*W.animations.competencyStaggerCol+Math.round((Math.random()-.5)*W.animations.competencyStaggerRandom)),Xe={id:$,compId:L.id??null,name:L.name??L,displayName:Y(L.name??L,14),x:N?.x??A.x??h,y:N?.y??A.y??u,animScale:.84,animOpacity:0,animDelay:Re,animFilter:"blur(6px) drop-shadow(0 10px 18px rgba(2,6,23,0.36))",animTargetX:je.x,animTargetY:re(je.y),is_critical:!1,description:L.description??null,readiness:L.readiness??null,skills:Array.isArray(L.skills)?L.skills:[],raw:L};Qe.push(Xe),X.push({source:A.id,target:$})}),{childNodes:Qe,childEdges:X}}function le(A,G,X,N,P={},E){const _=Array.isArray(A.skills)?A.skills:A.raw?.skills??[];if(!Array.isArray(_)||_.length===0)return{grandChildNodes:[],grandChildEdges:[]};const p=W.skill.maxDisplay,v=_.slice(0,p),k=N?.x??A.x??450,m=N?.y??A.y??300,h=W.skill.radial.offsetY,u=Math.round(h*(1+W.skill.radial.offsetFactor)),U=Math.round(m+u+30),fe=P?.layout??void 0,ye=Cl(fe,!1,v.length,W.skill.defaultLayout);let ge=[];if(ye==="radial"){const oe=W.skill.radial.radius,me=W.skill.radial.startAngle,Ie=(W.skill.radial.endAngle-me)/Math.max(1,v.length-1);ge=v.map((Qe,L)=>{const Se=me+L*Ie,je=Math.round(k+oe*Math.cos(Se)),$=Math.round(U+oe*Math.sin(Se));return{x:je,y:$}})}else if(ye==="sides")try{ge=kl(v.length,k,m,W.skill.sides,null)}catch{ge=[]}else{const oe=W.skill.matrixVariants;try{const me=xl(v.length,oe,W.skill.maxDisplay);ge=wl(v.length,k,U,{rows:me.rows,cols:me.cols,hSpacing:W.skill.linear.hSpacing,vSpacing:W.skill.linear.vSpacing})}catch{const Ne=Math.min(4,v.length);ge=wl(v.length,k,U,{rows:1,cols:Ne,hSpacing:W.skill.linear.hSpacing,vSpacing:W.skill.linear.vSpacing})}}const xe=[];return v.forEach((oe,me)=>{const Fe=ge[me]||{x:k,y:U},Ne=-(Math.abs(A.id)*1e5+me+1),Ie=Math.max(0,Math.floor(me/4)*W.animations.skillStaggerRow+me%4*W.animations.skillStaggerCol),Qe={id:Ne,name:oe.name??oe,x:N?.x??A.x??k,y:N?.y??A.y??m,animScale:.8,animOpacity:0,animDelay:Ie,animTargetX:Fe.x,animTargetY:re(Fe.y),raw:oe};xe.push(Qe),X.push({source:A.id,target:Ne})}),{grandChildNodes:xe,grandChildEdges:X}}function F(A=!1,G){return G=typeof G=="number"?G:W.animations.collapseDuration,{animated:A,duration:G}}function b(A,G,X,N){try{const P=A.map(v=>({id:v.id,x:v.x||0,y:v.y||0})),E=G.map(v=>({source:v.source,target:v.target})),_=Mi(P).force("link",Ai(E).id(v=>v.id).distance(W.capability.forces.linkDistance).strength(W.capability.forces.linkStrength)).force("charge",_i().strength(W.capability.forces.chargeStrength)).force("center",Ni(X/2,N/2));for(let v=0;v<300;v++)_.tick();_.stop();const p=new Map(P.map(v=>[v.id,{x:Math.round(v.x),y:Math.round(v.y)}]));return A.map(v=>{const k=p.get(v.id);return{...v,x:k?.x??v.x,y:k?.y??v.y}})}catch(P){return console.warn("[runForceLayout] failed",P),A}}return{LAYOUT_CONFIG:W,wait:K,clampY:re,wrapLabel:Y,computeInitialPosition:T,centerOnNode:q,expandCompetencies:O,expandSkills:le,collapseGrandChildren:F,runForceLayout:b}}function Di(){const K=i(2),re=i([]),Y=i([]),T=i([]),q=i([]),O=i([]);function le(E,_,p,v,k){re.value=E,Y.value=_,T.value=p,q.value=v,O.value=k}function F(E){if(E){if(T.value&&Array.isArray(T.value)){const _=T.value.find(p=>p.id===E);if(_)return _}if(q.value&&Array.isArray(q.value)){const _=q.value.find(p=>p.id===E);if(_)return _}if(O.value&&Array.isArray(O.value)){const _=O.value.find(p=>p.id===E);if(_)return _}}}function b(E){return!E||E>=0?!1:!!O.value?.find(_=>_.id===E)}function A(E,_=!0){try{const p=_?E.target:E.source,v=F(p);if(!v)return{x:void 0,y:void 0};const k=v.x;let m=v.y;if(_&&p<0){const h=b(p);m=(m??0)-((h?14:24)+(h?4:6))}return{x:k,y:m}}catch{}return{x:void 0,y:void 0}}function G(E){try{const _=F(E.target);if(!_)return 0;const p=re.value?.filter(v=>{const k=F(v.target);return v.source===E.source&&k&&Math.abs((k.x??0)-(_.x??0))<=8})||[];return p.sort((v,k)=>v.target-k.target),Math.max(0,p.findIndex(v=>v===E))}catch{}return 0}function X(E){return E.animOpacity??.98}function N(E){try{const _=A(E,!1),p=A(E,!0),v=_.x,k=_.y,m=p.x,h=p.y,u=K.value,M=b(E.target)||b(E.source)||Y.value&&Y.value.includes(E);if(u===2&&typeof v=="number"&&typeof m=="number"){const U=M?W.skill.edge.baseDepth:W.competency.edge.baseDepth,fe=M?W.skill.edge.curveFactor:W.competency.edge.curveFactor,ye=Math.abs((h??0)-(k??0)),ge=Math.max(U,Math.round(ye*fe)+U),xe=Math.min(k??0,h??0)+ge;return{isPath:!0,d:`M ${v} ${k} C ${v} ${xe} ${m} ${xe} ${m} ${h}`}}if(u===3&&typeof v=="number"&&typeof m=="number"){const U=G(E),fe=(re.value||[]).concat(Y.value||[]).filter(ge=>{const xe=F(ge.target),oe=F(E.target);return ge.source===E.source&&xe&&oe&&Math.abs((xe.x??0)-(oe.x??0))<=8}),ye=(U-(fe.length-1)/2)*(M?W.skill.edge.spreadOffset:W.competency.edge.spreadOffset);return{isPath:!1,x1:v,y1:k,x2:(m??0)+ye,y2:h}}if(u===1&&typeof v=="number"&&typeof m=="number"){const fe=(h??0)-((M?14:20)-2);return{isPath:!1,x1:v,y1:k,x2:m,y2:fe}}return{isPath:!1,x1:v,y1:k,x2:m,y2:h}}catch{return{isPath:!1,x1:void 0,y1:void 0,x2:void 0,y2:void 0}}}function P(E){try{const _=F(E.source),p=F(E.target);if(!_||!p||typeof _.x!="number"||typeof p.x!="number")return"";const v=W.capability.scenarioEdgeDepth,k=Math.min(_.y??0,p.y??0)+v;return`M ${_.x} ${_.y} C ${_.x} ${k} ${p.x} ${k} ${p.x} ${p.y}`}catch{}return""}return{childEdgeMode:K,injectState:le,renderedNodeById:F,isGrandChildNode:b,edgeEndpoint:A,groupedIndexForEdge:G,edgeAnimOpacity:X,edgeRenderFor:N,scenarioEdgePath:P}}function $i(K){const re=i([]),Y=i([]),T=i([]),q=i([]),O=i([]),le=i([]),F=i([]),b=i(null),A=i(null),G=i(null),X=i(null),N=i(null),P=i(!1),E=i(!1),_=i(!1),p=i("light"),v=i(!1),k=i(0),m=i(0),h=i(!1),u=i(0),M=i(0),U=i(2),fe=i(!1),ye=i(!1),ge=i(!1),xe=i(!1),oe=i(!1),me=i(!1),Fe=i(!1),Ne=i(!1),Ie=i(!1),Qe=i(!1),L=i(!1),Se=i(!1),je=i(!1),$=i(!1),Re=i(!1),Xe=i(!1),Pt=i(!1),qe=i(""),be=i(""),H=i(""),ie=i(""),ue=i(3),yt=i("target"),Dt=i(10),S=i(1),ua=i(""),da=i(3),Z=i(!1),de=i(""),pa=i(""),J=i(void 0),ve=i(null),Be=i(""),Ma=i(""),C=i("target"),Ba=i(10),Aa=i(1),nl=i(""),gt=i(3),va=i(!1),ot=i(""),rt=i(""),et=i(void 0),fa=i(""),Pe=i(null),De=i(""),$t=i(""),ht=i(null),bt=i(""),Ot=i(10),wt=i(1),Rt=i(3),He=i(!1),xt=i(""),kt=i(""),Tt=i(""),ma=i(""),We=i(null),ea=i(null),ya=i(null),tt=i(null),ta=i(""),Ha=i(""),Lt=i("technical"),aa=i("tactical"),nt=i("domain"),la=i(""),ia=i(!1),_a=i(void 0),Ct=i(void 0),$e=i(void 0),Ft=i(""),oa=i(!1),Gt=i(null),Ut=i(!1),Yt=i(null),ra=i({x:0,y:0}),Na=i(!1),St=i({x:0,y:0}),at=i(0),Te=i(0),st=i(1),Xt=i(900),Mt=i(600),qt=i(null),ze=i(0),At=i(null),_t=i([]),Ea=i([]),Va=i([]),Bt=Le(()=>G.value??A.value),za=Le(()=>p.value==="dark"?"dialog-dark":"dialog-light"),ja=Le(()=>{const lt=[];try{const na=K?.scenario?.name||"—";if(lt.push(`Escenario: ${na}`),A.value){const Ae=A.value?.name||"—";lt.push(`Capacidad: ${Ae}`)}if(G.value){const Ae=G.value,it=Ae?.name||Ae?.raw?.name||Ae?.compName||"—";lt.push(`Competencia: ${it}`)}}catch{return"Escenario: —"}return lt.join("  ›  ")}),Ia=Le(()=>{const lt=[];try{const na=K?.scenario?.name||"—";if(lt.push(`Escenario: ${na}`),A.value){const Ae=A.value?.name||"—";lt.push(`Capacidad: ${Ae}`)}if(G.value){const Ae=G.value,it=Ae?.name||Ae?.raw?.name||Ae?.compName||"—";lt.push(`Competencia: ${it}`)}}catch{return["Escenario: —"]}return lt}),Pa=Le(()=>!_.value),Wa=Le(()=>({transform:`translate(${at.value}px, ${Te.value}px) scale(${st.value})`,transformOrigin:"0 0"}));function Da(){qe.value="",be.value="",H.value="",ie.value="",ue.value=3,yt.value="target",Dt.value=10,S.value=1,ua.value="",da.value=3,Z.value=!1}function sl(){ot.value="",rt.value="",et.value=void 0,fa.value=""}function Ka(){kt.value="",Tt.value="",ma.value="",We.value=null,ea.value=null,ya.value=null,tt.value=null}function $a(){E.value=!E.value}function cl(){_.value=!_.value}function ul(){p.value=p.value==="light"?"dark":"light"}function Za(){U.value=(U.value+1)%4}function dl(){at.value=0,Te.value=0,st.value=1}return{nodes:re,edges:Y,childNodes:T,childEdges:q,grandChildNodes:O,grandChildEdges:le,scenarioEdges:F,scenarioNode:b,focusedNode:A,selectedChild:G,selectedSkillDetail:X,contextMenuTarget:N,loaded:P,showSidebar:E,nodeSidebarCollapsed:_,sidebarTheme:p,contextMenuVisible:v,contextMenuLeft:k,contextMenuTop:m,contextMenuIsChild:h,tooltipX:u,tooltipY:M,childEdgeMode:U,noAnimations:fe,positionsDirty:ye,suppressWatcherLayout:ge,createModalVisible:xe,createCompDialogVisible:oe,addExistingCompDialogVisible:me,createSkillDialogVisible:Fe,selectSkillDialogVisible:Ne,skillDetailDialogVisible:Ie,followScenario:Qe,creating:L,creatingComp:Se,savingNode:je,savingSkill:$,attachingSkill:Re,savingSkillDetail:Xe,loadingSkills:Pt,newCapName:qe,newCapDescription:be,newCapType:H,newCapCategory:ie,newCapImportance:ue,pivotStrategicRole:yt,pivotStrategicWeight:Dt,pivotPriority:S,pivotRationale:ua,pivotRequiredLevel:da,pivotIsCritical:Z,editCapName:de,editCapDescription:pa,editCapImportance:J,editCapLevel:ve,editCapType:Be,editCapCategory:Ma,editPivotStrategicRole:C,editPivotStrategicWeight:Ba,editPivotPriority:Aa,editPivotRationale:nl,editPivotRequiredLevel:gt,editPivotIsCritical:va,newCompName:ot,newCompDescription:rt,newCompReadiness:et,newCompSkills:fa,addExistingSelection:Pe,editChildName:De,editChildDescription:$t,editChildReadiness:ht,editChildSkills:bt,editChildPivotStrategicWeight:Ot,editChildPivotPriority:wt,editChildPivotRequiredLevel:Rt,editChildPivotIsCritical:He,editChildPivotRationale:xt,newSkillName:kt,newSkillCategory:Tt,newSkillDescription:ma,skillCreationError:We,skillCreationSuccess:ea,selectedSkillForDeletion:ya,selectedSkillId:tt,skillEditName:ta,skillEditDescription:Ha,skillEditCategory:Lt,skillEditComplexityLevel:aa,skillEditScopeType:nt,skillEditDomainTag:la,skillEditIsCritical:ia,skillPivotRequiredLevel:_a,skillPivotPriority:Ct,skillPivotWeight:$e,skillPivotRationale:Ft,skillPivotIsRequired:oa,capabilityTreeRaw:Gt,showScenarioRaw:Ut,dragging:Yt,dragOffset:ra,panelDragging:Na,panelDragOffset:St,viewX:at,viewY:Te,viewScale:st,width:Xt,height:Mt,editFormScrollEl:qt,editFormScrollPercent:ze,savedFocusedNodeId:At,availableCapabilities:_t,availableExistingCompetencies:Ea,availableSkills:Va,displayNode:Bt,dialogThemeClass:za,breadcrumbTitle:ja,breadcrumbParts:Ia,nodeSidebarVisible:Pa,viewportStyle:Wa,resetCreateCapForm:Da,resetCompetencyForm:sl,resetSkillForm:Ka,toggleSidebar:$a,toggleNodeSidebarCollapse:cl,toggleSidebarTheme:ul,nextChildEdgeMode:Za,resetViewport:dl}}function Hl(K,re=40,Y=2e3){return Math.max(re,Math.min(Y,K))}function Oi(K,re,Y,T){let q=!1;const O=T?.id;let le=K.slice();O!=null&&le.some(P=>P&&P.id===O)&&(q=!0,le=le.filter(P=>P.id!==O));const F=le.length;if(!F)return K.slice();const b=Math.round(re/2),A=Math.round(Y/2-30),X=Math.max(200,re-48*2);let N=le.map(P=>({...P}));if(F===1)N=N.map(P=>({...P,x:b,y:A}));else if(F===2){const P=Math.min(220,Math.floor(X/3));N=N.map((E,_)=>({...E,x:b+(_===0?-P/2:P/2),y:A}))}else if(F===3){const P=Math.min(220,Math.floor(X/4));N=N.map((E,_)=>_===1?{...E,x:b,y:A}:{...E,x:b+(_===0?-P:P),y:A})}else if(F>=4&&F<=6){const P=F,E=Math.min(160,Math.floor(X/P)),_=(P-1)*E,p=Math.round(b-_/2);N=N.map((v,k)=>({...v,x:p+k*E,y:A}))}else{let P=Math.min(6,Math.max(2,Math.ceil(Math.sqrt(F)))),E=Math.ceil(F/P);F===10&&(P=5,E=2);const _=Math.min(140,Math.floor(X/P)),p=Math.min(140,Math.floor((Y-160)/Math.max(1,E))),v=(P-1)*_,k=(E-1)*p,m=Math.round(b-v/2),u=Math.round(A-k/2+40);N=N.map((M,U)=>{const fe=Math.floor(U/P),ye=U%P;return{...M,x:m+ye*_,y:Hl(u+fe*p)}})}try{if(T){const E=T.x??Math.round(re/2),_=T.y??Math.round(Y*.12);let p=0;if(N.forEach(v=>{if(!v||v.x==null||v.y==null)return;const k=v.x-E,m=v.y-_,h=Math.sqrt(k*k+m*m);if(h<120){const u=120-h;u>p&&(p=u)}}),p>0){const k=Math.round(p+20);N=N.map(m=>!m||m.y==null?m:{...m,y:Hl((m.y??0)+k)})}}}catch{}return q&&T?[...N,{...T}]:N}const Ri={key:0},Ti={key:1},Li=["width","height","viewBox"],Fi=["width","height"],Gi=["width","height"],Ui={class:"edges"},Yi=["x1","y1","x2","y2"],Xi=["transform"],qi={class:"scenario-edges"},Bi=["d"],Hi=["x1","y1","x2","y2"],zi={class:"child-edges"},ji=["d"],Wi=["x1","y1","x2","y2"],Ki={class:"grandchild-edges"},Zi=["d","stroke-opacity"],Ji=["x1","y1","x2","y2","stroke-opacity"],Qi=["data-node-id"],eo=["data-node-id","onPointerdown","onClick","onContextmenu"],to={key:0,class:"node-inner",r:"12",fill:"#ff5050","fill-opacity":"0.95"},ao={x:0,y:38,"text-anchor":"middle",class:"node-label"},lo=["dy"],io={class:"child-nodes"},oo=["data-node-id","onClick","onContextmenu"],ro=["fill","stroke"],no={x:0,y:22,"text-anchor":"middle",class:"node-label",style:{"font-size":"10px"}},so=["dy"],co={class:"skill-nodes"},uo=["data-node-id","onClick"],po={x:0,y:4,"text-anchor":"middle",class:"node-label",style:{"font-size":"10px"}},vo=["transform"],fo=["transform","title"],mo={x:"0",y:"4","text-anchor":"middle","font-size":"10",fill:"#dbeafe",style:{"font-weight":"700"}},yo=["transform"],go=["width"],ho={xmlns:"http://www.w3.org/1999/xhtml",class:"svg-title-fo"},bo={class:"svg-title-text"},wo={class:"d-flex align-center"},xo={class:"d-flex align-center",style:{gap:"8px"}},ko={class:"mb-2 text-xs text-white/60"},Co={class:"text-small text-medium-emphasis mb-2"},So={key:0,style:{position:"relative"}},Mo={style:{"max-height":"360px",overflow:"auto","padding-right":"12px"}},Ao={style:{display:"flex",gap:"8px","grid-column":"1 / -1","margin-top":"8px"}},_o={style:{display:"grid",gap:"12px","grid-template-columns":"1fr 1fr","align-items":"start"}},No={key:1,style:{position:"relative"}},Eo={style:{display:"flex",gap:"8px","margin-bottom":"8px"}},Vo={style:{"max-height":"360px",overflow:"auto","padding-right":"12px"}},Io={style:{display:"grid",gap:"12px","grid-template-columns":"1fr 1fr","align-items":"start"}},Po={key:1},Do={style:{"margin-top":"6px"}},$o={style:{"margin-top":"8px",display:"flex",gap:"8px","align-items":"center"}},Oo={key:0,style:{"margin-top":"12px","max-height":"420px",overflow:"auto",background:"rgba(0, 0, 0, 0.04)",padding:"8px","border-radius":"6px"}},Ro={style:{"white-space":"pre-wrap","word-break":"break-word"}},To={key:0,style:{"margin-top":"8px"}},Lo={key:0},Fo={style:{display:"flex",gap:"8px","grid-column":"1/-1","margin-top":"8px"}},Go={class:"grid",style:{display:"grid",gap:"12px","grid-template-columns":"1fr 1fr"}},Uo={key:0,style:{"margin-top":"14px"}},Yo={class:"grid",style:{display:"grid",gap:"12px","grid-template-columns":"1fr 1fr"}},Xo={key:1},qo={class:"grid",style:{display:"grid",gap:"12px","grid-template-columns":"1fr 1fr"}},Bo={class:"mt-3",style:{"margin-top":"12px"}},Ho={class:"grid",style:{display:"grid",gap:"12px","grid-template-columns":"1fr 1fr"}},zo={class:"text-xs",style:{"margin-top":"6px"}},jo={class:"text-xs",style:{"margin-top":"6px"}},Wo={class:"text-xs",style:{"margin-top":"6px"}},Ko={key:0,class:"cap-list"},Zo=.3,Jo=3,zl=.1,mt=420,Qo=60,er=Ci({__name:"Index",props:{scenario:{},childColumns:{},competencyLayout:{default:()=>({parentOffset:80})},capabilityChildrenOffset:{default:150},scenarioEdgeCurveDepth:{default:90},visualConfig:{default:()=>({nodeRadius:34,focusRadius:34,scenarioOffset:80,scenarioOffsetSwap:150,childDrop:18,skillDrop:18,edge:{baseDepth:40,curveFactor:.35,spreadOffset:18},edgeSkill:{baseDepth:20,curveFactor:.25,spreadOffset:10}})}},emits:["createCapability"],setup(K,{emit:re}){function Y(){const t=S.value;S.value=null,Z.value=[],de.value=[],C.value=null;try{ca()}catch{}if($.value=$.value.map(e=>({...e,visible:!0})),t)try{(Array.isArray(t?.competencies)?t.competencies.length:0)>=4?Ee(t,{x:t.x??0,y:t.y??0},{layout:"matrix"}):Ee(t,{x:t.x??0,y:t.y??0})}catch{Ee(t,{x:t.x??0,y:t.y??0})}Ht.value=0,zt.value=0}const T={1:"1",2:"2",3:"3"},q={1:"1",2:"2",3:"3",4:"4",5:"5",6:"6",7:"7",8:"8",9:"9",10:"10"},O={1:"1",2:"2",3:"3",4:"4",5:"5"},le={1:"1",2:"2",3:"3",4:"4",5:"5"};function F(t){if(!t)return null;const e=typeof t=="number"?t:t.id;if(e==null)return null;const a=Q.value?Q.value.id:null;if(a!=null&&e===a)return 0;let l=e,o=0;for(;l!=null;){const n=de.value.find(d=>d.target===l);if(n){if(l=n.source,o++,o>10)break;continue}if(pa.value.find(d=>d.target===l)){o++;break}$.value.find(d=>d.id===l)&&(o=Math.max(o,1));break}return o}const b=K;$i();const A=Ii(),{runForceLayout:G,expandSkills:X,LAYOUT_CONFIG:N,clampY:P}=Pi(),{injectState:E,childEdgeMode:_}=Di();ol(()=>{try{E(de,ve,$,Z,J)}catch(t){console.warn("[ScenarioPlanning] Error inyectando state en useScenarioEdges",t)}});const p=async t=>{try{const e=typeof t=="string"?parseInt(t,10):t,a=await A.loadCapabilityTree(e);a&&Array.isArray(a)&&(Ua(a),je.value=!0)}catch(e){console.error("[loadTreeFromApi] Error cargando árbol de capacidades",e),H("Error cargando árbol de capacidades")}},v=i(!1);i([]);const k=i(""),m=i(""),h=i(""),u=i(""),M=i(3),U=i("target"),fe=i([]);async function ye(t){try{if(!t){fe.value=[];return}const e=typeof t=="string"?parseInt(t,10):t,a=await L.get(`/api/scenarios/${e}/step2/data`),l=a?.data??a,o=Array.isArray(l?.roles)?l.roles:[];fe.value=o.map(n=>n.role_name??n.name??String(n.role_id??n.id??""))}catch(e){console.debug("[loadStep2RolesFromApi] failed to fetch step2 roles",e),fe.value=[]}}function ge(t){if(!Array.isArray(t))return[];const e=[];for(const a of t){if(!a&&a!==0)continue;let l=null;if(typeof a=="string"?l=a:typeof a=="number"?l=String(a):a?.role_name?l=a.role_name:a?.name?l=a.name:a?.label?l=a.label:a?.id&&(l=String(a.id)),l!=null){const o=String(l).trim();o&&!e.includes(o)&&e.push(o)}}return e}const xe=Le(()=>{const t=b.scenario,e=ge(t?.strategic_roles??t?.roles??t?.available_roles??[]),a=ge(fe.value??[]),l=[];for(const n of e)l.includes(n)||l.push(n);for(const n of a)l.includes(n)||l.push(n);const o=["target","watch","sunset"];for(const n of o)l.includes(n)||l.push(n);return l});ft(()=>b.scenario?.id,t=>{if(t)try{const e=b.scenario,a=e?.strategic_roles??e?.roles??e?.available_roles??null;(!Array.isArray(a)||a.length===0)&&ye(t)}catch{}});const oe=i(10),me=i(1),Fe=i(""),Ne=i(3),Ie=i(!1),Qe=i(!1),L=Sl();async function Se(){try{const t=document.cookie.includes("XSRF-TOKEN=");if(console.debug("[ensureCsrf] has XSRF-TOKEN cookie?",t),!t)try{const e=L?.api?.get??L?.get;typeof e=="function"&&await e("/sanctum/csrf-cookie"),console.debug("[ensureCsrf] fetched /sanctum/csrf-cookie")}catch(e){console.warn("[ensureCsrf] failed to fetch csrf-cookie",e)}}catch{}}const je=i(!1),$=i([]),Re=i([]),Xe=i(null),Pt=i({x:0,y:0}),qe=i(!1),{showSuccess:be,showError:H}=jl(),ie=i(900),ue=i(600),yt=i(null);let Dt=[];const S=i(null),ua=i(0),da=i(0),Z=i([]),de=i([]),pa=i([]),J=i([]),ve=i([]),Be=i(!1),Ma=i(!1),C=i(null),Ba=i(!1),Aa=Vi({nodes:$,focusedNode:S,childNodes:Z,selectedChild:C,grandChildNodes:J},{wrapLabel:tl,debug:!1});Le(()=>{const t=[];try{const e=b.scenario?.name||"—";if(t.push(`Escenario: ${e}`),S.value){const a=S.value?.name||"—";t.push(`Capacidad: ${a}`)}if(C.value){const a=C.value,l=a?.name||a?.raw?.name||a?.compName||"—";t.push(`Competencia: ${l}`)}}catch{return`Escenario: ${b.scenario?.name||"—"}`}return t.join("  ›  ")});const nl=Le(()=>{const t=[];try{const e=b.scenario?.name||"—";if(t.push(`Escenario: ${e}`),S.value){const a=S.value?.name||"—";t.push(`Capacidad: ${a}`)}if(C.value){const a=C.value,l=a?.name||a?.raw?.name||a?.compName||"—";t.push(`Competencia: ${l}`)}}catch{return[`Escenario: ${b.scenario?.name||"—"}`]}return t}),gt=i(null),va=i(!1),ot=i(""),rt=i(""),et=i(void 0),fa=i(null),Pe=i(""),De=i("");i(null);const $t=i("target"),ht=i(10),bt=i(1),Ot=i(""),wt=i(3),Rt=i(!1),He=i(!1),xt=i(!1),kt=i(!1),Tt=i(!1),ma=i([]),We=i(""),ea=i(""),ya=i(void 0),tt=i(""),ta=i(null);function Ha(){We.value="",ea.value="",ya.value=void 0,tt.value=""}const Lt=i(!1),aa=i(!1),nt=i([]),la=i(null),ia=i(null),_a=i(null),Ct=i(!1),$e=i(null),Ft=i(""),oa=i(""),Gt=i("technical"),Ut=i("tactical"),Yt=i("domain"),ra=i(""),Na=i(!1),St=i(void 0),at=i(void 0),Te=i(void 0),st=i(""),Xt=i(!1),Mt=i(!1),qt=i(null),ze=i(""),At=i(""),_t=i(""),Ea=i(!1),Va=i(!1),Bt=i(!1),za=i(0),ja=i(0),Ia=i(null),Pa=i(!1),Wa=i(null),Da=["offset","gap-large","curve","spread"];function sl(){_.value=(_.value+1)%Da.length}function Ka(t,e){try{e.preventDefault(),e.stopPropagation()}catch{}const a=yt.value?yt.value.getBoundingClientRect():{left:0,top:0,width:ie.value,height:ue.value},l=260,o=e.clientX-a.left,n=e.clientY-a.top,r=Math.max(8,Math.min(o,(a.width??ie.value)-l-8)),c=Math.max(8,Math.min(n,(a.height??ue.value)-24));za.value=Math.round(r),ja.value=Math.round(c),Ia.value=t,Pa.value=!!(t&&t.id!=null&&t.id<0),Bt.value=!0}function $a(){Bt.value=!1,Ia.value=null}function cl(){const t=Ia.value;if(!t)return $a();if(Pa.value){C.value=t;const e=de.value.find(l=>l.target===t.id),a=e?we(e.source):null;a&&(S.value=we(a.id)||a)}else S.value=we(t.id)||t,C.value=null;Oe(async()=>{try{if(el(),Pa.value&&C.value){const e=C.value?.compId??C.value?.raw?.id??Math.abs(C.value?.id||0);if(e){const a=await yl(Number(e));try{C.value.skills=Array.isArray(a)?a:[]}catch(l){}}}}catch{}Be.value=!0,$a()})}ol(async()=>{const t=e=>{if(Bt.value){try{const a=Wa.value;if(a&&e.target&&e.target instanceof Node&&a.contains(e.target))return}catch{}Bt.value&&$a()}};document.addEventListener("pointerdown",t),hl(()=>document.removeEventListener("pointerdown",t))});async function ul(){try{const t=await L.get("/api/skills");nt.value=Array.isArray(t)?t:t?.data??[]}catch{nt.value=[]}}const{createAndAttachSkill:Za}=Ei();async function dl(){if(xt.value){if(!ze.value||!ze.value.trim())return H("El nombre es obligatorio");const t=String(tt.value||"").split(",").map(e=>e.trim()).filter(Boolean);t.push(ze.value.trim()),tt.value=t.join(", "),Lt.value=!1,ze.value="",At.value="",_t.value="",be("Skill añadida (se guardará junto con la competencia)");return}if(!C.value)return H("Seleccione una competencia");if(!ze.value||!ze.value.trim())return H("El nombre es obligatorio");Ea.value=!0;try{const t={name:ze.value.trim()};t.category=At.value&&String(At.value).trim()!==""?At.value:"technical",_t.value&&String(_t.value).trim()!==""&&(t.description=_t.value);const e=C.value.compId??C.value.raw?.id??Math.abs(C.value.id||0);if(!e)throw new Error("No competency target available");const a=await Za(e,t);if(a&&(Array.isArray(C.value.skills)||(C.value.skills=[]),C.value.skills.push(a)),C.value){const o=C.value.id,n=La(o),r=Me(o)??C.value,c=r&&n?{x:r.x,y:n.y}:r??n,d=X(C.value,J.value,ve.value,c,{layout:"auto"},ue.value);J.value=d.grandChildNodes,ve.value=d.grandChildEdges,Oe(()=>{J.value=J.value.map(g=>({...g,x:g.animTargetX??g.x,y:g.animTargetY??g.y,animScale:1,animOpacity:1,animFilter:"none"}))})}ia.value=`Skill "${ze.value}" creada y asociada correctamente`,ze.value="",At.value="",_t.value="",await Oe();const l=document.querySelector("[data-skill-form]");l&&l.scrollIntoView({behavior:"smooth",block:"start"})}catch(t){console.error("createAndAttachSkill error",t);let e="Error creando y asociando skill";t?.response?.data?.message?e=t.response.data.message:t?.message?e=t.message:typeof t=="string"&&(e=t),la.value=e}finally{Ea.value=!1}}async function lt(){if(!C.value)return H("Seleccione una competencia");if(!qt.value)return H("Seleccione una skill");Va.value=!0;try{const t=C.value.compId??C.value.raw?.id??Math.abs(C.value.id||0);try{await L.post(`/api/competencies/${t}/skills`,{skill_id:qt.value})}catch{const a=nt.value.find(l=>l.id===qt.value);a&&(Array.isArray(C.value.skills)||(C.value.skills=[]),C.value.skills.push(a))}if(C.value){const e=C.value.id,a=La(e),l=Me(e)??C.value,o=l&&a?{x:l.x,y:a.y}:l??a,n=X(C.value,J.value,ve.value,o,{layout:"auto"},ue.value);J.value=n.grandChildNodes,ve.value=n.grandChildEdges,Oe(()=>{J.value=J.value.map(r=>({...r,x:r.animTargetX??r.x,y:r.animTargetY??r.y,animScale:1,animOpacity:1,animFilter:"none"}))})}aa.value=!1,qt.value=null,be("Skill asociada")}catch{H("Error asociando skill")}finally{Va.value=!1}}async function na(t){const e=t??$e.value;if(!e)return H("No hay skill seleccionada");if(!C.value)return H("Seleccione una competencia");if(!S.value)return H("Seleccione una capacidad");Ma.value=!0;const a=C.value.raw?.id??C.value.compId??C.value.id,l=S.value?.id,o=e?.id??e?.raw?.id??null;console.debug("[removeSkillFromCompetency]",{realCompetencyId:a,capabilityId:l,skillId:o,skillToDelete:e}),Mt.value=!0;try{let n=!1;if(a&&o){console.debug("[removeSkillFromCompetency] Attempting DELETE:",{endpoint:`/api/competencies/${a}/skills/${o}`,realCompetencyId:a,skillId:o});try{const r=await L.delete(`/api/competencies/${a}/skills/${o}`);n=!0,console.debug("[removeSkillFromCompetency] SUCCESS: Deleted via backend",r)}catch(r){console.debug("[removeSkillFromCompetency] FAILED: backend delete:",r)}}await Aa.remove("skill",o,a),Array.isArray(nt.value)&&(nt.value=nt.value.filter(r=>r.id!==o),console.debug("[removeSkillFromCompetency] availableSkills filtered")),Ct.value=!1,$e.value=null,be("Skill eliminada correctamente")}catch(n){console.error("removeSkillFromCompetency error",n),H("Error eliminando skill")}finally{Mt.value=!1,Ma.value=!1}}const Ae=i(""),it=i(""),ga=i(null),Ml=i(""),ha=i(10),ba=i(1),wa=i(3),xa=i(!1),Oa=i(""),Ja=i(!1),Ra=i(null),Kl=i(0);let Ta=null;function Al(t,e=!0){try{const a=de.value.find(n=>n.target===t),l=a?a.source:null,o=Q.value?.id??null;$.value=$.value.map(n=>n.id===l?{...n,visible:!0}:e&&n.id===o?{...n,visible:!0}:{...n,visible:!1}),Z.value=Z.value.map(n=>n.id===t?{...n,visible:!0}:n.__parentId===l||n.parentId===l?{...n,visible:!1}:{...n,visible:!1})}catch{}}function Zl(){const t=Ra.value;if(!t)return;const e=Math.max(0,t.scrollHeight-t.clientHeight),a=e===0?0:Math.round(t.scrollTop/e*100);Kl.value=a}const ka={collapsed:"stratos:scenario:nodeSidebarCollapsed",lastView:"stratos:scenario:lastView",lastFocusedId:"stratos:scenario:lastFocusedNodeId"},pl=i(null),Ht=i(0),zt=i(0),Ca=i(1),Qa=i(!1),_l=i(0),Nl=i(0),El=i(0),Vl=i(0),Jl=Le(()=>({transform:`translate(${Ht.value}px, ${zt.value}px) scale(${Ca.value})`,transformOrigin:"0 0"}));function Ql(t){if(!t.ctrlKey)return;t.preventDefault();const a=t.currentTarget.getBoundingClientRect(),l=t.clientX-a.left,o=t.clientY-a.top,n=(l-Ht.value)/Ca.value,r=(o-zt.value)/Ca.value,c=t.deltaY>0?-zl:zl,d=Math.max(Zo,Math.min(Jo,Ca.value+c));Ht.value=l-n*d,zt.value=o-r*d,Ca.value=d}function ei(t){t.button!==0||t.target.closest(".node-group, button, input, [data-interactive]")||(Qa.value=!0,_l.value=t.clientX,Nl.value=t.clientY,El.value=Ht.value,Vl.value=zt.value,t.currentTarget.style.cursor="grabbing")}function ti(t){if(!Qa.value)return;const e=t.clientX-_l.value,a=t.clientY-Nl.value;Ht.value=El.value+e,zt.value=Vl.value+a}function Il(t){Qa.value&&(Qa.value=!1,t.currentTarget.style.cursor="default")}const ke=Le(()=>C.value??S.value),Q=i(null),vl=i(!1);function jt(t){return new Promise(e=>setTimeout(e,t))}function Wt(t,e=mt*2+Qo){return new Promise(a=>{const l=`[data-node-id="${t}"]`;let o=document.querySelector(l),n=null;const r=()=>{o&&o.removeEventListener("transitionend",c),n&&clearTimeout(n)},c=d=>{const g=d;(!g.propertyName||g.propertyName==="transform")&&(r(),a(!0))};n=setTimeout(()=>{r(),a(!1)},e),o?o.addEventListener("transitionend",c):Oe().then(()=>{if(o=document.querySelector(l),!o){n&&clearTimeout(n),a(!1);return}o.addEventListener("transitionend",c)})})}function La(t){try{if(!yt.value)return;const e=`[data-node-id="${t}"]`,a=document.querySelector(e);if(!a)return;const l=yt.value.getBoundingClientRect(),o=a.getBoundingClientRect(),n=o.left+o.width/2-l.left,r=o.top+o.height/2-l.top,c=Ca.value||1,d=Math.round((n-(Ht.value||0))/c),g=Math.round((r-(zt.value||0))/c);return{x:d,y:g}}catch{}}const ct=i(new Map);function Fa(t,e){if(!t)return;if(e&&e.id!==t.id&&(Z.value=[],de.value=[]),ct.value.size===0&&($.value.forEach(I=>{ct.value.set(I.id,{x:I.x??0,y:I.y??0})}),Q.value&&ct.value.set(Q.value.id,{x:Q.value.x,y:Q.value.y})),e&&e.id!==t.id){const I=$.value.find(se=>se.id===e.id),ee=$.value.find(se=>se.id===t.id);if(I&&ee){const se=I.x??0,pe=I.y??0;if(I.x=ee.x??se,I.y=ee.y??pe,ee.x=se,ee.y=pe,$.value=$.value.map(Ce=>Ce&&(Ce.id===ee.id?{...ee}:Ce.id===I.id?{...I}:Ce)),vl.value&&Q.value){const Ce=Math.round(ie.value/2),ce=Math.round(ue.value*.45),Ge=b.visualConfig?.scenarioOffsetSwap??150;Q.value.x=Ce,Q.value.y=Math.round(ce-Ge)}return}}const a=Math.round(ie.value/2),o=Math.round(ue.value*.25),n=Math.round(ie.value*.18),r=Math.round(ie.value*.82),d=$.value.filter(I=>I&&I.id!==t.id).map(I=>({n:I,origX:I.x??ct.value.get(I.id)?.x??ie.value/2})).sort((I,ee)=>I.origX-ee.origX).map(I=>I.n),g=Math.ceil(d.length/2),f=d.slice(0,g),w=d.slice(g),R=I=>I.y??ct.value.get(I.id)?.y??o;f.sort((I,ee)=>R(I)-R(ee)),w.sort((I,ee)=>R(I)-R(ee));const V=64,B=Math.max(120,ue.value-64),ne=(I,ee,se)=>{if(I.length===0)return;const pe=I.length,Ce=Math.max(0,B-V),s=34,ce=Math.max(48,s*2+8),Kt=pe>1?Math.min(140,Math.max(ce,Math.floor(Ce/(pe-1)))):0,j=Math.round(s+12),Ke=Math.max(V,o-j),dt=Math.min(B,o+j),Nt=5;if(pe<=Nt){let Ve=Math.round(o-(pe-1)*Kt/2);const Jt=Ve+(pe-1)*Kt;if(!(Jt<Ke||Ve>dt)){const Ze=Ke-V,vt=B-dt;if(Ze>=vt){const Vt=Math.min(Ze,dt-Ve+j);Ve=Math.max(V,Ve-Vt)}else{const Vt=Math.min(vt,Jt-Ke+j);Ve=Math.min(B-(pe-1)*Kt,Ve+Vt)}}for(let Ze=0;Ze<pe;Ze++){const vt=I[Ze],Vt=Ve+Ze*Kt;vt.x=ee,vt.y=P(Vt)}return}const Zt=Math.ceil(pe/Nt),Et=Math.ceil(pe/Zt),ll=56;for(let Ve=0;Ve<Zt;Ve++){const Jt=I.slice(Ve*Et,Ve*Et+Et),pt=Jt.length,Ze=pt>1?Math.min(Kt,Math.floor(Ce/(pt-1))):0,vt=Math.round(o-(pt-1)*Ze/2),Vt=Ve-(Zt-1)/2,gl=Math.round(Vt*ll)*(se==="left"?-1:1),xi=ee+gl;for(let il=0;il<pt;il++){const ql=Jt[il],ki=vt+il*Ze;ql.x=Math.min(Math.max(32,xi),Math.max(48,ie.value-32)),ql.y=P(ki)}}};if(ne(f,n,"left"),ne(w,r,"right"),$.value=$.value.map(I=>{if(!I)return I;if(I.id===t.id)return{...I,x:a,y:o};const ee=f.find(se=>se.id===I.id)||w.find(se=>se.id===I.id);return ee?{...I,x:ee.x,y:ee.y}:{...I,x:Math.min(Math.max(48,I.x??a),Math.max(160,ie.value-48)),y:P(I.y??o)}}),vl.value&&Q.value){const I=b.visualConfig?.scenarioOffset??80;Q.value.x=a,Q.value.y=Math.round(o-I)}}function fl(){Q.value={id:0,name:b.scenario&&(b.scenario.name||"Escenario"),x:Math.round(ie.value/2),y:Math.round(ue.value*.1)}}async function ai(){try{await Ga()}catch{}try{Y()}catch{}}ft(S,t=>{try{if(t&&window.__DEBUG__){const a=t.id!=null&&t.id<0?de.value.find(l=>l.target===t.id)?.source??null:null;console.debug("[focusedNode.change] id=",t.id,"level=",F(t.id),"isChild=",!!(t.skills||t.compId),"parentId=",a)}}catch{}if(!t){ot.value="",rt.value="",et.value=void 0,fa.value=null,$t.value="target",ht.value=10,bt.value=1,Ot.value="",wt.value=3,Rt.value=!1;return}ot.value=t.name??"",rt.value=t.description??t.raw?.description??"",et.value=t.importance??t.raw?.importance??void 0,fa.value=t.level??null;const e=a=>t[a]??t.raw?.[a]??t.raw?.attributes?.[a]??t.raw?.capability?.[a]??t.raw?.data?.[a]??t.raw?.entity?.[a]??"";try{const a=e("type");Pe.value=typeof a=="string"?a.toLowerCase():a!=null?String(a).toLowerCase():""}catch{Pe.value=""}try{const a=e("category");De.value=typeof a=="string"?a.toLowerCase():a!=null?String(a).toLowerCase():""}catch{De.value=""}$t.value=t.strategic_role??t.raw?.strategic_role??"target",ht.value=t.raw?.strategic_weight??10,bt.value=t.raw?.priority??1,Ot.value=t.raw?.rationale??"",wt.value=t.raw?.required_level??t.required??3,Rt.value=!!(t.raw?.is_critical||t.is_critical);try{const a=C.value;if(!t)ca(),C.value=null;else if(a){const l=de.value.find(n=>n.target===a.id);(l?l.source:null)!==t.id&&(ca(),C.value=null)}}catch{}}),ft(C,t=>{if(!t){try{ca()}catch{}Ae.value="",it.value="",ga.value=null,Ml.value="",ha.value=10,ba.value=1,wa.value=3,xa.value=!1,Oa.value="";return}if(!Ma.value)try{S.value&&Ee(S.value,{x:S.value.x??0,y:S.value.y??0},{layout:"auto"})}catch{}Ae.value=t.name??t.raw?.name??"",it.value=t.description??t.raw?.description??"",ga.value=t.readiness??t.raw?.readiness??null;const e=Array.isArray(t.skills)?t.skills.map(l=>l.name??l):[];Ml.value=e.join(", ");const a=t.raw?.pivot??t.raw?.capability_pivot??{};ha.value=a?.strategic_weight??10,ba.value=a?.priority??1,wa.value=a?.required_level??3,xa.value=!!a?.is_critical,Oa.value=a?.rationale??""}),ft(xt,t=>{t||Ha()});function el(){if(S.value){const t=S.value,e=o=>t[o]??t.raw?.[o]??t.raw?.attributes?.[o]??t.raw?.capability?.[o]??t.raw?.data?.[o]??t.raw?.entity?.[o]??"";ot.value=t.name??"",rt.value=t.description??t.raw?.description??"",et.value=t.importance??t.raw?.importance??void 0,fa.value=t.level??null;try{const o=e("type");Pe.value=typeof o=="string"?o.toLowerCase():o!=null?String(o).toLowerCase():""}catch{Pe.value=""}try{const o=e("category");De.value=typeof o=="string"?o.toLowerCase():o!=null?String(o).toLowerCase():""}catch{De.value=""}try{const o=t.raw??{};let n=[];try{n=Object.keys(o)}catch{n=[]}console.debug("[resetFocusedEdits] resolved type=",Pe.value,"category=",De.value),console.debug("[resetFocusedEdits] raw keys=",n);try{console.debug("[resetFocusedEdits] raw.capability=",o?.capability)}catch(r){}try{console.debug("[resetFocusedEdits] raw.scenario_capabilities=",o?.scenario_capabilities)}catch(r){}try{console.debug("[resetFocusedEdits] raw.pivot=",o?.pivot)}catch(r){}try{console.debug("[resetFocusedEdits] capabilityTreeRaw sample=",gt?.value?Array.isArray(gt.value)?gt.value.find(r=>r.id==t.id):gt.value:null)}catch(r){}}catch{}$t.value=t.strategic_role??t.raw?.strategic_role??"target";const a=t.raw??{};let l=a.pivot??a.scenario_capabilities??a.scenario_capability??a._pivot??null;Array.isArray(l)&&(l=l[0]??null),ht.value=t.strategic_weight??l?.strategic_weight??a.strategic_weight??10,bt.value=t.priority??l?.priority??a.priority??1,Ot.value=t.rationale??l?.rationale??a.rationale??"",wt.value=t.required_level??l?.required_level??a.required_level??t.required??3,Rt.value=!!(t.is_critical??l?.is_critical??a.is_critical??t.is_critical)}}async function li(){if(!S.value)return;const t=S.value.id;He.value=!0,await Se();try{const e={name:ot.value,description:rt.value,importance:typeof et.value<"u"?Number(et.value):void 0,position_x:S.value.x??void 0,position_y:S.value.y??void 0,type:Pe.value||void 0,category:De.value||void 0};try{console.debug("[saveFocusedNode] PATCH /api/capabilities/"+t,e);const n=await L.patch(`/api/capabilities/${t}`,e);console.debug("[saveFocusedNode] PATCH /api/capabilities response",n),be("Capacidad actualizada");try{const r=S.value;r&&(r.type=Pe.value||r.type,r.category=De.value||r.category,r.raw={...r.raw||{},...n?.data??{}})}catch(r){}}catch(n){try{const r=n,c=r?.response?.status??null;console.error("[saveFocusedNode] error PATCH /api/capabilities/"+t,r?.response?.data??r),c!==404&&H(r?.response?.data?.message||"Error actualizando capacidad")}catch(r){}}const a={strategic_role:$t.value,strategic_weight:typeof ht.value<"u"?Number(ht.value):void 0,priority:typeof bt.value<"u"?Number(bt.value):void 0,rationale:Ot.value,required_level:typeof wt.value<"u"?Number(wt.value):void 0,is_critical:!!Rt.value};try{if(!b.scenario||!b.scenario.id)console.warn("[saveFocusedNode] no scenario context available; skipping pivot update");else{console.debug("[saveFocusedNode] PATCH pivot",{scenarioId:b.scenario?.id,id:t,pivotPayload:a});let n=null;try{n=await L.patch(`/api/strategic-planning/scenarios/${b.scenario?.id}/capabilities/${t}`,a),be("Relación escenario–capacidad actualizada")}catch(r){console.error("[saveFocusedNode] error PATCH pivot",r?.response?.data??r);try{n=await L.post(`/api/strategic-planning/scenarios/${b.scenario?.id}/capabilities`,{name:ot.value,description:rt.value||"",importance:et.value??3,type:Pe.value??null,category:De.value??null,strategic_role:a.strategic_role,strategic_weight:a.strategic_weight,priority:a.priority,rationale:a.rationale,required_level:a.required_level,is_critical:a.is_critical}),be("Relación actualizada (fallback)")}catch(c){console.error("[saveFocusedNode] error POST pivot fallback",c?.response?.data??c),H("No se pudo actualizar la relación. Verifica el backend.")}}try{const r=(n?.data?.updated??n?.data??n)||null;if(r&&typeof r=="object"){const d=(r.updated??r)||r;if($.value=$.value.map(g=>{if(g.id===t){const f={...g.raw??{},scenario_capabilities:Array.isArray(g.raw?.scenario_capabilities)?g.raw.scenario_capabilities:[g.raw.scenario_capabilities].filter(Boolean)};return f.scenario_capabilities=f.scenario_capabilities||[],f.scenario_capabilities.length===0&&f.scenario_capabilities.push({}),f.scenario_capabilities[0]={...f.scenario_capabilities[0]||{},...d||{}},{...g,raw:f}}return g}),S.value&&S.value.id===t){const g={...S.value.raw??{}};g.scenario_capabilities=g.scenario_capabilities||[],g.scenario_capabilities.length===0&&g.scenario_capabilities.push({}),g.scenario_capabilities[0]={...g.scenario_capabilities[0]||{},...d||{}},S.value={...S.value,raw:g}}}}catch(r){}}}catch(n){console.error("[saveFocusedNode] unexpected error in pivot update flow",n)}try{const n=S.value?.id??t;$.value=$.value.map(r=>{if(r.id===n){const c={...r.raw??{},type:Pe.value??r.raw?.type??null,category:De.value??r.raw?.category??null};return{...r,type:Pe.value??r.type,category:De.value??r.category,raw:c}}return r}),S.value&&S.value.id===t&&(S.value={...S.value,type:Pe.value??S.value.type,category:De.value??S.value.category,raw:{...S.value.raw??{},type:Pe.value??S.value.raw?.type,category:De.value??S.value.raw?.category}})}catch(n){}let l=null;try{const n=await L.get(`/api/capabilities/${t}`);l=n?.data??n}catch(n){}const o=S.value?S.value.id:null;await p(b.scenario?.id);try{if(l&&typeof l.id<"u"&&($.value=$.value.map(n=>n.id===Number(l.id)?{...n,type:l.type??n.type,category:l.category??n.category,raw:{...n.raw??{},...l??{}}}:n),S.value&&S.value.id===Number(l.id))){S.value={...S.value||{},type:l.type??S.value.type,category:l.category??S.value.category,raw:{...S.value.raw??{},...l??{}}};try{el()}catch(n){}}}catch(n){}try{console.debug("[saveFocusedNode] after refresh, focusedId=",o,"nodeById=",we(o))}catch(n){}if(o!=null){const n=we(o);if(n){S.value=n;try{el()}catch(r){}await Oe(),Fa(n)}}}finally{He.value=!1}}async function Pl(){if(!S.value&&!C.value)return;const t=C.value||S.value;if(!t)return;const e=t.id,a=typeof e=="number"&&e<0;console.debug("[deleteFocusedNode] selectedChild:",C.value?"YES":"NO","id:",e,"isChild:",a);let l=null;a&&(l=t.compId??Math.abs(e));const o=a||C.value!==null,n=o?"competencia":"capacidad",r=o?"¿Eliminar esta competencia? Esta acción es irreversible.":"¿Eliminar esta capacidad y su relación con el escenario? Esta acción es irreversible.";if(console.debug("[deleteFocusedNode] isCompetency:",o,"nodeName:",n,"compId:",l),!!window.confirm(r)){He.value=!0;try{if(o){const d=l||Math.abs(e);console.debug("[deleteFocusedNode] Deleting competency with ID:",d);const g=de.value.find(w=>w.target===e),f=g?g.source:S.value?.id;if(console.debug("[deleteFocusedNode] Parent capability ID:",f),!f){H("No se puede determinar la capacidad padre"),He.value=!1;return}try{const w=await L.delete(`/api/strategic-planning/scenarios/${b.scenario?.id}/capabilities/${f}/competencies/${d}`);console.debug("[deleteFocusedNode] DELETE competency response:",w)}catch(w){const R=w;if(console.debug("[deleteFocusedNode] DELETE competency error status:",R?.response?.status),R?.response?.status!==404)throw w}Z.value=Z.value.filter(w=>(w.compId??Math.abs(w.id))!==d),de.value=de.value.filter(w=>w.target!==e&&w.source!==e),J.value=J.value.filter(w=>w.parentId!==d&&w.parentId!==e),ve.value=ve.value.filter(w=>w.source!==e&&w.target!==e),console.debug("[deleteFocusedNode] Competency deleted locally"),be("Competencia eliminada")}else{console.debug("[deleteFocusedNode] Deleting capability with ID:",e);let d=null,g=null;try{await L.delete(`/api/strategic-planning/scenarios/${b.scenario?.id}/capabilities/${e}`)}catch(f){d=f?.response?.status??null}try{await L.delete(`/api/capabilities/${e}`),$.value=$.value.filter(f=>f.id!==e),Z.value=Z.value.filter(f=>!(f.__parentId===e||f.parentId===e||f.raw&&f.raw.capability_id===e)),Re.value=Re.value.filter(f=>f.source!==e&&f.target!==e),de.value=de.value.filter(f=>f.source!==e&&f.target!==e)}catch(f){g=f?.response?.status??null}(d===404||d===null)&&(g===404||g===null)?($.value=$.value.filter(f=>f.id!==e),Z.value=Z.value.filter(f=>!(f.__parentId===e||f.parentId===e||f.raw&&f.raw.capability_id===e)),Re.value=Re.value.filter(f=>f.source!==e&&f.target!==e),de.value=de.value.filter(f=>f.source!==e&&f.target!==e),H("Eliminado localmente. El backend no expone endpoints DELETE; implementar API para eliminación permanente.")):be("Capacidad y relación eliminadas")}await p(b.scenario?.id),S.value=null,C.value=null}catch(d){console.error("[deleteFocusedNode] Error:",d),H(`Error al eliminar ${n}`)}finally{He.value=!1}}}function ii(){k.value="",m.value="",h.value="",u.value="",M.value=3,U.value="target",oe.value=10,me.value=1,Fe.value="",Ne.value=3,Ie.value=!1,Be.value=!1,v.value=!0}function oi(){try{const t=ke.value;if(t&&(t.compId||typeof t.id=="number"&&t.id<0)){const e=de.value.find(l=>l.target===t.id),a=e?we(e.source):null;a&&(S.value=a)}else if(t&&t.id!=null)S.value=we(t.id)||t;else if(C.value){const e=C.value?.id??null,a=e!=null?de.value.find(o=>o.target===e):null,l=a?we(a.source):null;l&&(S.value=l)}}catch{}C.value=null,xt.value=!0}function ri(){try{const t=ke.value;if(t&&(t.compId||typeof t.id=="number"&&t.id<0))C.value=t;else if(t&&Array.isArray(t.competencies)&&t.competencies.length>0){const e=t.competencies[0],a=Z.value.find(l=>l.compId===e.id);C.value=a||{compId:e.id,raw:e,id:-(t.id*1e3+1)}}else if(t&&t.skillId){const e=ve.value?.find(a=>a.target===t.id);if(e){const a=Z.value.find(l=>l.id===e.source);a?C.value=a:console.warn("[showCreateSkillDialog] parent competency not found in childNodes")}}else if(C.value){const e=C.value;if(e.skillId){const a=ve.value?.find(l=>l.target===e.id);if(a){const l=Z.value.find(o=>o.id===a.source);l&&(C.value=l)}}}C.value&&C.value.skillId&&(console.warn("[showCreateSkillDialog] selectedChild is a skill, not a competency. Clearing."),C.value=null)}catch(t){console.error("[showCreateSkillDialog] error setting context:",t)}Lt.value=!0}async function ni(){await ul(),aa.value=!0}async function si(){await mi(),kt.value=!0}async function ci(){if(!b.scenario||!b.scenario.id)return H("Escenario no seleccionado");if(!k.value||!k.value.trim())return H("El nombre es obligatorio");Qe.value=!0,await Se();try{const t={name:k.value.trim(),description:m.value||null,importance:typeof M.value<"u"?Number(M.value):3,type:h.value||null,category:u.value||null,strategic_role:U.value,strategic_weight:typeof oe.value<"u"?Number(oe.value):10,priority:typeof me.value<"u"?Number(me.value):1,rationale:Fe.value||null,required_level:typeof Ne.value<"u"?Number(Ne.value):3,is_critical:!!Ie.value};console.debug("[saveNewCapability] POST /api/strategic-planning/scenarios/"+b.scenario.id+"/capabilities",t);const e=await L.post(`/api/strategic-planning/scenarios/${b.scenario.id}/capabilities`,t);console.debug("[saveNewCapability] POST response",e);const a=e?.data??e;be("Capacidad creada y asociada al escenario");try{if(a&&typeof a.id<"u"){const l=Dl($.value.length,($.value.length||0)+1),o={id:Number(a.id),name:a.name,displayName:tl(a.name,14),x:Math.round(l.x),y:Math.round(l.y),is_critical:!!a.is_critical,description:a.description??null,competencies:[],importance:a.importance??3,level:null,required:null,raw:a};$.value=[...$.value,o],Ya(b.scenario.capabilities||[]),qe.value=!0}}catch(l){}await p(b.scenario.id),v.value=!1,k.value="",m.value="",h.value="",u.value="",M.value=3,U.value="target",oe.value=10,me.value=1,Fe.value="",Ne.value=3,Ie.value=!1}catch(t){H(t?.response?.data?.message||"Error creando capacidad")}finally{Qe.value=!1}}function tl(t,e=14){if(t==null)return"";const a=String(t).trim();if(a.length<=e)return a;const l=(d,g)=>{if(d.length<=g)return{line:d,rest:""};const w=d.slice(0,g+1).lastIndexOf(" ");if(w>0){const R=d.slice(0,w),V=d.slice(w+1).trim();return{line:R,rest:V}}return{line:d.slice(0,g),rest:d.slice(g).trim()}},o=l(a,e);if(!o.rest)return o.line;const n=o.rest;if(n.length<=e)return o.line+`
`+n;const r=l(n,e);let c=r.line;return r.rest&&c.length>=e?(c=c.slice(0,Math.max(0,e-1)),c=c.replace(/\s+$/,""),c=c+"…"):r.rest&&(c=c+"…"),o.line+`
`+c}function Dl(t,e){const a=ie.value/2,l=ue.value/2-30;if(e<=1)return{x:Math.round(a),y:Math.round(l)};const o=Math.min(5,Math.max(1,Math.ceil(Math.sqrt(e)))),n=Math.max(1,Math.ceil(e/o)),r=24,c=Math.max(120,ie.value-r*2),d=Math.max(120,ue.value-r*2),g=o>1?Math.min(160,Math.floor(c/o)):0,f=n>1?Math.min(140,Math.floor(d/n)):0,w=t%o,R=Math.floor(t/o),V=(o-1)*g,B=(n-1)*f,ne=w*g-V/2,I=R*f-B/2;return{x:Math.round(a+ne),y:Math.round(l+I)}}async function Ga(){if(!$.value.length)return;const e=Q.value?{id:Q.value.id,x:Q.value.x,y:Q.value.y}:void 0;try{console.debug("[reorderNodes] before - count:",$.value.length,"ids:",$.value.map(a=>a&&a.id))}catch{}$.value=Oi($.value.map(a=>({...a,name:a.name??a.raw?.name??""})),ie.value,ue.value,e);try{console.debug("[reorderNodes] after - count:",$.value.length,"ids:",$.value.map(a=>a&&a.id))}catch{}qe.value=!0;try{S.value=null,Z.value=[],de.value=[],Be.value=!1}catch{}try{await Xl(),qe.value=!1}catch{H("No se pudieron guardar las posiciones tras reordenar"),qe.value=!0}}function $l(t){const a=Math.max(160,ie.value-48);if(S.value&&t&&t.id!==S.value.id){const o=S.value.x??ie.value/2,n=t.x??ie.value/2,r=Math.round(ie.value*.18),c=Math.round(ie.value*.82),d=n<o?r:c;return Math.min(Math.max(48,d),a)}const l=t.x??0;return Math.min(Math.max(48,l),a)}function Me(t){if(t==null)return null;if(Q.value&&t===Q.value.id)return{x:Q.value.x,y:Q.value.y};if(t<0){const a=al(t);return a||Xa(t)}const e=we(t);return e?{x:$l(e),y:P(e.y??0)}:null}function Ol(t,e=!0){try{const a=e?t.target:t.source,l=Me(a);if(!l)return{x:void 0,y:void 0};const o=l.x;let n=l.y;if(e&&a<0){const r=!!al(a);n=(n??0)-((r?14:24)+(r?4:6))}return{x:o,y:n}}catch{}return{x:void 0,y:void 0}}function ui(t){try{const e=Me(t.target);if(!e)return 0;const a=de.value.filter(l=>{const o=Me(l.target);return l.source===t.source&&o&&Math.abs((o.x??0)-(e.x??0))<=8});return a.sort((l,o)=>l.target-o.target),Math.max(0,a.findIndex(l=>l===t))}catch{}return 0}function Rl(t){return t.animOpacity??.98}function ut(t){try{const e=Ol(t,!1),a=Ol(t,!0),l=e.x,o=e.y,n=a.x,r=a.y,c=_.value,d=!!al(t.target)||!!al(t.source)||ve.value.includes(t);if(c===2&&typeof l=="number"&&typeof n=="number"){const g=d?N.skill.edge.baseDepth:N.competency.edge.baseDepth,f=d?N.skill.edge.curveFactor:N.competency.edge.curveFactor,w=Math.abs((r??0)-(o??0)),R=Math.max(g,Math.round(w*f)+g),V=Math.min(o??0,r??0)+R;return{isPath:!0,d:`M ${l} ${o} C ${l} ${V} ${n} ${V} ${n} ${r}`}}if(c===3&&typeof l=="number"&&typeof n=="number"){const g=ui(t),f=de.value.concat(ve.value).filter(R=>{const V=Me(R.target),B=Me(t.target);return R.source===t.source&&V&&B&&Math.abs((V.x??0)-(B.x??0))<=8}),w=(g-(f.length-1)/2)*(d?N.skill.edge.spreadOffset:N.competency.edge.spreadOffset);return{isPath:!1,x1:l,y1:o,x2:(n??0)+w,y2:r}}if(c===1&&typeof l=="number"&&typeof n=="number"){const f=(r??0)-((d?14:20)-2);return{isPath:!1,x1:l,y1:o,x2:n,y2:f}}return{isPath:!1,x1:l,y1:o,x2:n,y2:r}}catch{return{isPath:!1,x1:void 0,y1:void 0,x2:void 0,y2:void 0}}}function Tl(t){try{const e=Me(t.source),a=Me(t.target);if(!e||!a||typeof e.x!="number"||typeof a.x!="number")return"";const l=N.capability.scenarioEdgeDepth,o=Math.min(e.y??0,a.y??0)+l;return`M ${e.x} ${e.y} C ${e.x} ${o} ${a.x} ${o} ${a.x} ${a.y}`}catch{}return""}function Ua(t){if(!Array.isArray(t)||t.length===0){$.value=[];return}ie.value/2,ue.value/2-30,Math.min(ie.value,ue.value)/3,2*Math.PI/t.length;const e=t.map((l,o)=>{const n=l.position_x??l.x??l.cx??null,r=l.position_y??l.y??l.cy??null,c=n!=null?parseFloat(String(n)):NaN,d=r!=null?parseFloat(String(r)):NaN,g=!Number.isNaN(c)&&!Number.isNaN(d);let f,w;g&&(c>=0&&c<=100&&d>=0&&d<=100?(f=Math.round(c/100*ie.value),w=Math.round(d/100*ue.value)):(f=Math.round(c),w=Math.round(d)));const R=Dl(o,t.length),V=Math.round(R.x),B=Math.round(R.y);return{id:Number(l.id),name:l.name,x:f??V,y:w??B,_hasCoords:g,is_critical:l.is_critical??l.isCritical??!1,description:l.description??l.desc??null,competencies:Array.isArray(l.competencies)?l.competencies:Array.isArray(l.competency)?l.competency:[],importance:l.importance??l.rank??null,level:l.level??null,required:l.required??null,type:l.type??l.raw?.type??null,category:l.category??l.raw?.category??null,raw:l}});$.value=e.map(l=>({id:l.id,name:l.name,displayName:tl(l.name,14),x:l.x,y:l.y,is_critical:!!l.is_critical,description:l.description,competencies:l.competencies,importance:l.importance,level:l.level,required:l.required,type:l.type,category:l.category,raw:l.raw})),fl();try{if(Q.value){const o=Q.value.x??Math.round(ie.value/2),n=Q.value.y??Math.round(ue.value*.1);$.value=$.value.map(r=>{if(!r||r.x==null||r.y==null)return r;const c=r.x-o,d=r.y-n,g=Math.sqrt(c*c+d*d);if(g<140){if(g===0)return{...r,x:r.x,y:P(n+140)};const f=140/Math.max(1,g),w=Math.round(o+c*f),R=Math.round(n+d*f);return{...r,x:w,y:P(R)}}return r})}}catch{}pa.value=$.value.map(l=>({source:Q.value?.id??0,target:l.id,isScenarioEdge:!0})),Ya(t),e.some(l=>!!l._hasCoords)&&ie.value&&ue.value&&G($.value,Re.value,ie.value,ue.value),Dt=t}function Ya(t){const e=[],a=b.scenario?.connections;Array.isArray(a)&&a.length>0?a.forEach(l=>{const o=l.source??l.source_id??null,n=l.target??l.target_id??null;o!=null&&n!=null&&e.push({source:Number(o),target:Number(n),isCritical:!!l.is_critical})}):t.forEach(l=>{Array.isArray(l.connected_to)&&l.connected_to.forEach(o=>{e.push({source:Number(l.id),target:Number(o)})}),Array.isArray(l.links)&&l.links.forEach(o=>e.push({source:Number(l.id),target:Number(o)})),Array.isArray(l.connections)&&l.connections.forEach(o=>{const n=o.source??o.source_id??null,r=o.target??o.target_id??null;n!=null&&r!=null&&e.push({source:Number(n),target:Number(r),isCritical:!!o.is_critical})})}),Re.value=e}function we(t){return $.value.find(e=>e.id===t)||null}function Xa(t){return Z.value.find(e=>e.id===t)||null}const Ll=async(t,e)=>{try{window.__DEBUG__&&(console.debug("[node.click] id=",t?.id,"level=",F(t?.id),"isTrusted=",!!e?.isTrusted,"time=",Date.now()),console.debug(new Error("click-stack").stack?.split(`
`).slice(1,6).join(`
`)))}catch{}try{const n=F(t?.id);try{if(t?.id!=null&&t.id>=0&&S.value&&S.value.id===t.id&&Z.value.length>0){di();return}if(n===2&&C.value&&C.value.id===t.id&&J.value.length>0){ca();return}}catch(r){}if(n===2){try{window.__DEBUG__&&console.debug("[node.click.level2] id=",t?.id,"level=",n)}catch(r){}try{Ja.value=!0,setTimeout(()=>{Ja.value=!1},Math.max(300,mt))}catch(r){}try{const r=de.value.find(d=>d.target===t.id),c=r?we(r.source):null;if(c){const d=S.value?{...S.value}:void 0;try{ca()}catch(R){}Fa(c,d);const g=Math.max(0,Math.round(mt*.6));await Promise.race([Wt(c.id),jt(g)]);const f=t.id??t.compId??t.raw?.id,w=Z.value.find(R=>R.id===f||R.compId===f||R.raw?.id===f)??t;C.value=w;try{window.__DEBUG__&&console.debug("[expandCompetencies.call] source=handleNodeClick, target=parentNode",{nodeId:c?.id,comps:Array.isArray(c?.competencies)?c.competencies.length:0,opts:{x:c?.x??0,y:c?.y??0},visualConfigLayout:b.visualConfig?.capabilityChildrenOffset,configDefault:N.competency?.defaultLayout})}catch(R){}try{const R=Array.isArray(c?.competencies)?c.competencies.length:0;R>=4?(console.debug&&console.debug("[expandCompetencies.call] source=handleNodeClick (sides)",{nodeId:c?.id,comps:R}),Ee(c,{x:c.x??0,y:c.y??0},{layout:"sides"})):console.debug&&console.debug("[expandCompetencies.call] skipped (<4 competencies)",{nodeId:c?.id,comps:R})}catch{Ee(c,{x:c.x??0,y:c.y??0})}}c?S.value=c:S.value=t;try{const d=C.value?.id??t?.id;d!=null&&Al(d,!0)}catch(d){}try{const d=C.value?.id??S.value.id;if(d!=null&&(Z.value=Z.value.map(f=>f.id===d?{...f,animOpacity:1,animScale:f.animScale??1,visible:!0}:f),Xa(d))){const f=Z.value.filter(w=>w.id!==d);Z.value=f.concat(Z.value.filter(w=>w.id===d))}}catch(d){}try{const d=C.value,g=d.compId??d.raw?.id??Math.abs(d.id||0),f=Z.value.find(V=>V.id===g||V.compId===g||V.raw?.id===g)??d,w={...f,skills:f.skills,raw:{...f.raw??{},skills:f.skills}},R=Array.isArray(w.skills)?w.skills:w.raw?.skills??[];if(R&&R.length>0||g){if(R&&R.length>0)try{if(w&&w.id!=null){const V=w.id;await Wt(V),await jt(10);const B=La(V),ne=Me(V)??{x:w?.x??0,y:w?.y??0},I=ne&&B?{x:ne.x,y:B.y}:ne??B,ee=X(w,J.value,ve.value,I,{layout:"auto"},ue.value);J.value=ee.grandChildNodes,ve.value=ee.grandChildEdges,Oe(()=>{J.value=J.value.map(se=>({...se,x:se.animTargetX??se.x,y:se.animTargetY??se.y,animScale:1,animOpacity:1,animFilter:"none"}))})}else{const V=X(w,J.value,ve.value,{x:w.x??0,y:w.y??0},{layout:"auto"},ue.value);J.value=V.grandChildNodes,ve.value=V.grandChildEdges,Oe(()=>{J.value=J.value.map(B=>({...B,x:B.animTargetX??B.x,y:B.animTargetY??B.y,animScale:1,animOpacity:1,animFilter:"none"}))})}}catch{const B=X(d,J.value,ve.value,{x:d.x??0,y:d.y??0},{layout:"auto"},ue.value);J.value=B.grandChildNodes,ve.value=B.grandChildEdges,Oe(()=>{J.value=J.value.map(ne=>({...ne,x:ne.animTargetX??ne.x,y:ne.animTargetY??ne.y,animScale:1,animOpacity:1,animFilter:"none"}))})}else if(g)try{const V=await yl(Number(g));try{C.value.skills=Array.isArray(V)?V:[]}catch(B){}try{const B=c&&c.id!=null?c.id:null;if(B==null)throw new Error("missing parent id");await Wt(B),await jt(40);const ne=La(B),I=Me(B)??{x:c?.x,y:c?.y};console.debug&&console.debug("[expandSkills.debug] parentId=",B,"domPos=",ne,"renderedPos=",I,"modelPos=",{x:c?.x,y:c?.y});const ee=I&&ne?{x:I.x,y:ne.y}:I??ne,se=X(C.value,J.value,ve.value,ee,{layout:"auto"},ue.value);J.value=se.grandChildNodes,ve.value=se.grandChildEdges,Oe(()=>{J.value=J.value.map(pe=>({...pe,x:pe.animTargetX??pe.x,y:pe.animTargetY??pe.y,animScale:1,animOpacity:1,animFilter:"none"}))})}catch{const ne=C.value.id,I=La(ne),ee=Me(ne)??C.value,se=ee&&I?{x:ee.x,y:I.y}:ee??I,pe=X(C.value,J.value,ve.value,se,{layout:"auto"},ue.value);J.value=pe.grandChildNodes,ve.value=pe.grandChildEdges,Oe(()=>{J.value=J.value.map(Ce=>({...Ce,x:Ce.animTargetX??Ce.x,y:Ce.animTargetY??Ce.y,animScale:1,animOpacity:1,animFilter:"none"}))})}}catch(V){}}}catch(d){}}catch(r){}return}}catch{}try{const n=Date.now();if(window.__lastClick&&window.__lastClick.id===t?.id&&n-window.__lastClick.time<300){window.__DEBUG__&&console.debug("[node.click] ignored duplicate click id=",t?.id);return}window.__lastClick={id:t?.id,time:n}}catch{}const a=S.value?{...S.value}:void 0;let l=null;if(t&&t.id!=null&&t.id<0){const n=de.value.find(c=>c.target===t.id),r=n?we(n.source):null;if(r){try{if(F(t.id)===2){try{Ja.value=!0}catch(V){}const R=r.id;$.value=$.value.map(V=>V.id===R?{...V,visible:!0}:{...V,visible:!1}),setTimeout(()=>{$.value=$.value.map(V=>V.id===R?{...V,visible:!0}:{...V,visible:!1})},Math.max(40,mt-120))}}catch{}const c={x:r.x??0,y:r.y??0};Fa(r,a);const d=Math.max(0,Math.round(mt*.6));await Promise.race([Wt(r.id),jt(d)]);const g=we(r.id)||r;try{window.__DEBUG__&&console.debug("[expandCompetencies.call] source=childClick, target=updatedParent",{nodeId:g?.id,comps:Array.isArray(g?.competencies)?g.competencies.length:0,opts:c,visualConfigLayout:b.visualConfig?.capabilityChildrenOffset,configDefault:N.competency?.defaultLayout})}catch{}try{(Array.isArray(g?.competencies)?g.competencies.length:0)>=4?Ee(g,c,{layout:"matrix"}):Ee(g,c)}catch{Ee(g,c)}const f=Xa(t.id);C.value=f||t,S.value=r;try{const w=C.value,R=w?.compId??w?.raw?.id??Math.abs(w?.id||0);if(R){const V=await yl(Number(R));try{C.value.skills=Array.isArray(V)?V:[]}catch(B){}}}catch{}try{const w=C.value?.id??t?.id;w!=null&&Al(w,!0)}catch{}try{const w=C.value?.id??S.value.id;if(w!=null&&(Z.value=Z.value.map(V=>V.id===w?{...V,animOpacity:1,animScale:V.animScale??1,visible:!0}:V),Xa(w))){const V=Z.value.filter(B=>B.id!==w);Z.value=V.concat(Z.value.filter(B=>B.id===w))}}catch{}if(l=f||g||we(t.id)||t,f&&(f.skills||f.competencies)){const w=f.id,R=Math.max(0,Math.round(mt*.5));await Promise.race([Wt(w),jt(R)]);try{window.__DEBUG__&&console.debug("[expandCompetencies.call] source=childClick.grandchildren, target=freshChild",{nodeId:f?.id,comps:Array.isArray(f?.competencies)?f.competencies.length:0,opts:c,visualConfigLayout:b.visualConfig?.capabilityChildrenOffset,configDefault:N.competency?.defaultLayout})}catch{}try{(Array.isArray(f?.competencies)?f.competencies.length:0)>=4?Ee(f,c,{layout:"matrix"}):Ee(f,c)}catch{Ee(f,c)}}}else{S.value=t;const c={x:t.x??0,y:t.y??0};Fa(t,a);const d=Math.max(0,Math.round(mt*.6));await Promise.race([Wt(t.id),jt(d)]),l=we(t.id)||t;try{window.__DEBUG__&&console.debug("[expandCompetencies.call] source=childClick.fallback, target=updated",{nodeId:l?.id,comps:Array.isArray(l?.competencies)?l.competencies.length:0,opts:c,visualConfigLayout:b.visualConfig?.capabilityChildrenOffset,configDefault:N.competency?.defaultLayout})}catch{}Ee(l,c)}}else{S.value=t;const n={x:t.x??0,y:t.y??0};Fa(t,a);try{const r=we(t.id)||t,c=Math.round(ie.value/2),d=Math.round(ue.value*.25);r.x=c,r.y=d;const g=Q.value?.id??null;$.value=$.value.map(w=>w.id===r.id||w.id===g?{...w,visible:!0}:{...w,visible:!1}),setTimeout(()=>{$.value=$.value.map(w=>w.id===r.id||w.id===g?{...w,visible:!0}:{...w,visible:!1})},Math.max(40,mt-120));const f=Math.max(0,Math.round(mt*.6));await Promise.race([Wt(r.id),jt(f)]),l=we(r.id)||r;try{window.__DEBUG__&&console.debug("[expandCompetencies.call] source=capabilityClick, target=updated",{nodeId:l?.id,comps:Array.isArray(l?.competencies)?l.competencies.length:0,opts:{limit:10,rows:2,cols:5},visualConfigLayout:b.visualConfig?.capabilityChildrenOffset,configDefault:N.competency?.defaultLayout})}catch(w){}Ee(l,n,{limit:10,rows:2,cols:5})}catch{const c=Math.max(0,Math.round(mt*.6));await Promise.race([Wt(t.id),jt(c)]),l=we(t.id)||t;try{window.__DEBUG__&&console.debug("[expandCompetencies.call] source=capabilityClick.fallback, target=updated",{nodeId:l?.id,comps:Array.isArray(l?.competencies)?l.competencies.length:0,opts:n,visualConfigLayout:b.visualConfig?.capabilityChildrenOffset,configDefault:N.competency?.defaultLayout})}catch{}Ee(l,n)}}!!document.fullscreenElement?e?(ua.value=e.clientX+12,da.value=e.clientY+12):(ua.value=(t.x??0)+12,da.value=(t.y??0)+12):(ua.value=24,da.value=24);try{if(vl.value&&Q.value&&(l||t)){const n=b.visualConfig?.scenarioOffset??80,r=l||t;Q.value.x=r.x??0,Q.value.y=Math.round((r.y??0)-n)}}catch{}},di=()=>{S.value=null,Z.value=[],de.value=[];try{ca()}catch{}if(C.value=null,ct.value&&ct.value.size>0){if($.value=$.value.map(t=>{const e=ct.value.get(t.id);return e?{...t,x:e.x,y:e.y}:t}),Q.value){const t=ct.value.get(Q.value.id);t&&(Q.value.x=t.x,Q.value.y=t.y)}ct.value.clear()}Ht.value=0,zt.value=0};i(!1),i({x:0,y:0});const qa=i(!1),pi=i("light"),sa=Le(()=>pi.value==="dark"?"dialog-dark":"dialog-light"),ml=i(null),Fl=Le(()=>{try{const t=ml.value;return t?typeof t.valid=="boolean"?!t.valid:typeof t.isValid=="boolean"?!t.isValid:!1:!1}catch{return!1}});Le(()=>!qa.value),Le(()=>{const t=!!document.fullscreenElement,e=qa.value?56:360;return t?{position:"fixed",right:"0px",top:"0px",height:"100vh",width:`${e}px`,zIndex:1e5,overflow:"auto"}:{width:`${e}px`}});function vi(t,e){try{const a=ve.value.find(o=>o.target===t.id),l=a?Xa(a.source):null;if(l){C.value=l;const o=de.value.find(n=>n.target===l.id);o&&(S.value=we(o.source))}try{$e.value=t&&(t.raw??t)||t;const o=$e.value||{};Ft.value=o.name??"",oa.value=o.description??"",Gt.value=o.category??Gt.value,Ut.value=o.complexity_level??Ut.value,Yt.value=o.scope_type??Yt.value,ra.value=o.domain_tag??"",Na.value=!!o.is_critical;try{const n=C.value,r=S.value;if(n&&r&&b.scenario&&b.scenario.id){let c=n.raw?.pivot??n.raw?.capability_pivot??null;!c&&Array.isArray(r?.raw?.scenario_capabilities)&&(c=r.raw.scenario_capabilities.find(d=>Number(d.competency_id??d.id??0)===Number(n.compId??n.raw?.id??Math.abs(n.id||0)))),c?(St.value=c.required_level??c.required??St.value,at.value=c.priority??at.value,Te.value=c.strategic_weight??c.weight??Te.value,st.value=c.rationale??"",Xt.value=!!(c.is_required??c.is_critical??!1)):(St.value=void 0,at.value=void 0,Te.value=void 0,st.value="",Xt.value=!1)}}catch(n){}Ct.value=!0}catch(o){}}catch{}}async function Gl(){try{console.debug("[saveSkillDetail] invoked",{selectedSkillDetail:$e?.value??null,skillEditName:Ft?.value??null,selectedChild:C?.value??null,focusedNode:S?.value??null})}catch{}if(!$e.value)return H("No hay skill seleccionada");const t=$e.value.id??null;if(!t)return H("Skill no tiene id");Mt.value=!0;try{const e={name:Ft.value?.trim()??void 0,description:oa.value?.trim()??void 0,category:Gt.value,complexity_level:Ut.value,scope_type:Yt.value,domain_tag:ra.value?.trim()??void 0,is_critical:!!Na.value};Object.keys(e).forEach(l=>e[l]===void 0&&delete e[l]);try{try{await Se()}catch{}await L.patch(`/api/skills/${t}`,e),be("Skill actualizada")}catch(l){try{console.error("saveSkillDetail - skill patch error",l,l?.response?.data)}catch{console.error("saveSkillDetail - skill patch error",l)}throw H("Error guardando skill"),l}try{try{const d=typeof $e.value<"u"?$e.value??$e:null,g=d?.pivot??d?.raw?.pivot??null,f=g?.id??g?.pivot_id??null,w=typeof C.value<"u"?C.value??C:null;if(f){const R={};if(Te.value!==void 0&&Te.value!==null&&(R.weight=Te.value),Object.keys(R).forEach(V=>R[V]===void 0&&delete R[V]),Object.keys(R).length>0)try{await L.patch(`/api/competency-skills/${f}`,R),be("Atributos de relación skill-competencia actualizados")}catch(V){console.error("saveSkillDetail - competency_skills patch failed",V)}}}catch(d){}const l=C.value&&typeof C.value=="object"?C.value??null:null,o=S.value&&typeof S.value=="object"?S.value??null:null,n=b.scenario?.id??null,r=l?.compId??l?.raw?.id??Math.abs(l?.id||0),c=o?.id??o?.raw?.id??null;if(n&&c&&r){const d={required_level:St.value,priority:at.value,strategic_weight:Te.value,weight:Te.value,rationale:st.value?.trim()??void 0,is_required:!!Xt.value};if(Object.keys(d).forEach(g=>d[g]===void 0&&delete d[g]),Object.keys(d).length>0)try{await L.patch(`/api/strategic-planning/scenarios/${n}/capabilities/${c}/competencies/${r}`,d),be("Atributos de competencia actualizados")}catch(g){const f=l?.raw?.pivot?.id??l?.raw?.capability_pivot?.id??null;if(f)try{await L.patch(`/api/capability-competencies/${f}`,d),be("Atributos de competencia actualizados (pivot)")}catch(w){console.error("saveSkillDetail - pivot patch fallback failed",w),H("Error guardando atributos de competencia")}else console.error("saveSkillDetail - pivot patch primary failed",g),H("Error guardando atributos de competencia")}}}catch(l){}let a=null;try{const l=await L.get(`/api/skills/${t}`),o=l?.data??l;a=Array.isArray(o)?o[0]:o}catch(l){console.error("Failed to refresh skill after save",l)}if(a&&typeof a.id<"u"){const l=C.value?.compId??C.value?.raw?.id;await Aa.update("skill",a,l),$e.value=a}Ct.value=!1}catch{}finally{try{console.debug("[saveSkillDetail] finished, savingSkillDetail:",Mt.value)}catch{}Mt.value=!1}}ft(Ct,t=>{t||($e.value=null,Ft.value="",oa.value="",Gt.value="technical",Ut.value="tactical",Yt.value="domain",ra.value="",Na.value=!1,St.value=void 0,at.value=void 0,Te.value=void 0,st.value="",Xt.value=!1)}),ft(Lt,t=>{if(t){const e=ke.value;e&&(e.skillId||typeof e.id=="number"&&e.id>0)?_a.value=e:_a.value=null}else la.value=null,ia.value=null,_a.value=null}),ol(()=>{try{window.__saveSkillDetail=Gl}catch{}}),hl(()=>{try{delete window.__saveSkillDetail}catch{}});function Ee(t,e,a={}){Z.value=[],de.value=[];const l=t.competencies??[];if(!Array.isArray(l)||l.length===0)return;const o=N.competency?N.competency.maxDisplay:10,n=Math.min(a.limit??o,o),r=l.slice(0,n);if(l.length>o)try{H&&H(`Solo se muestran hasta ${o} competencias`)}catch{}console.debug("[expandCompetencies] count:",r.length,"selectedChild:",C.value?"YES":"NO");const c=t.x??Math.round(ie.value/2),d=t.y??Math.round(ue.value/2),g={rows:1,cols:4,hSpacing:100,vSpacing:80},f=t.id!=null&&t.id<0?80:N.competency?.parentOffset,w=typeof b.visualConfig?.capabilityChildrenOffset=="number"?b.visualConfig.capabilityChildrenOffset:typeof b.capabilityChildrenOffset=="number"?b.capabilityChildrenOffset:b.competencyLayout?.parentOffset??f,R=b.visualConfig?.childDrop??b.competencyLayout?.skillDrop??18,V=Math.round(d+w+R);let B=a.rows??b.competencyLayout?.rows??g.rows,ne=a.cols??b.competencyLayout?.cols??g.cols,I=b.competencyLayout?.hSpacing??g.hSpacing,ee=b.competencyLayout?.vSpacing??g.vSpacing;const se=C.value?.compId??null,pe=se!==null&&r.some(j=>j.id===se),Ce=N.competency&&Array.isArray(N.competency.matrixVariants)?N.competency.matrixVariants:[];try{const j=xl(r.length,Ce,o);B=j.rows,ne=j.cols}catch{}const s=N.competency&&N.competency.defaultLayout?N.competency.defaultLayout:"auto",ce=Cl(a.layout,pe,r.length,s);console.debug("[expandCompetencies] hasSelectedChild:",pe,"layout:",ce);let Ge=[];if(ce==="radial"){console.debug("[expandCompetencies] Using RADIAL layout");const j=r.findIndex(Jt=>Jt.id===se),Ke=N.competency.radial.radius,dt=N.competency.radial.selectedOffsetY,Nt=r.length-1,Zt=N.competency.radial.startAngle,Ve=(N.competency.radial.endAngle-Zt)/Nt;Ge=r.map((Jt,pt)=>{if(pt===j)return{x:c,y:V+dt};const Ze=pt>j?pt-1:pt,vt=Zt+Ze*Ve,Vt=Math.round(c+Ke*Math.cos(vt)),gl=Math.round(V+Ke*Math.sin(vt));return{x:Vt,y:gl}})}else if(ce==="sides"){console.debug("[expandCompetencies] Using SIDES layout");try{const j=r.findIndex(Nt=>Nt.id===se),dt={hSpacing:Math.max(220,Math.round(I*1.6)),vSpacing:ee,parentOffset:w+R,selectedOffsetMultiplier:N.competency&&N.competency.sides&&typeof N.competency.sides.selectedOffsetMultiplier=="number"?N.competency.sides.selectedOffsetMultiplier:.75};Ge=kl(r.length,c,d,dt,j>=0?j:null)}catch(j){console.debug("sides layout compute failed",j),Ge=[]}}else console.debug("[expandCompetencies] Using MATRIX layout (rows:",B,"cols:",ne,"hSpacing:",I,"vSpacing:",ee,")"),r.length>5&&(I=Math.round(I*1.3),ee=Math.round(ee*1.4),console.debug("[expandCompetencies] Expanded spacing for >5 nodes without selection")),Ge=Wl(r.length,c,V,B,ne,I,ee);const Kt=[];r.forEach((j,Ke)=>{const dt=Ge[Ke]||{x:c,y:V},Nt=-(t.id*1e3+Ke+1),Zt=Math.max(0,Math.floor(Ke/ne)*N.animations.competencyStaggerRow+Ke%ne*N.animations.competencyStaggerCol+Math.round((Math.random()-.5)*N.animations.competencyStaggerRandom)),Et=Z.value.find(Ve=>Ve.compId===(j.id??null)),ll={id:Nt,compId:j.id??null,name:j.name??j,displayName:tl(j.name??j,14),x:Et?Et.x:e?.x??t.x??c,y:Et?Et.y:e?.y??t.y??d,animScale:.84,animOpacity:0,animDelay:Zt,animFilter:"blur(6px) drop-shadow(0 10px 18px rgba(2,6,23,0.36))",animTargetX:dt.x,animTargetY:P(dt.y),is_critical:!1,description:j.description??null,readiness:j.readiness??null,skills:Array.isArray(j.skills)?j.skills:[],raw:j};Kt.push(ll),de.value.push({source:t.id,target:Nt})}),Z.value=Kt.slice(),Oe(()=>{Z.value=Z.value.map(j=>({...j,x:j.animTargetX??j.x,y:j.animTargetY??j.y,animScale:1.06,animOpacity:1,animFilter:"none"})),setTimeout(()=>{Z.value=Z.value.map(j=>({...j,animScale:1})),Oe(()=>{Z.value.forEach(j=>{delete j.animTargetX,delete j.animTargetY,delete j.animDelay,delete j.animFilter})})},N.animations.competencyEntryFinalize)})}function al(t){return J.value.find(e=>e.id===t)||null}function ca(t=!1,e){try{if(e=typeof e=="number"?e:N.animations.collapseDuration??10,!t){J.value=[],ve.value=[];return}if(!Array.isArray(J.value)||J.value.length===0){ve.value=[];return}J.value=J.value.map(a=>({...a,animScale:.8,animOpacity:0,animFilter:"blur(6px)"}));try{ve.value=ve.value.map(a=>({...a,animOpacity:0}))}catch(a){}setTimeout(()=>{try{ve.value=[]}catch(a){}},e+10),setTimeout(()=>{try{J.value=[]}catch(a){}},e+10)}catch{}}function fi(t,e){Xe.value=t,Pt.value.x=e.clientX-t.x,Pt.value.y=e.clientY-t.y,window.addEventListener("pointermove",Ul),window.addEventListener("pointerup",Yl)}async function mi(){try{const t=await L.get("/api/competencies"),e=t?.data??t,l=(S.value??ke.value??null)?.competencies?.map(o=>o.id)||[];ma.value=Array.isArray(e)?e.filter(o=>!l.includes(o.id)):[]}catch{ma.value=[]}}async function yl(t){if(!t)return[];Ba.value=!0;try{try{if(b.scenario&&b.scenario.id){const e=await L.get(`/api/strategic-planning/scenarios/${b.scenario.id}/capability-tree`),a=Array.isArray(e)?e:e?.data??e??[];for(const l of a)if(!(!l||!Array.isArray(l.competencies))){for(const o of l.competencies)if(Number(o.id)===Number(t))return Array.isArray(o.skills)?o.skills:o?.skills||[]}}}catch(e){}try{const e=await L.get(`/api/competencies/${t}/skills`),a=e?.data??e;if(Array.isArray(a))return a}catch(e){}try{const e=await L.get(`/api/competencies/${t}`),a=e?.data??e;if(a){if(Array.isArray(a.skills))return a.skills;if(Array.isArray(a.data?.skills))return a.data.skills}}catch(e){}try{const e=await L.get("/api/skills"),a=Array.isArray(e)?e:e?.data??[];return Array.isArray(a)?a.filter(o=>o?Array.isArray(o.competencies)?o.competencies.some(n=>Number(n.id)===Number(t)):o.pivot&&(o.pivot.competency_id||o.pivot.competencyId)?Number(o.pivot.competency_id||o.pivot.competencyId)===Number(t):!1:!1):[]}catch(e){}}catch{}finally{Ba.value=!1}return[]}async function yi(){let t=S.value??null;if(!t&&C.value){const o=C.value?.id??null,n=o!=null?de.value.find(r=>r.target===o):null;t=n?we(n.source):null}!t&&ke.value&&(t=ke.value);const e=t?.id??t?.raw?.id??null;if(!e||Number(e)<=0){H("Seleccione una capacidad para asociar");return}if(!b.scenario?.id){H("Escenario no especificado");return}const a=e,l=b.scenario.id;Tt.value=!0;try{console.debug("[createAndAttachComp] start",{scenarioId:l,capId:a,name:We.value}),await Se();const o={competency:{name:We.value,description:ea.value},required_level:3,weight:1,rationale:"",is_required:!1},n=await L.post(`/api/strategic-planning/scenarios/${l}/capabilities/${a}/competencies`,o),r=n?.data??n;console.debug("[createAndAttachComp] success",r),await p(l);const c=we(a);let d=null;if(c&&Array.isArray(c.competencies)){const g=c.competencies.find(f=>{const w=f?.name||f?.compName||f?.raw?.name||"";return String(w).trim()===String(We.value).trim()});g&&(d=Number(g.id??g.compId??g.raw?.id??Math.abs(g.id||0))||null)}d||(d=Number(r?.id??r?.data?.id??r?.competency?.id??r?.competency_id)||null);try{if(tt.value&&String(tt.value).trim()){const g=String(tt.value).split(",").map(f=>f.trim()).filter(Boolean);for(const f of g)try{if(!d){console.warn("[createAndAttachComp] no compId found; skipping skill creation for",f);continue}await Za(d,{name:f,category:"technical"})}catch(w){console.error("[createAndAttachComp] failed creating skill",f,w)}}}catch(g){}xt.value=!1,Ha(),c&&Ee(c,{x:c.x??0,y:c.y??0}),be("Competencia creada y asociada")}catch(o){console.error("[createAndAttachComp] error",o),H("Error creando competencia")}finally{Tt.value=!1}}function gi(){try{console.debug("[onClickCreateAndAttachComp] click",{name:We.value,cap:ke.value?.id})}catch{}if(!ke.value||!ke.value.id){H("Seleccione una capacidad para asociar");return}if(!We.value||!String(We.value).trim()){H("El nombre de la competencia es obligatorio");return}Tt.value=!0,(async()=>{try{await Se(),await yi()}catch(t){console.error("[onClickCreateAndAttachComp] handler error",t),H("Error al crear la competencia")}finally{Tt.value=!1}})()}async function hi(){if(!ke.value||!ke.value.id)return H("Seleccione una capacidad");if(!ta.value)return H("Seleccione una competencia existente");const t=ke.value.id;await Se();try{await L.post(`/api/strategic-planning/scenarios/${b.scenario?.id}/capabilities/${t}/competencies`,{competency_id:ta.value}),kt.value=!1,await p(b.scenario?.id);const e=we(t);e&&Ee(e,{x:e.x??0,y:e.y??0}),be("Competencia asociada correctamente")}catch{try{await L.post(`/api/capabilities/${t}/competencies`,{competency_id:ta.value}),kt.value=!1,await p(b.scenario?.id);const a=we(t);a&&Ee(a,{x:a.x??0,y:a.y??0}),be("Competencia asociada correctamente")}catch{H("Error asociando competencia")}}}async function bi(){const t=C.value;if(!t)return H("No hay competencia seleccionada");await Se();try{const e=de.value.find(c=>c.target===t.id),a=e?e.source:null,l=t.compId??t.raw?.id??Math.abs(t.id),o=Array.isArray(t.skills)?t.skills.map(c=>c.id??c.raw?.id??c).filter(c=>typeof c=="number"):[],n={name:Ae.value,description:it.value,skills:o};if(console.debug("[saveSelectedChild] compPayload (name, description, skills only; readiness is calculated)",n,"compId",l,"skillIds extracted from child.skills:",o),console.debug("[saveSelectedChild] about to PATCH compId check:",!!l),l){console.debug("[saveSelectedChild] INSIDE if (compId), about to call api.patch");try{const c=`/api/competencies/${l}`;console.debug("[saveSelectedChild] calling PATCH:",c,"with payload:",n);const d=await L.patch(c,n);console.debug("[saveSelectedChild] PATCH /api/competencies/"+l+" success, response:",d)}catch(c){console.error("[saveSelectedChild] ERROR in PATCH /api/competencies/"+l,c?.response?.data??c),H("Error actualizando competencia: "+(c?.response?.data?.message||c?.message||"Unknown error"));return}}else console.warn("[saveSelectedChild] compId is falsy, skipping PATCH. child.compId=",t.compId,"child.raw?.id=",t.raw?.id,"child.id=",t.id);if(a&&l){const c={weight:typeof ha.value<"u"?Number(ha.value):void 0,priority:typeof ba.value<"u"?Number(ba.value):void 0,required_level:typeof wa.value<"u"?Number(wa.value):void 0,is_required:!!xa.value,is_critical:!!xa.value,rationale:Oa.value};console.debug("[saveSelectedChild] pivotPayload",c,"parentId",a,"compId",l);try{const d=await L.patch(`/api/strategic-planning/scenarios/${b.scenario?.id}/capabilities/${a}/competencies/${l}`,c);console.debug("[saveSelectedChild] PATCH child pivot response",d)}catch{try{const g=await L.patch(`/api/capabilities/${a}/competencies/${l}`,c);console.debug("[saveSelectedChild] PATCH child pivot fallback response",g)}catch(g){console.error("[saveSelectedChild] error updating pivot",g?.response?.data??g)}}}let r=null;try{if(l){const c=await L.get(`/api/competencies/${l}`);r=c?.data??c}}catch(c){}r&&typeof r.id<"u"&&(await Aa.update("competency",r,a??void 0),Ae.value=r.name??Ae.value,it.value=r.description??it.value,ga.value=r.readiness??ga.value),be("Competencia actualizada")}catch{H("Error guardando competencia")}}function Ul(t){Xe.value&&(Xe.value.x=Math.round(t.clientX-Pt.value.x),Xe.value.y=Math.round(t.clientY-Pt.value.y),qe.value=!0)}async function Yl(){if(Xe.value&&(Xe.value=null),window.removeEventListener("pointermove",Ul),window.removeEventListener("pointerup",Yl),qe.value){try{await Xl()}catch{}qe.value=!1}}const wi=()=>{$.value=$.value.map(t=>({...t,x:void 0,y:void 0})),b.scenario&&Array.isArray(b.scenario.capabilities)&&Ua(b.scenario.capabilities)},Xl=async()=>{if(!b.scenario||!b.scenario.id)return H("Escenario no seleccionado");try{const t={positions:$.value.map(e=>({id:e.id,x:e.x,y:e.y}))};await L.post(`/api/strategic-planning/scenarios/${b.scenario.id}/capability-tree/save-positions`,t),be("Posiciones guardadas")}catch{H("Error al guardar posiciones")}};return ol(async()=>{try{window.__nodeLevel=F}catch{}if(b.scenario&&Array.isArray(b.scenario.capabilities)&&b.scenario.capabilities.length>0){const o=b.scenario.capabilities;gt.value=o;const n=o[0];if(!(!!n&&(n.strategic_weight!==void 0||n.priority!==void 0||n.required_level!==void 0||n.is_critical!==void 0||n.raw&&(n.raw.strategic_weight!==void 0||n.raw.priority!==void 0)||n.pivot&&(n.pivot.strategic_weight!==void 0||n.pivot.priority!==void 0)||n.scenario_capabilities&&Object.keys(n.scenario_capabilities).length>0))){await p(b.scenario.id),fl();try{await Ga()}catch{}return}Ua(o),Ya(o);try{const c=localStorage.getItem(ka.collapsed);c!==null&&(qa.value=c==="true");const d=localStorage.getItem(ka.lastView),g=localStorage.getItem(ka.lastFocusedId);if(g&&(pl.value=parseInt(g,10)),d==="scenario"&&!S.value&&(Be.value=!0),pl.value){const f=we(pl.value);f&&(S.value=f)}}catch{}je.value=!0,fl();try{wi()}catch{}try{await Ga()}catch{}return}p(b.scenario?.id);const t=yt.value,e=(o,n)=>{const r=o??t?.clientWidth??900;let c=t?.clientHeight??0;if(!c||c===0){const w=t?.getBoundingClientRect().top??0;c=Math.max(320,Math.round(window.innerHeight-w-24))}const g=t?.querySelector(".map-controls")?.offsetHeight??0,f=n??Math.max(300,c-g-12);ie.value=r,ue.value=f,Array.isArray(Dt)&&Dt.length>0&&(Ua(Dt),Ya(Dt))};e();let a=null;t&&window.ResizeObserver&&(a=new ResizeObserver(o=>{for(const n of o){const r=Math.round(n.contentRect.width),c=Math.round(n.contentRect.height);e(r,c)}}),a.observe(t));const l=()=>e();window.addEventListener("resize",l),Ta=o=>Zl(),Oe(()=>{Ra.value&&Ra.value.addEventListener("scroll",Ta)}),hl(()=>{Ra.value&&Ta&&Ra.value.removeEventListener("scroll",Ta),Ta=null,a&&a.disconnect(),window.removeEventListener("resize",l)})}),ft([qa,Be,S],()=>{try{localStorage.setItem(ka.collapsed,qa.value?"true":"false");const t=S.value?"node":Be.value?"scenario":"none";localStorage.setItem(ka.lastView,t),localStorage.setItem(ka.lastFocusedId,S.value?String(S.value.id):"")}catch{}},{immediate:!0}),ft(()=>b.scenario,(t,e)=>{if(t&&t!==e)if(Array.isArray(t.capabilities)&&t.capabilities.length>0){const a=t.capabilities;Ua(a),Ya(a),je.value=!0;try{Ga()}catch{}}else p(t.id)},{immediate:!1}),ft(()=>b.scenario&&(b.scenario.name??null),t=>{Q.value&&(Q.value.name=t??"Escenario")}),ft(()=>$.value.map(t=>t.id),()=>{Q.value&&Array.isArray($.value)&&(pa.value=$.value.map(t=>({source:Q.value.id,target:t.id,isScenarioEdge:!0})))},{immediate:!0}),Re.value||(Re.value=[]),(t,e)=>{const a=_e("v-icon"),l=_e("v-list-item"),o=_e("v-list"),n=_e("v-menu"),r=_e("v-btn"),c=_e("v-card-title"),d=_e("v-text-field"),g=_e("v-textarea"),f=_e("v-slider"),w=_e("v-checkbox"),R=_e("v-form"),V=_e("v-select"),B=_e("v-switch"),ne=_e("v-card-text"),I=_e("v-spacer"),ee=_e("v-card-actions"),se=_e("v-card"),pe=_e("v-dialog"),Ce=_e("v-alert");return z(),te("div",null,[x("div",{class:It(["prototype-map-root",{"no-animations":Ja.value}]),ref_key:"mapRoot",ref:yt},[je.value?(z(),te("div",Ti,[(z(),te("svg",{width:ie.value,height:ue.value,viewBox:`0 0 ${ie.value} ${ue.value}`,class:"map-canvas",style:{"touch-action":"none",cursor:"grab"},onWheel:Ql,onMousedown:ei,onMousemove:ti,onMouseup:Il,onMouseleave:Il},[e[89]||(e[89]=bl('<defs data-v-01b4f566><linearGradient id="bgGrad" x1="0" y1="0" x2="1" y2="1" data-v-01b4f566><stop offset="0%" stop-color="#040914" stop-opacity="1" data-v-01b4f566></stop><stop offset="25%" stop-color="#071029" stop-opacity="1" data-v-01b4f566></stop><stop offset="70%" stop-color="#071a2a" stop-opacity="1" data-v-01b4f566></stop><stop offset="100%" stop-color="#051018" stop-opacity="1" data-v-01b4f566></stop></linearGradient><radialGradient id="nodeGrad" cx="30%" cy="25%" r="70%" data-v-01b4f566><stop offset="0%" stop-color="#ffffff" stop-opacity="0.75" data-v-01b4f566></stop><stop offset="12%" stop-color="#e8f6ff" stop-opacity="0.55" data-v-01b4f566></stop><stop offset="45%" stop-color="#6fc3ff" stop-opacity="0.95" data-v-01b4f566></stop><stop offset="100%" stop-color="#0b66b2" stop-opacity="1" data-v-01b4f566></stop></radialGradient><radialGradient id="iridescentGrad" cx="70%" cy="30%" r="90%" data-v-01b4f566><stop offset="0%" stop-color="#ffffff" stop-opacity="0.0" data-v-01b4f566></stop><stop offset="18%" stop-color="#ffd6f7" stop-opacity="0.06" data-v-01b4f566></stop><stop offset="32%" stop-color="#d6f7ff" stop-opacity="0.07" data-v-01b4f566></stop><stop offset="48%" stop-color="#fff2d6" stop-opacity="0.06" data-v-01b4f566></stop><stop offset="68%" stop-color="#d6fff3" stop-opacity="0.05" data-v-01b4f566></stop><stop offset="100%" stop-color="#ffffff" stop-opacity="0.0" data-v-01b4f566></stop></radialGradient><radialGradient id="bubbleOuterGrad" cx="50%" cy="50%" r="80%" data-v-01b4f566><stop offset="0%" stop-color="#0b66b2" stop-opacity="0.06" data-v-01b4f566></stop><stop offset="60%" stop-color="#6fc3ff" stop-opacity="0.18" data-v-01b4f566></stop><stop offset="85%" stop-color="#6fc3ff" stop-opacity="0.06" data-v-01b4f566></stop><stop offset="100%" stop-color="#0b66b2" stop-opacity="0.02" data-v-01b4f566></stop></radialGradient><radialGradient id="bubbleCoreGrad" cx="35%" cy="30%" r="60%" data-v-01b4f566><stop offset="0%" stop-color="#ffffff" stop-opacity="0.9" data-v-01b4f566></stop><stop offset="35%" stop-color="#dffaff" stop-opacity="0.7" data-v-01b4f566></stop><stop offset="100%" stop-color="#6fc3ff" stop-opacity="0.0" data-v-01b4f566></stop></radialGradient><filter id="innerGlow" x="-30%" y="-30%" width="160%" height="160%" data-v-01b4f566><feGaussianBlur in="SourceAlpha" stdDeviation="6" result="blurInner" data-v-01b4f566></feGaussianBlur><feComposite in="blurInner" in2="SourceGraphic" operator="arithmetic" k1="0" k2="1" k3="-1" k4="0" result="innerComp" data-v-01b4f566></feComposite><feMerge data-v-01b4f566><feMergeNode in="innerComp" data-v-01b4f566></feMergeNode><feMergeNode in="SourceGraphic" data-v-01b4f566></feMergeNode></feMerge></filter><radialGradient id="glassGrad" cx="35%" cy="28%" r="72%" data-v-01b4f566><stop offset="0%" stop-color="#ffffff" stop-opacity="0.30" data-v-01b4f566></stop><stop offset="30%" stop-color="#dff6ff" stop-opacity="0.12" data-v-01b4f566></stop><stop offset="70%" stop-color="#9fd8ff" stop-opacity="0.08" data-v-01b4f566></stop><stop offset="100%" stop-color="#0b66b2" stop-opacity="0.18" data-v-01b4f566></stop></radialGradient><filter id="glassBlur" x="-20%" y="-20%" width="140%" height="140%" data-v-01b4f566><feGaussianBlur stdDeviation="4" result="gblur" data-v-01b4f566></feGaussianBlur><feMerge data-v-01b4f566><feMergeNode in="gblur" data-v-01b4f566></feMergeNode><feMergeNode in="SourceGraphic" data-v-01b4f566></feMergeNode></feMerge></filter><filter id="softGlow" x="-50%" y="-50%" width="200%" height="200%" data-v-01b4f566><feGaussianBlur stdDeviation="6" result="blur" data-v-01b4f566></feGaussianBlur><feMerge data-v-01b4f566><feMergeNode in="blur" data-v-01b4f566></feMergeNode><feMergeNode in="SourceGraphic" data-v-01b4f566></feMergeNode></feMerge></filter><linearGradient id="childGrad" x1="0" y1="0" x2="1" y2="0" data-v-01b4f566><stop offset="0%" stop-color="#7dd3fc" stop-opacity="1" data-v-01b4f566></stop><stop offset="100%" stop-color="#04234A" stop-opacity="1" data-v-01b4f566></stop></linearGradient><linearGradient id="scenarioEdgeGrad" x1="0" y1="0" x2="1" y2="0" data-v-01b4f566><stop offset="0%" stop-color="#9be7ff" stop-opacity="0.98" data-v-01b4f566></stop><stop offset="50%" stop-color="#6fb8ff" stop-opacity="0.9" data-v-01b4f566></stop><stop offset="100%" stop-color="#3fa6ff" stop-opacity="0.82" data-v-01b4f566></stop></linearGradient><linearGradient id="compassNeedleGrad" x1="0" y1="0" x2="0" y2="1" data-v-01b4f566><stop offset="0%" stop-color="#08306b" stop-opacity="1" data-v-01b4f566></stop><stop offset="60%" stop-color="#1e66d6" stop-opacity="1" data-v-01b4f566></stop><stop offset="100%" stop-color="#9fe6ff" stop-opacity="1" data-v-01b4f566></stop></linearGradient><linearGradient id="edgeGrad" x1="0" y1="0" x2="1" y2="0" data-v-01b4f566><stop offset="0%" stop-color="#09c8d2" stop-opacity="0.85" data-v-01b4f566></stop><stop offset="60%" stop-color="#66b8ff" stop-opacity="0.6" data-v-01b4f566></stop><stop offset="100%" stop-color="#9bd0ff" stop-opacity="0.45" data-v-01b4f566></stop></linearGradient><filter id="edgeGlow" x="-50%" y="-50%" width="200%" height="200%" data-v-01b4f566><feGaussianBlur stdDeviation="3" result="blurEdge" data-v-01b4f566></feGaussianBlur><feMerge data-v-01b4f566><feMergeNode in="blurEdge" data-v-01b4f566></feMergeNode><feMergeNode in="SourceGraphic" data-v-01b4f566></feMergeNode></feMerge></filter><filter id="innerShadow" x="-20%" y="-20%" width="140%" height="140%" data-v-01b4f566><feOffset dx="0" dy="2" result="off" data-v-01b4f566></feOffset><feGaussianBlur in="off" stdDeviation="2" result="blur2" data-v-01b4f566></feGaussianBlur><feComposite in="SourceGraphic" in2="blur2" operator="over" data-v-01b4f566></feComposite></filter><filter id="specular" x="-50%" y="-50%" width="200%" height="200%" data-v-01b4f566><feGaussianBlur stdDeviation="3" result="spec" data-v-01b4f566></feGaussianBlur><feMerge data-v-01b4f566><feMergeNode in="spec" data-v-01b4f566></feMergeNode><feMergeNode in="SourceGraphic" data-v-01b4f566></feMergeNode></feMerge></filter><radialGradient id="competencyGrad" cx="30%" cy="25%" r="70%" data-v-01b4f566><stop offset="0%" stop-color="#16B7E8" stop-opacity="0.85" data-v-01b4f566></stop><stop offset="50%" stop-color="#039B8E" stop-opacity="0.95" data-v-01b4f566></stop><stop offset="100%" stop-color="#21A7B6" stop-opacity="1" data-v-01b4f566></stop></radialGradient><radialGradient id="competencySelectedGrad" cx="30%" cy="25%" r="70%" data-v-01b4f566><stop offset="0%" stop-color="#D9F0EF" stop-opacity="0.95" data-v-01b4f566></stop><stop offset="50%" stop-color="#3BB6BC" stop-opacity="1" data-v-01b4f566></stop><stop offset="100%" stop-color="#167780" stop-opacity="1" data-v-01b4f566></stop></radialGradient><radialGradient id="skillGrad" cx="30%" cy="25%" r="70%" data-v-01b4f566><stop offset="0%" stop-color="#6ee7b7" stop-opacity="0.85" data-v-01b4f566></stop><stop offset="50%" stop-color="#10b981" stop-opacity="0.95" data-v-01b4f566></stop><stop offset="100%" stop-color="#047857" stop-opacity="1" data-v-01b4f566></stop></radialGradient><radialGradient id="skillSelectedGrad" cx="30%" cy="25%" r="70%" data-v-01b4f566><stop offset="0%" stop-color="#a7f3d0" stop-opacity="0.95" data-v-01b4f566></stop><stop offset="50%" stop-color="#0CBEBE" stop-opacity="1" data-v-01b4f566></stop><stop offset="100%" stop-color="#08959F" stop-opacity="1" data-v-01b4f566></stop></radialGradient></defs>',1)),x("rect",{x:"0",y:"0",width:ie.value,height:ue.value,rx:"12",ry:"12",fill:"url(#bgGrad)"},null,8,Fi),x("rect",{x:"1",y:"1",width:ie.value-4,height:ue.value-2,rx:"12",ry:"12",fill:"none",stroke:"rgba(255,255,255,0.04)","stroke-width":"1",filter:"url(#softGlow)"},null,8,Gi),x("g",{class:"viewport-group",style:Sa(Jl.value)},[x("g",Ui,[(z(!0),te(Ue,null,Je(Re.value,(s,ce)=>(z(),te("line",{key:`edge-${ce}`,x1:Me(s.source)?.x??void 0,y1:Me(s.source)?.y??void 0,x2:Me(s.target)?.x??void 0,y2:Me(s.target)?.y??void 0,class:"edge-line",stroke:"url(#edgeGrad)","stroke-width":"2","stroke-linecap":"round",filter:"url(#edgeGlow)","stroke-opacity":"0.9"},null,8,Yi))),128))]),x("g",{class:"scenario-create-control",transform:`translate(${Math.max(48,ie.value-56)}, 72)`,onClick:Ye(ii,["stop"]),style:{cursor:"pointer"},"aria-label":"Crear capacidad"},[...e[74]||(e[74]=[x("circle",{r:"12",fill:"rgba(255,255,255,0.03)",stroke:"rgba(255,255,255,0.05)"},null,-1),x("title",null,"Crear capacidad",-1),x("text",{x:"0",y:"4","text-anchor":"middle","font-size":"16",fill:"#dbeafe",style:{"font-weight":"700"}}," + ",-1)])],8,Xi),x("g",qi,[(z(!0),te(Ue,null,Je(pa.value,(s,ce)=>(z(),te(Ue,{key:`scenario-edge-${ce}`},[Tl(s)?(z(),te("path",{key:0,d:Tl(s),class:"edge-line scenario-edge",stroke:"url(#scenarioEdgeGrad)","stroke-width":"2.6","stroke-linecap":"round",fill:"none",filter:"url(#edgeGlow)","stroke-opacity":"0.95"},null,8,Bi)):(z(),te("line",{key:1,x1:Me(s.source)?.x??void 0,y1:Me(s.source)?.y??void 0,x2:Me(s.target)?.x??void 0,y2:Me(s.target)?.y??void 0,class:"edge-line scenario-edge",stroke:"url(#scenarioEdgeGrad)","stroke-width":"2.6","stroke-linecap":"round",filter:"url(#edgeGlow)","stroke-opacity":"0.95"},null,8,Hi))],64))),128))]),x("g",zi,[rl(_)===2?(z(!0),te(Ue,{key:0},Je(de.value,(s,ce)=>(z(),te("path",{key:`child-edge-path-${ce}`,d:ut(s).d,class:"edge-line child-edge",stroke:"url(#childGrad)","stroke-width":"4","stroke-linecap":"round",fill:"none",filter:"url(#edgeGlow)","stroke-opacity":"0.98","marker-end":"url(#childArrow)"},null,8,ji))),128)):(z(!0),te(Ue,{key:1},Je(de.value,(s,ce)=>(z(),te("line",{key:`child-edge-line-${ce}`,x1:ut(s).x1??void 0,y1:ut(s).y1??void 0,x2:ut(s).x2??void 0,y2:ut(s).y2??void 0,class:"edge-line child-edge",stroke:"url(#childGrad)","stroke-width":"2","stroke-linecap":"round",filter:"url(#edgeGlow)","stroke-opacity":"0.98","marker-end":"url(#childArrow)"},null,8,Wi))),128))]),x("g",Ki,[rl(_)===2?(z(!0),te(Ue,{key:0},Je(ve.value,(s,ce)=>(z(),te("path",{key:`grandchild-edge-path-${ce}`,d:ut(s).d,class:"edge-line child-edge",stroke:"url(#childGrad)","stroke-width":"4","stroke-linecap":"round",fill:"none",filter:"url(#edgeGlow)","stroke-opacity":Rl(s),style:{transition:"stroke-opacity 180ms ease"},"marker-end":"url(#childArrow)"},null,8,Zi))),128)):(z(!0),te(Ue,{key:1},Je(ve.value,(s,ce)=>(z(),te("line",{key:`grandchild-edge-line-${ce}`,x1:ut(s).x1??void 0,y1:ut(s).y1??void 0,x2:ut(s).x2??void 0,y2:ut(s).y2??void 0,class:"edge-line child-edge",stroke:"url(#childGrad)","stroke-width":"2","stroke-linecap":"round",filter:"url(#edgeGlow)","stroke-opacity":Rl(s),style:{transition:"stroke-opacity 180ms ease"},"marker-end":"url(#childArrow)"},null,8,Ji))),128))]),Q.value?(z(),te("g",{key:0,style:Sa([{transform:`translate(${Q.value.x}px, ${Q.value.y}px)`},{cursor:"pointer"}]),class:"node-group scenario-node","data-node-id":Q.value.id,onClick:Ye(ai,["stop"]),title:"Ver información del escenario"},[x("title",null,he(Q.value.name),1),e[75]||(e[75]=bl('<circle class="node-circle" r="22" fill="url(#glassGrad)" filter="url(#softGlow)" stroke="rgba(255,255,255,0.06)" stroke-width="1.2" data-v-01b4f566></circle><g class="scenario-icon" transform="translate(0,0) scale(1.6)" data-v-01b4f566><circle r="9" fill="rgba(0,0,0,0.28)" data-v-01b4f566></circle><g class="rose" transform="translate(0,0)" data-v-01b4f566><g class="rose-x" transform="translate(0,2)" data-v-01b4f566><path class="rose-x-arm" d="M0,-14 L5,0 L0,10 L-5,0 Z" transform="rotate(45) scale(1.2)" fill="rgba(255,255,255,0.06)" data-v-01b4f566></path><path class="rose-x-arm" d="M0,-14 L5,0 L0,10 L-5,0 Z" transform="rotate(-45) scale(1.2)" fill="rgba(255,255,255,0.06)" data-v-01b4f566></path></g><path class="rose-outline" d="M0,-14 L4,-4 L14,0 L4,4 L0,14 L-4,4 L-14,0 L-4,-4 Z" data-v-01b4f566></path><path class="rose-primary" d="M0,-14 L5,0 L0,10 L-5,0 Z" data-v-01b4f566></path><path class="rose-secondary" d="M0,14 L5,0 L0,-10 L-5,0 Z" transform="scale(1.1)" fill="url(#compassNeedleGrad)" data-v-01b4f566></path><circle class="rose-center" r="2" data-v-01b4f566></circle></g></g>',2))],12,Qi)):Qt("",!0),(z(!0),te(Ue,null,Je($.value,s=>(z(),te("g",{key:s.id,style:Sa({transform:`translate(${$l(s)}px, ${s.y}px)`}),class:It(["node-group",{critical:!!s.is_critical,focused:S.value&&S.value.id===s.id,dragging:Xe.value&&Xe.value.id===s.id,small:S.value&&S.value.id!==s.id}]),"data-node-id":s.id,onPointerdown:Ye(ce=>fi(s,ce),["prevent"]),onClick:Ye(ce=>Ll(s,ce),["stop"]),onContextmenu:Ye(ce=>Ka(s,ce),["prevent","stop"])},[x("title",null,he(s.name),1),e[76]||(e[76]=x("circle",{class:"node-circle",r:"34",fill:"url(#bubbleOuterGrad)",filter:"url(#innerGlow)",stroke:"rgba(255,255,255,0.12)","stroke-opacity":"1","stroke-width":"1.2"},null,-1)),e[77]||(e[77]=x("circle",{class:"node-iridescence",r:"34",fill:"url(#iridescentGrad)",opacity:"0.22",style:{"mix-blend-mode":"screen"}},null,-1)),e[78]||(e[78]=x("circle",{class:"node-core",r:"10",fill:"url(#bubbleCoreGrad)",filter:"url(#specular)"},null,-1)),e[79]||(e[79]=x("circle",{class:"node-rim",r:"34",fill:"none",stroke:"#ffffff","stroke-opacity":"0.08","stroke-width":"1.4"},null,-1)),s.is_critical?(z(),te("circle",to)):Qt("",!0),x("text",ao,[(z(!0),te(Ue,null,Je((s.displayName??s.name).split(`
`),(ce,Ge)=>(z(),te("tspan",{key:Ge,x:0,dy:Ge===0?0:12},he(ce),9,lo))),128))])],46,eo))),128)),x("g",io,[(z(!0),te(Ue,null,Je(Z.value,s=>(z(),te("g",{key:s.id,style:Sa({transform:`translate(${s.x}px, ${s.y}px) scale(${s.animScale??1})`,opacity:s.animOpacity??.88,transitionDelay:s.animDelay?s.animDelay+"ms":void 0,filter:s.animFilter?s.animFilter:void 0}),class:"node-group child-node","data-node-id":s.id,onClick:Ye(ce=>Ll(s,ce),["stop"]),onContextmenu:Ye(ce=>Ka(s,ce),["prevent","stop"])},[x("title",null,he(s.name),1),x("circle",{class:"node-circle",r:20,fill:s.id===C.value?.id?"url(#competencySelectedGrad)":"url(#competencyGrad)",stroke:s.id===C.value?.id?"rgba(167, 139, 250, 0.8)":"rgba(124, 58, 237, 0.5)","stroke-width":"1.5"},null,8,ro),e[80]||(e[80]=x("circle",{class:"node-iridescence child-iridescence",r:20,fill:"url(#iridescentGrad)",opacity:"0.18",style:{"mix-blend-mode":"screen"}},null,-1)),e[81]||(e[81]=x("ellipse",{class:"node-reflection child-reflection",cx:"-6",cy:"-6",rx:"7",ry:"4.5",fill:"#ffffff","fill-opacity":"0.14",transform:"rotate(-22)",filter:"url(#specular)"},null,-1)),e[82]||(e[82]=x("circle",{class:"node-rim child-rim",r:20,fill:"none",stroke:"#ffffff","stroke-opacity":"0.06","stroke-width":"1"},null,-1)),e[83]||(e[83]=x("circle",{class:"node-gloss child-gloss",r:22,fill:"none",stroke:"#ffffff","stroke-opacity":"0.04","stroke-width":"4",filter:"url(#softGlow)"},null,-1)),x("text",no,[(z(!0),te(Ue,null,Je(String(s.displayName??s.name).split(`
`),(ce,Ge)=>(z(),te("tspan",{key:Ge,x:0,dy:Ge===0?0:10},he(ce),9,so))),128))])],44,oo))),128))]),x("g",co,[(z(!0),te(Ue,null,Je(J.value,s=>(z(),te("g",{key:`${s.id}-${s.name}-${s.raw?.id}`,style:Sa({transform:`translate(${s.x}px, ${s.y}px) scale(${s.animScale??1})`,opacity:s.animOpacity??.85}),class:"node-group skill-node","data-node-id":s.id,onClick:Ye(ce=>vi(s),["stop"])},[x("title",null,he(s.name),1),e[84]||(e[84]=bl('<circle class="node-circle" r="14" fill="url(#skillGrad)" stroke="rgba(16, 185, 129, 0.5)" stroke-width="1" data-v-01b4f566></circle><circle class="node-iridescence" r="14" fill="url(#iridescentGrad)" opacity="0.14" style="mix-blend-mode:screen;" data-v-01b4f566></circle><circle class="node-rim skill-rim" r="14" fill="none" stroke="#ffffff" stroke-opacity="0.06" stroke-width="1" data-v-01b4f566></circle><circle class="node-gloss skill-gloss" r="16" fill="none" stroke="#ffffff" stroke-opacity="0.04" stroke-width="3" filter="url(#softGlow)" data-v-01b4f566></circle><ellipse class="node-reflection skill-reflection" cx="-5" cy="-5" rx="5" ry="3" fill="#ffffff" fill-opacity="0.12" transform="rotate(-22)" filter="url(#specular)" data-v-01b4f566></ellipse>',5)),x("text",po,he(s.name),1)],12,uo))),128))]),x("g",{class:"diagram-control reorder-control",transform:`translate(${Math.max(48,ie.value-56)}, 108)`,onClick:Ye(Ga,["stop"]),style:{cursor:"pointer"}},[...e[85]||(e[85]=[x("circle",{r:"12",fill:"rgba(182, 221, 77, 0.04)",stroke:"rgba(255,255,255,0.06)"},null,-1),x("title",null,"Reordenar nodos",-1),x("text",{x:"0",y:"4","text-anchor":"middle","font-size":"11",fill:"#dbeafe",style:{"font-weight":"700"}}," R ",-1)])],8,vo),x("g",{class:"diagram-control mode-control",transform:`translate(${Math.max(48,ie.value-56)}, 180)`,onClick:Ye(sl,["stop"]),style:{cursor:"pointer"},title:`Edge mode: ${Da[rl(_)]}`},[e[86]||(e[86]=x("circle",{r:"12",fill:"rgba(255,255,255,0.03)",stroke:"rgba(255,255,255,0.06)"},null,-1)),e[87]||(e[87]=x("title",null,"Cambiar modo conector",-1)),x("text",mo,he(Da[rl(_)]),1)],8,fo),x("g",{class:"diagram-control restore-control",transform:`translate(${Math.max(48,ie.value-56)}, 144)`,onClick:Ye(Y,["stop"]),style:{cursor:"pointer"}},[...e[88]||(e[88]=[x("circle",{r:"12",fill:"rgba(255,255,255,0.04)",stroke:"rgba(255,255,255,0.06)"},null,-1),x("title",null,"Restaurar vista",-1),x("text",{x:"0",y:"4","text-anchor":"middle","font-size":"11",fill:"#dbeafe",style:{"font-weight":"700"}}," ↺ ",-1)])],8,yo)],4),(z(),te("foreignObject",{x:"12",y:"8",width:Math.min(420,ie.value-48),height:"40"},[x("div",ho,[x("div",bo,[(z(!0),te(Ue,null,Je(nl.value,(s,ce)=>(z(),te("div",{key:`breadcrumb-${ce}`,class:"svg-title-line"},he(s),1))),128))])])],8,go))],40,Li)),y(n,{modelValue:Bt.value,"onUpdate:modelValue":e[0]||(e[0]=s=>Bt.value=s),absolute:"","offset-y":"",transition:"scale-transition","close-on-content-click":!1,"open-on-click":!1,style:Sa({left:za.value+"px",top:ja.value+"px",zIndex:2e5})},{default:D(()=>[x("div",{ref_key:"contextMenuEl",ref:Wa,class:"node-context-menu-v",style:{"min-width":"250px"}},[y(o,{density:"compact"},{default:D(()=>[y(l,{onClick:cl,class:"node-context-item"},{default:D(()=>[x("div",wo,[y(a,{class:"me-2"},{default:D(()=>[...e[90]||(e[90]=[ae("mdi-eye-outline",-1)])]),_:1}),e[91]||(e[91]=x("span",null,"Ver Detalles",-1))])]),_:1})]),_:1})],512)]),_:1},8,["modelValue","style"]),y(pe,{modelValue:Be.value,"onUpdate:modelValue":e[26]||(e[26]=s=>Be.value=s),"max-width":"980",persistent:"",scrollable:"",transition:"scale-transition","content-class":"capability-dialog",role:"dialog","aria-modal":"true","aria-label":ke.value?`Detalles: ${ke.value.name}`:"Detalle de elemento"},{default:D(()=>[y(se,{class:It(sa.value)},{default:D(()=>[y(c,{class:"d-flex justify-space-between align-center"},{default:D(()=>[x("strong",null,he(ke.value?ke.value.name:Be.value?"Escenario":"Detalle"),1),x("div",xo,[y(r,{icon:"",small:"",variant:"text",onClick:e[1]||(e[1]=s=>Be.value=!1)},{default:D(()=>[y(a,{icon:"mdi-close"})]),_:1})])]),_:1}),y(ne,{style:{"max-height":"70vh",overflow:"auto"}},{default:D(()=>[ke.value?(z(),te(Ue,{key:0},[x("div",ko,[x("div",null,[e[92]||(e[92]=x("strong",null,"ID:",-1)),ae(" "+he(ke.value.id??"—"),1)]),x("div",null,[e[93]||(e[93]=x("strong",null,"Competencias:",-1)),ae(" "+he((ke.value.competencies||[]).length),1)])]),x("div",Co,[ke.value.skills||ke.value.compId?(z(),te("div",So,[x("div",Mo,[y(R,{ref_key:"capForm",ref:ml,onSubmit:e[10]||(e[10]=Ye(()=>{},["prevent"]))},{default:D(()=>[x("div",Ao,[y(r,{small:"",color:"primary",onClick:ri},{default:D(()=>[...e[94]||(e[94]=[ae("Crear Skill",-1)])]),_:1},8,["onClick"]),y(r,{small:"",color:"primary",onClick:ni},{default:D(()=>[...e[95]||(e[95]=[ae("Agregar existente",-1)])]),_:1},8,["onClick"]),y(r,{color:"error",onClick:Pl,loading:He.value},{default:D(()=>[...e[96]||(e[96]=[ae("Eliminar nodo",-1)])]),_:1},8,["onClick","loading"]),y(r,{color:"primary",onClick:bi,loading:He.value,disabled:He.value||Fl.value},{default:D(()=>[...e[97]||(e[97]=[ae("Guardar",-1)])]),_:1},8,["onClick","loading","disabled"])]),x("div",_o,[y(d,{modelValue:Ae.value,"onUpdate:modelValue":e[2]||(e[2]=s=>Ae.value=s),label:"Nombre",required:""},null,8,["modelValue"]),x("div",null,[y(d,{modelValue:ga.value,"onUpdate:modelValue":e[3]||(e[3]=s=>ga.value=s),label:"Readiness (%)",type:"number",readonly:"",hint:"Calculado automáticamente por el sistema basado en evaluaciones y niveles","persistent-hint":""},null,8,["modelValue"])]),y(g,{modelValue:it.value,"onUpdate:modelValue":e[4]||(e[4]=s=>it.value=s),label:"Descripción",rows:"3",style:{"grid-column":`1 /
                                                                    -1`}},null,8,["modelValue"]),e[98]||(e[98]=x("div",{style:{"grid-column":`1 /
                                                                    -1`,"font-weight":"700","margin-top":"6px"}}," Atributos de la relación con la capacidad ",-1)),x("div",null,[y(f,{modelValue:ha.value,"onUpdate:modelValue":e[5]||(e[5]=s=>ha.value=s),label:"Strategic weight (1-10)",min:1,max:10,step:1,color:"primary",ticks:q,"show-ticks":"always"},null,8,["modelValue","ticks"])]),x("div",null,[y(f,{modelValue:ba.value,"onUpdate:modelValue":e[6]||(e[6]=s=>ba.value=s),label:"Priority (1-5)",min:1,max:5,step:1,color:"orange",ticks:O,"show-ticks":"always"},null,8,["modelValue","ticks"])]),x("div",null,[y(f,{modelValue:wa.value,"onUpdate:modelValue":e[7]||(e[7]=s=>wa.value=s),label:"Required level (1-5)",min:1,max:5,step:1,color:"teal",ticks:le,"show-ticks":"always"},null,8,["modelValue","ticks"])]),y(w,{modelValue:xa.value,"onUpdate:modelValue":e[8]||(e[8]=s=>xa.value=s),label:"Is critical"},null,8,["modelValue"]),y(g,{modelValue:Oa.value,"onUpdate:modelValue":e[9]||(e[9]=s=>Oa.value=s),label:"Rationale",rows:"2",style:{"grid-column":`1 /
                                                                    -1`}},null,8,["modelValue"])])]),_:1},512)])])):(z(),te("div",No,[x("div",Eo,[y(r,{small:"",color:"primary",onClick:oi},{default:D(()=>[...e[99]||(e[99]=[ae("Crear competencia",-1)])]),_:1},8,["onClick"]),y(r,{small:"",color:"primary",onClick:si},{default:D(()=>[...e[100]||(e[100]=[ae("Agregar existente",-1)])]),_:1},8,["onClick"]),y(r,{color:"error",onClick:Pl,loading:He.value},{default:D(()=>[...e[101]||(e[101]=[ae("Eliminar nodo",-1)])]),_:1},8,["loading"]),y(r,{color:"primary",onClick:li,loading:He.value,disabled:He.value||Fl.value},{default:D(()=>[...e[102]||(e[102]=[ae("Guardar",-1)])]),_:1},8,["loading","disabled"]),y(r,{text:"",color:"primary",onClick:el},{default:D(()=>[...e[103]||(e[103]=[ae("Cancelar",-1)])]),_:1})]),x("div",Vo,[y(R,{ref_key:"capForm",ref:ml,onSubmit:e[22]||(e[22]=Ye(()=>{},["prevent"]))},{default:D(()=>[x("div",Io,[y(d,{modelValue:ot.value,"onUpdate:modelValue":e[11]||(e[11]=s=>ot.value=s),label:"Nombre",required:""},null,8,["modelValue"]),x("div",null,[y(f,{modelValue:et.value,"onUpdate:modelValue":e[12]||(e[12]=s=>et.value=s),label:"Importancia",min:1,max:3,step:1,color:"primary",ticks:T,"show-ticks":"always"},null,8,["modelValue","ticks"])]),y(V,{modelValue:Pe.value,"onUpdate:modelValue":e[13]||(e[13]=s=>Pe.value=s),items:["technical","behavioral","strategic"],label:"Tipo"},null,8,["modelValue"]),y(V,{modelValue:De.value,"onUpdate:modelValue":e[14]||(e[14]=s=>De.value=s),items:["technical","leadership","business","operational"],label:"Categoría"},null,8,["modelValue"]),y(g,{modelValue:rt.value,"onUpdate:modelValue":e[15]||(e[15]=s=>rt.value=s),label:"Descripción",rows:"3",style:{"grid-column":`1 /
                                                                    -1`}},null,8,["modelValue"]),e[104]||(e[104]=x("div",{style:{"grid-column":`1 /
                                                                    -1`,"font-weight":"700","margin-top":"6px"}}," Atributos para el escenario (scenario_capabilities) ",-1)),y(V,{modelValue:$t.value,"onUpdate:modelValue":e[16]||(e[16]=s=>$t.value=s),items:xe.value,label:"Strategic role"},null,8,["modelValue","items"]),x("div",null,[y(f,{modelValue:ht.value,"onUpdate:modelValue":e[17]||(e[17]=s=>ht.value=s),label:"Strategic weight",min:1,max:10,step:1,color:"primary",ticks:q,"show-ticks":"always"},null,8,["modelValue","ticks"])]),x("div",null,[y(f,{modelValue:bt.value,"onUpdate:modelValue":e[18]||(e[18]=s=>bt.value=s),label:"Priority (1-5)",min:1,max:5,step:1,color:"orange",ticks:O,"show-ticks":"always"},null,8,["modelValue","ticks"])]),x("div",null,[y(f,{modelValue:wt.value,"onUpdate:modelValue":e[19]||(e[19]=s=>wt.value=s),label:"Required level (1-5)",min:1,max:5,step:1,color:"teal",ticks:le,"show-ticks":"always"},null,8,["modelValue","ticks"])]),y(B,{modelValue:Rt.value,"onUpdate:modelValue":e[20]||(e[20]=s=>Rt.value=s),label:"Is critical"},null,8,["modelValue"]),y(g,{modelValue:Ot.value,"onUpdate:modelValue":e[21]||(e[21]=s=>Ot.value=s),label:"Rationale",rows:"2",style:{"grid-column":`1 /
                                                                    -1`}},null,8,["modelValue"])])]),_:1},512)])]))])],64)):(z(),te("div",Po,[e[111]||(e[111]=x("div",{style:{"font-weight":"700"}}," Escenario ",-1)),x("div",null,[e[105]||(e[105]=x("strong",null,"Nombre:",-1)),ae(" "+he(b.scenario?.name??"—"),1)]),x("div",null,[e[106]||(e[106]=x("strong",null,"ID:",-1)),ae(" "+he(b.scenario?.id??"—"),1)]),x("div",null,[e[107]||(e[107]=x("strong",null,"Descripción:",-1)),ae(" "+he(b.scenario?.description??"—"),1)]),x("div",Do,[e[108]||(e[108]=x("strong",null,"Estado:",-1)),ae(" "+he(b.scenario?.status??"—")+" • ",1),e[109]||(e[109]=x("strong",null,"Año fiscal:",-1)),ae(" "+he(b.scenario?.fiscal_year??"—"),1)]),x("div",$o,[y(r,{small:"",color:"secondary",onClick:e[23]||(e[23]=s=>va.value=!va.value)},{default:D(()=>[ae(he(va.value?"Ocultar JSON":"Ver JSON crudo"),1)]),_:1}),y(r,{small:"",text:"",onClick:e[24]||(e[24]=()=>{p(b.scenario?.id)})},{default:D(()=>[...e[110]||(e[110]=[ae("Refrescar árbol",-1)])]),_:1})]),va.value?(z(),te("div",Oo,[x("pre",Ro,he(gt.value?JSON.stringify(gt.value,null,2):'No hay datos cargados. Pulsa "Refrescar árbol".'),1)])):Qt("",!0)]))]),_:1}),y(ee,null,{default:D(()=>[y(I),y(r,{text:"",onClick:e[25]||(e[25]=s=>Be.value=!1)},{default:D(()=>[...e[112]||(e[112]=[ae("Cerrar",-1)])]),_:1})]),_:1})]),_:1},8,["class"])]),_:1},8,["modelValue","aria-label"]),y(pe,{modelValue:xt.value,"onUpdate:modelValue":e[33]||(e[33]=s=>xt.value=s),"max-width":"640",transition:"scale-transition"},{default:D(()=>[y(se,{class:It(sa.value)},{default:D(()=>[y(c,null,{default:D(()=>[...e[113]||(e[113]=[ae("Crear competencia",-1)])]),_:1}),y(ne,null,{default:D(()=>[y(R,{onSubmit:e[31]||(e[31]=Ye(()=>{},["prevent"]))},{default:D(()=>[y(d,{modelValue:We.value,"onUpdate:modelValue":e[27]||(e[27]=s=>We.value=s),label:"Nombre",required:""},null,8,["modelValue"]),y(g,{modelValue:ea.value,"onUpdate:modelValue":e[28]||(e[28]=s=>ea.value=s),label:"Descripción",rows:"3"},null,8,["modelValue"]),y(d,{modelValue:ya.value,"onUpdate:modelValue":e[29]||(e[29]=s=>ya.value=s),label:"Readiness",type:"number"},null,8,["modelValue"]),y(g,{modelValue:tt.value,"onUpdate:modelValue":e[30]||(e[30]=s=>tt.value=s),label:"Skills (coma-separadas)",rows:"2"},null,8,["modelValue"])]),_:1})]),_:1}),y(ee,null,{default:D(()=>[y(I),y(r,{text:"",onClick:e[32]||(e[32]=s=>xt.value=!1)},{default:D(()=>[...e[114]||(e[114]=[ae("Cancelar",-1)])]),_:1}),y(r,{color:"primary",loading:Tt.value,onClick:gi},{default:D(()=>[...e[115]||(e[115]=[ae("Crear y asociar",-1)])]),_:1},8,["loading"])]),_:1})]),_:1},8,["class"])]),_:1},8,["modelValue"]),y(pe,{modelValue:Lt.value,"onUpdate:modelValue":e[40]||(e[40]=s=>Lt.value=s),"max-width":"640",transition:"scale-transition"},{default:D(()=>[y(se,{class:It(sa.value)},{default:D(()=>[y(c,null,{default:D(()=>[...e[116]||(e[116]=[ae("Crear nueva skill",-1)])]),_:1}),y(ne,null,{default:D(()=>[ia.value?(z(),Bl(Ce,{key:0,type:"success",closable:"",class:"mb-4","onClick:close":e[34]||(e[34]=s=>ia.value=null)},{default:D(()=>[ae(he(ia.value),1)]),_:1})):Qt("",!0),la.value?(z(),Bl(Ce,{key:1,type:"error",closable:"",class:"mb-4","onClick:close":e[35]||(e[35]=s=>la.value=null)},{default:D(()=>[ae(he(la.value),1)]),_:1})):Qt("",!0),y(R,{"data-skill-form":""},{default:D(()=>[y(d,{modelValue:ze.value,"onUpdate:modelValue":e[36]||(e[36]=s=>ze.value=s),label:"Nombre",required:""},null,8,["modelValue"]),y(d,{modelValue:At.value,"onUpdate:modelValue":e[37]||(e[37]=s=>At.value=s),label:"Categoría"},null,8,["modelValue"]),y(g,{modelValue:_t.value,"onUpdate:modelValue":e[38]||(e[38]=s=>_t.value=s),label:"Descripción",rows:"3"},null,8,["modelValue"])]),_:1})]),_:1}),y(ee,null,{default:D(()=>[y(I),y(r,{text:"",onClick:e[39]||(e[39]=s=>Lt.value=!1)},{default:D(()=>[...e[117]||(e[117]=[ae("Cerrar",-1)])]),_:1}),y(r,{color:"primary",loading:Ea.value,onClick:dl},{default:D(()=>[...e[118]||(e[118]=[ae("Crear y asociar",-1)])]),_:1},8,["loading"])]),_:1})]),_:1},8,["class"])]),_:1},8,["modelValue"]),y(pe,{modelValue:aa.value,"onUpdate:modelValue":e[43]||(e[43]=s=>aa.value=s),"max-width":"720",transition:"scale-transition"},{default:D(()=>[y(se,{class:It(sa.value)},{default:D(()=>[y(c,null,{default:D(()=>[...e[119]||(e[119]=[ae("Seleccionar skill existente",-1)])]),_:1}),y(ne,null,{default:D(()=>[y(V,{items:nt.value,"item-title":"name","item-value":"id",modelValue:qt.value,"onUpdate:modelValue":e[41]||(e[41]=s=>qt.value=s),label:"Skill"},null,8,["items","modelValue"]),nt.value.length===0?(z(),te("div",To," No se encontraron skills. ")):Qt("",!0)]),_:1}),y(ee,null,{default:D(()=>[y(I),y(r,{text:"",onClick:e[42]||(e[42]=s=>aa.value=!1)},{default:D(()=>[...e[120]||(e[120]=[ae("Cancelar",-1)])]),_:1}),y(r,{color:"primary",loading:Va.value,onClick:lt},{default:D(()=>[...e[121]||(e[121]=[ae("Asociar",-1)])]),_:1},8,["loading"])]),_:1})]),_:1},8,["class"])]),_:1},8,["modelValue"]),y(pe,{modelValue:Ct.value,"onUpdate:modelValue":e[57]||(e[57]=s=>Ct.value=s),"max-width":"720",transition:"scale-transition"},{default:D(()=>[y(se,{class:It(sa.value)},{default:D(()=>[y(c,null,{default:D(()=>[...e[122]||(e[122]=[ae("Detalle de la skill",-1)])]),_:1}),y(ne,null,{default:D(()=>[$e.value?(z(),te("div",Lo,[x("div",Fo,[y(r,{text:"",onClick:e[44]||(e[44]=s=>Ct.value=!1)},{default:D(()=>[...e[123]||(e[123]=[ae("Cancelar",-1)])]),_:1}),y(r,{color:"primary",loading:Mt.value,onClick:Gl},{default:D(()=>[...e[124]||(e[124]=[ae("Guardar",-1)])]),_:1},8,["loading"]),y(r,{color:"error",loading:Mt.value,onClick:e[45]||(e[45]=s=>na($e.value))},{default:D(()=>[...e[125]||(e[125]=[ae("Borrar",-1)])]),_:1},8,["loading"])]),x("div",Go,[y(d,{modelValue:Ft.value,"onUpdate:modelValue":e[46]||(e[46]=s=>Ft.value=s),label:"Nombre",required:""},null,8,["modelValue"]),y(V,{modelValue:Gt.value,"onUpdate:modelValue":e[47]||(e[47]=s=>Gt.value=s),items:["technical","behavioral","domain"],label:"Categoría"},null,8,["modelValue"]),y(V,{modelValue:Ut.value,"onUpdate:modelValue":e[48]||(e[48]=s=>Ut.value=s),items:["basic","tactical","strategic"],label:"Nivel de complejidad"},null,8,["modelValue"]),y(d,{modelValue:ra.value,"onUpdate:modelValue":e[49]||(e[49]=s=>ra.value=s),label:"Tag de dominio"},null,8,["modelValue"]),y(V,{modelValue:Yt.value,"onUpdate:modelValue":e[50]||(e[50]=s=>Yt.value=s),items:["domain","global","local"],label:"Scope"},null,8,["modelValue"]),y(g,{modelValue:oa.value,"onUpdate:modelValue":e[51]||(e[51]=s=>oa.value=s),label:"Descripción",rows:"3",style:{"grid-column":"1 / -1"}},null,8,["modelValue"])]),C.value&&S.value?(z(),te("div",Uo,[e[126]||(e[126]=x("div",{style:{"font-weight":"700","margin-bottom":"6px"}}," Atributos de la relación con la competencia ",-1)),x("div",null,[y(f,{modelValue:Te.value,"onUpdate:modelValue":e[52]||(e[52]=s=>Te.value=s),label:"Peso estratégico (1-10)",min:1,max:10,step:1,color:"primary",ticks:q,"show-ticks":"always"},null,8,["modelValue"])]),x("div",Yo,[x("div",null,[y(f,{modelValue:at.value,"onUpdate:modelValue":e[53]||(e[53]=s=>at.value=s),label:"Prioridad (1-5)",min:1,max:5,step:1,color:"orange",ticks:O,"show-ticks":"always"},null,8,["modelValue"])]),x("div",null,[y(f,{modelValue:St.value,"onUpdate:modelValue":e[54]||(e[54]=s=>St.value=s),label:"Nivel requerido (1-5)",min:1,max:5,step:1,color:"teal",ticks:le,"show-ticks":"always"},null,8,["modelValue"])]),x("div",null,[y(B,{modelValue:Xt.value,"onUpdate:modelValue":e[55]||(e[55]=s=>Xt.value=s),color:"success",label:"Es crítica"},null,8,["modelValue"]),y(g,{modelValue:st.value,"onUpdate:modelValue":e[56]||(e[56]=s=>st.value=s),label:"Justificación",rows:"2",style:{"grid-column":"1 / -1"}},null,8,["modelValue"])])])])):Qt("",!0)])):(z(),te("div",Xo,"No hay información de la skill."))]),_:1}),y(ee,null,{default:D(()=>[y(I)]),_:1})]),_:1},8,["class"])]),_:1},8,["modelValue"]),y(pe,{modelValue:kt.value,"onUpdate:modelValue":e[60]||(e[60]=s=>kt.value=s),"max-width":"640",transition:"scale-transition"},{default:D(()=>[y(se,{class:It(sa.value)},{default:D(()=>[y(c,null,{default:D(()=>[...e[127]||(e[127]=[ae("Agregar competencia existente",-1)])]),_:1}),y(ne,null,{default:D(()=>[y(V,{items:ma.value,"item-title":"name","item-value":"id",modelValue:ta.value,"onUpdate:modelValue":e[58]||(e[58]=s=>ta.value=s),label:"Competencia"},null,8,["items","modelValue"])]),_:1}),y(ee,null,{default:D(()=>[y(I),y(r,{text:"",onClick:e[59]||(e[59]=s=>kt.value=!1)},{default:D(()=>[...e[128]||(e[128]=[ae("Cancelar",-1)])]),_:1}),y(r,{color:"primary",onClick:hi},{default:D(()=>[...e[129]||(e[129]=[ae("Agregar",-1)])]),_:1})]),_:1})]),_:1},8,["class"])]),_:1},8,["modelValue"]),y(pe,{modelValue:v.value,"onUpdate:modelValue":e[73]||(e[73]=s=>v.value=s),"max-width":"720",transition:"scale-transition"},{default:D(()=>[y(se,{class:It(sa.value)},{default:D(()=>[y(c,null,{default:D(()=>[...e[130]||(e[130]=[ae("Crear capacidad",-1)])]),_:1}),y(ne,null,{default:D(()=>[x("div",qo,[y(d,{modelValue:k.value,"onUpdate:modelValue":e[61]||(e[61]=s=>k.value=s),label:"NombreXX",required:""},null,8,["modelValue"]),y(V,{modelValue:h.value,"onUpdate:modelValue":e[62]||(e[62]=s=>h.value=s),items:["technical","behavioral","strategic"],label:"Tipo"},null,8,["modelValue"]),y(V,{modelValue:u.value,"onUpdate:modelValue":e[63]||(e[63]=s=>u.value=s),items:["technical","leadership","business","operational"],label:"Categoría"},null,8,["modelValue"]),x("div",null,[y(f,{modelValue:M.value,"onUpdate:modelValue":e[64]||(e[64]=s=>M.value=s),label:"Importancia (1-3):",min:1,max:3,step:1,color:"green",ticks:T,"show-ticks":"always"},null,8,["modelValue"])]),y(g,{modelValue:m.value,"onUpdate:modelValue":e[65]||(e[65]=s=>m.value=s),label:"Descripción",rows:"3",style:{"grid-column":"1 / -1"}},null,8,["modelValue"])]),x("div",Bo,[e[131]||(e[131]=x("div",{style:{"font-weight":"700","margin-bottom":"6px"}}," Atributos para el escenario (scenario_capabilities) ",-1)),x("div",Ho,[y(V,{modelValue:U.value,"onUpdate:modelValue":e[66]||(e[66]=s=>U.value=s),items:xe.value,label:"Strategic role"},null,8,["modelValue","items"]),x("div",null,[y(f,{modelValue:oe.value,"onUpdate:modelValue":e[67]||(e[67]=s=>oe.value=s),label:"Strategic weight (1-10)",min:1,max:10,step:1,color:"primary"},null,8,["modelValue"]),x("div",zo," Valor: "+he(oe.value??"-"),1)]),x("div",null,[y(f,{modelValue:me.value,"onUpdate:modelValue":e[68]||(e[68]=s=>me.value=s),label:"Priority (1-5)",min:1,max:5,step:1,color:"orange"},null,8,["modelValue"]),x("div",jo," Valor: "+he(me.value??"-"),1)]),x("div",null,[y(f,{modelValue:Ne.value,"onUpdate:modelValue":e[69]||(e[69]=s=>Ne.value=s),label:"Required level (1-5)",min:1,max:5,step:1,color:"teal"},null,8,["modelValue"]),x("div",Wo," Valor: "+he(Ne.value??"-"),1)]),y(w,{modelValue:Ie.value,"onUpdate:modelValue":e[70]||(e[70]=s=>Ie.value=s),label:"Is critical"},null,8,["modelValue"]),y(g,{modelValue:Fe.value,"onUpdate:modelValue":e[71]||(e[71]=s=>Fe.value=s),label:"Rationale",rows:"2",style:{"grid-column":"1 / -1"}},null,8,["modelValue"])])])]),_:1}),y(ee,null,{default:D(()=>[y(I),y(r,{text:"",onClick:e[72]||(e[72]=s=>v.value=!1)},{default:D(()=>[...e[132]||(e[132]=[ae("Cancelar",-1)])]),_:1}),y(r,{color:"primary",loading:Qe.value,onClick:ci},{default:D(()=>[...e[133]||(e[133]=[ae("Guardar",-1)])]),_:1},8,["loading"])]),_:1})]),_:1},8,["class"])]),_:1},8,["modelValue"]),$.value.length===0?(z(),te("div",Ko," No hay capacidades para mostrar. ")):Qt("",!0)])):(z(),te("div",Ri,"Cargando mapa..."))],2)])}}}),or=Si(er,[["__scopeId","data-v-01b4f566"]]);export{or as default};
