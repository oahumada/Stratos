import{d as Se,r as p,b as c,f as te,w as o,e as s,j as m,t as v,c as d,g as r,F as ae,q as ne,v as V,m as Re,o as Ze,k as y,l as U,u,i as C,O as xe,P as et,s as tt}from"./app-B4Q7DtOZ.js";import{u as at,n as H}from"./FieldHelp-CfAKUl3b.js";import nt from"./PreviewConfirm-BUvksGLW.js";import{_ as st}from"./StepHorizon.vue_vue_type_script_setup_true_lang-DHmQkcQl.js";import ot from"./StepIdentity-DIuH8JJK.js";import{_ as rt}from"./StepIntent.vue_vue_type_script_setup_true_lang-B4u9Ekjf.js";import{_ as lt}from"./StepResources.vue_vue_type_script_setup_true_lang-Ch7d6lwL.js";import{_ as it}from"./StepSituation.vue_vue_type_script_setup_true_lang-NxYaDh5q.js";const ct={key:0},ut={key:1},dt=Se({__name:"ErrorModal",props:{modelValue:{type:Boolean,default:!1},title:{type:String,default:"Errores"},messages:{type:Array,default:()=>[]}},emits:["update:modelValue"],setup(L,{emit:t}){const se=L,oe=t,E=V({get:()=>se.modelValue,set:K=>oe("update:modelValue",K)});function D(){E.value=!1}return(K,O)=>{const re=p("v-card-title"),N=p("v-card-text"),Q=p("v-spacer"),le=p("v-btn"),X=p("v-card-actions"),ie=p("v-card"),ce=p("v-dialog");return c(),te(ce,{modelValue:E.value,"onUpdate:modelValue":O[0]||(O[0]=G=>E.value=G),"max-width":"600"},{default:o(()=>[s(ie,null,{default:o(()=>[s(re,null,{default:o(()=>[m(v(L.title),1)]),_:1}),s(N,null,{default:o(()=>[L.messages&&L.messages.length?(c(),d("div",ct,[r("ul",null,[(c(!0),d(ae,null,ne(L.messages,(G,ue)=>(c(),d("li",{key:ue},v(G),1))),128))])])):(c(),d("div",ut,[...O[1]||(O[1]=[r("p",null,"No hay detalles adicionales.",-1)])]))]),_:1}),s(X,null,{default:o(()=>[s(Q),s(le,{text:"",color:"primary",onClick:D},{default:o(()=>[...O[2]||(O[2]=[m("Cerrar",-1)])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])}}}),pt=Re(dt,[["__scopeId","data-v-d76618b4"]]),mt={class:"generate-wizard"},vt={class:"progress-label"},gt={class:"font-weight-medium"},ft={style:{"margin-top":"6px"}},_t={key:0,style:{color:"var(--v-theme-error)","font-weight":"600","margin-bottom":"6px"}},yt={style:{margin:"0.25rem 0 0","padding-left":"1rem"}},bt={key:0},ht={class:"mt-2"},wt={key:0},kt={class:"d-flex align-center justify-space-between mb-2"},Ct={class:"caption d-flex align-center"},At={class:"d-flex align-center"},xt={key:0,class:"mb-3"},St={key:1,class:"instruction-error-text caption"},Rt={class:"d-flex align-center mt-2"},Vt={class:"wizard-controls d-flex mt-4"},It={key:1,class:"generation-status"},Pt={style:{"margin-top":"8px"}},Et=["disabled"],Mt={key:0},Ft={key:0,class:"d-flex align-center",style:{"min-height":"120px"}},Ot={key:0,class:"caption"},Nt={key:0},$t={key:1},jt={key:0,class:"mb-2"},zt={class:"mt-2"},Lt={key:1,class:"mb-2"},Dt={style:{"max-height":"400px",overflow:"auto",background:"#f6f6f6",padding:"8px"}},Gt={key:2,class:"mb-3"},Jt={class:"subtitle-2",style:{color:"var(--v-theme-error)","font-weight":"600"}},Ut={style:{"margin-top":"6px","padding-left":"1rem",color:"var(--v-theme-error)"}},qt={key:2,class:"preview-modal-backdrop"},Bt={class:"preview-modal"},Tt=Se({__name:"GenerateWizard",setup(L){const t=at(),se={1:ot,2:it,3:rt,4:lt,5:st},oe=V(()=>se[t.step]);Ze(()=>{Y(x.value)});const E=["company_name","industry","company_size","current_challenges","current_capabilities","strategic_goal","key_initiatives","time_horizon"],D=[...E,"current_gaps","budget_level","talent_availability","milestones"],K=E.length*2+(D.length-E.length)*1,O=V(()=>{const a=t.data;let e=0;return D.forEach(n=>{a[n]&&(e+=E.includes(n)?2:1)}),e}),re=V(()=>{const a=t.data;return D.reduce((e,n)=>a[n]?e+1:e,0)}),N=V(()=>Math.round(O.value/K*100)),Q=V(()=>N.value<40?"error":N.value<80?"warning":"success"),le={1:["company_name","industry","company_size"],2:["current_challenges","current_capabilities","current_gaps"],3:["strategic_goal","key_initiatives"],4:["budget_level","talent_availability"],5:["time_horizon","milestones"]},X=V(()=>{const a=le[t.step]||[],e=t.data;return a.filter(n=>E.includes(n)&&!e[n]).length}),ie=V(()=>N.value<40?"Insuficiente":N.value<80?"Parcial":"Completado"),ce=a=>{const e=t.data,n=[];switch(a){case 1:e.company_name||n.push("Nombre de la organización"),e.industry||n.push("Industria"),e.company_size||n.push("Tamaño (personas)");break;case 2:e.current_challenges||n.push("Desafíos"),e.current_capabilities||n.push("Capacidades existentes"),e.current_gaps||n.push("Brechas");break;case 3:e.strategic_goal||n.push("Objetivo principal"),e.key_initiatives||n.push("Iniciativas clave");break;case 4:e.budget_level||n.push("Nivel de presupuesto"),e.talent_availability||n.push("Disponibilidad de talento");break;case 5:e.time_horizon||n.push("Plazo"),e.milestones||n.push("Hitos");break}return n},G=V(()=>ce(t.step));function ue(){t.next()}function Ve(){t.prev()}const q=y(!1),x=y("es"),de=y(!1),fe=y(""),_e=y([]);function b(a,e="Error"){fe.value=e,_e.value=Array.isArray(a)?a:[a],de.value=!0}const w=y(""),k=y(!1),M=y(!1),j=y([]),I=y(null),P=y("db");function Ie(a){if(!a)return!1;const e=a.toLowerCase();return e.includes("formato: markdown")||e.includes("format: markdown")||e.includes("markdown.")||e.includes(`
markdown`)}function pe(){return P.value==="client"&&w.value&&Ie(w.value)?{valid:!1,message:"La instrucción contiene indicaciones para formato Markdown. Cambie la instrucción a salida JSON única, o seleccione una instrucción de la base de datos."}:{valid:!0}}const me=V(()=>pe());async function Y(a="es"){M.value=!0;try{const n=(await U.get("/api/strategic-planning/scenarios/instructions",{params:{language:a}})).data.data||[];j.value=n,n.length?(I.value=0,w.value=n[0].content||"",k.value=!!n[0].editable,x.value=n[0].language||a,P.value="db"):(j.value=[],I.value=null,w.value="",k.value=!1,x.value=a,P.value="client")}catch(e){console.error("Failed loading instruction",e)}finally{M.value=!1}}function Pe(a){if(I.value=a,a===null){P.value="client",k.value=!0;return}const e=j.value[a];w.value=e?.content||"",k.value=!!e?.editable,P.value="db"}async function Ee(){M.value=!0;try{const a={language:x.value,content:w.value,editable:!!k.value},e=await U.post("/api/strategic-planning/scenarios/instructions",a);e.data&&e.data.success&&await Y(x.value)}catch(a){console.error("Save instruction failed",a),b("No se pudo guardar la instrucción: "+(a?.response?.data?.message||a?.message))}finally{M.value=!1}}async function Me(){if(confirm("¿Restablecer la instrucción por defecto? Esto creará una nueva versión editable con el contenido por defecto.")){M.value=!0;try{const a=await U.post("/api/strategic-planning/scenarios/instructions/restore-default",{language:x.value});a.data&&a.data.success?await Y(x.value):b("No se pudo restaurar la instrucción por defecto")}catch(a){console.error("Restore default failed",a),b(a?.response?.data?.message||a?.message||"Error al restaurar por defecto")}finally{M.value=!1}}}async function Fe(){try{const a=await t.validate();if(!a.valid){b(a.errors,"Faltan campos críticos");return}const e=pe();if(!e.valid){b(e.message||"Instrucción incompatible","Instrucción incompatible"),k.value=!0;return}if(P.value==="client"&&w.value)t.setField("instruction",w.value),t.setField("instruction_id",null);else if(P.value==="db"&&I.value!==null){const l=j.value[I.value]?.id??null;t.setField("instruction",null),t.setField("instruction_id",l)}else t.setField("instruction",null),t.setField("instruction_id",null);t.setField("instruction_language",x.value),await t.preview(),q.value=!0}catch(a){const e=a;if(console.error("Preview failed",a),e?.response?.status===422){const l=e.response.data||{},f=l.errors?Object.entries(l.errors).map(([_,g])=>`${_}: ${Array.isArray(g)?g.join(", "):g}`):[l.message||JSON.stringify(l)];k.value=!0,b(f,"Validación de instrucción (422)");return}const n=ye(a);b(n.split(`
`),"Error al generar preview")}}async function Oe(a=!1){q.value=!1;try{const e=await t.validate();if(!e.valid){b(e.errors,"Faltan campos críticos");return}const n=pe();if(!n.valid){b(n.message||"Instrucción incompatible","Instrucción incompatible"),k.value=!0;return}if(t.importAfterAccept=!!a,P.value==="client"&&w.value)t.setField("instruction",w.value),t.setField("instruction_id",null);else if(P.value==="db"&&I.value!==null){const R=j.value[I.value]?.id??null;t.setField("instruction",null),t.setField("instruction_id",R)}else t.setField("instruction",null),t.setField("instruction_id",null);await t.generate();try{await t.fetchStatus()}catch{}const l=Date.now(),f=6e5;let _=null;try{const g=await t.fetchProgress();_=g?.progress?.received_chunks??(Array.isArray(g?.recent_chunks)?g.recent_chunks.length:_)}catch{}for(;t.generationStatus!=="complete"&&Date.now()-l<f;){await new Promise(g=>setTimeout(g,2e3));try{await t.fetchProgress(),await t.fetchStatus();const R=t.generationProgress?.progress?.received_chunks??(t.recentChunks?t.recentChunks.length:null);R!==null&&_!==null&&R>_&&(_=R)}catch{}}t.generationStatus==="complete"?(await t.fetchStatus(),$.value=!0):b("Generación encolada. Verifique el estado en la sección de generación.","Encolada")}catch(e){const n=e;if(console.error("Generate failed",e),n?.response?.status===422){const f=n.response.data||{},_=f.errors?Object.entries(f.errors).map(([g,R])=>`${g}: ${Array.isArray(R)?R.join(", "):R}`):[f.message||JSON.stringify(f)];k.value=!0,b(_,"Validación de instrucción (422)");return}const l=ye(e);b(l.split(`
`),"Error al generar escenario")}}function ye(a){if(!a)return"Unknown error";if(a.response&&a.response.data){const e=a.response.data;return e.errors?Object.entries(e.errors).map(([n,l])=>`${n}: ${Array.isArray(l)?l.join(", "):l}`).join(`
`):e.message||JSON.stringify(e)}return a.message||String(a)}function Ne(){q.value=!1,t.step=1}const z=y(!1),B=y(null),ve=y("");async function $e(){if(t.generationId){z.value=!0;try{const a=await t.accept(t.generationId),e=a?.data?.scenario_id||a?.data?.id||a?.data&&a.data.id;if(e){window.location.href=`/scenario-planning/${e}`;return}window.location.reload()}catch(a){console.error("Accept failed",a);const e=a;b(e?.response?.data?.message||e?.message||String(a),"Error al aceptar generación")}finally{z.value=!1}}}const $=y(!1);let T=null;const S=y(!1),h=y(null),be=V(()=>{if(h.value!==null)return h.value;try{const a=t.recentChunks?t.recentChunks.length:0;return a>0?a:null}catch{return null}}),je=()=>{const a=t.generationResult;if(!a)return!1;const e=typeof a.content=="string"&&a.content.trim().length>0,n=a.scenario_metadata&&Object.keys(a.scenario_metadata).length>0&&(a.scenario_metadata.name||a.scenario_metadata.description),l=Array.isArray(a.capabilities)&&a.capabilities.length>0;return e||n||l};function ze(){$.value=!0,Ce()}async function he(a=!1){if(t.generationId){t.importAfterAccept=!!a,B.value=null,ve.value="",z.value=!0;try{const e=await t.accept(t.generationId),n=e?.data?.scenario_id||e?.data?.id||e?.data&&e.data.id;if(n){window.location.href=`/scenario-planning/${n}`;return}window.location.reload()}catch(e){const n=e;if(n?.response?.status===422){const l=n.response.data||{},f=l.errors?Object.entries(l.errors).map(([_,g])=>`${_}: ${Array.isArray(g)?g.join(", "):g}`):[l.message||JSON.stringify(l)];ve.value="Validación del servidor (422)",B.value=f,$.value=!0,k.value=!0;return}console.error("Accept failed",e),b(n?.response?.data?.message||n?.message||String(e),"Error al aceptar generación")}finally{z.value=!1}}}function we(){$.value=!1,ke()}async function Le(){S.value=!0;try{await F("generation.regenerate",{reason:"operator_clicked"}),await t.generate();try{await t.fetchStatus()}catch{}await Z(),Ce()}catch(a){console.error("Regenerate failed",a),b(a?.response?.data?.message||a?.message||String(a),"Error al regenerar")}finally{S.value=!1}}function ke(){S.value=!1,T&&(clearInterval(T),T=null)}async function Ce(){if(T)return;S.value=!0;try{await t.fetchStatus(),await Z()}catch{}if(h.value===null&&t.generationResult&&t.generationResult.content&&(h.value=1),(h.value||0)>0&&(function(){const e=t.generationResult;if(!e)return!0;const n=typeof e.content=="string"&&e.content.trim().length>0,l=e.scenario_metadata&&Object.keys(e.scenario_metadata).length>0,f=Array.isArray(e.capabilities)&&e.capabilities.length>0;return!(n||l||f)})()&&(await F("generation.assemble_attempt",{phase:"initial"}),await ee()),t.generationStatus==="complete"){S.value=!1,(h.value||0)>0&&(function(){const n=t.generationResult;if(!n)return!0;const l=typeof n.content=="string"&&n.content.trim().length>0,f=n.scenario_metadata&&Object.keys(n.scenario_metadata).length>0,_=Array.isArray(n.capabilities)&&n.capabilities.length>0;return!(l||f||_)})()&&(await F("generation.assemble_attempt",{phase:"complete"}),await ee()),$.value=!0;return}T=setInterval(async()=>{try{await t.fetchStatus(),await Z(),(h.value||0)>0&&(function(){const n=t.generationResult;if(!n)return!0;const l=typeof n.content=="string"&&n.content.trim().length>0,f=n.scenario_metadata&&Object.keys(n.scenario_metadata).length>0,_=Array.isArray(n.capabilities)&&n.capabilities.length>0;return!(l||f||_)})()&&(await F("generation.assemble_attempt",{phase:"interval"}),await ee()),t.generationStatus==="complete"&&(ke(),$.value=!0)}catch{}},2e3)}async function Z(){try{if(!t.generationId){h.value=null;return}const a=await t.fetchProgress();a&&(a.progress&&typeof a.progress.received_chunks=="number"?h.value=a.progress.received_chunks:Array.isArray(a.recent_chunks)?h.value=a.recent_chunks.length:h.value=null)}catch{h.value=null}}async function F(a,e={}){try{const n={event:a,properties:{generationId:t.generationId,chunkCount:h.value,...e}};await U.post("/api/telemetry/event",n),console.debug("analytics sent",n)}catch(n){console.debug("analytics failed",n)}}async function ee(){try{if(!t.generationId)return null;try{const e=await U.get(`/api/strategic-planning/scenarios/generate/${t.generationId}/compacted`);if(e.data&&e.data.success){const n=e.data.data;if(Array.isArray(n)||typeof n=="object"&&n!==null)return t.generationResult=H(n),await F("generation.assemble_success",{method:"compacted_obj"}),t.generationResult;if(typeof n=="string")try{const l=JSON.parse(n);return t.generationResult=H(l),await F("generation.assemble_success",{method:"compacted_json"}),t.generationResult}catch{return t.generationResult=H({content:n}),await F("generation.assemble_success",{method:"compacted_raw"}),t.generationResult}}}catch{}const a=await U.get(`/api/strategic-planning/scenarios/generate/${t.generationId}/chunks`);if(a.data&&Array.isArray(a.data.data)&&a.data.data.length){h.value=a.data.data.length;const e=a.data.data.slice().sort((n,l)=>(n.sequence||0)-(l.sequence||0)).map(n=>n.chunk||"").join("");try{const n=JSON.parse(e);return t.generationResult=H(n),await F("generation.assemble_success",{method:"chunks",count:a.data.data.length}),t.generationResult}catch{return t.generationResult=H({content:e}),await F("generation.assemble_success",{method:"chunks_raw",count:a.data.data.length}),t.generationResult}}}catch{}return null}async function De(){try{await t.fetchStatus();try{await Z()}catch{}}catch(a){console.error("Refresh status failed",a),b(a?.response?.data?.message||a?.message||"Error al actualizar estado")}}function Ge(){t.prefillDemo(),w.value=`Por favor, genera UN SOLO objeto JSON que describa el escenario generado con las siguientes claves: 
- scenario_metadata: { name, description, scenario_type, horizon_months, fiscal_year }
- capabilities: [ { name, competencies: [ { name, required_level } ], importance } ]
- notes: string
Devuelve únicamente JSON válido sin texto adicional.`,k.value=!0,P.value="client",I.value=null,t.setField("instruction",w.value),t.step=5}return(a,e)=>{const n=p("v-progress-linear"),l=p("v-col"),f=p("v-chip"),_=p("v-card-text"),g=p("v-card"),R=p("v-menu"),A=p("v-btn"),Je=p("v-row"),W=p("v-icon"),Ue=p("v-tooltip"),qe=p("v-select"),Ae=p("v-radio"),Be=p("v-radio-group"),Te=p("v-textarea"),We=p("v-checkbox"),ge=p("v-spacer"),He=p("v-card-title"),Ke=p("v-progress-circular"),Qe=p("v-alert"),Xe=p("v-card-actions"),Ye=p("v-dialog");return c(),d("div",mt,[e[37]||(e[37]=r("h2",null,"Generar Escenario (Asistido)",-1)),s(Je,{class:"align-center mb-4"},{default:o(()=>[s(l,{cols:"12",md:"8"},{default:o(()=>[s(n,{value:N.value,color:Q.value,height:"25",rounded:""},{default:o(()=>[r("div",vt," Paso "+v(u(t).step)+" de 5 / "+v(N.value)+"% ("+v(re.value)+"/"+v(D.length)+") ",1)]),_:1},8,["value","color"])]),_:1}),s(l,{cols:"12",md:"4",class:"text-right"},{default:o(()=>[s(R,{"offset-y":""},{activator:o(({props:i})=>[s(f,xe(i,{color:Q.value,"text-color":"white",class:"cursor-pointer"}),{default:o(()=>[m(v(ie.value),1)]),_:1},16,["color"])]),default:o(()=>[s(g,{style:{"max-width":"320px"}},{default:o(()=>[s(_,null,{default:o(()=>[r("div",gt," Campos faltantes (Paso "+v(u(t).step)+") ",1),r("div",ft,[X.value>0?(c(),d("div",_t," Campos críticos faltantes: "+v(X.value),1)):C("",!0),r("ul",yt,[(c(!0),d(ae,null,ne(G.value,(i,J)=>(c(),d("li",{key:J},v(i),1))),128)),G.value.length===0?(c(),d("li",bt," Ninguno: paso completo ")):C("",!0)])])]),_:1})]),_:1})]),_:1}),r("div",ht,[s(A,{small:"",color:"secondary",onClick:Ge},{default:o(()=>[...e[12]||(e[12]=[m(" Cargar Demo ",-1)])]),_:1})])]),_:1})]),_:1}),(c(),te(et(oe.value))),u(t).step===5?(c(),d("div",wt,[s(g,{class:"pa-3 mb-4"},{default:o(()=>[r("div",kt,[r("div",null,[e[16]||(e[16]=r("strong",null,"Instrucciones del generador",-1)),r("div",Ct,[e[15]||(e[15]=r("div",null," Plantilla que se aplica al prompt generado. Soporta Markdown. ",-1)),s(Ue,null,{activator:o(({props:i})=>[s(W,xe(i,{class:"ml-2",small:"",color:"primary"}),{default:o(()=>[...e[13]||(e[13]=[m(" mdi-information ",-1)])]),_:1},16)]),default:o(()=>[e[14]||(e[14]=r("span",null," Recomendado: la instrucción debe exigir salida JSON única para integridad del import. ",-1))]),_:1})])]),r("div",At,[s(qe,{modelValue:x.value,"onUpdate:modelValue":e[0]||(e[0]=i=>x.value=i),items:["es","en"],dense:"","hide-details":"",style:{width:"90px"}},null,8,["modelValue"]),s(A,{small:"",class:"ml-2",loading:M.value,onClick:e[1]||(e[1]=i=>Y(x.value))},{default:o(()=>[...e[17]||(e[17]=[m("Cargar",-1)])]),_:1},8,["loading"])])]),j.value.length?(c(),d("div",xt,[s(Be,{modelValue:I.value,"onUpdate:modelValue":e[2]||(e[2]=i=>I.value=i),class:"mb-2",onChange:e[3]||(e[3]=i=>Pe(i!==null?Number(i):null))},{default:o(()=>[(c(!0),d(ae,null,ne(j.value,(i,J)=>(c(),d("div",{key:"instr-"+(i.id??J),style:{padding:"6px 0","border-bottom":"1px solid rgba(0, 0, 0, 0.04)"}},[s(Ae,{label:(i.editable?"Versión editable (Operador)":"Versión por defecto (Sistema)")+" / "+(i.author_name||"system")+" ("+(i.created_at?new Date(i.created_at).toLocaleString():"")+")",value:J},null,8,["label","value"])]))),128)),s(Ae,{label:"Editar/Usar como instrucción personalizada",value:null})]),_:1},8,["modelValue"])])):C("",!0),s(Te,{modelValue:w.value,"onUpdate:modelValue":e[4]||(e[4]=i=>w.value=i),readonly:!k.value,rows:"6",outlined:"",dense:"",placeholder:"Escribe las instrucciones aquí (Markdown)...",class:tt({"instruction-error":!me.value.valid})},null,8,["modelValue","readonly","class"]),me.value.valid?C("",!0):(c(),d("div",St,v(me.value.message),1)),r("div",Rt,[s(We,{modelValue:k.value,"onUpdate:modelValue":e[5]||(e[5]=i=>k.value=i),label:"Habilitar edición"},null,8,["modelValue"]),s(ge),s(A,{small:"",color:"secondary",class:"mr-2",loading:M.value,onClick:Me},{default:o(()=>[...e[18]||(e[18]=[m("Restablecer por defecto",-1)])]),_:1},8,["loading"]),s(A,{color:"primary",loading:M.value,onClick:Ee},{default:o(()=>[...e[19]||(e[19]=[m("Guardar instrucciones",-1)])]),_:1},8,["loading"])])]),_:1})])):C("",!0),r("div",Vt,[s(A,{color:"info",onClick:Ve,disabled:u(t).step===1},{default:o(()=>[s(W,{left:""},{default:o(()=>[...e[20]||(e[20]=[m("mdi-arrow-left",-1)])]),_:1}),e[21]||(e[21]=m(" Atrás ",-1))]),_:1},8,["disabled"]),s(ge),u(t).step<5?(c(),te(A,{key:0,color:"primary",class:"mx-2",depressed:"",onClick:ue},{default:o(()=>[e[23]||(e[23]=m(" Siguiente ",-1)),s(W,{right:""},{default:o(()=>[...e[22]||(e[22]=[m("mdi-arrow-right",-1)])]),_:1})]),_:1})):(c(),te(A,{key:1,color:"success",class:"mx-2",depressed:"",onClick:Fe,loading:u(t).generating},{default:o(()=>[s(W,{left:""},{default:o(()=>[...e[24]||(e[24]=[m("mdi-rocket-launch",-1)])]),_:1}),e[25]||(e[25]=m(" Generar ",-1))]),_:1},8,["loading"]))]),u(t).generationId?(c(),d("div",It,[r("p",null," ID: "+v(u(t).generationId)+" '-' Estado: "+v(u(t).generationStatus),1),r("div",Pt,[u(t).generationStatus==="complete"?(c(),d("button",{key:0,onClick:ze}," Ver respuesta ")):C("",!0),u(t).generationStatus==="complete"?(c(),d("button",{key:1,onClick:e[6]||(e[6]=()=>{u(t).importAfterAccept=!1,$e()}),disabled:z.value,style:{"margin-left":"8px"}}," Aceptar y crear escenario ",8,Et)):C("",!0)]),r("button",{onClick:De},"Actualizar"),u(t).generationResult?(c(),d("pre",Mt,v(JSON.stringify(u(t).generationResult,null,2)),1)):C("",!0)])):C("",!0),s(Ye,{modelValue:$.value,"onUpdate:modelValue":e[9]||(e[9]=i=>$.value=i),"max-width":"900","onClick:outside":we},{default:o(()=>[s(g,null,{default:o(()=>[s(He,null,{default:o(()=>[...e[26]||(e[26]=[m("Respuesta del LLM",-1)])]),_:1}),s(_,null,{default:o(()=>[S.value?(c(),d("div",Ft,[s(Ke,{indeterminate:"",color:"primary",class:"mr-4"}),r("div",null,[e[27]||(e[27]=r("div",null,[r("strong",null,"Esperando respuesta del LLM…")],-1)),e[28]||(e[28]=r("div",{class:"caption"}," La generación está en progreso. Esto puede tardar unos segundos. ",-1)),be.value!==null?(c(),d("div",Ot,[m(" Chunks recibidos: "+v(be.value)+" ",1),u(t).generationProgress&&u(t).generationProgress.percent!==null?(c(),d("span",Nt," — "+v(Math.round(u(t).generationProgress.percent))+"%",1)):C("",!0)])):C("",!0)])])):S.value?C("",!0):(c(),d("div",$t,[u(t).generationResult&&!je()&&(h.value===0||h.value===null)?(c(),d("div",jt,[s(Qe,{type:"warning",dense:"",class:"mb-2"},{default:o(()=>[s(W,{class:"mr-2",small:""},{default:o(()=>[...e[29]||(e[29]=[m("mdi-alert-circle-outline",-1)])]),_:1}),e[30]||(e[30]=r("div",null,[r("strong",null,"Respuesta parcial disponible"),r("div",{class:"caption",style:{"margin-top":"4px"}}," Se detectaron metadatos (confianza, assumptions) pero no hay contenido ensamblado en el servidor. Puedes intentar ensamblar los chunks o generar un nuevo intento. ")],-1))]),_:1}),r("div",zt,[s(A,{small:"",color:"primary",class:"mr-2",loading:S.value,onClick:ee},{default:o(()=>[...e[31]||(e[31]=[m(" Reintentar ensamblado ",-1)])]),_:1},8,["loading"]),s(A,{small:"",color:"secondary",loading:S.value,onClick:Le},{default:o(()=>[...e[32]||(e[32]=[m(" Regenerar (nuevo intento) ",-1)])]),_:1},8,["loading"])])])):(c(),d("div",Lt,[e[33]||(e[33]=r("strong",null,"Resumen:",-1)),r("div",null," Nombre: "+v(u(t).generationResult?.scenario_metadata?.name||u(t).generationResult?.name||u(t).generationResult?.scenario_metadata?.title||(u(t).previewPrompt?(u(t).previewPrompt||"").slice(0,48)+"...":"—")),1),r("div",null," Confianza: "+v(u(t).generationResult?.confidence_score??u(t).generationResult?.scenario_metadata?.confidence_score??"—"),1),r("div",null," Capacidades: "+v((u(t).generationResult?.capabilities||[]).length),1)])),r("pre",Dt,v(JSON.stringify(u(t).generationResult,null,2)),1)])),B.value&&B.value.length?(c(),d("div",Gt,[r("div",Jt,v(ve.value||"Errores de validación"),1),r("ul",Ut,[(c(!0),d(ae,null,ne(B.value,(i,J)=>(c(),d("li",{key:J},v(i),1))),128))])])):C("",!0)]),_:1}),s(Xe,null,{default:o(()=>[s(ge),s(A,{color:"secondary",text:"",onClick:we},{default:o(()=>[...e[34]||(e[34]=[m("Cerrar",-1)])]),_:1}),s(A,{color:"primary",onClick:e[7]||(e[7]=i=>he(!1)),loading:z.value,disabled:S.value||u(t).generationStatus!=="complete"},{default:o(()=>[...e[35]||(e[35]=[m("Aceptar y crear escenario",-1)])]),_:1},8,["loading","disabled"]),s(A,{color:"success",onClick:e[8]||(e[8]=i=>he(!0)),loading:z.value,disabled:S.value||u(t).generationStatus!=="complete"},{default:o(()=>[...e[36]||(e[36]=[m("Aceptar y crear + Importar",-1)])]),_:1},8,["loading","disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),q.value?(c(),d("div",qt,[r("div",Bt,[s(nt,{promptPreview:u(t).previewPrompt||"",onConfirm:Oe,onEdit:Ne},null,8,["promptPreview"]),r("button",{class:"close",onClick:e[10]||(e[10]=i=>q.value=!1)}," Cerrar ")])])):C("",!0),s(pt,{modelValue:de.value,"onUpdate:modelValue":e[11]||(e[11]=i=>de.value=i),title:fe.value,messages:_e.value},null,8,["modelValue","title","messages"])])}}}),ta=Re(Tt,[["__scopeId","data-v-7aed1d5c"]]);export{ta as default};
