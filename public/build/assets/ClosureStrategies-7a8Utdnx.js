import{u as O}from"./useApi-DEBD0yG7.js";import{d as T,r as d,B as j,o as A,b as o,c as J,e as P,f as r,w as t,j as n,k as l,t as i,J as q}from"./app-BQBzBluS.js";import"./apiHelper-CL77IM7H.js";const G={class:"closure-strategies"},H={class:"d-flex align-center"},K={class:"font-weight-medium"},L={class:"text-caption text-medium-emphasis"},Y=T({__name:"ClosureStrategies",props:{scenarioId:{}},emits:["refreshed"],setup(x,{emit:S}){const u=x,E=S,y=O(),{showSuccess:V,showError:b}=q(),p=d(!1),g=d(!1),k=d([]),m=d(null),_=d(null),N=["proposed","approved","in_progress","completed","cancelled"],C=["build","buy","borrow","bot","bind","bridge"],v=async()=>{if(u.scenarioId){p.value=!0;try{const s=await y.get(`/api/strategic-planning/scenarios/${u.scenarioId}`),a=s?.data||s;k.value=a?.closure_strategies||[]}catch(s){b("No se pudieron cargar las estrategias: "+s)}finally{p.value=!1}}},I=async()=>{g.value=!0;try{await y.post(`/api/strategic-planning/scenarios/${u.scenarioId}/refresh-suggested-strategies`),await v(),V("Estrategias sugeridas actualizadas"),E("refreshed")}catch(s){b("Error al refrescar estrategias: "+s)}finally{g.value=!1}},z=()=>k.value.filter(s=>{const a=m.value?s.status===m.value:!0,c=_.value?s.strategy===_.value:!0;return a&&c}),B=s=>s==null?"—":new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",maximumFractionDigits:0}).format(s),F=s=>s==null?"—":`${Math.round(s*100)}%`;return j(()=>u.scenarioId,v,{immediate:!0}),A(()=>{v()}),(s,a)=>{const c=o("v-col"),U=o("v-btn"),h=o("v-row"),w=o("v-select"),D=o("v-card-text"),M=o("v-icon"),f=o("v-chip"),R=o("v-data-table"),$=o("v-card");return P(),J("div",G,[r(h,{class:"mb-4"},{default:t(()=>[r(c,{cols:"12",md:"8"},{default:t(()=>[...a[2]||(a[2]=[n("h3",{class:"mb-1"},"Estrategias de cierre de brechas",-1),n("p",{class:"text-medium-emphasis mb-0"}," Revisa y filtra las estrategias sugeridas (6Bs) ",-1)])]),_:1}),r(c,{cols:"12",md:"4",class:"text-right"},{default:t(()=>[r(U,{color:"primary",loading:g.value,onClick:I,"prepend-icon":"mdi-refresh"},{default:t(()=>[...a[3]||(a[3]=[l(" Refrescar sugerencias ",-1)])]),_:1},8,["loading"])]),_:1})]),_:1}),r($,{class:"mb-4"},{default:t(()=>[r(D,null,{default:t(()=>[r(h,null,{default:t(()=>[r(c,{cols:"12",md:"4"},{default:t(()=>[r(w,{modelValue:m.value,"onUpdate:modelValue":a[0]||(a[0]=e=>m.value=e),items:N,label:"Estado",clearable:""},null,8,["modelValue"])]),_:1}),r(c,{cols:"12",md:"4"},{default:t(()=>[r(w,{modelValue:_.value,"onUpdate:modelValue":a[1]||(a[1]=e=>_.value=e),items:C,label:"Estrategia",clearable:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),r(R,{items:z(),headers:[{title:"Skill",key:"skill_name"},{title:"Estrategia",key:"strategy"},{title:"Costo",key:"estimated_cost"},{title:"Tiempo (sem)",key:"estimated_time_weeks"},{title:"Éxito",key:"success_probability"},{title:"Riesgo",key:"risk_level"},{title:"Estado",key:"status"}],loading:p.value,"item-key":"id",class:"elevation-0"},{"item.skill_name":t(({item:e})=>[n("div",H,[r(M,{size:"small",class:"mr-2"},{default:t(()=>[...a[4]||(a[4]=[l("mdi-lightbulb-on-outline",-1)])]),_:1}),n("div",null,[n("div",K,i(e.skill_name||"Skill"),1),n("div",L,i(e.strategy_name||"Estrategia"),1)])])]),"item.strategy":t(({item:e})=>[r(f,{size:"small",color:"primary",variant:"tonal",class:"text-uppercase"},{default:t(()=>[l(i(e.strategy),1)]),_:2},1024)]),"item.estimated_cost":t(({item:e})=>[l(i(B(e.estimated_cost)),1)]),"item.estimated_time_weeks":t(({item:e})=>[l(i(e.estimated_time_weeks||"—"),1)]),"item.success_probability":t(({item:e})=>[l(i(F(e.success_probability)),1)]),"item.risk_level":t(({item:e})=>[r(f,{size:"small",color:e.risk_level==="high"?"error":e.risk_level==="medium"?"warning":"success",variant:"flat"},{default:t(()=>[l(i(e.risk_level||"—"),1)]),_:2},1032,["color"])]),"item.status":t(({item:e})=>[r(f,{size:"small",color:e.status==="approved"?"success":e.status==="in_progress"?"info":e.status==="completed"?"primary":"warning",variant:"flat"},{default:t(()=>[l(i(e.status||"proposed"),1)]),_:2},1032,["color"])]),"no-data":t(()=>[...a[5]||(a[5]=[n("div",{class:"pa-6 text-medium-emphasis text-center"}," No hay estrategias para este escenario. ",-1)])]),_:1},8,["items","loading"])]),_:1})])}}});export{Y as default};
