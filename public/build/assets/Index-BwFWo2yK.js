import{D as Ve,J as jl,k as p,d as Lo,o as Gt,B as Je,R as ul,r as xe,b as q,c as J,g as w,I as dl,p as nt,F as Te,q as Ue,G as Fe,u as Lt,t as ye,i as ba,e as d,w as F,j as ee,s as na,f as Bl,v as st,m as Uo}from"./app-B4Q7DtOZ.js";import{u as yl}from"./useApi-D-wG6FEk.js";import{s as Yo,l as Xo,m as Bo,a as qo}from"./transform-9n3FYwas.js";import"./apiHelper-BLoNXDsG.js";function pl($,Y,R,N={}){const G=N.rows??2,b=N.cols??5,D=N.hSpacing??120,M=N.vSpacing??100,L=Math.min($,G*b),V=[];for(let ue=0;ue<L;ue++){const h=Math.floor(ue/b),H=ue%b,E=L-h*b,A=Math.min(E,b),k=A>1?(A-1)*D:0,g=Math.round(Y-k/2+H*D),P=Math.round(R+h*M);V.push({x:g,y:P})}return V}function fl($,Y=[{min:4,max:8,rows:2,cols:4},{min:9,max:10,rows:2,cols:5}],R=10){const N=Math.min($,R);for(const G of Y)if((G.min??0)<=$&&$<=(G.max??1/0))return{rows:G.rows,cols:G.cols,limit:N};return{rows:2,cols:Math.min(5,Math.max(1,Math.ceil($/2))),limit:N}}function Wl($,Y,R,N,G,b=120,D=100){return pl($,Y,R,{rows:N,cols:G,hSpacing:b,vSpacing:D})}function Ut($,Y,R){const N=[];if($<=0)return N;if($===1)return N.push(Y),N;const G=($-1)*R,b=Math.round(Y-G/2);for(let D=0;D<$;D++)N.push(b+D*R);return N}function Ho($,Y,R,N,G){const{hSpacing:b,vSpacing:D,parentOffset:M,selectedOffsetMultiplier:L,topY:V}=G,ue=Math.round(Y-b),h=Math.round(Y+b),H=[],E=$-1,A=Math.floor(E/2),k=E-A,g=Ut(A,V,D).reverse(),P=Ut(k,V,D),T=R+Math.round(M*L);let f=0,x=0;for(let c=0;c<$;c++)c===N?H.push({x:Math.round(Y),y:T}):f<g.length?H.push({x:ue,y:g[f++]}):H.push({x:h,y:P[x++]??V});return H}function zo($,Y,R,N){const{hSpacing:G,vSpacing:b}=N,D=Math.round(Y-G),M=Math.round(Y+G),L=[],V=Math.floor($/2),ue=$-V,h=Ut(V,R,b).reverse(),H=Ut(ue,R,b);for(let E=0;E<$;E++)if(E<V)L.push({x:D,y:h[E]??R});else{const A=E-V;L.push({x:M,y:H[A]??R})}return L}function vl($,Y,R,N={},G=null){const b=N.hSpacing??140,D=N.vSpacing??90,M=N.parentOffset??80,L=N.selectedOffsetMultiplier??.75;if($===0)return[];const V=R+M;return G!=null&&G>=0&&G<$?Ho($,Y,R,G,{hSpacing:b,vSpacing:D,parentOffset:M,selectedOffsetMultiplier:L,topY:V}):zo($,Y,V,{hSpacing:b,vSpacing:D})}function ml($,Y,R,N="auto"){if($&&$!=="auto")return $;const G=N??"auto";return G!=="auto"?G:Y&&R>3?"sides":"matrix"}function jo(){const{post:$,get:Y}=yl();async function R(b,D){if(!b)throw new Error("compId required");try{const M=await $(`/api/competencies/${b}/skills`,{skill:D});return M?.data??M}catch(M){throw M}}async function N(b,D){if(!b)throw new Error("compId required");if(!D)throw new Error("skillId required");try{const M=await $(`/api/competencies/${b}/skills`,{skill_id:D});return M?.data??M}catch(M){throw M}}async function G(b){if(!b)return[];const D=await Y(`/api/competencies/${b}/skills`);return D?.data??D}return{createAndAttachSkill:R,attachExistingSkill:N,listSkillsForCompetency:G}}function Wo($,Y={}){const{nodes:R,focusedNode:N,childNodes:G,selectedChild:b,grandChildNodes:D}=$,{wrapLabel:M=g=>g,debug:L=!1}=Y,V=(...g)=>{L&&console.debug("[useHierarchicalUpdate]",...g)};function ue(g,P){if(!g||typeof g.id>"u")return V("updateSkill: invalid freshSkill",g),!1;const T=g.id;V("updateSkill",{skillId:T,competencyId:P,name:g.name});const f=c=>c.map(C=>(C.id??C.raw?.id)===T?{...g,pivot:C.pivot??C.raw?.pivot,raw:{...g,pivot:C.pivot??C.raw?.pivot}}:C);if(D.value=D.value.map(c=>(c.raw?.id??c.skillId)===T?{...c,name:g.name,description:g.description,displayName:M(g.name??c.name,12),raw:{...g,pivot:c.raw?.pivot}}:c),V("Updated grandChildNodes"),b.value&&Array.isArray(b.value.skills)){const c=f(b.value.skills);b.value={...b.value,skills:c,raw:{...b.value.raw,skills:c}},V("Updated selectedChild.skills")}G.value=G.value.map(c=>{if(c.compId===P||c.raw?.id===P){const C=Array.isArray(c.skills)?f(c.skills):c.skills;return{...c,skills:C,raw:{...c.raw,skills:C}}}return c}),V("Updated childNodes[].skills");const x=N.value?.competencies;if(Array.isArray(x)){const c=x.find(C=>C.id===P);c&&Array.isArray(c.skills)&&(c.skills=f(c.skills),V("Updated focusedNode.competencies[].skills"))}return R.value=R.value.map(c=>{if(Array.isArray(c.competencies)){const C=c.competencies.find(z=>z.id===P);C&&Array.isArray(C.skills)&&(C.skills=f(C.skills))}return c}),V("Updated nodes[].competencies[].skills"),!0}function h(g,P){if(!g||typeof g.id>"u")return V("updateCompetency: invalid freshComp",g),!1;const T=g.id;V("updateCompetency",{compId:T,capabilityId:P,name:g.name});const f=c=>({name:g.name??c.name,description:g.description??c.description,readiness:g.readiness??c.readiness,skills:g.skills??c.skills});G.value=G.value.map(c=>c.compId===T||c.raw?.id===T?{...c,...f(c),displayName:M(g.name??c.name,14),raw:{...c.raw??{},...g}}:c),V("Updated childNodes"),b.value&&(b.value.compId===T||b.value.raw?.id===T)&&(b.value={...b.value,...f(b.value),displayName:M(g.name??b.value.name,14),raw:{...b.value.raw??{},...g}},V("Updated selectedChild"));const x=N.value?.competencies;if(Array.isArray(x)){const c=x.find(C=>C.id===T);c&&(Object.assign(c,f(c)),V("Updated focusedNode.competencies[]"))}return R.value=R.value.map(c=>{if(Array.isArray(c.competencies)){const C=c.competencies.find(z=>z.id===T);C&&Object.assign(C,f(C))}return c}),V("Updated nodes[].competencies[]"),!0}function H(g){if(!g||typeof g.id>"u")return V("updateCapability: invalid freshCap",g),!1;const P=g.id;V("updateCapability",{capId:P,name:g.name});const T=f=>({name:g.name??f.name,description:g.description??f.description,competencies:g.competencies??f.competencies});return R.value=R.value.map(f=>f.id===P?{...f,...T(f),displayName:M(g.name??f.name,16),raw:{...f.raw??{},...g}}:f),V("Updated nodes[]"),N.value&&N.value.id===P&&(Object.assign(N.value,T(N.value)),N.value.displayName=M(g.name??N.value.name,16),N.value.raw&&Object.assign(N.value.raw,g),V("Updated focusedNode")),!0}function E(g,P){V("removeSkill",{skillId:g,competencyId:P});const T=c=>c.filter(C=>(C.id??C.raw?.id)!==g);D.value=D.value.filter(c=>(c.skillId??c.raw?.id??c.raw?.raw?.id)!==g&&c.id!==g),b.value&&Array.isArray(b.value.skills)&&(b.value.skills=T(b.value.skills)),b.value&&Array.isArray(b.value.raw?.skills)&&(b.value.raw.skills=T(b.value.raw.skills));const f=N.value?.competencies;if(Array.isArray(f)){const c=f.find(C=>C.id===P);c&&Array.isArray(c.skills)&&(c.skills=T(c.skills))}const x=G.value.find(c=>c.compId===P);return x&&(Array.isArray(x.skills)&&(x.skills=T(x.skills)),Array.isArray(x.raw?.skills)&&(x.raw.skills=T(x.raw.skills))),R.value.forEach(c=>{if(Array.isArray(c.competencies)){const C=c.competencies.find(z=>z.id===P);C&&Array.isArray(C.skills)&&(C.skills=T(C.skills))}}),!0}async function A(g,P,T){let f=!1;switch(g){case"skill":if(!T)return V("updateSkill requires parentId (competencyId)"),!1;f=ue(P,T);break;case"competency":f=h(P,T);break;case"capability":f=H(P);break}return await Ve(),f}async function k(g,P,T){let f=!1;switch(g){case"skill":if(!T)return V("removeSkill requires parentId (competencyId)"),!1;f=E(P,T);break}return await Ve(),f}return{updateSkill:ue,updateCompetency:h,updateCapability:H,removeSkill:E,update:A,remove:k}}function Ko($){const Y=yl(),{showSuccess:R,showError:N}=jl(),G=f=>{const x=Y?.[f],c=Y?.api?.[f];return x??c},b=async(f,x)=>{const c=G("get");return typeof c=="function"?c(f,x):Promise.resolve({data:[]})},D=async(f,x)=>{const c=G("post");return typeof c=="function"?c(f,x):Promise.resolve({data:{}})},M=async(f,x)=>{const c=G("patch");return typeof c=="function"?c(f,x):Promise.resolve({data:{}})},L=async f=>{const x=G("delete");return typeof x=="function"?x(f):Promise.resolve({data:{}})};async function V(){try{const f=document.cookie.includes("XSRF-TOKEN=");if(console.debug("[ensureCsrf] has XSRF-TOKEN cookie?",f),!f){const x=Y?.api?.get??Y?.get;typeof x=="function"&&await x("/sanctum/csrf-cookie"),console.debug("[ensureCsrf] fetched /sanctum/csrf-cookie")}}catch(f){console.warn("[ensureCsrf] failed to fetch csrf-cookie",f)}}async function ue(f){if(!f)return[];try{console.debug("[loadCapabilityTree] fetching for scenario",f);const x=await b(`/api/strategic-planning/scenarios/${f}/capability-tree`),c=x?.data??x??[],C=Array.isArray(c)?c:c?.data??c??[];return console.debug("[loadCapabilityTree] fetched items_count=",C.length),C}catch(x){return console.error("[loadCapabilityTree] error",x),[]}}async function h(f,x,c){await V();try{console.debug("[saveCapability] PATCH /api/capabilities/"+f,x);const C=await M(`/api/capabilities/${f}`,x);if(console.debug("[saveCapability] PATCH /api/capabilities response",C),R("Capacidad actualizada"),c){const z={strategic_role:x.strategic_role,strategic_weight:x.strategic_weight,priority:x.priority,rationale:x.rationale,required_level:x.required_level,is_critical:x.is_critical};try{const se=await M(`/api/strategic-planning/scenarios/${c}/capabilities/${f}`,z);return console.debug("[saveCapability] PATCH pivot response",se),R("Relación escenario–capacidad actualizada"),se?.data??C?.data}catch(se){console.error("[saveCapability] error PATCH pivot",se);try{const de=await D(`/api/strategic-planning/scenarios/${c}/capabilities`,x);return R("Relación actualizada (fallback)"),de?.data}catch(de){console.error("[saveCapability] error POST fallback",de),N("No se pudo actualizar la relación. Verifica el backend.")}}}return C?.data}catch(C){const z=C;throw console.error("[saveCapability] error PATCH /api/capabilities/",z?.response?.data??z),z?.response?.status!==404&&N(z?.response?.data?.message||"Error actualizando capacidad"),C}}async function H(f,x){try{let c=null,C=null;if(x)try{await L(`/api/strategic-planning/scenarios/${x}/capabilities/${f}`)}catch(z){c=z?.response?.status??null}try{await L(`/api/capabilities/${f}`)}catch(z){C=z?.response?.status??null}return(c===404||c===null)&&(C===404||C===null)?N("Eliminado localmente. El backend no expone endpoints DELETE."):R("Capacidad y relación eliminadas"),!0}catch(c){return console.error("[deleteCapability] error",c),N("Error al eliminar capacidad"),!1}}async function E(f,x,c){try{const C=c?`/api/strategic-planning/scenarios/${c}/capabilities/${x}/competencies/${f}`:`/api/capabilities/${x}/competencies/${f}`;return console.debug("[deleteCompetency] DELETE",C),await L(C),R("Competencia eliminada"),!0}catch(C){return C?.response?.status===404?(console.debug("[deleteCompetency] DELETE 404, removing locally"),!0):(console.error("[deleteCompetency] error",C),N("Error eliminando competencia"),!1)}}async function A(f){if(!f)return[];try{$?.scenario?.id;try{const x=await b(`/api/competencies/${f}/skills`),c=x?.data??x;if(Array.isArray(c))return c}catch(x){console.debug("[fetchSkillsForCompetency] /competencies/:id/skills failed",x)}try{const x=await b(`/api/competencies/${f}`),c=x?.data??x;if(c?.skills&&Array.isArray(c.skills))return c.skills}catch(x){console.debug("[fetchSkillsForCompetency] /competencies/:id failed",x)}return[]}catch(x){return console.error("[fetchSkillsForCompetency] error",x),[]}}async function k(f,x){await V();try{console.debug("[saveSkill] PATCH /api/skills/"+f,x);const c=await M(`/api/skills/${f}`,x);return R("Skill actualizada"),c?.data??c}catch(c){throw console.error("[saveSkill] error",c),N("Error guardando skill"),c}}async function g(f,x,c){try{if(c)try{return await L(`/api/competency-skills/${c}`),R("Skill eliminada"),!0}catch(C){console.debug("[deleteSkill] DELETE by pivotId failed",C)}if(x&&f)try{return await L(`/api/competencies/${x}/skills/${f}`),R("Skill eliminada"),!0}catch(C){console.debug("[deleteSkill] DELETE via competency failed",C)}return N("No se pudo eliminar la skill"),!1}catch(C){return console.error("[deleteSkill] error",C),N("Error eliminando skill"),!1}}async function P(f,x,c){await V();try{console.debug("[createCompetency] POST",{scenarioId:c,capabilityId:f,competencyPayload:x});const C=c?`/api/strategic-planning/scenarios/${c}/capabilities/${f}/competencies`:`/api/capabilities/${f}/competencies`,z=await D(C,x),se=z?.data??z;return R("Competencia creada y asociada"),se}catch(C){throw console.error("[createCompetency] error",C),N("Error creando competencia"),C}}async function T(f,x){if(!f)return N("Escenario no seleccionado"),!1;try{const c={positions:x.map(C=>({id:C.id,x:C.x,y:C.y}))};return await D(`/api/strategic-planning/scenarios/${f}/capability-tree/save-positions`,c),R("Posiciones guardadas"),!0}catch(c){return console.error("[savePositions] error",c),N("Error al guardar posiciones"),!1}}return{ensureCsrf:V,loadCapabilityTree:ue,saveCapability:h,deleteCapability:H,deleteCompetency:E,fetchSkillsForCompetency:A,saveSkill:k,deleteSkill:g,createCompetency:P,savePositions:T}}const Ne={hSpacing:100,vSpacing:40,parentOffset:-20,edgeDepth:40,text:{fontSize:12,fontWeight:600},defaultLayout:"auto"},W={base:Ne,capability:{spacing:{hSpacing:Ne.hSpacing,vSpacing:Ne.vSpacing},forces:{linkDistance:100,linkStrength:.5,chargeStrength:-220},scenarioEdgeDepth:120,text:Ne.text},competency:{radial:{radius:150,selectedOffsetY:-20,startAngle:-Math.PI/4,endAngle:5*Math.PI/4},sides:{selectedOffsetMultiplier:.75},defaultLayout:Ne.defaultLayout,parentOffset:Ne.parentOffset,maxDisplay:10,matrixVariants:[{min:2,max:3,rows:1,cols:3},{min:4,max:8,rows:2,cols:4},{min:9,max:10,rows:2,cols:5}],spacing:{hSpacing:Ne.hSpacing,vSpacing:Ne.vSpacing,parentOffset:Ne.parentOffset},edge:{baseDepth:Ne.edgeDepth,curveFactor:.65,spreadOffset:18},text:{fontSize:10,fontWeight:600}},skill:{maxDisplay:10,radial:{radius:20,startAngle:-Math.PI/6,endAngle:7*Math.PI/6,offsetFactor:.8,offsetY:10},defaultLayout:Ne.defaultLayout,matrixVariants:[{min:2,max:3,rows:1,cols:3},{min:4,max:8,rows:1,cols:4},{min:9,max:10,rows:2,cols:5}],sides:{hSpacing:Ne.hSpacing,vSpacing:Ne.vSpacing*2,parentOffset:Ne.parentOffset,selectedOffsetMultiplier:.5},linear:{hSpacing:160,vSpacing:40},edge:{baseDepth:Ne.edgeDepth-5,curveFactor:.5,spreadOffset:20},text:Ne.text},animations:{competencyEntryFinalize:80,skillEntryFinalize:70,collapseDuration:10,competencyStaggerRow:30,competencyStaggerCol:12,competencyStaggerRandom:30,skillStaggerRow:20,skillStaggerCol:8,leadFactor:.6},node:{radius:34,focusRadius:44,competencyOpacity:.2,skillOpacity:.2},clamp:{minY:40,bottomPadding:40,minViewportHeight:120}};function Zo($){return new Promise(Y=>setTimeout(Y,$))}function Jo($,Y,R,N){if(!$)return;const G=Math.round(R/2),D=Math.round(N*.25);if(Y&&Y.id!==$.id){const M=Y,L=$,V=M.x??0,ue=M.y??0;return M.x=L.x??V,M.y=L.y??ue,L.x=V,L.y=ue,{updatedNode:L,updatedPrevNode:M}}return $.x=G,$.y=D,{updatedNode:$}}function ql($,Y=14){if($==null)return"";const R=String($).trim();if(R.length<=Y)return R;const N=(L,V)=>{if(L.length<=V)return{line:L,rest:""};const h=L.slice(0,V+1).lastIndexOf(" ");return h>0?{line:L.slice(0,h),rest:L.slice(h+1).trim()}:{line:L.slice(0,V),rest:L.slice(V).trim()}},G=N(R,Y);if(!G.rest)return G.line;const b=G.rest;if(b.length<=Y)return G.line+`
`+b;const D=N(b,Y);let M=D.line;return D.rest&&M.length>=Y?M=M.slice(0,Math.max(0,Y-1)).replace(/\s+$/,"")+"…":D.rest&&(M=M+"…"),G.line+`
`+M}function Qo($,Y,R,N){const G=R/2,b=N/2-30;if(Y<=1)return{x:Math.round(G),y:Math.round(b)};const D=Math.min(5,Math.max(1,Math.ceil(Math.sqrt(Y)))),M=Math.max(1,Math.ceil(Y/D)),L=24,V=Math.max(120,R-L*2),ue=Math.max(120,N-L*2),h=D>1?Math.min(160,Math.floor(V/D)):0,H=M>1?Math.min(140,Math.floor(ue/M)):0,E=$%D,A=Math.floor($/D),k=(D-1)*h,g=(M-1)*H,P=E*h-k/2,T=A*H-g/2;return{x:Math.round(G+P),y:Math.round(b+T)}}function er(){function $(b){const D=W.clamp.minY,M=W.clamp.bottomPadding,L=W.clamp.minViewportHeight,V=Math.max(L,globalThis.__scenarioHeight??600)-M;return Math.min(Math.max(b,D),V)}function Y(b,D,M,L,V={},ue,h){const H=b.competencies??[];if(!Array.isArray(H)||H.length===0)return{childNodes:[],childEdges:[]};const E=W.competency.maxDisplay,A=Math.min(V.limit??E,E),k=H.slice(0,A),g=b.x??Math.round((ue??900)/2),P=b.y??Math.round((h??600)/2),f=W.competency.spacing.parentOffset,c=Math.round(P+f+18);let C=V.rows??1,z=V.cols??4;const se=W.competency.spacing.hSpacing,de=W.competency.spacing.vSpacing,Ce=W.competency.matrixVariants;try{const me=fl(k.length,Ce,E);C=me.rows,z=me.cols}catch(me){console.log(me)}const ke=ml(V.layout,!1,k.length,W.competency.defaultLayout);let Ie=[];if(ke==="radial"){const me=W.competency.radial.radius,De=W.competency.radial.startAngle,ea=(W.competency.radial.endAngle-De)/Math.max(1,k.length-1);Ie=k.map((He,ka)=>{const Ga=De+ka*ea,ne=Math.round(g+me*Math.cos(Ga)),aa=Math.round(c+me*Math.sin(Ga));return{x:ne,y:aa}})}else if(ke==="sides")try{Ie=vl(k.length,g,P,W.competency.sides,null)}catch(me){console.warn("Failed to compute sides layout",me),Ie=[]}else Ie=Wl(k.length,g,c,C,z,se,de);const wa=[];return k.forEach((me,De)=>{const Re=Ie[De]||{x:g,y:c},$e=-(b.id*1e3+De+1),ea=Math.max(0,Math.floor(De/z)*W.animations.competencyStaggerRow+De%z*W.animations.competencyStaggerCol+Math.round((Math.random()-.5)*W.animations.competencyStaggerRandom)),He={id:$e,compId:me.id??null,name:me.name??me,displayName:ql(me.name??me,14),x:L?.x??b.x??g,y:L?.y??b.y??P,animScale:.84,animOpacity:0,animDelay:ea,animFilter:"blur(6px) drop-shadow(0 10px 18px rgba(2,6,23,0.36))",animTargetX:Re.x,animTargetY:$(Re.y),is_critical:!1,description:me.description??null,readiness:me.readiness??null,skills:Array.isArray(me.skills)?me.skills:[],raw:me};wa.push(He),M.push({source:b.id,target:$e})}),{childNodes:wa,childEdges:M}}function R(b,D,M,L,V={},ue){const h=Array.isArray(b.skills)?b.skills:b.raw?.skills??[];if(!Array.isArray(h)||h.length===0)return{grandChildNodes:[],grandChildEdges:[]};const H=W.skill.maxDisplay,E=h.slice(0,H),A=L?.x??b.x??450,k=L?.y??b.y??Math.round((ue??600)/2),g=W.skill.radial.offsetY,P=Math.round(g*(1+W.skill.radial.offsetFactor)),f=Math.round(k+P+30),x=V?.layout??void 0,c=ml(x,!1,E.length,W.skill.defaultLayout);let C=[];if(c==="radial"){const se=W.skill.radial.radius,de=W.skill.radial.startAngle,Ie=(W.skill.radial.endAngle-de)/Math.max(1,E.length-1);C=E.map((wa,me)=>{const De=de+me*Ie,Re=Math.round(A+se*Math.cos(De)),$e=Math.round(f+se*Math.sin(De));return{x:Re,y:$e}})}else if(c==="sides")try{C=vl(E.length,A,k,W.skill.sides,null)}catch(se){console.log(se),C=[]}else{const se=W.skill.matrixVariants;try{const de=fl(E.length,se,W.skill.maxDisplay);C=pl(E.length,A,f,{rows:de.rows,cols:de.cols,hSpacing:W.skill.linear.hSpacing,vSpacing:W.skill.linear.vSpacing})}catch(de){console.log(de);const Ce=1,ke=Math.min(4,E.length);C=pl(E.length,A,f,{rows:Ce,cols:ke,hSpacing:W.skill.linear.hSpacing,vSpacing:W.skill.linear.vSpacing})}}const z=[];return E.forEach((se,de)=>{const Ce=C[de]||{x:A,y:f},ke=-(Math.abs(b.id)*1e5+de+1),Ie=Math.max(0,Math.floor(de/4)*W.animations.skillStaggerRow+de%4*W.animations.skillStaggerCol),wa={id:ke,name:se.name??se,x:L?.x??b.x??A,y:L?.y??b.y??k,animScale:.8,animOpacity:0,animDelay:Ie,animTargetX:Ce.x,animTargetY:$(Ce.y),raw:se};z.push(wa),M.push({source:b.id,target:ke})}),{grandChildNodes:z,grandChildEdges:M}}function N(b=!1,D){return D=typeof D=="number"?D:W.animations.collapseDuration,{animated:b,duration:D}}function G(b,D,M,L){try{const V=b.map(E=>({id:E.id,x:E.x||0,y:E.y||0})),ue=D.map(E=>({source:E.source,target:E.target})),h=Yo(V).force("link",Xo(ue).id(E=>E.id).distance(W.capability.forces.linkDistance).strength(W.capability.forces.linkStrength)).force("charge",Bo().strength(W.capability.forces.chargeStrength)).force("center",qo(M/2,L/2));for(let E=0;E<300;E++)h.tick();h.stop();const H=new Map(V.map(E=>[E.id,{x:Math.round(E.x),y:Math.round(E.y)}]));return b.map(E=>{const A=H.get(E.id);return{...E,x:A?.x??E.x,y:A?.y??E.y}})}catch(V){return console.warn("[runForceLayout] failed",V),b}}return{LAYOUT_CONFIG:W,wait:Zo,clampY:$,wrapLabel:ql,computeInitialPosition:Qo,centerOnNode:Jo,expandCompetencies:Y,expandSkills:R,collapseGrandChildren:N,runForceLayout:G}}function ar(){const $=p(2),Y=p([]),R=p([]),N=p([]),G=p([]),b=p([]);function D(A,k,g,P,T){Y.value=A,R.value=k,N.value=g,G.value=P,b.value=T}function M(A){if(A){if(N.value&&Array.isArray(N.value)){const k=N.value.find(g=>g.id===A);if(k)return k}if(G.value&&Array.isArray(G.value)){const k=G.value.find(g=>g.id===A);if(k)return k}if(b.value&&Array.isArray(b.value)){const k=b.value.find(g=>g.id===A);if(k)return k}}}function L(A){return!A||A>=0?!1:!!b.value?.find(k=>k.id===A)}function V(A,k=!0){try{const g=k?A.target:A.source,P=M(g);if(!P)return{x:void 0,y:void 0};const T=P.x;let f=P.y;if(k&&g<0){const x=L(g);f=(f??0)-((x?14:24)+(x?4:6))}return{x:T,y:f}}catch{}return{x:void 0,y:void 0}}function ue(A){try{const k=M(A.target);if(!k)return 0;const g=Y.value?.filter(P=>{const T=M(P.target);return P.source===A.source&&T&&Math.abs((T.x??0)-(k.x??0))<=8})||[];return g.sort((P,T)=>P.target-T.target),Math.max(0,g.findIndex(P=>P===A))}catch{}return 0}function h(A){return A.animOpacity??.98}function H(A){try{const k=V(A,!1),g=V(A,!0),P=k.x,T=k.y,f=g.x,x=g.y,c=$.value,C=L(A.target)||L(A.source)||R.value&&R.value.includes(A);if(c===2&&typeof P=="number"&&typeof f=="number"){const z=C?W.skill.edge.baseDepth:W.competency.edge.baseDepth,se=C?W.skill.edge.curveFactor:W.competency.edge.curveFactor,de=Math.abs((x??0)-(T??0)),Ce=Math.max(z,Math.round(de*se)+z),ke=Math.min(T??0,x??0)+Ce;return{isPath:!0,d:`M ${P} ${T} C ${P} ${ke} ${f} ${ke} ${f} ${x}`}}if(c===3&&typeof P=="number"&&typeof f=="number"){const z=ue(A),se=(Y.value||[]).concat(R.value||[]).filter(Ce=>{const ke=M(Ce.target),Ie=M(A.target);return Ce.source===A.source&&ke&&Ie&&Math.abs((ke.x??0)-(Ie.x??0))<=8}),de=(z-(se.length-1)/2)*(C?W.skill.edge.spreadOffset:W.competency.edge.spreadOffset);return{isPath:!1,x1:P,y1:T,x2:(f??0)+de,y2:x}}if(c===1&&typeof P=="number"&&typeof f=="number"){const se=(x??0)-((C?14:20)-2);return{isPath:!1,x1:P,y1:T,x2:f,y2:se}}return{isPath:!1,x1:P,y1:T,x2:f,y2:x}}catch{return{isPath:!1,x1:void 0,y1:void 0,x2:void 0,y2:void 0}}}function E(A){try{const k=M(A.source),g=M(A.target);if(!k||!g||typeof k.x!="number"||typeof g.x!="number")return"";const P=W.capability.scenarioEdgeDepth,T=Math.min(k.y??0,g.y??0)+P;return`M ${k.x} ${k.y} C ${k.x} ${T} ${g.x} ${T} ${g.x} ${g.y}`}catch{}return""}return{childEdgeMode:$,injectState:D,renderedNodeById:M,isGrandChildNode:L,edgeEndpoint:V,groupedIndexForEdge:ue,edgeAnimOpacity:h,edgeRenderFor:H,scenarioEdgePath:E}}function Hl($,Y=40,R=2e3){return Math.max(Y,Math.min(R,$))}function tr($,Y,R,N){let G=!1;const b=N?.id;let D=$.slice();b!=null&&D.some(E=>E&&E.id===b)&&(G=!0,D=D.filter(E=>E.id!==b));const M=D.length;if(!M)return $.slice();const L=Math.round(Y/2),V=Math.round(R/2-30),h=Math.max(200,Y-48*2);let H=D.map(E=>({...E}));if(M===1)H=H.map(E=>({...E,x:L,y:V}));else if(M===2){const E=Math.min(220,Math.floor(h/3));H=H.map((A,k)=>({...A,x:L+(k===0?-E/2:E/2),y:V}))}else if(M===3){const E=Math.min(220,Math.floor(h/4));H=H.map((A,k)=>k===1?{...A,x:L,y:V}:{...A,x:L+(k===0?-E:E),y:V})}else if(M>=4&&M<=6){const E=M,A=Math.min(160,Math.floor(h/E)),k=(E-1)*A,g=Math.round(L-k/2);H=H.map((P,T)=>({...P,x:g+T*A,y:V}))}else{let E=Math.min(6,Math.max(2,Math.ceil(Math.sqrt(M)))),A=Math.ceil(M/E);M===10&&(E=5,A=2);const k=Math.min(140,Math.floor(h/E)),g=Math.min(140,Math.floor((R-160)/Math.max(1,A))),P=(E-1)*k,T=(A-1)*g,f=Math.round(L-P/2),c=Math.round(V-T/2+40);H=H.map((C,z)=>{const se=Math.floor(z/E),de=z%E;return{...C,x:f+de*k,y:Hl(c+se*g)}})}try{if(N){const A=N.x??Math.round(Y/2),k=N.y??Math.round(R*.12);let g=0;if(H.forEach(P=>{if(!P||P.x==null||P.y==null)return;const T=P.x-A,f=P.y-k,x=Math.sqrt(T*T+f*f);if(x<120){const c=120-x;c>g&&(g=c)}}),g>0){const T=Math.round(g+20);H=H.map(f=>!f||f.y==null?f:{...f,y:Hl((f.y??0)+T)})}}}catch{}return G&&N?[...H,{...N}]:H}const lr={key:0},or={key:1},rr=["width","height","viewBox"],ir=["width","height"],nr=["width","height"],sr={class:"edges"},cr=["x1","y1","x2","y2"],ur=["transform"],dr={class:"scenario-edges"},pr=["d"],fr=["x1","y1","x2","y2"],vr={class:"child-edges"},mr=["d"],yr=["x1","y1","x2","y2"],gr={class:"grandchild-edges"},hr=["d","stroke-opacity"],br=["x1","y1","x2","y2","stroke-opacity"],wr=["data-node-id"],kr=["data-node-id","onPointerdown","onClick","onContextmenu"],xr={key:0,class:"node-inner",r:"12",fill:"#ff5050","fill-opacity":"0.95"},Cr={x:0,y:38,"text-anchor":"middle",class:"node-label"},Sr=["dy"],_r={class:"child-nodes"},Er=["data-node-id","onClick","onContextmenu"],Mr=["fill","stroke"],Ar={x:0,y:22,"text-anchor":"middle",class:"node-label",style:{"font-size":"10px"}},Nr=["dy"],Vr={class:"skill-nodes"},Ir=["data-node-id","onClick"],Or={x:0,y:4,"text-anchor":"middle",class:"node-label",style:{"font-size":"10px"}},Pr=["transform"],Tr=["transform","title"],Fr={x:"0",y:"4","text-anchor":"middle","font-size":"10",fill:"#dbeafe",style:{"font-weight":"700"}},Dr=["transform"],Rr=["width"],$r={xmlns:"http://www.w3.org/1999/xhtml",class:"svg-title-fo"},Gr={class:"svg-title-text"},Lr={class:"d-flex align-center"},Ur={class:"d-flex align-center",style:{gap:"8px"}},Yr={class:"mb-2 text-xs text-white/60"},Xr={class:"text-small text-medium-emphasis mb-2"},Br={key:0,style:{position:"relative"}},qr={style:{"max-height":"360px",overflow:"auto","padding-right":"12px"}},Hr={style:{display:"flex",gap:"8px","grid-column":"1 / -1","margin-top":"8px"}},zr={style:{display:"grid",gap:"12px","grid-template-columns":"1fr 1fr","align-items":"start"}},jr={key:1,style:{position:"relative"}},Wr={style:{display:"flex",gap:"8px","margin-bottom":"8px"}},Kr={style:{"max-height":"360px",overflow:"auto","padding-right":"12px"}},Zr={style:{display:"grid",gap:"12px","grid-template-columns":"1fr 1fr","align-items":"start"}},Jr={key:1},Qr={style:{"margin-top":"6px"}},ei={style:{"margin-top":"8px",display:"flex",gap:"8px","align-items":"center"}},ai={key:0,style:{"margin-top":"12px","max-height":"420px",overflow:"auto",background:"rgba(0, 0, 0, 0.04)",padding:"8px","border-radius":"6px"}},ti={style:{"white-space":"pre-wrap","word-break":"break-word"}},li={key:0,style:{"margin-top":"8px"}},oi={key:0},ri={style:{display:"flex",gap:"8px","grid-column":"1/-1","margin-top":"8px"}},ii={class:"grid",style:{display:"grid",gap:"12px","grid-template-columns":"1fr 1fr"}},ni={key:0,style:{"margin-top":"14px"}},si={class:"grid",style:{display:"grid",gap:"12px","grid-template-columns":"1fr 1fr"}},ci={key:1},ui={class:"grid",style:{display:"grid",gap:"12px","grid-template-columns":"1fr 1fr"}},di={class:"mt-3",style:{"margin-top":"12px"}},pi={class:"grid",style:{display:"grid",gap:"12px","grid-template-columns":"1fr 1fr"}},fi={class:"text-xs",style:{"margin-top":"6px"}},vi={class:"text-xs",style:{"margin-top":"6px"}},mi={class:"text-xs",style:{"margin-top":"6px"}},yi={key:0,class:"cap-list"},gi=.3,hi=3,zl=.1,Qe=420,bi=60,wi=Lo({__name:"Index",props:{scenario:{},childColumns:{},competencyLayout:{default:()=>({parentOffset:80})},capabilityChildrenOffset:{default:150},scenarioEdgeCurveDepth:{default:90},visualConfig:{default:()=>({nodeRadius:34,focusRadius:34,scenarioOffset:80,scenarioOffsetSwap:150,childDrop:18,skillDrop:18,edge:{baseDepth:40,curveFactor:.35,spreadOffset:18},edgeSkill:{baseDepth:20,curveFactor:.25,spreadOffset:10}})}},emits:["createCapability"],setup($,{emit:Y}){function R(){const a=_.value;_.value=null,te.value=[],pe.value=[],S.value=null;try{$a()}catch(e){console.warn("[restoreView] Error collapsing grandchildren",e)}if(U.value=U.value.map(e=>({...e,visible:!0})),a)try{(Array.isArray(a?.competencies)?a.competencies.length:0)>=4?Ee(a,{x:a.x??0,y:a.y??0},{layout:"matrix"}):Ee(a,{x:a.x??0,y:a.y??0})}catch(e){console.warn("[restoreView] Error expanding competencies",e),Ee(a,{x:a.x??0,y:a.y??0})}pa.value=0,fa.value=0}const N={1:"1",2:"2",3:"3"},G={1:"1",2:"2",3:"3",4:"4",5:"5",6:"6",7:"7",8:"8",9:"9",10:"10"},b={1:"1",2:"2",3:"3",4:"4",5:"5"},D={1:"1",2:"2",3:"3",4:"4",5:"5"};function M(a){if(!a)return null;const e=typeof a=="number"?a:a.id;if(e==null)return null;if(L(e))return 0;let t=e,l=0;const o=10;for(;l<=o;){const i=V(t);if(i!=null){t=i,l++;continue}return l+ue(t,l)}return l}function L(a){const e=K.value?K.value.id:null;return e!=null&&a===e}function V(a){const e=pe.value.find(t=>t.target===a);return e?e.source:null}function ue(a,e){return Nt.value.some(o=>o.target===a)?1:U.value.some(o=>o.id===a)?Math.max(e,1)-e:0}const h=$,H=Ko(),{runForceLayout:E,expandSkills:A,LAYOUT_CONFIG:k,clampY:g}=er(),{injectState:P,childEdgeMode:T}=ar();Gt(()=>{try{P(pe,ve,U,te,Q)}catch(a){console.warn("[ScenarioPlanning] Error inyectando state en useScenarioEdges",a)}});const f=async a=>{try{const e=typeof a=="string"?Number.parseInt(a,10):a,t=await H.loadCapabilityTree(e);t&&Array.isArray(t)&&(St(t),Mt.value=!0)}catch(e){console.error("[loadTreeFromApi] Error cargando árbol de capacidades",e),ae("Error cargando árbol de capacidades")}},x=p(!1),c=p(""),C=p(""),z=p(""),se=p(""),de=p(3),Ce=p("target"),ke=p([]);async function Ie(a){try{if(!a){ke.value=[];return}const e=typeof a=="string"?Number.parseInt(a,10):a,t=await ne.get(`/api/scenarios/${e}/step2/data`),l=t?.data??t,o=Array.isArray(l?.roles)?l.roles:[];ke.value=o.map(i=>i.role_name??i.name??String(i.role_id??i.id??""))}catch(e){console.debug("[loadStep2RolesFromApi] failed to fetch step2 roles",e),ke.value=[]}}function wa(a){return!a&&a!==0?null:typeof a=="string"?a:typeof a=="number"?String(a):a?.role_name??a?.name??a?.label??(a?.id?String(a.id):null)}function me(a){if(!Array.isArray(a))return[];const e=[];for(const t of a){const l=wa(t);if(l!=null){const o=String(l).trim();o&&!e.includes(o)&&e.push(o)}}return e}const De=st(()=>{const a=h.scenario,e=me(a?.strategic_roles??a?.roles??a?.available_roles??[]),t=me(ke.value??[]),l=[];for(const i of e)l.includes(i)||l.push(i);for(const i of t)l.includes(i)||l.push(i);const o=["target","watch","sunset"];for(const i of o)l.includes(i)||l.push(i);return l});Je(()=>h.scenario?.id,a=>{if(a)try{const e=h.scenario,t=e?.strategic_roles??e?.roles??e?.available_roles??null;(!Array.isArray(t)||t.length===0)&&Ie(a)}catch(e){console.warn("[watchScenario] Error in scenario watcher",e)}});const Re=p(10),$e=p(1),ea=p(""),He=p(3),ka=p(!1),Ga=p(!1),ne=yl();async function aa(){try{const a=document.cookie.includes("XSRF-TOKEN=");if(console.debug("[ensureCsrf] has XSRF-TOKEN cookie?",a),!a)try{const e=ne?.api?.get??ne?.get;typeof e=="function"&&await e("/sanctum/csrf-cookie"),console.debug("[ensureCsrf] fetched /sanctum/csrf-cookie")}catch(e){console.warn("[ensureCsrf] failed to fetch csrf-cookie",e)}}catch(a){console.warn("[ensureCsrf] Error in ensureCsrf outer block",a)}}const Mt=p(!1),U=p([]),ta=p([]),sa=p(null),At=p({x:0,y:0}),xa=p(!1),{showSuccess:Se,showError:ae}=jl(),oe=p(900),fe=p(600),La=p(null);let ct=[];const _=p(null),Yt=p(0),Xt=p(0),te=p([]),pe=p([]),Nt=p([]),Q=p([]),ve=p([]),Ye=p(!1),Bt=p(!1),S=p(null),gl=p(!1),qt=Wo({nodes:U,focusedNode:_,childNodes:te,selectedChild:S,grandChildNodes:Q},{wrapLabel:Ft,debug:!1}),Kl=st(()=>{const a=[];try{const e=h.scenario?.name||"—";if(a.push(`Escenario: ${e}`),_.value){const t=_.value?.name||"—";a.push(`Capacidad: ${t}`)}if(S.value){const t=S.value,l=t?.name||t?.raw?.name||t?.compName||"—";a.push(`Competencia: ${l}`)}}catch(e){return console.warn("[breadcrumbParts] Error building breadcrumb parts",e),[`Escenario: ${h.scenario?.name||"—"}`]}return a}),Ca=p(null),Vt=p(!1),Sa=p(""),_a=p(""),ca=p(void 0),Ht=p(null),_e=p(""),Ae=p(""),Ua=p("target"),Ea=p(10),Ma=p(1),Ya=p(""),Aa=p(3),Xa=p(!1),Xe=p(!1),Na=p(!1),Ba=p(!1),ut=p(!1),zt=p([]),la=p(""),It=p(""),jt=p(void 0),ua=p(""),dt=p(null);function hl(){la.value="",It.value="",jt.value=void 0,ua.value=""}const qa=p(!1),pt=p(!1),da=p([]),ft=p(null),vt=p(null),Wt=p(null),Va=p(!1),Oe=p(null),mt=p(""),yt=p(""),Ha=p("technical"),za=p("tactical"),ja=p("domain"),gt=p(""),Kt=p(!1),Ia=p(void 0),Oa=p(void 0),Be=p(void 0),Wa=p(""),Ka=p(!1),Za=p(!1),Ja=p(null),qe=p(""),Pa=p(""),Ta=p(""),Zt=p(!1),Jt=p(!1),Qa=p(!1),bl=p(0),wl=p(0),Qt=p(null),el=p(!1),kl=p(null),al=["offset","gap-large","curve","spread"];function Zl(){T.value=(T.value+1)%al.length}function xl(a,e){try{e.preventDefault(),e.stopPropagation()}catch(v){console.warn("[openNodeContextMenu] Error preventing default/propagation",v)}const t=La.value?La.value.getBoundingClientRect():{left:0,top:0,width:oe.value,height:fe.value},l=260,o=e.clientX-t.left,i=e.clientY-t.top,r=Math.max(8,Math.min(o,(t.width??oe.value)-l-8)),s=Math.max(8,Math.min(i,(t.height??fe.value)-24));bl.value=Math.round(r),wl.value=Math.round(s),Qt.value=a,el.value=!!(a&&a.id!=null&&a.id<0),Qa.value=!0}function tl(){Qa.value=!1,Qt.value=null}function Jl(){const a=Qt.value;if(!a)return tl();if(el.value){S.value=a;const e=pe.value.find(l=>l.target===a.id),t=e?ge(e.source):null;t&&(_.value=ge(t.id)||t)}else _.value=ge(a.id)||a,S.value=null;Ve(async()=>{try{if(Tt(),el.value&&S.value){const e=S.value?.compId??S.value?.raw?.id??Math.abs(S.value?.id||0);if(e){const t=await sl(Number(e));try{S.value.skills=Array.isArray(t)?t:[]}catch(l){console.warn("[contextViewEdit] Error assigning skills",l)}}}}catch(e){console.warn("[contextViewEdit] Error in nextTick callback",e)}Ye.value=!0,tl()})}Gt(async()=>{const a=e=>{if(Qa.value){try{const t=kl.value;if(t&&e.target&&e.target instanceof Node&&t.contains(e.target))return}catch(t){console.warn("[contextMenuHandler] Error checking if click was inside menu",t)}Qa.value&&tl()}};document.addEventListener("pointerdown",a),ul(()=>document.removeEventListener("pointerdown",a))});async function Ql(){try{const a=await ne.get("/api/skills");da.value=Array.isArray(a)?a:a?.data??[]}catch(a){console.warn("[loadAvailableSkills] Error loading skills",a),da.value=[]}}const{createAndAttachSkill:Cl}=jo();function eo(){if(!qe.value||!qe.value.trim()){ae("El nombre es obligatorio");return}const a=String(ua.value||"").split(",").map(e=>e.trim()).filter(Boolean);a.push(qe.value.trim()),ua.value=a.join(", "),qa.value=!1,qe.value="",Pa.value="",Ta.value="",Se("Skill añadida (se guardará junto con la competencia)")}function ao(){const a={name:qe.value.trim()};a.category=Pa.value&&String(Pa.value).trim()!==""?Pa.value:"technical",Ta.value&&String(Ta.value).trim()!==""&&(a.description=Ta.value);const e=S.value.compId??S.value.raw?.id??Math.abs(S.value.id||0);return{payload:a,compId:e}}async function to(a){if(a&&(Array.isArray(S.value.skills)||(S.value.skills=[]),S.value.skills.push(a)),S.value){const t=S.value.id,l=kt(t),o=we(t)??S.value,i=o&&l?{x:o.x,y:l.y}:o??l,r=A(S.value,Q.value,ve.value,i,{layout:"auto"},fe.value);Q.value=r.grandChildNodes,ve.value=r.grandChildEdges,Ve(()=>{Q.value=Q.value.map(s=>({...s,x:s.animTargetX??s.x,y:s.animTargetY??s.y,animScale:1,animOpacity:1,animFilter:"none"}))})}vt.value=`Skill "${qe.value}" creada y asociada correctamente`,qe.value="",Pa.value="",Ta.value="",await Ve();const e=document.querySelector("[data-skill-form]");e&&e.scrollIntoView({behavior:"smooth",block:"start"})}function lo(a){return a?.response?.data?.message?a.response.data.message:a?.message?a.message:typeof a=="string"?a:"Error creando y asociando skill"}async function oo(){if(Na.value){eo();return}if(!S.value)return ae("Seleccione una competencia");if(!qe.value||!qe.value.trim())return ae("El nombre es obligatorio");Zt.value=!0;try{const{payload:a,compId:e}=ao();if(!e)throw new Error("No competency target available");const t=await Cl(e,a);await to(t)}catch(a){console.error("[createAndAttachSkill] error",a),ft.value=lo(a)}finally{Zt.value=!1}}async function ro(){if(!S.value)return ae("Seleccione una competencia");if(!Ja.value)return ae("Seleccione una skill");Jt.value=!0;try{const a=S.value.compId??S.value.raw?.id??Math.abs(S.value.id||0);try{await ne.post(`/api/competencies/${a}/skills`,{skill_id:Ja.value})}catch(e){console.warn("[attachExistingSkill] Backend attach failed, falling back to optimistic update",e);const t=da.value.find(l=>l.id===Ja.value);t&&(Array.isArray(S.value.skills)||(S.value.skills=[]),S.value.skills.push(t))}if(S.value){const e=S.value.id,t=kt(e),l=we(e)??S.value,o=l&&t?{x:l.x,y:t.y}:l??t,i=A(S.value,Q.value,ve.value,o,{layout:"auto"},fe.value);Q.value=i.grandChildNodes,ve.value=i.grandChildEdges,Ve(()=>{Q.value=Q.value.map(r=>({...r,x:r.animTargetX??r.x,y:r.animTargetY??r.y,animScale:1,animOpacity:1,animFilter:"none"}))})}pt.value=!1,Ja.value=null,Se("Skill asociada")}catch(a){console.error("[attachExistingSkill] Error associates skill",a),ae("Error asociando skill")}finally{Jt.value=!1}}async function io(a){const e=a??Oe.value;if(!e)return ae("No hay skill seleccionada");if(!S.value)return ae("Seleccione una competencia");if(!_.value)return ae("Seleccione una capacidad");Bt.value=!0;const t=S.value.raw?.id??S.value.compId??S.value.id,l=_.value?.id,o=e?.id??e?.raw?.id??null;console.debug("[removeSkillFromCompetency]",{realCompetencyId:t,capabilityId:l,skillId:o,skillToDelete:e}),Za.value=!0;try{if(t&&o){console.debug("[removeSkillFromCompetency] Attempting DELETE:",{endpoint:`/api/competencies/${t}/skills/${o}`,realCompetencyId:t,skillId:o});try{const r=await ne.delete(`/api/competencies/${t}/skills/${o}`);console.debug("[removeSkillFromCompetency] SUCCESS: Deleted via backend",r)}catch(r){console.debug("[removeSkillFromCompetency] FAILED: backend delete:",r)}}await qt.remove("skill",o,t),Array.isArray(da.value)&&(da.value=da.value.filter(r=>r.id!==o),console.debug("[removeSkillFromCompetency] availableSkills filtered")),Va.value=!1,Oe.value=null,Se("Skill eliminada correctamente")}catch(i){console.error("[removeSkillFromCompetency] error",i),ae("Error eliminando skill")}finally{Za.value=!1,Bt.value=!1}}const Fa=p(""),Da=p(""),et=p(null),Sl=p(""),at=p(10),tt=p(1),lt=p(3),ot=p(!1),ht=p(""),Ot=p(!1),bt=p(null),no=p(0);let wt=null;function _l(a,e=!0){try{const t=pe.value.find(i=>i.target===a),l=t?t.source:null,o=K.value?.id??null;U.value=U.value.map(i=>i.id===l?{...i,visible:!0}:e&&i.id===o?{...i,visible:!0}:{...i,visible:!1}),te.value=te.value.map(i=>i.id===a?{...i,visible:!0}:i.__parentId===l||i.parentId===l?{...i,visible:!1}:{...i,visible:!1})}catch(t){console.warn("[showOnlySelectedAndParent] Error calculating visibility",t)}}function so(){const a=bt.value;if(!a)return;const e=Math.max(0,a.scrollHeight-a.clientHeight),t=e===0?0:Math.round(a.scrollTop/e*100);no.value=t}const rt={collapsed:"stratos:scenario:nodeSidebarCollapsed",lastView:"stratos:scenario:lastView",lastFocusedId:"stratos:scenario:lastFocusedNodeId"},ll=p(null),pa=p(0),fa=p(0),it=p(1),Pt=p(!1),El=p(0),Ml=p(0),Al=p(0),Nl=p(0),co=st(()=>({transform:`translate(${pa.value}px, ${fa.value}px) scale(${it.value})`,transformOrigin:"0 0"}));function uo(a){if(!a.ctrlKey)return;a.preventDefault();const t=a.currentTarget.getBoundingClientRect(),l=a.clientX-t.left,o=a.clientY-t.top,i=(l-pa.value)/it.value,r=(o-fa.value)/it.value,s=a.deltaY>0?-zl:zl,v=Math.max(gi,Math.min(hi,it.value+s));pa.value=l-i*v,fa.value=o-r*v,it.value=v}function po(a){a.button!==0||a.target.closest(".node-group, button, input, [data-interactive]")||(Pt.value=!0,El.value=a.clientX,Ml.value=a.clientY,Al.value=pa.value,Nl.value=fa.value,a.currentTarget.style.cursor="grabbing")}function fo(a){if(!Pt.value)return;const e=a.clientX-El.value,t=a.clientY-Ml.value;pa.value=Al.value+e,fa.value=Nl.value+t}function Vl(a){Pt.value&&(Pt.value=!1,a.currentTarget.style.cursor="default")}const he=st(()=>S.value??_.value),K=p(null),ol=p(!1);function va(a){return new Promise(e=>setTimeout(e,a))}function ma(a,e=Qe*2+bi){return new Promise(t=>{const l=`[data-node-id="${a}"]`;let o=document.querySelector(l),i=null;const r=()=>{o&&o.removeEventListener("transitionend",s),i&&clearTimeout(i)},s=v=>{const m=v;(!m.propertyName||m.propertyName==="transform")&&(r(),t(!0))};i=setTimeout(()=>{r(),t(!1)},e),o?o.addEventListener("transitionend",s):Ve().then(()=>{if(o=document.querySelector(l),!o){i&&clearTimeout(i),t(!1);return}o.addEventListener("transitionend",s)})})}function kt(a){try{if(!La.value)return;const e=`[data-node-id="${a}"]`,t=document.querySelector(e);if(!t)return;const l=La.value.getBoundingClientRect(),o=t.getBoundingClientRect(),i=o.left+o.width/2-l.left,r=o.top+o.height/2-l.top,s=it.value||1,v=Math.round((i-(pa.value||0))/s),m=Math.round((r-(fa.value||0))/s);return{x:v,y:m}}catch(e){console.warn("[getNodeMapCenter] Error calculating node center",e)}}const ze=p(new Map);function xt(a,e){if(!a)return;if(e&&e.id!==a.id&&(te.value=[],pe.value=[]),ze.value.size===0&&(U.value.forEach(O=>{ze.value.set(O.id,{x:O.x??0,y:O.y??0})}),K.value&&ze.value.set(K.value.id,{x:K.value.x,y:K.value.y})),e&&e.id!==a.id){const O=U.value.find(re=>re.id===e.id),Z=U.value.find(re=>re.id===a.id);if(O&&Z){const re=O.x??0,ce=O.y??0;if(O.x=Z.x??re,O.y=Z.y??ce,Z.x=re,Z.y=ce,U.value=U.value.map(be=>be&&(be.id===Z.id?{...Z}:be.id===O.id?{...O}:be)),ol.value&&K.value){const be=Math.round(oe.value/2),ie=Math.round(fe.value*.45),Pe=h.visualConfig?.scenarioOffsetSwap??150;K.value.x=be,K.value.y=Math.round(ie-Pe)}return}}const t=Math.round(oe.value/2),o=Math.round(fe.value*.25),i=Math.round(oe.value*.18),r=Math.round(oe.value*.82),v=U.value.filter(O=>O&&O.id!==a.id).map(O=>({n:O,origX:O.x??ze.value.get(O.id)?.x??oe.value/2})).sort((O,Z)=>O.origX-Z.origX).map(O=>O.n),m=Math.ceil(v.length/2),u=v.slice(0,m),y=v.slice(m),X=O=>O.y??ze.value.get(O.id)?.y??o;u.sort((O,Z)=>X(O)-X(Z)),y.sort((O,Z)=>X(O)-X(Z));const I=64,B=Math.max(120,fe.value-64),le=(O,Z,re)=>{if(O.length===0)return;const ce=O.length,be=Math.max(0,B-I),n=34,ie=Math.max(48,n*2+8),ya=ce>1?Math.min(140,Math.max(ie,Math.floor(be/(ce-1)))):0,j=Math.round(n+12),Ge=Math.max(I,o-j),We=Math.min(B,o+j),oa=5;if(ce<=oa){let Me=Math.round(o-(ce-1)*ya/2);const ha=Me+(ce-1)*ya;if(!(ha<Ge||Me>We)){const Le=Ge-I,Ze=B-We;if(Le>=Ze){const ia=Math.min(Le,We-Me+j);Me=Math.max(I,Me-ia)}else{const ia=Math.min(Ze,ha-Ge+j);Me=Math.min(B-(ce-1)*ya,Me+ia)}}for(let Le=0;Le<ce;Le++){const Ze=O[Le],ia=Me+Le*ya;Ze.x=Z,Ze.y=g(ia)}return}const ga=Math.ceil(ce/oa),ra=Math.ceil(ce/ga),Rt=56;for(let Me=0;Me<ga;Me++){const ha=O.slice(Me*ra,Me*ra+ra),Ke=ha.length,Le=Ke>1?Math.min(ya,Math.floor(be/(Ke-1))):0,Ze=Math.round(o-(Ke-1)*Le/2),ia=Me-(ga-1)/2,cl=Math.round(ia*Rt)*(re==="left"?-1:1),$o=Z+cl;for(let $t=0;$t<Ke;$t++){const Xl=ha[$t],Go=Ze+$t*Le;Xl.x=Math.min(Math.max(32,$o),Math.max(48,oe.value-32)),Xl.y=g(Go)}}};if(le(u,i,"left"),le(y,r,"right"),U.value=U.value.map(O=>{if(!O)return O;if(O.id===a.id)return{...O,x:t,y:o};const Z=u.find(re=>re.id===O.id)||y.find(re=>re.id===O.id);return Z?{...O,x:Z.x,y:Z.y}:{...O,x:Math.min(Math.max(48,O.x??t),Math.max(160,oe.value-48)),y:g(O.y??o)}}),ol.value&&K.value){const O=h.visualConfig?.scenarioOffset??80;K.value.x=t,K.value.y=Math.round(o-O)}}function rl(){K.value={id:0,name:h.scenario&&(h.scenario.name||"Escenario"),x:Math.round(oe.value/2),y:Math.round(fe.value*.1)}}async function vo(){try{await Ct()}catch(a){console.warn("[handleScenarioClick] Error reordering nodes",a)}try{R()}catch(a){console.warn("[handleScenarioClick] Error restoring view",a)}}Je(_,a=>{try{if(a&&globalThis.__DEBUG__){const t=a.id!=null&&a.id<0?pe.value.find(l=>l.target===a.id)?.source??null:null;console.debug("[focusedNode.change] id=",a.id,"level=",M(a.id),"isChild=",!!(a.skills||a.compId),"parentId=",t)}}catch(t){console.warn("[watchFocusedNode] Error in debug logging",t)}if(!a){Sa.value="",_a.value="",ca.value=void 0,Ht.value=null,Ua.value="target",Ea.value=10,Ma.value=1,Ya.value="",Aa.value=3,Xa.value=!1;return}Sa.value=a.name??"",_a.value=a.description??a.raw?.description??"",ca.value=a.importance??a.raw?.importance??void 0,Ht.value=a.level??null;const e=t=>a[t]??a.raw?.[t]??a.raw?.attributes?.[t]??a.raw?.capability?.[t]??a.raw?.data?.[t]??a.raw?.entity?.[t]??"";try{const t=e("type");typeof t=="string"?_e.value=t.toLowerCase():t==null?_e.value="":_e.value=String(t).toLowerCase()}catch(t){console.warn("[watchFocusedNode] Error resolving type",t),_e.value=""}try{const t=e("category");typeof t=="string"?Ae.value=t.toLowerCase():t==null?Ae.value="":Ae.value=String(t).toLowerCase()}catch(t){console.warn("[watchFocusedNode] Error resolving category",t),Ae.value=""}Ua.value=a.strategic_role??a.raw?.strategic_role??"target",Ea.value=a.raw?.strategic_weight??10,Ma.value=a.raw?.priority??1,Ya.value=a.raw?.rationale??"",Aa.value=a.raw?.required_level??a.required??3,Xa.value=!!(a.raw?.is_critical||a.is_critical);try{const t=S.value;if(!a)$a(),S.value=null;else if(t){const l=pe.value.find(i=>i.target===t.id);(l?l.source:null)!==a.id&&($a(),S.value=null)}}catch(t){console.warn("[watchFocusedNode] Error collapsing orphan skills",t)}}),Je(S,a=>{if(!a){try{$a()}catch(l){console.warn("[watchSelectedChild] Error collapsing grandchildren",l)}Fa.value="",Da.value="",et.value=null,Sl.value="",at.value=10,tt.value=1,lt.value=3,ot.value=!1,ht.value="";return}if(!Bt.value)try{_.value&&Ee(_.value,{x:_.value.x??0,y:_.value.y??0},{layout:"auto"})}catch(l){console.warn("[watchSelectedChild] Error expanding competencies",l)}Fa.value=a.name??a.raw?.name??"",Da.value=a.description??a.raw?.description??"",et.value=a.readiness??a.raw?.readiness??null;const e=Array.isArray(a.skills)?a.skills.map(l=>l.name??l):[];Sl.value=e.join(", ");const t=a.raw?.pivot??a.raw?.capability_pivot??{};at.value=t?.strategic_weight??10,tt.value=t?.priority??1,lt.value=t?.required_level??3,ot.value=!!t?.is_critical,ht.value=t?.rationale??""}),Je(Na,a=>{a||hl()});function Tt(){if(_.value){const a=_.value,e=o=>a[o]??a.raw?.[o]??a.raw?.attributes?.[o]??a.raw?.capability?.[o]??a.raw?.data?.[o]??a.raw?.entity?.[o]??"";Sa.value=a.name??"",_a.value=a.description??a.raw?.description??"",ca.value=a.importance??a.raw?.importance??void 0,Ht.value=a.level??null;try{const o=e("type");typeof o=="string"?_e.value=o.toLowerCase():o==null?_e.value="":_e.value=String(o).toLowerCase()}catch(o){console.warn("[resetFocusedEdits] Error resolving type",o),_e.value=""}try{const o=e("category");Ae.value=typeof o=="string"?o.toLowerCase():o==null?"":String(o).toLowerCase()}catch(o){console.warn("[resetFocusedEdits] Error resolving category",o),Ae.value=""}try{const o=a.raw??{};let i=[];try{i=Object.keys(o)}catch(r){console.warn("[resetFocusedEdits] Error getting raw keys",r),i=[]}console.debug("[resetFocusedEdits] resolved type=",_e.value,"category=",Ae.value),console.debug("[resetFocusedEdits] raw keys=",i);try{console.debug("[resetFocusedEdits] raw.capability=",o?.capability)}catch(r){console.warn("[resetFocusedEdits] Error debugging raw.capability",r)}try{console.debug("[resetFocusedEdits] raw.scenario_capabilities=",o?.scenario_capabilities)}catch(r){console.warn("[resetFocusedEdits] Error debugging raw.scenario_capabilities",r)}try{console.debug("[resetFocusedEdits] raw.pivot=",o?.pivot)}catch(r){console.warn("[resetFocusedEdits] Error debugging raw.pivot",r)}try{console.debug("[resetFocusedEdits] capabilityTreeRaw sample=",Ca?.value?Array.isArray(Ca.value)?Ca.value.find(r=>r.id==a.id):Ca.value:null)}catch(r){console.warn("[resetFocusedEdits] Error debugging capabilityTreeRaw",r)}}catch(o){console.warn("[resetFocusedEdits] Error in debug block",o)}Ua.value=a.strategic_role??a.raw?.strategic_role??"target";const t=a.raw??{};let l=t.pivot??t.scenario_capabilities??t.scenario_capability??t._pivot??null;Array.isArray(l)&&(l=l[0]??null),Ea.value=a.strategic_weight??l?.strategic_weight??t.strategic_weight??10,Ma.value=a.priority??l?.priority??t.priority??1,Ya.value=a.rationale??l?.rationale??t.rationale??"",Aa.value=a.required_level??l?.required_level??t.required_level??a.required??3,Xa.value=!!(a.is_critical??l?.is_critical??t.is_critical??a.is_critical)}}async function mo(){if(!_.value)return;const a=_.value.id;Xe.value=!0,await aa();try{const e={name:Sa.value,description:_a.value,importance:typeof ca.value<"u"?Number(ca.value):void 0,position_x:_.value.x??void 0,position_y:_.value.y??void 0,type:_e.value||void 0,category:Ae.value||void 0};try{console.debug("[saveFocusedNode] PATCH /api/capabilities/"+a,e);const i=await ne.patch(`/api/capabilities/${a}`,e);console.debug("[saveFocusedNode] PATCH /api/capabilities response",i),Se("Capacidad actualizada");try{const r=_.value;r&&(r.type=_e.value||r.type,r.category=Ae.value||r.category,r.raw={...r.raw||{},...i?.data??{}})}catch(r){console.warn("[saveFocusedNode] Error in optimistic local update",r)}}catch(i){try{const r=i,s=r?.response?.status??null;console.error("[saveFocusedNode] error PATCH /api/capabilities/"+a,r?.response?.data??r),s!==404&&ae(r?.response?.data?.message||"Error actualizando capacidad")}catch(r){console.warn("[saveFocusedNode] Error handling cap update error",r)}}const t={strategic_role:Ua.value,strategic_weight:typeof Ea.value<"u"?Number(Ea.value):void 0,priority:typeof Ma.value<"u"?Number(Ma.value):void 0,rationale:Ya.value,required_level:typeof Aa.value<"u"?Number(Aa.value):void 0,is_critical:!!Xa.value};try{if(!h.scenario||!h.scenario.id)console.warn("[saveFocusedNode] no scenario context available; skipping pivot update");else{console.debug("[saveFocusedNode] PATCH pivot",{scenarioId:h.scenario?.id,id:a,pivotPayload:t});let i=null;try{i=await ne.patch(`/api/strategic-planning/scenarios/${h.scenario?.id}/capabilities/${a}`,t),Se("Relación escenario–capacidad actualizada")}catch(r){console.error("[saveFocusedNode] error PATCH pivot",r?.response?.data??r);try{i=await ne.post(`/api/strategic-planning/scenarios/${h.scenario?.id}/capabilities`,{name:Sa.value,description:_a.value||"",importance:ca.value??3,type:_e.value??null,category:Ae.value??null,strategic_role:t.strategic_role,strategic_weight:t.strategic_weight,priority:t.priority,rationale:t.rationale,required_level:t.required_level,is_critical:t.is_critical}),Se("Relación actualizada (fallback)")}catch(s){console.error("[saveFocusedNode] error POST pivot fallback",s?.response?.data??s),ae("No se pudo actualizar la relación. Verifica el backend.")}}try{const r=(i?.data?.updated??i?.data??i)||null;if(r&&typeof r=="object"){const v=(r.updated??r)||r;if(U.value=U.value.map(m=>{if(m.id===a){const u={...m.raw??{},scenario_capabilities:Array.isArray(m.raw?.scenario_capabilities)?m.raw.scenario_capabilities:[m.raw.scenario_capabilities].filter(Boolean)};return u.scenario_capabilities=u.scenario_capabilities||[],u.scenario_capabilities.length===0&&u.scenario_capabilities.push({}),u.scenario_capabilities[0]={...u.scenario_capabilities[0]||{},...v||{}},{...m,raw:u}}return m}),_.value&&_.value.id===a){const m={..._.value.raw??{}};m.scenario_capabilities=m.scenario_capabilities||[],m.scenario_capabilities.length===0&&m.scenario_capabilities.push({}),m.scenario_capabilities[0]={...m.scenario_capabilities[0]||{},...v||{}},_.value={..._.value,raw:m}}}}catch(r){console.warn("[saveFocusedNode] Error merging pivot updates",r)}}}catch(i){console.error("[saveFocusedNode] unexpected error in pivot update flow",i)}try{const i=_.value?.id??a;U.value=U.value.map(r=>{if(r.id===i){const s={...r.raw??{},type:_e.value??r.raw?.type??null,category:Ae.value??r.raw?.category??null};return{...r,type:_e.value??r.type,category:Ae.value??r.category,raw:s}}return r}),_.value&&_.value.id===a&&(_.value={..._.value,type:_e.value??_.value.type,category:Ae.value??_.value.category,raw:{..._.value.raw??{},type:_e.value??_.value.raw?.type,category:Ae.value??_.value.raw?.category}})}catch(i){console.warn("[saveFocusedNode] Error updating local node",i)}let l=null;try{const i=await ne.get(`/api/capabilities/${a}`);l=i?.data??i}catch(i){console.warn("[saveFocusedNode] Error fetching fresh capability",i)}const o=_.value?_.value.id:null;await f(h.scenario?.id);try{if(l&&typeof l.id<"u"&&(U.value=U.value.map(i=>i.id===Number(l.id)?{...i,type:l.type??i.type,category:l.category??i.category,raw:{...i.raw??{},...l}}:i),_.value&&_.value.id===Number(l.id))){_.value={..._.value,type:l.type??_.value.type,category:l.category??_.value.category,raw:{..._.value.raw??{},...l??{}}};try{Tt()}catch(i){console.warn("[saveFocusedNode] Error resetting edits after merge",i)}}}catch(i){console.warn("[saveFocusedNode] Error merging authoritative fields",i)}try{console.debug("[saveFocusedNode] after refresh, focusedId=",o,"nodeById=",ge(o))}catch(i){console.warn("[saveFocusedNode] Error debugging after refresh",i)}if(o!=null){const i=ge(o);if(i){_.value=i;try{Tt()}catch(r){console.warn("[saveFocusedNode] Error resetting edits after restore",r)}await Ve(),xt(i)}}}finally{Xe.value=!1}}async function Il(){if(!_.value&&!S.value)return;const a=S.value||_.value;if(!a)return;const e=a.id,t=typeof e=="number"&&e<0;console.debug("[deleteFocusedNode] selectedChild:",S.value?"YES":"NO","id:",e,"isChild:",t);let l=null;t&&(l=a.compId??Math.abs(e));const o=t||S.value!==null,i=o?"competencia":"capacidad",r=o?"¿Eliminar esta competencia? Esta acción es irreversible.":"¿Eliminar esta capacidad y su relación con el escenario? Esta acción es irreversible.";if(console.debug("[deleteFocusedNode] isCompetency:",o,"nodeName:",i,"compId:",l),!!globalThis.confirm(r)){Xe.value=!0;try{if(o){const v=l||Math.abs(e);console.debug("[deleteFocusedNode] Deleting competency with ID:",v);const m=pe.value.find(y=>y.target===e),u=m?m.source:_.value?.id;if(console.debug("[deleteFocusedNode] Parent capability ID:",u),!u){ae("No se puede determinar la capacidad padre"),Xe.value=!1;return}try{const y=await ne.delete(`/api/strategic-planning/scenarios/${h.scenario?.id}/capabilities/${u}/competencies/${v}`);console.debug("[deleteFocusedNode] DELETE competency response:",y)}catch(y){const X=y;if(console.debug("[deleteFocusedNode] DELETE competency error status:",X?.response?.status),X?.response?.status!==404)throw y}te.value=te.value.filter(y=>(y.compId??Math.abs(y.id))!==v),pe.value=pe.value.filter(y=>y.target!==e&&y.source!==e),Q.value=Q.value.filter(y=>y.parentId!==v&&y.parentId!==e),ve.value=ve.value.filter(y=>y.source!==e&&y.target!==e),console.debug("[deleteFocusedNode] Competency deleted locally"),Se("Competencia eliminada")}else{console.debug("[deleteFocusedNode] Deleting capability with ID:",e);let v=null,m=null;try{await ne.delete(`/api/strategic-planning/scenarios/${h.scenario?.id}/capabilities/${e}`)}catch(u){v=u?.response?.status??null}try{await ne.delete(`/api/capabilities/${e}`),U.value=U.value.filter(u=>u.id!==e),te.value=te.value.filter(u=>!(u.__parentId===e||u.parentId===e||u.raw&&u.raw.capability_id===e)),ta.value=ta.value.filter(u=>u.source!==e&&u.target!==e),pe.value=pe.value.filter(u=>u.source!==e&&u.target!==e)}catch(u){m=u?.response?.status??null}(v===404||v===null)&&(m===404||m===null)?(U.value=U.value.filter(u=>u.id!==e),te.value=te.value.filter(u=>!(u.__parentId===e||u.parentId===e||u.raw&&u.raw.capability_id===e)),ta.value=ta.value.filter(u=>u.source!==e&&u.target!==e),pe.value=pe.value.filter(u=>u.source!==e&&u.target!==e),ae("Eliminado localmente. El backend no expone endpoints DELETE; implementar API para eliminación permanente.")):Se("Capacidad y relación eliminadas")}await f(h.scenario?.id),_.value=null,S.value=null}catch(v){console.error("[deleteFocusedNode] Error:",v),ae(`Error al eliminar ${i}`)}finally{Xe.value=!1}}}function yo(){c.value="",C.value="",z.value="",se.value="",de.value=3,Ce.value="target",Re.value=10,$e.value=1,ea.value="",He.value=3,ka.value=!1,Ye.value=!1,x.value=!0}function go(){try{const a=he.value;if(a&&(a.compId||typeof a.id=="number"&&a.id<0)){const e=pe.value.find(l=>l.target===a.id),t=e?ge(e.source):null;t&&(_.value=t)}else if(a&&a.id!=null)_.value=ge(a.id)||a;else if(S.value){const e=S.value?.id??null,t=e!=null?pe.value.find(o=>o.target===e):null,l=t?ge(t.source):null;l&&(_.value=l)}}catch(a){console.warn("[showCreateCompDialog] Error setting focused node",a)}S.value=null,Na.value=!0}function ho(){try{const a=he.value;if(a&&(a.compId||typeof a.id=="number"&&a.id<0))S.value=a;else if(a&&Array.isArray(a.competencies)&&a.competencies.length>0){const e=a.competencies[0],t=te.value.find(l=>l.compId===e.id);S.value=t||{compId:e.id,raw:e,id:-(a.id*1e3+1)}}else if(a&&a.skillId){const e=ve.value?.find(t=>t.target===a.id);if(e){const t=te.value.find(l=>l.id===e.source);t?S.value=t:console.warn("[showCreateSkillDialog] parent competency not found in childNodes")}}else if(S.value){const e=S.value;if(e.skillId){const t=ve.value?.find(l=>l.target===e.id);if(t){const l=te.value.find(o=>o.id===t.source);l&&(S.value=l)}}}S.value&&S.value.skillId&&(console.warn("[showCreateSkillDialog] selectedChild is a skill, not a competency. Clearing."),S.value=null)}catch(a){console.error("[showCreateSkillDialog] error setting context:",a)}qa.value=!0}async function bo(){await Ql(),pt.value=!0}async function wo(){await Oo(),Ba.value=!0}async function ko(){if(!h.scenario||!h.scenario.id)return ae("Escenario no seleccionado");if(!c.value||!c.value.trim())return ae("El nombre es obligatorio");Ga.value=!0,await aa();try{const a={name:c.value.trim(),description:C.value||null,importance:typeof de.value<"u"?Number(de.value):3,type:z.value||null,category:se.value||null,strategic_role:Ce.value,strategic_weight:typeof Re.value<"u"?Number(Re.value):10,priority:typeof $e.value<"u"?Number($e.value):1,rationale:ea.value||null,required_level:typeof He.value<"u"?Number(He.value):3,is_critical:!!ka.value};console.debug("[saveNewCapability] POST /api/strategic-planning/scenarios/"+h.scenario.id+"/capabilities",a);const e=await ne.post(`/api/strategic-planning/scenarios/${h.scenario.id}/capabilities`,a);console.debug("[saveNewCapability] POST response",e);const t=e?.data??e;Se("Capacidad creada y asociada al escenario");try{if(t&&typeof t.id<"u"){const l=Ol(U.value.length,(U.value.length||0)+1),o={id:Number(t.id),name:t.name,displayName:Ft(t.name,14),x:Math.round(l.x),y:Math.round(l.y),is_critical:!!t.is_critical,description:t.description??null,competencies:[],importance:t.importance??3,level:null,required:null,raw:t};U.value=[...U.value,o],_t(h.scenario.capabilities||[]),xa.value=!0}}catch(l){console.warn("[saveNewCapability] Error in optimistic update",l)}await f(h.scenario.id),x.value=!1,c.value="",C.value="",z.value="",se.value="",de.value=3,Ce.value="target",Re.value=10,$e.value=1,ea.value="",He.value=3,ka.value=!1}catch(a){ae(a?.response?.data?.message||"Error creando capacidad")}finally{Ga.value=!1}}function Ft(a,e=14){if(a==null)return"";const t=String(a).trim();if(t.length<=e)return t;const l=(v,m)=>{if(v.length<=m)return{line:v,rest:""};const y=v.slice(0,m+1).lastIndexOf(" ");if(y>0){const X=v.slice(0,y),I=v.slice(y+1).trim();return{line:X,rest:I}}return{line:v.slice(0,m),rest:v.slice(m).trim()}},o=l(t,e);if(!o.rest)return o.line;const i=o.rest;if(i.length<=e)return o.line+`
`+i;const r=l(i,e);let s=r.line;return r.rest&&s.length>=e?(s=s.slice(0,Math.max(0,e-1)),s=s.replace(/\s+$/,""),s=s+"…"):r.rest&&(s=s+"…"),o.line+`
`+s}function Ol(a,e){const t=oe.value/2,l=fe.value/2-30;if(e<=1)return{x:Math.round(t),y:Math.round(l)};const o=Math.min(5,Math.max(1,Math.ceil(Math.sqrt(e)))),i=Math.max(1,Math.ceil(e/o)),r=24,s=Math.max(120,oe.value-r*2),v=Math.max(120,fe.value-r*2),m=o>1?Math.min(160,Math.floor(s/o)):0,u=i>1?Math.min(140,Math.floor(v/i)):0,y=a%o,X=Math.floor(a/o),I=(o-1)*m,B=(i-1)*u,le=y*m-I/2,O=X*u-B/2;return{x:Math.round(t+le),y:Math.round(l+O)}}async function Ct(){if(!U.value.length)return;const e=K.value?{id:K.value.id,x:K.value.x,y:K.value.y}:void 0;try{console.debug("[reorderNodes] before - count:",U.value.length,"ids:",U.value.map(t=>t&&t.id))}catch(t){console.warn("[reorderNodes] Error in pre-reorder debug logging",t)}U.value=tr(U.value.map(t=>({...t,name:t.name??t.raw?.name??""})),oe.value,fe.value,e);try{console.debug("[reorderNodes] after - count:",U.value.length,"ids:",U.value.map(t=>t&&t.id))}catch(t){console.warn("[reorderNodes] Error in post-reorder debug logging",t)}xa.value=!0;try{_.value=null,te.value=[],pe.value=[],Ye.value=!1}catch(t){console.warn("[reorderNodes] Error resetting focus/sidebar",t)}try{await Yl(),xa.value=!1}catch{ae("No se pudieron guardar las posiciones tras reordenar"),xa.value=!0}}function Pl(a){const t=Math.max(160,oe.value-48);if(_.value&&a&&a.id!==_.value.id){const o=_.value.x??oe.value/2,i=a.x??oe.value/2,r=Math.round(oe.value*.18),s=Math.round(oe.value*.82),v=i<o?r:s;return Math.min(Math.max(48,v),t)}const l=a.x??0;return Math.min(Math.max(48,l),t)}function we(a){if(a==null)return null;if(K.value&&a===K.value.id)return{x:K.value.x,y:K.value.y};if(a<0){const t=Dt(a);return t||Et(a)}const e=ge(a);return e?{x:Pl(e),y:g(e.y??0)}:null}function Tl(a,e=!0){try{const t=e?a.target:a.source,l=we(t);if(!l)return{x:void 0,y:void 0};const o=l.x;let i=l.y;if(e&&t<0){const r=!!Dt(t);i=(i??0)-((r?14:24)+(r?4:6))}return{x:o,y:i}}catch{}return{x:void 0,y:void 0}}function xo(a){try{const e=we(a.target);if(!e)return 0;const t=pe.value.filter(l=>{const o=we(l.target);return l.source===a.source&&o&&Math.abs((o.x??0)-(e.x??0))<=8});return t.sort((l,o)=>l.target-o.target),Math.max(0,t.findIndex(l=>l===a))}catch(e){console.warn("[groupedIndexForEdge] Error calculating index",e)}return 0}function Fl(a){return a.animOpacity??.98}function je(a){try{const e=Tl(a,!1),t=Tl(a,!0),l=e.x,o=e.y,i=t.x,r=t.y,s=T.value,v=!!Dt(a.target)||!!Dt(a.source)||ve.value.includes(a);if(s===2&&typeof l=="number"&&typeof i=="number"){const m=v?k.skill.edge.baseDepth:k.competency.edge.baseDepth,u=v?k.skill.edge.curveFactor:k.competency.edge.curveFactor,y=Math.abs((r??0)-(o??0)),X=Math.max(m,Math.round(y*u)+m),I=Math.min(o??0,r??0)+X;return{isPath:!0,d:`M ${l} ${o} C ${l} ${I} ${i} ${I} ${i} ${r}`}}if(s===3&&typeof l=="number"&&typeof i=="number"){const m=xo(a),u=pe.value.concat(ve.value).filter(X=>{const I=we(X.target),B=we(a.target);return X.source===a.source&&I&&B&&Math.abs((I.x??0)-(B.x??0))<=8}),y=(m-(u.length-1)/2)*(v?k.skill.edge.spreadOffset:k.competency.edge.spreadOffset);return{isPath:!1,x1:l,y1:o,x2:(i??0)+y,y2:r}}if(s===1&&typeof l=="number"&&typeof i=="number"){const u=(r??0)-((v?14:20)-2);return{isPath:!1,x1:l,y1:o,x2:i,y2:u}}return{isPath:!1,x1:l,y1:o,x2:i,y2:r}}catch(e){return console.warn("[edgeRenderFor] error",e),{isPath:!1,x1:void 0,y1:void 0,x2:void 0,y2:void 0}}}function Dl(a){try{const e=we(a.source),t=we(a.target);if(!e||!t||typeof e.x!="number"||typeof t.x!="number")return"";const l=k.capability.scenarioEdgeDepth,o=Math.min(e.y??0,t.y??0)+l;return`M ${e.x} ${e.y} C ${e.x} ${o} ${t.x} ${o} ${t.x} ${t.y}`}catch(e){console.warn("[scenarioEdgePath] error",e)}return""}function St(a){if(!Array.isArray(a)||a.length===0){U.value=[];return}oe.value/2,fe.value/2-30,Math.min(oe.value,fe.value)/3,2*Math.PI/a.length;const e=a.map((l,o)=>{const i=l.position_x??l.x??l.cx??null,r=l.position_y??l.y??l.cy??null,s=i!=null?parseFloat(String(i)):NaN,v=r!=null?parseFloat(String(r)):NaN,m=!Number.isNaN(s)&&!Number.isNaN(v);let u,y;m&&(s>=0&&s<=100&&v>=0&&v<=100?(u=Math.round(s/100*oe.value),y=Math.round(v/100*fe.value)):(u=Math.round(s),y=Math.round(v)));const X=Ol(o,a.length),I=Math.round(X.x),B=Math.round(X.y);return{id:Number(l.id),name:l.name,x:u??I,y:y??B,_hasCoords:m,is_critical:l.is_critical??l.isCritical??!1,description:l.description??l.desc??null,competencies:Array.isArray(l.competencies)?l.competencies:Array.isArray(l.competency)?l.competency:[],importance:l.importance??l.rank??null,level:l.level??null,required:l.required??null,type:l.type??l.raw?.type??null,category:l.category??l.raw?.category??null,raw:l}});U.value=e.map(l=>({id:l.id,name:l.name,displayName:Ft(l.name,14),x:l.x,y:l.y,is_critical:!!l.is_critical,description:l.description,competencies:l.competencies,importance:l.importance,level:l.level,required:l.required,type:l.type,category:l.category,raw:l.raw})),rl();try{if(K.value){const o=K.value.x??Math.round(oe.value/2),i=K.value.y??Math.round(fe.value*.1);U.value=U.value.map(r=>{if(!r||r.x==null||r.y==null)return r;const s=r.x-o,v=r.y-i,m=Math.sqrt(s*s+v*v);if(m<140){if(m===0)return{...r,x:r.x,y:g(i+140)};const u=140/Math.max(1,m),y=Math.round(o+s*u),X=Math.round(i+v*u);return{...r,x:y,y:g(X)}}return r})}}catch{}Nt.value=U.value.map(l=>({source:K.value?.id??0,target:l.id,isScenarioEdge:!0})),_t(a),e.some(l=>!!l._hasCoords)&&oe.value&&fe.value&&E(U.value,ta.value,oe.value,fe.value),ct=a}function _t(a){const e=[],t=h.scenario?.connections;Array.isArray(t)&&t.length>0?t.forEach(l=>{const o=l.source??l.source_id??null,i=l.target??l.target_id??null;o!=null&&i!=null&&e.push({source:Number(o),target:Number(i),isCritical:!!l.is_critical})}):a.forEach(l=>{Array.isArray(l.connected_to)&&l.connected_to.forEach(o=>{e.push({source:Number(l.id),target:Number(o)})}),Array.isArray(l.links)&&l.links.forEach(o=>e.push({source:Number(l.id),target:Number(o)})),Array.isArray(l.connections)&&l.connections.forEach(o=>{const i=o.source??o.source_id??null,r=o.target??o.target_id??null;i!=null&&r!=null&&e.push({source:Number(i),target:Number(r),isCritical:!!o.is_critical})})}),ta.value=e}function ge(a){return U.value.find(e=>e.id===a)||null}function Et(a){return te.value.find(e=>e.id===a)||null}const Rl=async(a,e)=>{try{globalThis.__DEBUG__&&(console.debug("[node.click] id=",a?.id,"level=",M(a?.id),"isTrusted=",!!e?.isTrusted,"time=",Date.now()),console.debug(new Error("click-stack").stack?.split(`
`).slice(1,6).join(`
`)))}catch(i){console.warn("[handleNodeClick] Error in initial debug logging",i)}try{const i=M(a?.id);try{if(a?.id!=null&&a.id>=0&&_.value&&_.value.id===a.id&&te.value.length>0){Co();return}if(i===2&&S.value&&S.value.id===a.id&&Q.value.length>0){$a();return}}catch(r){console.warn("[handleNodeClick] Error checking collapse conditions",r)}if(i===2){try{globalThis.__DEBUG__&&console.debug("[node.click.level2] id=",a?.id,"level=",i)}catch(r){console.warn("[handleNodeClick] Error in level 2 debug logging",r)}try{Ot.value=!0,setTimeout(()=>{Ot.value=!1},Math.max(300,Qe))}catch(r){console.warn("[handleNodeClick] Error setting noAnimations",r)}try{const r=pe.value.find(v=>v.target===a.id),s=r?ge(r.source):null;if(s){const v=_.value?{..._.value}:void 0;try{$a()}catch(X){console.warn("[handleNodeClick] Error in pre-expand collapse",X)}xt(s,v);const m=Math.max(0,Math.round(Qe*.6));await Promise.race([ma(s.id),va(m)]);const u=a.id??a.compId??a.raw?.id,y=te.value.find(X=>X.id===u||X.compId===u||X.raw?.id===u)??a;S.value=y;try{globalThis.__DEBUG__&&console.debug("[expandCompetencies.call] source=handleNodeClick, target=parentNode",{nodeId:s?.id,comps:Array.isArray(s?.competencies)?s.competencies.length:0,opts:{x:s?.x??0,y:s?.y??0},visualConfigLayout:h.visualConfig?.capabilityChildrenOffset,configDefault:k.competency?.defaultLayout})}catch(X){console.warn("[handleNodeClick] Error in expansion debug logging",X)}try{const X=Array.isArray(s?.competencies)?s.competencies.length:0;X>=4?(console.debug("[expandCompetencies.call] source=handleNodeClick (sides)",{nodeId:s?.id,comps:X}),Ee(s,{x:s.x??0,y:s.y??0},{layout:"sides"})):console.debug("[expandCompetencies.call] skipped (<4 competencies)",{nodeId:s?.id,comps:X})}catch{Ee(s,{x:s.x??0,y:s.y??0})}}s?_.value=s:_.value=a;try{const v=S.value?.id??a?.id;v!=null&&_l(v,!0)}catch(v){console.warn("[handleNodeClick] Error updating visibility",v)}try{const v=S.value?.id??_.value.id;if(v!=null&&(te.value=te.value.map(u=>u.id===v?{...u,animOpacity:1,animScale:u.animScale??1,visible:!0}:u),Et(v))){const u=te.value.filter(y=>y.id!==v);te.value=u.concat(te.value.filter(y=>y.id===v))}}catch(v){console.warn("[handleNodeClick] Error reordering child nodes",v)}try{const v=S.value,m=v.compId??v.raw?.id??Math.abs(v.id||0),u=te.value.find(I=>I.id===m||I.compId===m||I.raw?.id===m)??v,y={...u,skills:u.skills,raw:{...u.raw??{},skills:u.skills}},X=Array.isArray(y.skills)?y.skills:y.raw?.skills??[];if(X&&X.length>0||m){if(X&&X.length>0)try{if(y&&y.id!=null){const I=y.id;await ma(I),await va(10);const B=kt(I),le=we(I)??{x:y?.x??0,y:y?.y??0},O=le&&B?{x:le.x,y:B.y}:le??B,Z=A(y,Q.value,ve.value,O,{layout:"auto"},fe.value);Q.value=Z.grandChildNodes,ve.value=Z.grandChildEdges,Ve(()=>{Q.value=Q.value.map(re=>({...re,x:re.animTargetX??re.x,y:re.animTargetY??re.y,animScale:1,animOpacity:1,animFilter:"none"}))})}else{const I=A(y,Q.value,ve.value,{x:y.x??0,y:y.y??0},{layout:"auto"},fe.value);Q.value=I.grandChildNodes,ve.value=I.grandChildEdges,Ve(()=>{Q.value=Q.value.map(B=>({...B,x:B.animTargetX??B.x,y:B.animTargetY??B.y,animScale:1,animOpacity:1,animFilter:"none"}))})}}catch(I){console.warn("[handleNodeClick] Error in transition logic, using fallback",I);const B=A(v,Q.value,ve.value,{x:v.x??0,y:v.y??0},{layout:"auto"},fe.value);Q.value=B.grandChildNodes,ve.value=B.grandChildEdges,Ve(()=>{Q.value=Q.value.map(le=>({...le,x:le.animTargetX??le.x,y:le.animTargetY??le.y,animScale:1,animOpacity:1,animFilter:"none"}))})}else if(m)try{const I=await sl(Number(m));try{S.value.skills=Array.isArray(I)?I:[]}catch(B){console.warn("[handleNodeClick] Error assigning skills",B)}try{const B=s&&s.id!=null?s.id:null;if(B==null)throw new Error("missing parent id");await ma(B),await va(40);const le=kt(B),O=we(B)??{x:s?.x,y:s?.y};console.debug("[expandSkills.debug] parentId=",B,"domPos=",le,"renderedPos=",O,"modelPos=",{x:s?.x,y:s?.y});const Z=O&&le?{x:O.x,y:le.y}:O??le,re=A(S.value,Q.value,ve.value,Z,{layout:"auto"},fe.value);Q.value=re.grandChildNodes,ve.value=re.grandChildEdges,Ve(()=>{Q.value=Q.value.map(ce=>({...ce,x:ce.animTargetX??ce.x,y:ce.animTargetY??ce.y,animScale:1,animOpacity:1,animFilter:"none"}))})}catch(B){console.warn("[handleNodeClick] Error waiting for transition before expansion, using fallback",B);const le=S.value.id,O=kt(le),Z=we(le)??S.value,re=Z&&O?{x:Z.x,y:O.y}:Z??O,ce=A(S.value,Q.value,ve.value,re,{layout:"auto"},fe.value);Q.value=ce.grandChildNodes,ve.value=ce.grandChildEdges,Ve(()=>{Q.value=Q.value.map(be=>({...be,x:be.animTargetX??be.x,y:be.animTargetY??be.y,animScale:1,animOpacity:1,animFilter:"none"}))})}}catch(I){console.warn("[handleNodeClick] Error in skill fetch/expand flow",I)}}}catch(v){console.warn("[handleNodeClick] Error in nested dependency check",v)}}catch(r){console.warn("[handleNodeClick] Error in level 2 short-circuit",r)}return}}catch(i){console.warn("[handleNodeClick] Error in outer level 2 handler",i)}try{const i=Date.now();if(globalThis.__lastClick&&globalThis.__lastClick.id===a?.id&&i-globalThis.__lastClick.time<300){globalThis.__DEBUG__&&console.debug("[node.click] ignored duplicate click id=",a?.id);return}globalThis.__lastClick={id:a?.id,time:i}}catch(i){console.warn("[handleNodeClick] Error in click debounce/guard",i)}const t=_.value?{..._.value}:void 0;let l=null;if(a&&a.id!=null&&a.id<0){const i=pe.value.find(s=>s.target===a.id),r=i?ge(i.source):null;if(r){try{if(M(a.id)===2){try{Ot.value=!0}catch(I){console.warn("[handleNodeClick] Error setting noAnimations (child click)",I)}const X=r.id;U.value=U.value.map(I=>I.id===X?{...I,visible:!0}:{...I,visible:!1}),setTimeout(()=>{U.value=U.value.map(I=>I.id===X?{...I,visible:!0}:{...I,visible:!1})},Math.max(40,Qe-120))}}catch(y){console.warn("[handleNodeClick] Error updating visibility (child click)",y)}const s={x:r.x??0,y:r.y??0};xt(r,t);const v=Math.max(0,Math.round(Qe*.6));await Promise.race([ma(r.id),va(v)]);const m=ge(r.id)||r;try{globalThis.__DEBUG__&&console.debug("[expandCompetencies.call] source=childClick, target=updatedParent",{nodeId:m?.id,comps:Array.isArray(m?.competencies)?m.competencies.length:0,opts:s,visualConfigLayout:h.visualConfig?.capabilityChildrenOffset,configDefault:k.competency?.defaultLayout})}catch(y){console.warn("[handleNodeClick] Error in child click expansion debug",y)}try{(Array.isArray(m?.competencies)?m.competencies.length:0)>=4?Ee(m,s,{layout:"matrix"}):Ee(m,s)}catch(y){console.warn("[handleNodeClick] Error in competency expansion logic",y),Ee(m,s)}const u=Et(a.id);S.value=u||a,_.value=r;try{const y=S.value,X=y?.compId??y?.raw?.id??Math.abs(y?.id||0);if(X){const I=await sl(Number(X));try{S.value.skills=Array.isArray(I)?I:[]}catch(B){console.warn("[handleNodeClick] Error assigning skills (child click)",B)}}}catch(y){console.warn("[handleNodeClick] Error fetching skills (child click)",y)}try{const y=S.value?.id??a?.id;y!=null&&_l(y,!0)}catch(y){console.warn("[handleNodeClick] Error showing only selected (child click)",y)}try{const y=S.value?.id??_.value.id;if(y!=null&&(te.value=te.value.map(I=>I.id===y?{...I,animOpacity:1,animScale:I.animScale??1,visible:!0}:I),Et(y))){const I=te.value.filter(B=>B.id!==y);te.value=I.concat(te.value.filter(B=>B.id===y))}}catch(y){console.warn("[handleNodeClick] Error ensuring visibility (child click)",y)}if(l=u||m||ge(a.id)||a,u&&(u.skills||u.competencies)){const y=u.id,X=Math.max(0,Math.round(Qe*.5));await Promise.race([ma(y),va(X)]);try{globalThis.__DEBUG__&&console.debug("[expandCompetencies.call] source=childClick.grandchildren, target=freshChild",{nodeId:u?.id,comps:Array.isArray(u?.competencies)?u.competencies.length:0,opts:s,visualConfigLayout:h.visualConfig?.capabilityChildrenOffset,configDefault:k.competency?.defaultLayout})}catch(I){console.warn("[handleNodeClick] Error in grandchild expansion debug",I)}try{(Array.isArray(u?.competencies)?u.competencies.length:0)>=4?Ee(u,s,{layout:"matrix"}):Ee(u,s)}catch{Ee(u,s)}}}else{_.value=a;const s={x:a.x??0,y:a.y??0};xt(a,t);const v=Math.max(0,Math.round(Qe*.6));await Promise.race([ma(a.id),va(v)]),l=ge(a.id)||a;try{globalThis.__DEBUG__&&console.debug("[expandCompetencies.call] source=childClick.fallback, target=updated",{nodeId:l?.id,comps:Array.isArray(l?.competencies)?l.competencies.length:0,opts:s,visualConfigLayout:h.visualConfig?.capabilityChildrenOffset,configDefault:k.competency?.defaultLayout})}catch(m){console.warn("[handleNodeClick] Error in fallback expansion debug",m)}Ee(l,s)}}else{_.value=a;const i={x:a.x??0,y:a.y??0};xt(a,t);try{const r=ge(a.id)||a,s=Math.round(oe.value/2),v=Math.round(fe.value*.25);r.x=s,r.y=v;const m=K.value?.id??null;U.value=U.value.map(y=>y.id===r.id||y.id===m?{...y,visible:!0}:{...y,visible:!1}),setTimeout(()=>{U.value=U.value.map(y=>y.id===r.id||y.id===m?{...y,visible:!0}:{...y,visible:!1})},Math.max(40,Qe-120));const u=Math.max(0,Math.round(Qe*.6));await Promise.race([ma(r.id),va(u)]),l=ge(r.id)||r;try{globalThis.__DEBUG__&&console.debug("[expandCompetencies.call] source=capabilityClick, target=updated",{nodeId:l?.id,comps:Array.isArray(l?.competencies)?l.competencies.length:0,opts:{limit:10,rows:2,cols:5},visualConfigLayout:h.visualConfig?.capabilityChildrenOffset,configDefault:k.competency?.defaultLayout})}catch(y){console.warn("[handleNodeClick] Error in capability expansion debug",y)}Ee(l,i,{limit:10,rows:2,cols:5})}catch{const s=Math.max(0,Math.round(Qe*.6));await Promise.race([ma(a.id),va(s)]),l=ge(a.id)||a;try{globalThis.__DEBUG__&&console.debug("[expandCompetencies.call] source=capabilityClick.fallback, target=updated",{nodeId:l?.id,comps:Array.isArray(l?.competencies)?l.competencies.length:0,opts:i,visualConfigLayout:h.visualConfig?.capabilityChildrenOffset,configDefault:k.competency?.defaultLayout})}catch{}Ee(l,i)}}!!document.fullscreenElement?e?(Yt.value=e.clientX+12,Xt.value=e.clientY+12):(Yt.value=(a.x??0)+12,Xt.value=(a.y??0)+12):(Yt.value=24,Xt.value=24);try{if(ol.value&&K.value&&(l||a)){const i=h.visualConfig?.scenarioOffset??80,r=l||a;K.value.x=r.x??0,K.value.y=Math.round((r.y??0)-i)}}catch(i){console.warn("[handleNodeClick] Error in followScenario logic",i)}},Co=()=>{_.value=null,te.value=[],pe.value=[];try{$a()}catch(a){console.warn("[closeTooltip] Error collapsing grandchildren",a)}if(S.value=null,ze.value&&ze.value.size>0){if(U.value=U.value.map(a=>{const e=ze.value.get(a.id);return e?{...a,x:e.x,y:e.y}:a}),K.value){const a=ze.value.get(K.value.id);a&&(K.value.x=a.x,K.value.y=a.y)}ze.value.clear()}pa.value=0,fa.value=0},il=p(!1),So=p("light"),Ra=st(()=>So.value==="dark"?"dialog-dark":"dialog-light"),nl=p(null),$l=st(()=>{try{const a=nl.value;return a?typeof a.valid=="boolean"?!a.valid:typeof a.isValid=="boolean"?!a.isValid:!1:!1}catch(a){return console.warn("[capFormInvalid] Error checking form validity",a),!1}});function _o(a,e){try{const t=ve.value.find(o=>o.target===a.id),l=t?Et(t.source):null;if(l){S.value=l;const o=pe.value.find(i=>i.target===l.id);o&&(_.value=ge(o.source))}try{Oe.value=a&&(a.raw??a)||a;const o=Oe.value||{};mt.value=o.name??"",yt.value=o.description??"",Ha.value=o.category??Ha.value,za.value=o.complexity_level??za.value,ja.value=o.scope_type??ja.value,gt.value=o.domain_tag??"",Kt.value=!!o.is_critical;try{const i=S.value,r=_.value;if(i&&r&&h.scenario&&h.scenario.id){let s=i.raw?.pivot??i.raw?.capability_pivot??null;!s&&Array.isArray(r?.raw?.scenario_capabilities)&&(s=r.raw.scenario_capabilities.find(v=>Number(v.competency_id??v.id??0)===Number(i.compId??i.raw?.id??Math.abs(i.id||0)))),s?(Ia.value=s.required_level??s.required??Ia.value,Oa.value=s.priority??Oa.value,Be.value=s.strategic_weight??s.weight??Be.value,Wa.value=s.rationale??"",Ka.value=!!(s.is_required??s.is_critical??!1)):(Ia.value=void 0,Oa.value=void 0,Be.value=void 0,Wa.value="",Ka.value=!1)}}catch(i){console.warn("[handleSkillClick] Error resolving pivot values",i)}Va.value=!0}catch(o){console.warn("[handleSkillClick] Error setting skill detail",o)}}catch(t){console.warn("[handleSkillClick] Outer error in skill click handler",t)}}async function Eo(a){const e={name:mt.value?.trim()??void 0,description:yt.value?.trim()??void 0,category:Ha.value,complexity_level:za.value,scope_type:ja.value,domain_tag:gt.value?.trim()??void 0,is_critical:!!Kt.value};Object.keys(e).forEach(t=>e[t]===void 0&&delete e[t]);try{await aa()}catch(t){console.warn("[saveSkillDetail] Error ensuring CSRF (non-fatal)",t)}try{await ne.patch(`/api/skills/${a}`,e),Se("Skill actualizada")}catch(t){try{console.error("[saveSkillDetail] skill patch error",t,t?.response?.data)}catch{console.error("[saveSkillDetail] skill patch error",t)}throw ae("Error guardando skill"),t}}async function Mo(){try{const a=typeof Oe.value<"u"?Oe.value??Oe:null,e=a?.pivot??a?.raw?.pivot??null,t=e?.id??e?.pivot_id??null;if(t){const l={};if(Be.value!==void 0&&Be.value!==null&&(l.weight=Be.value),Object.keys(l).forEach(o=>l[o]===void 0&&delete l[o]),Object.keys(l).length>0)try{await ne.patch(`/api/competency-skills/${t}`,l),Se("Atributos de relación skill-competencia actualizados")}catch(o){console.error("[saveSkillDetail] competency_skills patch failed",o)}}}catch(a){console.warn("[saveSkillDetail] Error in csPayload update logic",a)}}async function Ao(){const a=S.value&&typeof S.value=="object"?S.value??null:null,e=_.value&&typeof _.value=="object"?_.value??null:null,t=h.scenario?.id??null,l=a?.compId??a?.raw?.id??Math.abs(a?.id||0),o=e?.id??e?.raw?.id??null;if(t&&o&&l){const i={required_level:Ia.value,priority:Oa.value,strategic_weight:Be.value,weight:Be.value,rationale:Wa.value?.trim()??void 0,is_required:!!Ka.value};if(Object.keys(i).forEach(r=>i[r]===void 0&&delete i[r]),Object.keys(i).length>0)try{await ne.patch(`/api/strategic-planning/scenarios/${t}/capabilities/${o}/competencies/${l}`,i),Se("Atributos de competencia actualizados")}catch(r){const s=a?.raw?.pivot?.id??a?.raw?.capability_pivot?.id??null;if(s)try{await ne.patch(`/api/capability-competencies/${s}`,i),Se("Atributos de competencia actualizados (pivot)")}catch(v){console.error("[saveSkillDetail] pivot patch fallback failed",v),ae("Error guardando atributos de competencia")}else console.error("[saveSkillDetail] pivot patch primary failed",r),ae("Error guardando atributos de competencia")}}}async function No(){try{await Mo(),await Ao()}catch(a){console.warn("[saveSkillDetail] Error in pivot update flow",a)}}async function Vo(a){let e=null;try{const t=await ne.get(`/api/skills/${a}`),l=t?.data??t;e=Array.isArray(l)?l[0]:l}catch(t){console.error("[saveSkillDetail] Failed to refresh skill after save",t)}if(e&&typeof e.id<"u"){const t=S.value?.compId??S.value?.raw?.id;await qt.update("skill",e,t),Oe.value=e}}async function Gl(){try{console.debug("[saveSkillDetail] invoked",{selectedSkillDetail:Oe?.value??null})}catch{}if(!Oe.value)return ae("No hay skill seleccionada");const a=Oe.value.id??null;if(!a)return ae("Skill no tiene id");Za.value=!0;try{await Eo(a),await No(),await Vo(a),Va.value=!1}catch(e){console.error("[saveSkillDetail] Error in save flow",e)}finally{Za.value=!1}}Je(Va,a=>{a||(Oe.value=null,mt.value="",yt.value="",Ha.value="technical",za.value="tactical",ja.value="domain",gt.value="",Kt.value=!1,Ia.value=void 0,Oa.value=void 0,Be.value=void 0,Wa.value="",Ka.value=!1)}),Je(qa,a=>{if(a){const e=he.value;e&&(e.skillId||typeof e.id=="number"&&e.id>0)?Wt.value=e:Wt.value=null}else ft.value=null,vt.value=null,Wt.value=null}),Gt(()=>{try{globalThis.__saveSkillDetail=Gl}catch(a){console.warn("[onMounted] Error exposing saveSkillDetail",a)}}),ul(()=>{try{delete globalThis.__saveSkillDetail}catch(a){console.warn("[onBeforeUnmount] Error deleting saveSkillDetail",a)}});function Ee(a,e,t={}){te.value=[],pe.value=[];const l=a.competencies??[];if(!Array.isArray(l)||l.length===0)return;const o=k.competency?k.competency.maxDisplay:10,i=Math.min(t.limit??o,o),r=l.slice(0,i);if(l.length>o)try{ae(`Solo se muestran hasta ${o} competencias`)}catch{}console.debug("[expandCompetencies] count:",r.length,"selectedChild:",S.value?"YES":"NO");const s=a.x??Math.round(oe.value/2),v=a.y??Math.round(fe.value/2),m={rows:1,cols:4,hSpacing:100,vSpacing:80},u=a.id!=null&&a.id<0?80:k.competency?.parentOffset,y=typeof h.visualConfig?.capabilityChildrenOffset=="number"?h.visualConfig.capabilityChildrenOffset:typeof h.capabilityChildrenOffset=="number"?h.capabilityChildrenOffset:h.competencyLayout?.parentOffset??u,X=h.visualConfig?.childDrop??h.competencyLayout?.skillDrop??18,I=Math.round(v+y+X);let B=t.rows??h.competencyLayout?.rows??m.rows,le=t.cols??h.competencyLayout?.cols??m.cols,O=h.competencyLayout?.hSpacing??m.hSpacing,Z=h.competencyLayout?.vSpacing??m.vSpacing;const re=S.value?.compId??null,ce=re!==null&&r.some(j=>j.id===re),be=k.competency&&Array.isArray(k.competency.matrixVariants)?k.competency.matrixVariants:[];try{const j=fl(r.length,be,o);B=j.rows,le=j.cols}catch{}const n=k.competency&&k.competency.defaultLayout?k.competency.defaultLayout:"auto",ie=ml(t.layout,ce,r.length,n);console.debug("[expandCompetencies] hasSelectedChild:",ce,"layout:",ie);let Pe=[];if(ie==="radial"){console.debug("[expandCompetencies] Using RADIAL layout");const j=r.findIndex(ha=>ha.id===re),Ge=k.competency.radial.radius,We=k.competency.radial.selectedOffsetY,oa=r.length-1,ga=k.competency.radial.startAngle,Me=(k.competency.radial.endAngle-ga)/oa;Pe=r.map((ha,Ke)=>{if(Ke===j)return{x:s,y:I+We};const Le=Ke>j?Ke-1:Ke,Ze=ga+Le*Me,ia=Math.round(s+Ge*Math.cos(Ze)),cl=Math.round(I+Ge*Math.sin(Ze));return{x:ia,y:cl}})}else if(ie==="sides"){console.debug("[expandCompetencies] Using SIDES layout");try{const j=r.findIndex(oa=>oa.id===re),We={hSpacing:Math.max(220,Math.round(O*1.6)),vSpacing:Z,parentOffset:y+X,selectedOffsetMultiplier:k.competency&&k.competency.sides&&typeof k.competency.sides.selectedOffsetMultiplier=="number"?k.competency.sides.selectedOffsetMultiplier:.75};Pe=vl(r.length,s,v,We,j>=0?j:null)}catch(j){console.debug("sides layout compute failed",j),Pe=[]}}else console.debug("[expandCompetencies] Using MATRIX layout (rows:",B,"cols:",le,"hSpacing:",O,"vSpacing:",Z,")"),r.length>5&&(O=Math.round(O*1.3),Z=Math.round(Z*1.4),console.debug("[expandCompetencies] Expanded spacing for >5 nodes without selection")),Pe=Wl(r.length,s,I,B,le,O,Z);const ya=[];r.forEach((j,Ge)=>{const We=Pe[Ge]||{x:s,y:I},oa=-(a.id*1e3+Ge+1),ga=Math.max(0,Math.floor(Ge/le)*k.animations.competencyStaggerRow+Ge%le*k.animations.competencyStaggerCol+Math.round((Math.random()-.5)*k.animations.competencyStaggerRandom)),ra=te.value.find(Me=>Me.compId===(j.id??null)),Rt={id:oa,compId:j.id??null,name:j.name??j,displayName:Ft(j.name??j,14),x:ra?ra.x:e?.x??a.x??s,y:ra?ra.y:e?.y??a.y??v,animScale:.84,animOpacity:0,animDelay:ga,animFilter:"blur(6px) drop-(0 10px 18px rgba(2,6,23,0.36))",animTargetX:We.x,animTargetY:g(We.y),is_critical:!1,description:j.description??null,readiness:j.readiness??null,skills:Array.isArray(j.skills)?j.skills:[],raw:j};ya.push(Rt),pe.value.push({source:a.id,target:oa})}),te.value=ya.slice(),Ve(()=>{te.value=te.value.map(j=>({...j,x:j.animTargetX??j.x,y:j.animTargetY??j.y,animScale:1.06,animOpacity:1,animFilter:"none"})),setTimeout(()=>{te.value=te.value.map(j=>({...j,animScale:1})),Ve(()=>{te.value.forEach(j=>{delete j.animTargetX,delete j.animTargetY,delete j.animDelay,delete j.animFilter})})},k.animations.competencyEntryFinalize)})}function Dt(a){return Q.value.find(e=>e.id===a)||null}function $a(a=!1,e){try{if(e=typeof e=="number"?e:k.animations.collapseDuration??10,!a){Q.value=[],ve.value=[];return}if(!Array.isArray(Q.value)||Q.value.length===0){ve.value=[];return}Q.value=Q.value.map(t=>({...t,animScale:.8,animOpacity:0,animFilter:"blur(6px)"}));try{ve.value=ve.value.map(t=>({...t,animOpacity:0}))}catch(t){console.warn("[collapseGrandChildren] Error fading edges",t)}setTimeout(()=>{try{ve.value=[]}catch(t){console.warn("[collapseGrandChildren] Error clearing edges",t)}},e+10),setTimeout(()=>{try{Q.value=[]}catch(t){console.warn("[collapseGrandChildren] Error clearing nodes",t)}},e+10)}catch(t){console.warn("[collapseGrandChildren] Outer error in collapse",t)}}function Io(a,e){sa.value=a,At.value.x=e.clientX-a.x,At.value.y=e.clientY-a.y,globalThis.addEventListener("pointermove",Ll),globalThis.addEventListener("pointerup",Ul)}async function Oo(){try{const a=await ne.get("/api/competencies"),e=a?.data??a,l=(_.value??he.value??null)?.competencies?.map(o=>o.id)||[];zt.value=Array.isArray(e)?e.filter(o=>!l.includes(o.id)):[]}catch(a){console.warn("[fetchAvailableCompetencies] Error fetching competencies",a),zt.value=[]}}async function sl(a){if(!a)return[];gl.value=!0;try{try{if(h.scenario&&h.scenario.id){const e=await ne.get(`/api/strategic-planning/scenarios/${h.scenario.id}/capability-tree`),t=Array.isArray(e)?e:e?.data??e??[];for(const l of t)if(!(!l||!Array.isArray(l.competencies))){for(const o of l.competencies)if(Number(o.id)===Number(a))return Array.isArray(o.skills)?o.skills:o?.skills||[]}}}catch(e){console.warn("[fetchSkillsForCompetency] Error in tree fetch fallback",e)}try{const e=await ne.get(`/api/competencies/${a}/skills`),t=e?.data??e;if(Array.isArray(t))return t}catch(e){console.warn("[fetchSkillsForCompetency] Error in skill fetch fallback",e)}try{const e=await ne.get(`/api/competencies/${a}`),t=e?.data??e;if(t){if(Array.isArray(t.skills))return t.skills;if(Array.isArray(t.data?.skills))return t.data.skills}}catch(e){console.warn("[fetchSkillsForCompetency] Error in competency fetch fallback",e)}try{const e=await ne.get("/api/skills"),t=Array.isArray(e)?e:e?.data??[];return Array.isArray(t)?t.filter(o=>o?Array.isArray(o.competencies)?o.competencies.some(i=>Number(i.id)===Number(a)):o.pivot&&(o.pivot.competency_id||o.pivot.competencyId)?Number(o.pivot.competency_id||o.pivot.competencyId)===Number(a):!1:!1):[]}catch(e){console.warn("[fetchSkillsForCompetency] Error in generic skill fallback",e)}}catch(e){console.error("[fetchSkillsForCompetency] Outer error in skill fetch",e)}finally{gl.value=!1}return[]}async function Po(){let a=_.value??null;if(!a&&S.value){const o=S.value?.id??null,i=o!=null?pe.value.find(r=>r.target===o):null;a=i?ge(i.source):null}!a&&he.value&&(a=he.value);const e=a?.id??a?.raw?.id??null;if(!e||Number(e)<=0){ae("Seleccione una capacidad para asociar");return}if(!h.scenario?.id){ae("Escenario no especificado");return}const t=e,l=h.scenario.id;ut.value=!0;try{console.debug("[createAndAttachComp] start",{scenarioId:l,capId:t,name:la.value}),await aa();const o={competency:{name:la.value,description:It.value},required_level:3,weight:1,rationale:"",is_required:!1},i=await ne.post(`/api/strategic-planning/scenarios/${l}/capabilities/${t}/competencies`,o),r=i?.data??i;console.debug("[createAndAttachComp] success",r),await f(l);const s=ge(t);let v=null;if(s&&Array.isArray(s.competencies)){const m=s.competencies.find(u=>{const y=u?.name||u?.compName||u?.raw?.name||"";return String(y).trim()===String(la.value).trim()});m&&(v=Number(m.id??m.compId??m.raw?.id??Math.abs(m.id||0))||null)}v||(v=Number(r?.id??r?.data?.id??r?.competency?.id??r?.competency_id)||null);try{if(ua.value&&String(ua.value).trim()){const m=String(ua.value).split(",").map(u=>u.trim()).filter(Boolean);for(const u of m)try{if(!v){console.warn("[createAndAttachComp] no compId found; skipping skill creation for",u);continue}await Cl(v,{name:u,category:"technical"})}catch(y){console.error("[createAndAttachComp] failed creating skill",u,y)}}}catch(m){console.warn("[createAndAttachComp] Error in skill creation loop",m)}Na.value=!1,hl(),s&&Ee(s,{x:s.x??0,y:s.y??0}),Se("Competencia creada y asociada")}catch(o){console.error("[createAndAttachComp] error",o),ae("Error creando competencia")}finally{ut.value=!1}}function To(){try{console.debug("[onClickCreateAndAttachComp] click",{name:la.value,cap:he.value?.id})}catch(a){console.warn("[onClickCreateAndAttachComp] Debug log failed",a)}if(!he.value||!he.value.id){ae("Seleccione una capacidad para asociar");return}if(!la.value||!String(la.value).trim()){ae("El nombre de la competencia es obligatorio");return}ut.value=!0,(async()=>{try{await aa(),await Po()}catch(a){console.error("[onClickCreateAndAttachComp] handler error",a),ae("Error al crear la competencia")}finally{ut.value=!1}})()}async function Fo(){if(!he.value||!he.value.id)return ae("Seleccione una capacidad");if(!dt.value)return ae("Seleccione una competencia existente");const a=he.value.id;await aa();try{await ne.post(`/api/strategic-planning/scenarios/${h.scenario?.id}/capabilities/${a}/competencies`,{competency_id:dt.value}),Ba.value=!1,await f(h.scenario?.id);const e=ge(a);e&&Ee(e,{x:e.x??0,y:e.y??0}),Se("Competencia asociada correctamente")}catch{try{await ne.post(`/api/capabilities/${a}/competencies`,{competency_id:dt.value}),Ba.value=!1,await f(h.scenario?.id);const t=ge(a);t&&Ee(t,{x:t.x??0,y:t.y??0}),Se("Competencia asociada correctamente")}catch(t){console.error("[attachExistingComp] Error in fallback association",t),ae("Error asociando competencia")}}}async function Do(){const a=S.value;if(!a)return ae("No hay competencia seleccionada");await aa();try{const e=pe.value.find(s=>s.target===a.id),t=e?e.source:null,l=a.compId??a.raw?.id??Math.abs(a.id),o=Array.isArray(a.skills)?a.skills.map(s=>s.id??s.raw?.id??s).filter(s=>typeof s=="number"):[],i={name:Fa.value,description:Da.value,skills:o};if(console.debug("[saveSelectedChild] compPayload (name, description, skills only; readiness is calculated)",i,"compId",l,"skillIds extracted from child.skills:",o),console.debug("[saveSelectedChild] about to PATCH compId check:",!!l),l){console.debug("[saveSelectedChild] INSIDE if (compId), about to call api.patch");try{const s=`/api/competencies/${l}`;console.debug("[saveSelectedChild] calling PATCH:",s,"with payload:",i);const v=await ne.patch(s,i);console.debug("[saveSelectedChild] PATCH /api/competencies/"+l+" success, response:",v)}catch(s){console.error("[saveSelectedChild] ERROR in PATCH /api/competencies/"+l,s?.response?.data??s),ae("Error actualizando competencia: "+(s?.response?.data?.message||s?.message||"Unknown error"));return}}else console.warn("[saveSelectedChild] compId is falsy, skipping PATCH. child.compId=",a.compId,"child.raw?.id=",a.raw?.id,"child.id=",a.id);if(t&&l){const s={weight:typeof at.value<"u"?Number(at.value):void 0,priority:typeof tt.value<"u"?Number(tt.value):void 0,required_level:typeof lt.value<"u"?Number(lt.value):void 0,is_required:!!ot.value,is_critical:!!ot.value,rationale:ht.value};console.debug("[saveSelectedChild] pivotPayload",s,"parentId",t,"compId",l);try{const v=await ne.patch(`/api/strategic-planning/scenarios/${h.scenario?.id}/capabilities/${t}/competencies/${l}`,s);console.debug("[saveSelectedChild] PATCH child pivot response",v)}catch{try{const m=await ne.patch(`/api/capabilities/${t}/competencies/${l}`,s);console.debug("[saveSelectedChild] PATCH child pivot fallback response",m)}catch(m){console.error("[saveSelectedChild] error updating pivot",m?.response?.data??m)}}}let r=null;try{if(l){const s=await ne.get(`/api/competencies/${l}`);r=s?.data??s}}catch(s){}r&&typeof r.id<"u"&&(await qt.update("competency",r,t??void 0),Fa.value=r.name??Fa.value,Da.value=r.description??Da.value,et.value=r.readiness??et.value),Se("Competencia actualizada")}catch{ae("Error guardando competencia")}}function Ll(a){sa.value&&(sa.value.x=Math.round(a.clientX-At.value.x),sa.value.y=Math.round(a.clientY-At.value.y),xa.value=!0)}async function Ul(){if(sa.value&&(sa.value=null),globalThis.removeEventListener("pointermove",Ll),globalThis.removeEventListener("pointerup",Ul),xa.value){try{await Yl()}catch{}xa.value=!1}}const Ro=()=>{U.value=U.value.map(a=>({...a,x:void 0,y:void 0})),h.scenario&&Array.isArray(h.scenario.capabilities)&&St(h.scenario.capabilities)},Yl=async()=>{if(!h.scenario||!h.scenario.id)return ae("Escenario no seleccionado");try{const a={positions:U.value.map(e=>({id:e.id,x:e.x,y:e.y}))};await ne.post(`/api/strategic-planning/scenarios/${h.scenario.id}/capability-tree/save-positions`,a),Se("Posiciones guardadas")}catch{ae("Error al guardar posiciones")}};return Gt(async()=>{try{globalThis.__nodeLevel=M}catch{}if(h.scenario&&Array.isArray(h.scenario.capabilities)&&h.scenario.capabilities.length>0){const o=h.scenario.capabilities;Ca.value=o;const i=o[0];if(!(!!i&&(i.strategic_weight!==void 0||i.priority!==void 0||i.required_level!==void 0||i.is_critical!==void 0||i.raw&&(i.raw.strategic_weight!==void 0||i.raw.priority!==void 0)||i.pivot&&(i.pivot.strategic_weight!==void 0||i.pivot.priority!==void 0)||i.scenario_capabilities&&Object.keys(i.scenario_capabilities).length>0))){await f(h.scenario.id),rl();try{await Ct()}catch{}return}St(o),_t(o);try{const s=localStorage.getItem(rt.collapsed);s!==null&&(il.value=s==="true");const v=localStorage.getItem(rt.lastView),m=localStorage.getItem(rt.lastFocusedId);if(m&&(ll.value=parseInt(m,10)),v==="scenario"&&!_.value&&(Ye.value=!0),ll.value){const u=ge(ll.value);u&&(_.value=u)}}catch{}Mt.value=!0,rl();try{Ro()}catch{}try{await Ct()}catch{}return}f(h.scenario?.id);const a=La.value,e=(o,i)=>{const r=o??a?.clientWidth??900;let s=a?.clientHeight??0;if(!s||s===0){const y=a?.getBoundingClientRect().top??0;s=Math.max(320,Math.round(globalThis.innerHeight-y-24))}const m=a?.querySelector(".map-controls")?.offsetHeight??0,u=i??Math.max(300,s-m-12);oe.value=r,fe.value=u,Array.isArray(ct)&&ct.length>0&&(St(ct),_t(ct))};e();let t=null;a&&globalThis.ResizeObserver&&(t=new ResizeObserver(o=>{for(const i of o){const r=Math.round(i.contentRect.width),s=Math.round(i.contentRect.height);e(r,s)}}),t.observe(a));const l=()=>e();globalThis.addEventListener("resize",l),wt=o=>so(),Ve(()=>{bt.value&&bt.value.addEventListener("scroll",wt)}),ul(()=>{bt.value&&wt&&bt.value.removeEventListener("scroll",wt),wt=null,t&&t.disconnect(),globalThis.removeEventListener("resize",l)})}),Je([il,Ye,_],()=>{try{localStorage.setItem(rt.collapsed,il.value?"true":"false");const a=_.value?"node":Ye.value?"scenario":"none";localStorage.setItem(rt.lastView,a),localStorage.setItem(rt.lastFocusedId,_.value?String(_.value.id):"")}catch{}},{immediate:!0}),Je(()=>h.scenario,(a,e)=>{if(a&&a!==e)if(Array.isArray(a.capabilities)&&a.capabilities.length>0){const t=a.capabilities;St(t),_t(t),Mt.value=!0;try{Ct()}catch{}}else f(a.id)},{immediate:!1}),Je(()=>h.scenario&&(h.scenario.name??null),a=>{K.value&&(K.value.name=a??"Escenario")}),Je(()=>U.value.map(a=>a.id),()=>{K.value&&Array.isArray(U.value)&&(Nt.value=U.value.map(a=>({source:K.value.id,target:a.id,isScenarioEdge:!0})))},{immediate:!0}),ta.value||(ta.value=[]),(a,e)=>{const t=xe("v-icon"),l=xe("v-list-item"),o=xe("v-list"),i=xe("v-menu"),r=xe("v-btn"),s=xe("v-card-title"),v=xe("v-text-field"),m=xe("v-textarea"),u=xe("v-slider"),y=xe("v-checkbox"),X=xe("v-form"),I=xe("v-select"),B=xe("v-switch"),le=xe("v-card-text"),O=xe("v-spacer"),Z=xe("v-card-actions"),re=xe("v-card"),ce=xe("v-dialog"),be=xe("v-alert");return q(),J("div",null,[w("div",{class:na(["prototype-map-root",{"no-animations":Ot.value}]),ref_key:"mapRoot",ref:La},[Mt.value?(q(),J("div",or,[(q(),J("svg",{width:oe.value,height:fe.value,viewBox:`0 0 ${oe.value} ${fe.value}`,class:"map-canvas",style:{"touch-action":"none",cursor:"grab"},onWheel:uo,onMousedown:po,onMousemove:fo,onMouseup:Vl,onMouseleave:Vl},[e[89]||(e[89]=dl('<defs data-v-60f64f76><linearGradient id="bgGrad" x1="0" y1="0" x2="1" y2="1" data-v-60f64f76><stop offset="0%" stop-color="#040914" stop-opacity="1" data-v-60f64f76></stop><stop offset="25%" stop-color="#071029" stop-opacity="1" data-v-60f64f76></stop><stop offset="70%" stop-color="#071a2a" stop-opacity="1" data-v-60f64f76></stop><stop offset="100%" stop-color="#051018" stop-opacity="1" data-v-60f64f76></stop></linearGradient><radialGradient id="nodeGrad" cx="30%" cy="25%" r="70%" data-v-60f64f76><stop offset="0%" stop-color="#ffffff" stop-opacity="0.75" data-v-60f64f76></stop><stop offset="12%" stop-color="#e8f6ff" stop-opacity="0.55" data-v-60f64f76></stop><stop offset="45%" stop-color="#6fc3ff" stop-opacity="0.95" data-v-60f64f76></stop><stop offset="100%" stop-color="#0b66b2" stop-opacity="1" data-v-60f64f76></stop></radialGradient><radialGradient id="iridescentGrad" cx="70%" cy="30%" r="90%" data-v-60f64f76><stop offset="0%" stop-color="#ffffff" stop-opacity="0.0" data-v-60f64f76></stop><stop offset="18%" stop-color="#ffd6f7" stop-opacity="0.06" data-v-60f64f76></stop><stop offset="32%" stop-color="#d6f7ff" stop-opacity="0.07" data-v-60f64f76></stop><stop offset="48%" stop-color="#fff2d6" stop-opacity="0.06" data-v-60f64f76></stop><stop offset="68%" stop-color="#d6fff3" stop-opacity="0.05" data-v-60f64f76></stop><stop offset="100%" stop-color="#ffffff" stop-opacity="0.0" data-v-60f64f76></stop></radialGradient><radialGradient id="bubbleOuterGrad" cx="50%" cy="50%" r="80%" data-v-60f64f76><stop offset="0%" stop-color="#0b66b2" stop-opacity="0.06" data-v-60f64f76></stop><stop offset="60%" stop-color="#6fc3ff" stop-opacity="0.18" data-v-60f64f76></stop><stop offset="85%" stop-color="#6fc3ff" stop-opacity="0.06" data-v-60f64f76></stop><stop offset="100%" stop-color="#0b66b2" stop-opacity="0.02" data-v-60f64f76></stop></radialGradient><radialGradient id="bubbleCoreGrad" cx="35%" cy="30%" r="60%" data-v-60f64f76><stop offset="0%" stop-color="#ffffff" stop-opacity="0.9" data-v-60f64f76></stop><stop offset="35%" stop-color="#dffaff" stop-opacity="0.7" data-v-60f64f76></stop><stop offset="100%" stop-color="#6fc3ff" stop-opacity="0.0" data-v-60f64f76></stop></radialGradient><filter id="innerGlow" x="-30%" y="-30%" width="160%" height="160%" data-v-60f64f76><feGaussianBlur in="SourceAlpha" stdDeviation="6" result="blurInner" data-v-60f64f76></feGaussianBlur><feComposite in="blurInner" in2="SourceGraphic" operator="arithmetic" k1="0" k2="1" k3="-1" k4="0" result="innerComp" data-v-60f64f76></feComposite><feMerge data-v-60f64f76><feMergeNode in="innerComp" data-v-60f64f76></feMergeNode><feMergeNode in="SourceGraphic" data-v-60f64f76></feMergeNode></feMerge></filter><radialGradient id="glassGrad" cx="35%" cy="28%" r="72%" data-v-60f64f76><stop offset="0%" stop-color="#ffffff" stop-opacity="0.30" data-v-60f64f76></stop><stop offset="30%" stop-color="#dff6ff" stop-opacity="0.12" data-v-60f64f76></stop><stop offset="70%" stop-color="#9fd8ff" stop-opacity="0.08" data-v-60f64f76></stop><stop offset="100%" stop-color="#0b66b2" stop-opacity="0.18" data-v-60f64f76></stop></radialGradient><filter id="glassBlur" x="-20%" y="-20%" width="140%" height="140%" data-v-60f64f76><feGaussianBlur stdDeviation="4" result="gblur" data-v-60f64f76></feGaussianBlur><feMerge data-v-60f64f76><feMergeNode in="gblur" data-v-60f64f76></feMergeNode><feMergeNode in="SourceGraphic" data-v-60f64f76></feMergeNode></feMerge></filter><filter id="softGlow" x="-50%" y="-50%" width="200%" height="200%" data-v-60f64f76><feGaussianBlur stdDeviation="6" result="blur" data-v-60f64f76></feGaussianBlur><feMerge data-v-60f64f76><feMergeNode in="blur" data-v-60f64f76></feMergeNode><feMergeNode in="SourceGraphic" data-v-60f64f76></feMergeNode></feMerge></filter><linearGradient id="childGrad" x1="0" y1="0" x2="1" y2="0" data-v-60f64f76><stop offset="0%" stop-color="#7dd3fc" stop-opacity="1" data-v-60f64f76></stop><stop offset="100%" stop-color="#04234A" stop-opacity="1" data-v-60f64f76></stop></linearGradient><linearGradient id="scenarioEdgeGrad" x1="0" y1="0" x2="1" y2="0" data-v-60f64f76><stop offset="0%" stop-color="#9be7ff" stop-opacity="0.98" data-v-60f64f76></stop><stop offset="50%" stop-color="#6fb8ff" stop-opacity="0.9" data-v-60f64f76></stop><stop offset="100%" stop-color="#3fa6ff" stop-opacity="0.82" data-v-60f64f76></stop></linearGradient><linearGradient id="compassNeedleGrad" x1="0" y1="0" x2="0" y2="1" data-v-60f64f76><stop offset="0%" stop-color="#08306b" stop-opacity="1" data-v-60f64f76></stop><stop offset="60%" stop-color="#1e66d6" stop-opacity="1" data-v-60f64f76></stop><stop offset="100%" stop-color="#9fe6ff" stop-opacity="1" data-v-60f64f76></stop></linearGradient><linearGradient id="edgeGrad" x1="0" y1="0" x2="1" y2="0" data-v-60f64f76><stop offset="0%" stop-color="#09c8d2" stop-opacity="0.85" data-v-60f64f76></stop><stop offset="60%" stop-color="#66b8ff" stop-opacity="0.6" data-v-60f64f76></stop><stop offset="100%" stop-color="#9bd0ff" stop-opacity="0.45" data-v-60f64f76></stop></linearGradient><filter id="edgeGlow" x="-50%" y="-50%" width="200%" height="200%" data-v-60f64f76><feGaussianBlur stdDeviation="3" result="blurEdge" data-v-60f64f76></feGaussianBlur><feMerge data-v-60f64f76><feMergeNode in="blurEdge" data-v-60f64f76></feMergeNode><feMergeNode in="SourceGraphic" data-v-60f64f76></feMergeNode></feMerge></filter><filter id="inner" x="-20%" y="-20%" width="140%" height="140%" data-v-60f64f76><feOffset dx="0" dy="2" result="off" data-v-60f64f76></feOffset><feGaussianBlur in="off" stdDeviation="2" result="blur2" data-v-60f64f76></feGaussianBlur><feComposite in="SourceGraphic" in2="blur2" operator="over" data-v-60f64f76></feComposite></filter><filter id="specular" x="-50%" y="-50%" width="200%" height="200%" data-v-60f64f76><feGaussianBlur stdDeviation="3" result="spec" data-v-60f64f76></feGaussianBlur><feMerge data-v-60f64f76><feMergeNode in="spec" data-v-60f64f76></feMergeNode><feMergeNode in="SourceGraphic" data-v-60f64f76></feMergeNode></feMerge></filter><radialGradient id="competencyGrad" cx="30%" cy="25%" r="70%" data-v-60f64f76><stop offset="0%" stop-color="#16B7E8" stop-opacity="0.85" data-v-60f64f76></stop><stop offset="50%" stop-color="#039B8E" stop-opacity="0.95" data-v-60f64f76></stop><stop offset="100%" stop-color="#21A7B6" stop-opacity="1" data-v-60f64f76></stop></radialGradient><radialGradient id="competencySelectedGrad" cx="30%" cy="25%" r="70%" data-v-60f64f76><stop offset="0%" stop-color="#D9F0EF" stop-opacity="0.95" data-v-60f64f76></stop><stop offset="50%" stop-color="#3BB6BC" stop-opacity="1" data-v-60f64f76></stop><stop offset="100%" stop-color="#167780" stop-opacity="1" data-v-60f64f76></stop></radialGradient><radialGradient id="skillGrad" cx="30%" cy="25%" r="70%" data-v-60f64f76><stop offset="0%" stop-color="#6ee7b7" stop-opacity="0.85" data-v-60f64f76></stop><stop offset="50%" stop-color="#10b981" stop-opacity="0.95" data-v-60f64f76></stop><stop offset="100%" stop-color="#047857" stop-opacity="1" data-v-60f64f76></stop></radialGradient><radialGradient id="skillSelectedGrad" cx="30%" cy="25%" r="70%" data-v-60f64f76><stop offset="0%" stop-color="#a7f3d0" stop-opacity="0.95" data-v-60f64f76></stop><stop offset="50%" stop-color="#0CBEBE" stop-opacity="1" data-v-60f64f76></stop><stop offset="100%" stop-color="#08959F" stop-opacity="1" data-v-60f64f76></stop></radialGradient></defs>',1)),w("rect",{x:"0",y:"0",width:oe.value,height:fe.value,rx:"12",ry:"12",fill:"url(#bgGrad)"},null,8,ir),w("rect",{x:"1",y:"1",width:oe.value-4,height:fe.value-2,rx:"12",ry:"12",fill:"none",stroke:"rgba(255,255,255,0.04)","stroke-width":"1",filter:"url(#softGlow)"},null,8,nr),w("g",{class:"viewport-group",style:nt(co.value)},[w("g",sr,[(q(!0),J(Te,null,Ue(ta.value,(n,ie)=>(q(),J("line",{key:`edge-${ie}`,x1:we(n.source)?.x??void 0,y1:we(n.source)?.y??void 0,x2:we(n.target)?.x??void 0,y2:we(n.target)?.y??void 0,class:"edge-line",stroke:"url(#edgeGrad)","stroke-width":"2","stroke-linecap":"round",filter:"url(#edgeGlow)","stroke-opacity":"0.9"},null,8,cr))),128))]),w("g",{class:"scenario-create-control",transform:`translate(${Math.max(48,oe.value-56)}, 72)`,onClick:Fe(yo,["stop"]),style:{cursor:"pointer"},"aria-label":"Crear capacidad"},[...e[74]||(e[74]=[w("circle",{r:"12",fill:"rgba(255,255,255,0.03)",stroke:"rgba(255,255,255,0.05)"},null,-1),w("title",null,"Crear capacidad",-1),w("text",{x:"0",y:"4","text-anchor":"middle","font-size":"16",fill:"#dbeafe",style:{"font-weight":"700"}}," + ",-1)])],8,ur),w("g",dr,[(q(!0),J(Te,null,Ue(Nt.value,(n,ie)=>(q(),J(Te,{key:`scenario-edge-${ie}`},[Dl(n)?(q(),J("path",{key:0,d:Dl(n),class:"edge-line scenario-edge",stroke:"url(#scenarioEdgeGrad)","stroke-width":"2.6","stroke-linecap":"round",fill:"none",filter:"url(#edgeGlow)","stroke-opacity":"0.95"},null,8,pr)):(q(),J("line",{key:1,x1:we(n.source)?.x??void 0,y1:we(n.source)?.y??void 0,x2:we(n.target)?.x??void 0,y2:we(n.target)?.y??void 0,class:"edge-line scenario-edge",stroke:"url(#scenarioEdgeGrad)","stroke-width":"2.6","stroke-linecap":"round",filter:"url(#edgeGlow)","stroke-opacity":"0.95"},null,8,fr))],64))),128))]),w("g",vr,[Lt(T)===2?(q(!0),J(Te,{key:0},Ue(pe.value,(n,ie)=>(q(),J("path",{key:`child-edge-path-${ie}`,d:je(n).d,class:"edge-line child-edge",stroke:"url(#childGrad)","stroke-width":"4","stroke-linecap":"round",fill:"none",filter:"url(#edgeGlow)","stroke-opacity":"0.98","marker-end":"url(#childArrow)"},null,8,mr))),128)):(q(!0),J(Te,{key:1},Ue(pe.value,(n,ie)=>(q(),J("line",{key:`child-edge-line-${ie}`,x1:je(n).x1??void 0,y1:je(n).y1??void 0,x2:je(n).x2??void 0,y2:je(n).y2??void 0,class:"edge-line child-edge",stroke:"url(#childGrad)","stroke-width":"2","stroke-linecap":"round",filter:"url(#edgeGlow)","stroke-opacity":"0.98","marker-end":"url(#childArrow)"},null,8,yr))),128))]),w("g",gr,[Lt(T)===2?(q(!0),J(Te,{key:0},Ue(ve.value,(n,ie)=>(q(),J("path",{key:`grandchild-edge-path-${ie}`,d:je(n).d,class:"edge-line child-edge",stroke:"url(#childGrad)","stroke-width":"4","stroke-linecap":"round",fill:"none",filter:"url(#edgeGlow)","stroke-opacity":Fl(n),style:{transition:"stroke-opacity 180ms ease"},"marker-end":"url(#childArrow)"},null,8,hr))),128)):(q(!0),J(Te,{key:1},Ue(ve.value,(n,ie)=>(q(),J("line",{key:`grandchild-edge-line-${ie}`,x1:je(n).x1??void 0,y1:je(n).y1??void 0,x2:je(n).x2??void 0,y2:je(n).y2??void 0,class:"edge-line child-edge",stroke:"url(#childGrad)","stroke-width":"2","stroke-linecap":"round",filter:"url(#edgeGlow)","stroke-opacity":Fl(n),style:{transition:"stroke-opacity 180ms ease"},"marker-end":"url(#childArrow)"},null,8,br))),128))]),K.value?(q(),J("g",{key:0,style:nt([{transform:`translate(${K.value.x}px, ${K.value.y}px)`},{cursor:"pointer"}]),class:"node-group scenario-node","data-node-id":K.value.id,onClick:Fe(vo,["stop"]),title:"Ver información del escenario"},[w("title",null,ye(K.value.name),1),e[75]||(e[75]=dl('<circle class="node-circle" r="22" fill="url(#glassGrad)" filter="url(#softGlow)" stroke="rgba(255,255,255,0.06)" stroke-width="1.2" data-v-60f64f76></circle><g class="scenario-icon" transform="translate(0,0) scale(1.6)" data-v-60f64f76><circle r="9" fill="rgba(0,0,0,0.28)" data-v-60f64f76></circle><g class="rose" transform="translate(0,0)" data-v-60f64f76><g class="rose-x" transform="translate(0,2)" data-v-60f64f76><path class="rose-x-arm" d="M0,-14 L5,0 L0,10 L-5,0 Z" transform="rotate(45) scale(1.2)" fill="rgba(255,255,255,0.06)" data-v-60f64f76></path><path class="rose-x-arm" d="M0,-14 L5,0 L0,10 L-5,0 Z" transform="rotate(-45) scale(1.2)" fill="rgba(255,255,255,0.06)" data-v-60f64f76></path></g><path class="rose-outline" d="M0,-14 L4,-4 L14,0 L4,4 L0,14 L-4,4 L-14,0 L-4,-4 Z" data-v-60f64f76></path><path class="rose-primary" d="M0,-14 L5,0 L0,10 L-5,0 Z" data-v-60f64f76></path><path class="rose-secondary" d="M0,14 L5,0 L0,-10 L-5,0 Z" transform="scale(1.1)" fill="url(#compassNeedleGrad)" data-v-60f64f76></path><circle class="rose-center" r="2" data-v-60f64f76></circle></g></g>',2))],12,wr)):ba("",!0),(q(!0),J(Te,null,Ue(U.value,n=>(q(),J("g",{key:n.id,style:nt({transform:`translate(${Pl(n)}px, ${n.y}px)`}),class:na(["node-group",{critical:!!n.is_critical,focused:_.value&&_.value.id===n.id,dragging:sa.value&&sa.value.id===n.id,small:_.value&&_.value.id!==n.id}]),"data-node-id":n.id,onPointerdown:Fe(ie=>Io(n,ie),["prevent"]),onClick:Fe(ie=>Rl(n,ie),["stop"]),onContextmenu:Fe(ie=>xl(n,ie),["prevent","stop"])},[w("title",null,ye(n.name),1),e[76]||(e[76]=w("circle",{class:"node-circle",r:"34",fill:"url(#bubbleOuterGrad)",filter:"url(#innerGlow)",stroke:"rgba(255,255,255,0.12)","stroke-opacity":"1","stroke-width":"1.2"},null,-1)),e[77]||(e[77]=w("circle",{class:"node-iridescence",r:"34",fill:"url(#iridescentGrad)",opacity:"0.22",style:{"mix-blend-mode":"screen"}},null,-1)),e[78]||(e[78]=w("circle",{class:"node-core",r:"10",fill:"url(#bubbleCoreGrad)",filter:"url(#specular)"},null,-1)),e[79]||(e[79]=w("circle",{class:"node-rim",r:"34",fill:"none",stroke:"#ffffff","stroke-opacity":"0.08","stroke-width":"1.4"},null,-1)),n.is_critical?(q(),J("circle",xr)):ba("",!0),w("text",Cr,[(q(!0),J(Te,null,Ue((n.displayName??n.name).split(`
`),(ie,Pe)=>(q(),J("tspan",{key:Pe,x:0,dy:Pe===0?0:12},ye(ie),9,Sr))),128))])],46,kr))),128)),w("g",_r,[(q(!0),J(Te,null,Ue(te.value,n=>(q(),J("g",{key:n.id,style:nt({transform:`translate(${n.x}px, ${n.y}px) scale(${n.animScale??1})`,opacity:n.animOpacity??.88,transitionDelay:n.animDelay?n.animDelay+"ms":void 0,filter:n.animFilter?n.animFilter:void 0}),class:"node-group child-node","data-node-id":n.id,onClick:Fe(ie=>Rl(n,ie),["stop"]),onContextmenu:Fe(ie=>xl(n,ie),["prevent","stop"])},[w("title",null,ye(n.name),1),w("circle",{class:"node-circle",r:20,fill:n.id===S.value?.id?"url(#competencySelectedGrad)":"url(#competencyGrad)",stroke:n.id===S.value?.id?"rgba(167, 139, 250, 0.8)":"rgba(124, 58, 237, 0.5)","stroke-width":"1.5"},null,8,Mr),e[80]||(e[80]=w("circle",{class:"node-iridescence child-iridescence",r:20,fill:"url(#iridescentGrad)",opacity:"0.18",style:{"mix-blend-mode":"screen"}},null,-1)),e[81]||(e[81]=w("ellipse",{class:"node-reflection child-reflection",cx:"-6",cy:"-6",rx:"7",ry:"4.5",fill:"#ffffff","fill-opacity":"0.14",transform:"rotate(-22)",filter:"url(#specular)"},null,-1)),e[82]||(e[82]=w("circle",{class:"node-rim child-rim",r:20,fill:"none",stroke:"#ffffff","stroke-opacity":"0.06","stroke-width":"1"},null,-1)),e[83]||(e[83]=w("circle",{class:"node-gloss child-gloss",r:22,fill:"none",stroke:"#ffffff","stroke-opacity":"0.04","stroke-width":"4",filter:"url(#softGlow)"},null,-1)),w("text",Ar,[(q(!0),J(Te,null,Ue(String(n.displayName??n.name).split(`
`),(ie,Pe)=>(q(),J("tspan",{key:Pe,x:0,dy:Pe===0?0:10},ye(ie),9,Nr))),128))])],44,Er))),128))]),w("g",Vr,[(q(!0),J(Te,null,Ue(Q.value,n=>(q(),J("g",{key:`${n.id}-${n.name}-${n.raw?.id}`,style:nt({transform:`translate(${n.x}px, ${n.y}px) scale(${n.animScale??1})`,opacity:n.animOpacity??.85}),class:"node-group skill-node","data-node-id":n.id,onClick:Fe(ie=>_o(n),["stop"])},[w("title",null,ye(n.name),1),e[84]||(e[84]=dl('<circle class="node-circle" r="14" fill="url(#skillGrad)" stroke="rgba(16, 185, 129, 0.5)" stroke-width="1" data-v-60f64f76></circle><circle class="node-iridescence" r="14" fill="url(#iridescentGrad)" opacity="0.14" style="mix-blend-mode:screen;" data-v-60f64f76></circle><circle class="node-rim skill-rim" r="14" fill="none" stroke="#ffffff" stroke-opacity="0.06" stroke-width="1" data-v-60f64f76></circle><circle class="node-gloss skill-gloss" r="16" fill="none" stroke="#ffffff" stroke-opacity="0.04" stroke-width="3" filter="url(#softGlow)" data-v-60f64f76></circle><ellipse class="node-reflection skill-reflection" cx="-5" cy="-5" rx="5" ry="3" fill="#ffffff" fill-opacity="0.12" transform="rotate(-22)" filter="url(#specular)" data-v-60f64f76></ellipse>',5)),w("text",Or,ye(n.name),1)],12,Ir))),128))]),w("g",{class:"diagram-control reorder-control",transform:`translate(${Math.max(48,oe.value-56)}, 108)`,onClick:Fe(Ct,["stop"]),style:{cursor:"pointer"}},[...e[85]||(e[85]=[w("circle",{r:"12",fill:"rgba(182, 221, 77, 0.04)",stroke:"rgba(255,255,255,0.06)"},null,-1),w("title",null,"Reordenar nodos",-1),w("text",{x:"0",y:"4","text-anchor":"middle","font-size":"11",fill:"#dbeafe",style:{"font-weight":"700"}}," R ",-1)])],8,Pr),w("g",{class:"diagram-control mode-control",transform:`translate(${Math.max(48,oe.value-56)}, 180)`,onClick:Fe(Zl,["stop"]),style:{cursor:"pointer"},title:`Edge mode: ${al[Lt(T)]}`},[e[86]||(e[86]=w("circle",{r:"12",fill:"rgba(255,255,255,0.03)",stroke:"rgba(255,255,255,0.06)"},null,-1)),e[87]||(e[87]=w("title",null,"Cambiar modo conector",-1)),w("text",Fr,ye(al[Lt(T)]),1)],8,Tr),w("g",{class:"diagram-control restore-control",transform:`translate(${Math.max(48,oe.value-56)}, 144)`,onClick:Fe(R,["stop"]),style:{cursor:"pointer"}},[...e[88]||(e[88]=[w("circle",{r:"12",fill:"rgba(255,255,255,0.04)",stroke:"rgba(255,255,255,0.06)"},null,-1),w("title",null,"Restaurar vista",-1),w("text",{x:"0",y:"4","text-anchor":"middle","font-size":"11",fill:"#dbeafe",style:{"font-weight":"700"}}," ↺ ",-1)])],8,Dr)],4),(q(),J("foreignObject",{x:"12",y:"8",width:Math.min(420,oe.value-48),height:"40"},[w("div",$r,[w("div",Gr,[(q(!0),J(Te,null,Ue(Kl.value,(n,ie)=>(q(),J("div",{key:`breadcrumb-${ie}`,class:"svg-title-line"},ye(n),1))),128))])])],8,Rr))],40,rr)),d(i,{modelValue:Qa.value,"onUpdate:modelValue":e[0]||(e[0]=n=>Qa.value=n),absolute:"","offset-y":"",transition:"scale-transition","close-on-content-click":!1,"open-on-click":!1,style:nt({left:bl.value+"px",top:wl.value+"px",zIndex:2e5})},{default:F(()=>[w("div",{ref_key:"contextMenuEl",ref:kl,class:"node-context-menu-v",style:{"min-width":"250px"}},[d(o,{density:"compact"},{default:F(()=>[d(l,{onClick:Jl,class:"node-context-item"},{default:F(()=>[w("div",Lr,[d(t,{class:"me-2"},{default:F(()=>[...e[90]||(e[90]=[ee("mdi-eye-outline",-1)])]),_:1}),e[91]||(e[91]=w("span",null,"Ver Detalles",-1))])]),_:1})]),_:1})],512)]),_:1},8,["modelValue","style"]),d(ce,{modelValue:Ye.value,"onUpdate:modelValue":e[26]||(e[26]=n=>Ye.value=n),"max-width":"980",persistent:"",scrollable:"",transition:"scale-transition","content-class":"capability-dialog",role:"dialog","aria-modal":"true","aria-label":he.value?`Detalles: ${he.value.name}`:"Detalle de elemento"},{default:F(()=>[d(re,{class:na(Ra.value)},{default:F(()=>[d(s,{class:"d-flex justify-space-between align-center"},{default:F(()=>[w("strong",null,ye(he.value?he.value.name:Ye.value?"Escenario":"Detalle"),1),w("div",Ur,[d(r,{icon:"",small:"",variant:"text",onClick:e[1]||(e[1]=n=>Ye.value=!1)},{default:F(()=>[d(t,{icon:"mdi-close"})]),_:1})])]),_:1}),d(le,{style:{"max-height":"70vh",overflow:"auto"}},{default:F(()=>[he.value?(q(),J(Te,{key:0},[w("div",Yr,[w("div",null,[e[92]||(e[92]=w("strong",null,"ID:",-1)),ee(" "+ye(he.value.id??"—"),1)]),w("div",null,[e[93]||(e[93]=w("strong",null,"Competencias:",-1)),ee(" "+ye((he.value.competencies||[]).length),1)])]),w("div",Xr,[he.value.skills||he.value.compId?(q(),J("div",Br,[w("div",qr,[d(X,{ref_key:"capForm",ref:nl,onSubmit:e[10]||(e[10]=Fe(()=>{},["prevent"]))},{default:F(()=>[w("div",Hr,[d(r,{small:"",color:"primary",onClick:ho},{default:F(()=>[...e[94]||(e[94]=[ee("Crear Skill",-1)])]),_:1},8,["onClick"]),d(r,{small:"",color:"primary",onClick:bo},{default:F(()=>[...e[95]||(e[95]=[ee("Agregar existente",-1)])]),_:1},8,["onClick"]),d(r,{color:"error",onClick:Il,loading:Xe.value},{default:F(()=>[...e[96]||(e[96]=[ee("Eliminar nodo",-1)])]),_:1},8,["onClick","loading"]),d(r,{color:"primary",onClick:Do,loading:Xe.value,disabled:Xe.value||$l.value},{default:F(()=>[...e[97]||(e[97]=[ee("Guardar",-1)])]),_:1},8,["onClick","loading","disabled"])]),w("div",zr,[d(v,{modelValue:Fa.value,"onUpdate:modelValue":e[2]||(e[2]=n=>Fa.value=n),label:"Nombre",required:""},null,8,["modelValue"]),w("div",null,[d(v,{modelValue:et.value,"onUpdate:modelValue":e[3]||(e[3]=n=>et.value=n),label:"Readiness (%)",type:"number",readonly:"",hint:"Calculado automáticamente por el sistema basado en evaluaciones y niveles","persistent-hint":""},null,8,["modelValue"])]),d(m,{modelValue:Da.value,"onUpdate:modelValue":e[4]||(e[4]=n=>Da.value=n),label:"Descripción",rows:"3",style:{"grid-column":`1 /
                                                                    -1`}},null,8,["modelValue"]),e[98]||(e[98]=w("div",{style:{"grid-column":`1 /
                                                                    -1`,"font-weight":"700","margin-top":"6px"}}," Atributos de la relación con la capacidad ",-1)),w("div",null,[d(u,{modelValue:at.value,"onUpdate:modelValue":e[5]||(e[5]=n=>at.value=n),label:"Strategic weight (1-10)",min:1,max:10,step:1,color:"primary",ticks:G,"show-ticks":"always"},null,8,["modelValue","ticks"])]),w("div",null,[d(u,{modelValue:tt.value,"onUpdate:modelValue":e[6]||(e[6]=n=>tt.value=n),label:"Priority (1-5)",min:1,max:5,step:1,color:"orange",ticks:b,"show-ticks":"always"},null,8,["modelValue","ticks"])]),w("div",null,[d(u,{modelValue:lt.value,"onUpdate:modelValue":e[7]||(e[7]=n=>lt.value=n),label:"Required level (1-5)",min:1,max:5,step:1,color:"teal",ticks:D,"show-ticks":"always"},null,8,["modelValue","ticks"])]),d(y,{modelValue:ot.value,"onUpdate:modelValue":e[8]||(e[8]=n=>ot.value=n),label:"Is critical"},null,8,["modelValue"]),d(m,{modelValue:ht.value,"onUpdate:modelValue":e[9]||(e[9]=n=>ht.value=n),label:"Rationale",rows:"2",style:{"grid-column":`1 /
                                                                    -1`}},null,8,["modelValue"])])]),_:1},512)])])):(q(),J("div",jr,[w("div",Wr,[d(r,{small:"",color:"primary",onClick:go},{default:F(()=>[...e[99]||(e[99]=[ee("Crear competencia",-1)])]),_:1},8,["onClick"]),d(r,{small:"",color:"primary",onClick:wo},{default:F(()=>[...e[100]||(e[100]=[ee("Agregar existente",-1)])]),_:1},8,["onClick"]),d(r,{color:"error",onClick:Il,loading:Xe.value},{default:F(()=>[...e[101]||(e[101]=[ee("Eliminar nodo",-1)])]),_:1},8,["loading"]),d(r,{color:"primary",onClick:mo,loading:Xe.value,disabled:Xe.value||$l.value},{default:F(()=>[...e[102]||(e[102]=[ee("Guardar",-1)])]),_:1},8,["loading","disabled"]),d(r,{text:"",color:"primary",onClick:Tt},{default:F(()=>[...e[103]||(e[103]=[ee("Cancelar",-1)])]),_:1})]),w("div",Kr,[d(X,{ref_key:"capForm",ref:nl,onSubmit:e[22]||(e[22]=Fe(()=>{},["prevent"]))},{default:F(()=>[w("div",Zr,[d(v,{modelValue:Sa.value,"onUpdate:modelValue":e[11]||(e[11]=n=>Sa.value=n),label:"Nombre",required:""},null,8,["modelValue"]),w("div",null,[d(u,{modelValue:ca.value,"onUpdate:modelValue":e[12]||(e[12]=n=>ca.value=n),label:"Importancia",min:1,max:3,step:1,color:"primary",ticks:N,"show-ticks":"always"},null,8,["modelValue","ticks"])]),d(I,{modelValue:_e.value,"onUpdate:modelValue":e[13]||(e[13]=n=>_e.value=n),items:["technical","behavioral","strategic"],label:"Tipo"},null,8,["modelValue"]),d(I,{modelValue:Ae.value,"onUpdate:modelValue":e[14]||(e[14]=n=>Ae.value=n),items:["technical","leadership","business","operational"],label:"Categoría"},null,8,["modelValue"]),d(m,{modelValue:_a.value,"onUpdate:modelValue":e[15]||(e[15]=n=>_a.value=n),label:"Descripción",rows:"3",style:{"grid-column":`1 /
                                                                    -1`}},null,8,["modelValue"]),e[104]||(e[104]=w("div",{style:{"grid-column":`1 /
                                                                    -1`,"font-weight":"700","margin-top":"6px"}}," Atributos para el escenario (scenario_capabilities) ",-1)),d(I,{modelValue:Ua.value,"onUpdate:modelValue":e[16]||(e[16]=n=>Ua.value=n),items:De.value,label:"Strategic role"},null,8,["modelValue","items"]),w("div",null,[d(u,{modelValue:Ea.value,"onUpdate:modelValue":e[17]||(e[17]=n=>Ea.value=n),label:"Strategic weight",min:1,max:10,step:1,color:"primary",ticks:G,"show-ticks":"always"},null,8,["modelValue","ticks"])]),w("div",null,[d(u,{modelValue:Ma.value,"onUpdate:modelValue":e[18]||(e[18]=n=>Ma.value=n),label:"Priority (1-5)",min:1,max:5,step:1,color:"orange",ticks:b,"show-ticks":"always"},null,8,["modelValue","ticks"])]),w("div",null,[d(u,{modelValue:Aa.value,"onUpdate:modelValue":e[19]||(e[19]=n=>Aa.value=n),label:"Required level (1-5)",min:1,max:5,step:1,color:"teal",ticks:D,"show-ticks":"always"},null,8,["modelValue","ticks"])]),d(B,{modelValue:Xa.value,"onUpdate:modelValue":e[20]||(e[20]=n=>Xa.value=n),label:"Is critical"},null,8,["modelValue"]),d(m,{modelValue:Ya.value,"onUpdate:modelValue":e[21]||(e[21]=n=>Ya.value=n),label:"Rationale",rows:"2",style:{"grid-column":`1 /
                                                                    -1`}},null,8,["modelValue"])])]),_:1},512)])]))])],64)):(q(),J("div",Jr,[e[111]||(e[111]=w("div",{style:{"font-weight":"700"}}," Escenario ",-1)),w("div",null,[e[105]||(e[105]=w("strong",null,"Nombre:",-1)),ee(" "+ye(h.scenario?.name??"—"),1)]),w("div",null,[e[106]||(e[106]=w("strong",null,"ID:",-1)),ee(" "+ye(h.scenario?.id??"—"),1)]),w("div",null,[e[107]||(e[107]=w("strong",null,"Descripción:",-1)),ee(" "+ye(h.scenario?.description??"—"),1)]),w("div",Qr,[e[108]||(e[108]=w("strong",null,"Estado:",-1)),ee(" "+ye(h.scenario?.status??"—")+" • ",1),e[109]||(e[109]=w("strong",null,"Año fiscal:",-1)),ee(" "+ye(h.scenario?.fiscal_year??"—"),1)]),w("div",ei,[d(r,{small:"",color:"secondary",onClick:e[23]||(e[23]=n=>Vt.value=!Vt.value)},{default:F(()=>[ee(ye(Vt.value?"Ocultar JSON":"Ver JSON crudo"),1)]),_:1}),d(r,{small:"",text:"",onClick:e[24]||(e[24]=()=>{f(h.scenario?.id)})},{default:F(()=>[...e[110]||(e[110]=[ee("Refrescar árbol",-1)])]),_:1})]),Vt.value?(q(),J("div",ai,[w("pre",ti,ye(Ca.value?JSON.stringify(Ca.value,null,2):'No hay datos cargados. Pulsa "Refrescar árbol".'),1)])):ba("",!0)]))]),_:1}),d(Z,null,{default:F(()=>[d(O),d(r,{text:"",onClick:e[25]||(e[25]=n=>Ye.value=!1)},{default:F(()=>[...e[112]||(e[112]=[ee("Cerrar",-1)])]),_:1})]),_:1})]),_:1},8,["class"])]),_:1},8,["modelValue","aria-label"]),d(ce,{modelValue:Na.value,"onUpdate:modelValue":e[33]||(e[33]=n=>Na.value=n),"max-width":"640",transition:"scale-transition"},{default:F(()=>[d(re,{class:na(Ra.value)},{default:F(()=>[d(s,null,{default:F(()=>[...e[113]||(e[113]=[ee("Crear competencia",-1)])]),_:1}),d(le,null,{default:F(()=>[d(X,{onSubmit:e[31]||(e[31]=Fe(()=>{},["prevent"]))},{default:F(()=>[d(v,{modelValue:la.value,"onUpdate:modelValue":e[27]||(e[27]=n=>la.value=n),label:"Nombre",required:""},null,8,["modelValue"]),d(m,{modelValue:It.value,"onUpdate:modelValue":e[28]||(e[28]=n=>It.value=n),label:"Descripción",rows:"3"},null,8,["modelValue"]),d(v,{modelValue:jt.value,"onUpdate:modelValue":e[29]||(e[29]=n=>jt.value=n),label:"Readiness",type:"number"},null,8,["modelValue"]),d(m,{modelValue:ua.value,"onUpdate:modelValue":e[30]||(e[30]=n=>ua.value=n),label:"Skills (coma-separadas)",rows:"2"},null,8,["modelValue"])]),_:1})]),_:1}),d(Z,null,{default:F(()=>[d(O),d(r,{text:"",onClick:e[32]||(e[32]=n=>Na.value=!1)},{default:F(()=>[...e[114]||(e[114]=[ee("Cancelar",-1)])]),_:1}),d(r,{color:"primary",loading:ut.value,onClick:To},{default:F(()=>[...e[115]||(e[115]=[ee("Crear y asociar",-1)])]),_:1},8,["loading"])]),_:1})]),_:1},8,["class"])]),_:1},8,["modelValue"]),d(ce,{modelValue:qa.value,"onUpdate:modelValue":e[40]||(e[40]=n=>qa.value=n),"max-width":"640",transition:"scale-transition"},{default:F(()=>[d(re,{class:na(Ra.value)},{default:F(()=>[d(s,null,{default:F(()=>[...e[116]||(e[116]=[ee("Crear nueva skill",-1)])]),_:1}),d(le,null,{default:F(()=>[vt.value?(q(),Bl(be,{key:0,type:"success",closable:"",class:"mb-4","onClick:close":e[34]||(e[34]=n=>vt.value=null)},{default:F(()=>[ee(ye(vt.value),1)]),_:1})):ba("",!0),ft.value?(q(),Bl(be,{key:1,type:"error",closable:"",class:"mb-4","onClick:close":e[35]||(e[35]=n=>ft.value=null)},{default:F(()=>[ee(ye(ft.value),1)]),_:1})):ba("",!0),d(X,{"data-skill-form":""},{default:F(()=>[d(v,{modelValue:qe.value,"onUpdate:modelValue":e[36]||(e[36]=n=>qe.value=n),label:"Nombre",required:""},null,8,["modelValue"]),d(v,{modelValue:Pa.value,"onUpdate:modelValue":e[37]||(e[37]=n=>Pa.value=n),label:"Categoría"},null,8,["modelValue"]),d(m,{modelValue:Ta.value,"onUpdate:modelValue":e[38]||(e[38]=n=>Ta.value=n),label:"Descripción",rows:"3"},null,8,["modelValue"])]),_:1})]),_:1}),d(Z,null,{default:F(()=>[d(O),d(r,{text:"",onClick:e[39]||(e[39]=n=>qa.value=!1)},{default:F(()=>[...e[117]||(e[117]=[ee("Cerrar",-1)])]),_:1}),d(r,{color:"primary",loading:Zt.value,onClick:oo},{default:F(()=>[...e[118]||(e[118]=[ee("Crear y asociar",-1)])]),_:1},8,["loading"])]),_:1})]),_:1},8,["class"])]),_:1},8,["modelValue"]),d(ce,{modelValue:pt.value,"onUpdate:modelValue":e[43]||(e[43]=n=>pt.value=n),"max-width":"720",transition:"scale-transition"},{default:F(()=>[d(re,{class:na(Ra.value)},{default:F(()=>[d(s,null,{default:F(()=>[...e[119]||(e[119]=[ee("Seleccionar skill existente",-1)])]),_:1}),d(le,null,{default:F(()=>[d(I,{items:da.value,"item-title":"name","item-value":"id",modelValue:Ja.value,"onUpdate:modelValue":e[41]||(e[41]=n=>Ja.value=n),label:"Skill"},null,8,["items","modelValue"]),da.value.length===0?(q(),J("div",li," No se encontraron skills. ")):ba("",!0)]),_:1}),d(Z,null,{default:F(()=>[d(O),d(r,{text:"",onClick:e[42]||(e[42]=n=>pt.value=!1)},{default:F(()=>[...e[120]||(e[120]=[ee("Cancelar",-1)])]),_:1}),d(r,{color:"primary",loading:Jt.value,onClick:ro},{default:F(()=>[...e[121]||(e[121]=[ee("Asociar",-1)])]),_:1},8,["loading"])]),_:1})]),_:1},8,["class"])]),_:1},8,["modelValue"]),d(ce,{modelValue:Va.value,"onUpdate:modelValue":e[57]||(e[57]=n=>Va.value=n),"max-width":"720",transition:"scale-transition"},{default:F(()=>[d(re,{class:na(Ra.value)},{default:F(()=>[d(s,null,{default:F(()=>[...e[122]||(e[122]=[ee("Detalle de la skill",-1)])]),_:1}),d(le,null,{default:F(()=>[Oe.value?(q(),J("div",oi,[w("div",ri,[d(r,{text:"",onClick:e[44]||(e[44]=n=>Va.value=!1)},{default:F(()=>[...e[123]||(e[123]=[ee("Cancelar",-1)])]),_:1}),d(r,{color:"primary",loading:Za.value,onClick:Gl},{default:F(()=>[...e[124]||(e[124]=[ee("Guardar",-1)])]),_:1},8,["loading"]),d(r,{color:"error",loading:Za.value,onClick:e[45]||(e[45]=n=>io(Oe.value))},{default:F(()=>[...e[125]||(e[125]=[ee("Borrar",-1)])]),_:1},8,["loading"])]),w("div",ii,[d(v,{modelValue:mt.value,"onUpdate:modelValue":e[46]||(e[46]=n=>mt.value=n),label:"Nombre",required:""},null,8,["modelValue"]),d(I,{modelValue:Ha.value,"onUpdate:modelValue":e[47]||(e[47]=n=>Ha.value=n),items:["technical","behavioral","domain"],label:"Categoría"},null,8,["modelValue"]),d(I,{modelValue:za.value,"onUpdate:modelValue":e[48]||(e[48]=n=>za.value=n),items:["basic","tactical","strategic"],label:"Nivel de complejidad"},null,8,["modelValue"]),d(v,{modelValue:gt.value,"onUpdate:modelValue":e[49]||(e[49]=n=>gt.value=n),label:"Tag de dominio"},null,8,["modelValue"]),d(I,{modelValue:ja.value,"onUpdate:modelValue":e[50]||(e[50]=n=>ja.value=n),items:["domain","global","local"],label:"Scope"},null,8,["modelValue"]),d(m,{modelValue:yt.value,"onUpdate:modelValue":e[51]||(e[51]=n=>yt.value=n),label:"Descripción",rows:"3",style:{"grid-column":"1 / -1"}},null,8,["modelValue"])]),S.value&&_.value?(q(),J("div",ni,[e[126]||(e[126]=w("div",{style:{"font-weight":"700","margin-bottom":"6px"}}," Atributos de la relación con la competencia ",-1)),w("div",null,[d(u,{modelValue:Be.value,"onUpdate:modelValue":e[52]||(e[52]=n=>Be.value=n),label:"Peso estratégico (1-10)",min:1,max:10,step:1,color:"primary",ticks:G,"show-ticks":"always"},null,8,["modelValue"])]),w("div",si,[w("div",null,[d(u,{modelValue:Oa.value,"onUpdate:modelValue":e[53]||(e[53]=n=>Oa.value=n),label:"Prioridad (1-5)",min:1,max:5,step:1,color:"orange",ticks:b,"show-ticks":"always"},null,8,["modelValue"])]),w("div",null,[d(u,{modelValue:Ia.value,"onUpdate:modelValue":e[54]||(e[54]=n=>Ia.value=n),label:"Nivel requerido (1-5)",min:1,max:5,step:1,color:"teal",ticks:D,"show-ticks":"always"},null,8,["modelValue"])]),w("div",null,[d(B,{modelValue:Ka.value,"onUpdate:modelValue":e[55]||(e[55]=n=>Ka.value=n),color:"success",label:"Es crítica"},null,8,["modelValue"]),d(m,{modelValue:Wa.value,"onUpdate:modelValue":e[56]||(e[56]=n=>Wa.value=n),label:"Justificación",rows:"2",style:{"grid-column":"1 / -1"}},null,8,["modelValue"])])])])):ba("",!0)])):(q(),J("div",ci,"No hay información de la skill."))]),_:1}),d(Z,null,{default:F(()=>[d(O)]),_:1})]),_:1},8,["class"])]),_:1},8,["modelValue"]),d(ce,{modelValue:Ba.value,"onUpdate:modelValue":e[60]||(e[60]=n=>Ba.value=n),"max-width":"640",transition:"scale-transition"},{default:F(()=>[d(re,{class:na(Ra.value)},{default:F(()=>[d(s,null,{default:F(()=>[...e[127]||(e[127]=[ee("Agregar competencia existente",-1)])]),_:1}),d(le,null,{default:F(()=>[d(I,{items:zt.value,"item-title":"name","item-value":"id",modelValue:dt.value,"onUpdate:modelValue":e[58]||(e[58]=n=>dt.value=n),label:"Competencia"},null,8,["items","modelValue"])]),_:1}),d(Z,null,{default:F(()=>[d(O),d(r,{text:"",onClick:e[59]||(e[59]=n=>Ba.value=!1)},{default:F(()=>[...e[128]||(e[128]=[ee("Cancelar",-1)])]),_:1}),d(r,{color:"primary",onClick:Fo},{default:F(()=>[...e[129]||(e[129]=[ee("Agregar",-1)])]),_:1})]),_:1})]),_:1},8,["class"])]),_:1},8,["modelValue"]),d(ce,{modelValue:x.value,"onUpdate:modelValue":e[73]||(e[73]=n=>x.value=n),"max-width":"720",transition:"scale-transition"},{default:F(()=>[d(re,{class:na(Ra.value)},{default:F(()=>[d(s,null,{default:F(()=>[...e[130]||(e[130]=[ee("Crear capacidad",-1)])]),_:1}),d(le,null,{default:F(()=>[w("div",ui,[d(v,{modelValue:c.value,"onUpdate:modelValue":e[61]||(e[61]=n=>c.value=n),label:"NombreXX",required:""},null,8,["modelValue"]),d(I,{modelValue:z.value,"onUpdate:modelValue":e[62]||(e[62]=n=>z.value=n),items:["technical","behavioral","strategic"],label:"Tipo"},null,8,["modelValue"]),d(I,{modelValue:se.value,"onUpdate:modelValue":e[63]||(e[63]=n=>se.value=n),items:["technical","leadership","business","operational"],label:"Categoría"},null,8,["modelValue"]),w("div",null,[d(u,{modelValue:de.value,"onUpdate:modelValue":e[64]||(e[64]=n=>de.value=n),label:"Importancia (1-3):",min:1,max:3,step:1,color:"green",ticks:N,"show-ticks":"always"},null,8,["modelValue"])]),d(m,{modelValue:C.value,"onUpdate:modelValue":e[65]||(e[65]=n=>C.value=n),label:"Descripción",rows:"3",style:{"grid-column":"1 / -1"}},null,8,["modelValue"])]),w("div",di,[e[131]||(e[131]=w("div",{style:{"font-weight":"700","margin-bottom":"6px"}}," Atributos para el escenario (scenario_capabilities) ",-1)),w("div",pi,[d(I,{modelValue:Ce.value,"onUpdate:modelValue":e[66]||(e[66]=n=>Ce.value=n),items:De.value,label:"Strategic role"},null,8,["modelValue","items"]),w("div",null,[d(u,{modelValue:Re.value,"onUpdate:modelValue":e[67]||(e[67]=n=>Re.value=n),label:"Strategic weight (1-10)",min:1,max:10,step:1,color:"primary"},null,8,["modelValue"]),w("div",fi," Valor: "+ye(Re.value??"-"),1)]),w("div",null,[d(u,{modelValue:$e.value,"onUpdate:modelValue":e[68]||(e[68]=n=>$e.value=n),label:"Priority (1-5)",min:1,max:5,step:1,color:"orange"},null,8,["modelValue"]),w("div",vi," Valor: "+ye($e.value??"-"),1)]),w("div",null,[d(u,{modelValue:He.value,"onUpdate:modelValue":e[69]||(e[69]=n=>He.value=n),label:"Required level (1-5)",min:1,max:5,step:1,color:"teal"},null,8,["modelValue"]),w("div",mi," Valor: "+ye(He.value??"-"),1)]),d(y,{modelValue:ka.value,"onUpdate:modelValue":e[70]||(e[70]=n=>ka.value=n),label:"Is critical"},null,8,["modelValue"]),d(m,{modelValue:ea.value,"onUpdate:modelValue":e[71]||(e[71]=n=>ea.value=n),label:"Rationale",rows:"2",style:{"grid-column":"1 / -1"}},null,8,["modelValue"])])])]),_:1}),d(Z,null,{default:F(()=>[d(O),d(r,{text:"",onClick:e[72]||(e[72]=n=>x.value=!1)},{default:F(()=>[...e[132]||(e[132]=[ee("Cancelar",-1)])]),_:1}),d(r,{color:"primary",loading:Ga.value,onClick:ko},{default:F(()=>[...e[133]||(e[133]=[ee("Guardar",-1)])]),_:1},8,["loading"])]),_:1})]),_:1},8,["class"])]),_:1},8,["modelValue"]),U.value.length===0?(q(),J("div",yi," No hay capacidades para mostrar. ")):ba("",!0)])):(q(),J("div",lr,"Cargando mapa..."))],2)])}}}),_i=Uo(wi,[["__scopeId","data-v-60f64f76"]]);export{_i as default};
