import{d as D,r as I,b as i,f as Y,w as O,e as $,p as ee,g as t,s as q,j as T,t as x,c as o,F as U,q as R,i as h,v as te,Q as se,l as L,k as w,M as z,B as Q,S as N,X as M,Y as ae,G as F,m as G,o as ne,Z as le}from"./app-B4Q7DtOZ.js";const ie={class:"flex items-center justify-between px-4 py-2 bg-gray-50 border-b"},oe={class:"flex items-center gap-3"},re={class:"text-lg font-semibold"},de={class:"mb-1"},ue=["innerHTML"],ce={key:0,class:"mt-2"},me={class:"info-example"},pe={class:"px-4 pb-3 flex justify-end"},ve=D({__name:"InfoLegend",props:{modelValue:{type:Boolean,required:!0},title:{type:String,default:"Información"},items:{type:Array,default:()=>[]},icon:{type:String,default:"mdi-information-variant-circle"},width:{type:[String,Number],default:480},stripeColor:{type:String,default:"rgb(var(--v-theme-info))"}},emits:["update:modelValue"],setup(g,{emit:j}){const r=te(()=>"text-2xl text-info-darken-1");return(v,a)=>{const b=I("v-icon"),d=I("v-btn"),f=I("v-card-text"),S=I("v-card"),C=I("v-dialog");return i(),Y(C,{"model-value":g.modelValue,"max-width":"{width}","onUpdate:modelValue":a[2]||(a[2]=_=>v.$emit("update:modelValue",_))},{default:O(()=>[$(S,{class:"rounded-lg shadow-sm",style:ee(`border-left:4px solid ${g.stripeColor}`)},{default:O(()=>[t("div",ie,[t("div",oe,[$(b,{class:q(r.value)},{default:O(()=>[T(x(g.icon),1)]),_:1},8,["class"]),t("div",re,x(g.title),1)]),$(d,{icon:"",variant:"text","aria-label":"Cerrar",onClick:a[0]||(a[0]=_=>v.$emit("update:modelValue",!1))},{default:O(()=>[$(b,null,{default:O(()=>[...a[3]||(a[3]=[T("mdi-close",-1)])]),_:1})]),_:1})]),$(f,{class:"p-4 bg-white",style:{"font-size":"16px","line-height":"1.4"}},{default:O(()=>[(i(!0),o(U,null,R(g.items,(_,y)=>(i(),o("div",{key:y,class:"mb-3"},[t("p",de,[t("strong",null,x(_.title),1),a[4]||(a[4]=T(": ",-1)),t("span",{innerHTML:_.text},null,8,ue)]),_.example?(i(),o("div",ce,[t("pre",me,x(_.example),1)])):h("",!0)]))),128))]),_:1}),t("div",pe,[$(d,{variant:"text",onClick:a[1]||(a[1]=_=>v.$emit("update:modelValue",!1))},{default:O(()=>[...a[5]||(a[5]=[T("Cerrar",-1)])]),_:1})])]),_:1},8,["style"])]),_:1},8,["model-value"])}}}),fe=se("transform",{actions:{async transformCompetency(g,j){return(await L.post(`/api/competencies/${g}/transform`,j)).data.data},async getVersions(g){return(await L.get(`/api/competencies/${g}/versions`)).data.data}}}),ye={class:"bars-editor"},be={key:0,class:"bars-guide"},ge={key:1,class:"bars-example"},_e={class:"mode-toggle"},ke=["disabled"],he=["disabled"],xe={key:2,class:"structured"},Se=["for"],Ve={class:"items"},$e={key:0},Ce=["data-testid","placeholder","onUpdate:modelValue","disabled"],Oe=["onClick"],Ae={key:0,class:"add-row"},we=["data-testid","onClick"],Ne={key:1},je={class:"skill-chips"},Ee={key:0},Be={class:"skill-chip"},Ie={key:1},Me=["data-testid","onUpdate:modelValue","disabled"],Ue=["onClick"],Te=["data-testid","onUpdate:modelValue"],Re={key:0,class:"skill-input-row"},Je=["onKeydown"],qe={key:0,class:"suggestions"},Le=["onClick"],De={key:3,class:"json-mode"},Pe=["disabled"],Qe=D({__name:"BarsEditor",props:{modelValue:{},initialMode:{},readOnly:{type:Boolean}},emits:["update:modelValue"],setup(g,{emit:j}){const r=g,v=j,a=w(r.initialMode??"structured"),b=()=>({behaviour:[],attitude:[],responsibility:[],skills:[]}),d=z(r.modelValue?C(r.modelValue):b()),f=w(JSON.stringify(r.modelValue??d,null,2)),S=w(null);function C(e){if(!e)return b();if(typeof e=="string")try{return JSON.parse(e)}catch{return b()}return{behaviour:Array.isArray(e.behaviour)?e.behaviour.slice():b().behaviour,attitude:Array.isArray(e.attitude)?e.attitude.slice():b().attitude,responsibility:Array.isArray(e.responsibility)?e.responsibility.slice():b().responsibility,skills:Array.isArray(e.skills)?e.skills.map(n=>{if(typeof n=="string")return{name:n};if(!n)return{name:""};const l=n.name??n.label??n.title??"";return{id:n.id,name:typeof l=="string"?l:String(l)}}):b().skills}}Q(()=>r.modelValue,e=>{if(a.value==="json")f.value=JSON.stringify(e??k(),null,2);else{const n=C(e);Object.keys(n).forEach(l=>{d[l]=n[l]})}}),Q(a,e=>{if(e==="json")f.value=JSON.stringify(k(),null,2),S.value=null;else try{const n=JSON.parse(f.value),l=C(n);Object.keys(l).forEach(c=>{d[c]=l[c]}),v("update:modelValue",k()),S.value=null}catch{S.value=null}});function _(){try{const e=JSON.parse(f.value);S.value=null,v("update:modelValue",e)}catch(e){S.value=e&&e.message?String(e.message):"Invalid JSON"}}const y=["behaviour","attitude","responsibility","skills"];function s(e){return e==="behaviour"?"Behaviour":e==="attitude"?"Attitude":e==="responsibility"?"Responsibility":"Skills"}function V(e){d[e].push(""),v("update:modelValue",k())}function E(){d.skills.push({name:""}),v("update:modelValue",k())}function u(e,n){d[e].splice(n,1),v("update:modelValue",k())}function J(){v("update:modelValue",k())}function k(){return{behaviour:d.behaviour.slice(),attitude:d.attitude.slice(),responsibility:d.responsibility.slice(),skills:d.skills.map(e=>e&&e.name?{id:e.id,name:e.name}:{name:String(e)})}}const p=w(""),B=w([]);let P=0;async function K(){const e=String(p.value||"").trim();if(!e){B.value=[];return}const n=++P;try{const l=await L.get("/api/skills",{params:{q:e}});if(n!==P)return;const c=l?.data??l;B.value=Array.isArray(c)?c:c?.data??[]}catch{B.value=[]}}function H(e){e&&(d.skills.push({id:e.id,name:e.name}),p.value="",B.value=[],v("update:modelValue",k()))}function Z(){const e=String(p.value||"").trim();e&&(d.skills.push({name:e}),p.value="",B.value=[],v("update:modelValue",k()))}function W(e){d.skills.splice(e,1),v("update:modelValue",k())}function X(e){return e?typeof e=="string"?e:e.name&&typeof e.name=="string"?e.name:e.label&&typeof e.label=="string"?e.label:e.title&&typeof e.title=="string"?e.title:String(e):""}return(e,n)=>(i(),o("div",ye,[n[6]||(n[6]=t("h4",{class:"bars-title"},"BARS",-1)),r.readOnly?h("",!0):(i(),o("p",be,'BARS = Behaviour, Attitude, Responsibility, Skills. Describe comportamientos observables o evidencias para cada sección. Ejemplo: "Behaviour: Comunica progreso semanalmente".')),r.readOnly?h("",!0):(i(),o("div",ge,[...n[4]||(n[4]=[t("strong",null,"Ejemplo rápido",-1),t("div",{class:"example-line"},"Behaviour: Comunica resultados claramente",-1),t("div",{class:"example-line"},"Attitude: Proactivo",-1),t("div",{class:"example-line"},"Responsibility: Mantener pipelines de datos",-1),t("div",{class:"example-line"},"Skills: SQL, Python",-1)])])),t("div",_e,[t("button",{type:"button",class:q(["mode-btn",{active:a.value==="structured"}]),onClick:n[0]||(n[0]=l=>a.value="structured"),disabled:r.readOnly},"Estructurado",10,ke),t("button",{type:"button",class:q(["mode-btn",{active:a.value==="json"}]),onClick:n[1]||(n[1]=l=>a.value="json"),disabled:r.readOnly},"JSON",10,he)]),a.value==="structured"?(i(),o("div",xe,[(i(),o(U,null,R(y,l=>t("div",{class:"section",key:l},[t("label",{for:l},x(s(l)),9,Se),t("div",Ve,[l!=="skills"?(i(),o("div",$e,[(i(!0),o(U,null,R(d[l],(c,m)=>(i(),o("div",{key:m,class:"item-row"},[N(t("input",{"data-testid":`${l}-${m}`,placeholder:`${s(l)} item ${Number(m)+1}`,"onUpdate:modelValue":A=>d[l][m]=A,onInput:J,disabled:r.readOnly},null,40,Ce),[[M,d[l][m]]]),r.readOnly?h("",!0):(i(),o("button",{key:0,type:"button",class:"remove",onClick:A=>u(l,Number(m))},"Eliminar",8,Oe))]))),128)),r.readOnly?h("",!0):(i(),o("div",Ae,[t("button",{type:"button",class:"add","data-testid":`add-${l}`,onClick:c=>V(l)},"Agregar "+x(s(l)),9,we)]))])):(i(),o("div",Ne,[t("div",je,[(i(!0),o(U,null,R(d.skills,(c,m)=>(i(),o(U,{key:m},[r.readOnly&&c&&c.name?(i(),o("div",Ee,[t("span",Be,x(X(c)),1)])):(i(),o("div",Ie,[N(t("input",{"data-testid":`skills-${m}`,placeholder:"Agregar skill...","onUpdate:modelValue":A=>d.skills[m].name=A,onInput:J,disabled:r.readOnly},null,40,Me),[[M,d.skills[m].name]]),r.readOnly?h("",!0):(i(),o("button",{key:0,type:"button",class:"remove",onClick:A=>W(Number(m))},"Eliminar",8,Ue))])),r.readOnly?h("",!0):N((i(),o("input",{key:2,"data-testid":`skills-hidden-${m}`,"onUpdate:modelValue":A=>d.skills[m].name=A,style:{position:"absolute",left:"-9999px",width:"1px",height:"1px",opacity:"0"},"aria-hidden":"true"},null,8,Te)),[[M,d.skills[m].name]])],64))),128))]),r.readOnly?h("",!0):(i(),o("div",Re,[N(t("input",{"data-testid":"skill-input",placeholder:"Agregar skill...","onUpdate:modelValue":n[2]||(n[2]=c=>p.value=c),onInput:K,onKeydown:ae(F(Z,["prevent"]),["enter"])},null,40,Je),[[M,p.value]]),B.value.length?(i(),o("div",qe,[(i(!0),o(U,null,R(B.value,(c,m)=>(i(),o("div",{key:m,class:"suggestion",onClick:A=>H(c)},x(c.name),9,Le))),128))])):h("",!0)]))]))]),!r.readOnly&&l==="skills"?(i(),o("button",{key:0,type:"button",class:"add","data-testid":"add-skills",onClick:E},"Agregar Skill")):h("",!0)])),64))])):(i(),o("div",De,[n[5]||(n[5]=t("label",null,"JSON",-1)),N(t("textarea",{"data-testid":"json-textarea","onUpdate:modelValue":n[3]||(n[3]=l=>f.value=l),onInput:_,rows:"8",disabled:r.readOnly},null,40,Pe),[[M,f.value]])]))]))}}),ze=G(Qe,[["__scopeId","data-v-2055f958"]]),Fe={class:"transform-modal"},Ge={class:"transform-header"},Ke={key:0,class:"text-sm"},He={class:"guide-toggle-row",style:{display:"flex","justify-content":"space-between","align-items":"center","margin-bottom":"0.5rem"}},Ze={style:{display:"flex",gap:"0.5rem","align-items":"center"}},We={style:{"margin-top":"0.5rem"}},Xe={style:{display:"flex","align-items":"center",gap:"0.5rem"}},Ye={class:"bars-container"},et={class:"modal-footer"},tt={type:"submit",class:"btn-primary"},st=D({__name:"TransformModal",props:{competencyId:{}},emits:["transformed","close"],setup(g,{emit:j}){const r=g,v=j,a=z({name:"",description:"",bars:null,create_skills_incubated:!0}),b=w(!1),d=[{title:"Descripción",text:'¿Para qué sirve esta pantalla?</strong> Para crear o transformar la definición de una competencia asociada a un rol. Al guardar se crea una nueva versión de la competencia (p. ej. 1.0, 1.1) que puede ser referenciada por mappings de roles. Esto permite mantener historial de definiciones y aplicar cambios sin romper referencias existentes. Rellena un <em>Nombre</em> y una <em>Descripción</em> para esta versión. El editor <strong>BARS</strong> contiene cuatro secciones: <strong>Behaviour</strong>, <strong>Attitude</strong>, <strong>Responsibility</strong> y <strong>Skills</strong>. Describe ejemplos concretos y observables (p. ej. "Comunica ideas claramente", "Aplica metodologías ágiles").'},{title:"Consejo",text:"Usa el modo <strong>Estructurado</strong> para editar por secciones o <strong>JSON</strong> si vas a pegar una definición completa. Si estás creando la versión inicial (1.0), piensa en la definición base que usará este rol; si estás transformando, documenta los cambios esperados y evidencias."},{title:"Skills incubadas",text:'Activa "Crear skills en incubación" para que las skills nuevas se creen con estado <code>incubation</code> al crear la versión. Estas aparecerán en el modal principal como "Skills creadas (incubación)" y pueden revisarse antes de cerrar.'},{title:"Ejemplo (JSON)",text:"En este ejemplo la versión define evidencias concretas y una lista de skills relevantes; al crear la versión se guarda esta definición y el mapping del rol puede apuntar a ella. Ejemplo de payload BARS que se guardará en metadata.bars:",example:`{
  "behaviour": ["Comunica resultados claramente","Documenta análisis"],
  "attitude": ["Proactivo","Orientado a detalle"],
  "responsibility": ["Mantener pipelines de datos","Revisar calidad de datos"],
  "skills": ["SQL","Python","ETL"]
}`}],f=w([]),S=w(!1),C=fe();ne(async()=>{S.value=!0;try{const y=await C.getVersions(r.competencyId);f.value=y||[]}catch{}finally{S.value=!1}});async function _(){try{const y=a.bars??null,s=Array.isArray(y?.skills)?y.skills:[],V=s.filter(p=>p&&p.id).map(p=>p.id),E=s.filter(p=>p&&!p.id).map(p=>p.name),u={name:a.name,description:a.description,metadata:{bars:y},create_skills_incubated:a.create_skills_incubated};V.length&&(u.skill_ids=V),E.length&&(u.new_skills=E),console.debug("transform-payload",u);const J=await C.transformCompetency(r.competencyId,u),k=await C.getVersions(r.competencyId);f.value=k||[],v("transformed",J)}catch(y){console.error("transform error",y);const s=y,V=s?.response?.data?.message||s?.response?.data||s?.message;try{alert("Error al transformar: "+(typeof V=="string"?V:JSON.stringify(V)))}catch{alert("Error al transformar")}}}return(y,s)=>{const V=I("v-icon"),E=I("v-btn");return i(),o("div",Fe,[t("form",{onSubmit:F(_,["prevent"])},[t("div",Ge,[t("h3",null,x(f.value.length===0?"Crear versión 1.0":"Transformar competencia"),1),f.value.length>0?(i(),o("p",Ke,"Versiones existentes: "+x(f.value.length),1)):h("",!0)]),t("div",He,[s[9]||(s[9]=t("div",null,[t("strong",null,"Guía rápida"),t("small",{class:"text-sm text-gray-500",style:{"margin-left":"0.5rem"}},"(¿Necesitas más detalle?)")],-1)),t("div",Ze,[s[8]||(s[8]=t("a",{href:"/docs/COMIENZA_AQUI_WORKFORCE_PLANNING.md",target:"_blank",rel:"noopener",class:"text-sm",style:{color:"#1f79ff"}},"Guía completa",-1)),$(E,{variant:"text",size:"small",class:"text-info",title:"ver información",onClick:s[0]||(s[0]=u=>b.value=!0)},{default:O(()=>[$(V,{class:"align-middle text-4xl text-info-darken-1"},{default:O(()=>[...s[7]||(s[7]=[T("mdi-information-variant-circle",-1)])]),_:1})]),_:1}),$(ve,{modelValue:b.value,"onUpdate:modelValue":s[1]||(s[1]=u=>b.value=u),title:"Guía: Transformación / BARS",items:d,icon:"mdi-information-variant-circle"},null,8,["modelValue"])])]),t("div",null,[s[10]||(s[10]=t("label",{for:"transform-name"},"Nombre",-1)),N(t("input",{id:"transform-name","onUpdate:modelValue":s[2]||(s[2]=u=>a.name=u),required:""},null,512),[[M,a.name]])]),t("div",null,[s[11]||(s[11]=t("label",{for:"transform-desc"},"Descripción",-1)),N(t("textarea",{id:"transform-desc","onUpdate:modelValue":s[3]||(s[3]=u=>a.description=u)},null,512),[[M,a.description]])]),t("div",We,[t("label",Xe,[N(t("input",{type:"checkbox","onUpdate:modelValue":s[4]||(s[4]=u=>a.create_skills_incubated=u)},null,512),[[le,a.create_skills_incubated]]),s[12]||(s[12]=t("span",null,"Crear skills en incubación",-1))]),s[13]||(s[13]=t("p",{class:"text-sm text-gray-500",style:{margin:"0.25rem 0 0 1.8rem"}},"Si está activado, las skills nuevas se crearán con estado 'incubation' cuando se cree la versión.",-1))]),t("div",Ye,[$(ze,{modelValue:a.bars,"onUpdate:modelValue":s[5]||(s[5]=u=>a.bars=u),initialMode:"structured",readOnly:!1},null,8,["modelValue"])]),t("div",et,[t("button",{type:"button",class:"btn-secondary",onClick:s[6]||(s[6]=u=>y.$emit("close"))},"Cancelar"),t("button",tt,x(f.value.length===0?"Crear versión 1.0":"Transformar"),1)])],32)])}}}),at=G(st,[["__scopeId","data-v-912e36a8"]]),lt=Object.freeze(Object.defineProperty({__proto__:null,default:at},Symbol.toStringTag,{value:"Module"}));export{at as T,ve as _,lt as a,fe as u};
